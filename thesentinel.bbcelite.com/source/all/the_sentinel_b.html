<?php
include_once("../../templates/template_functions.php");
page_header("all_source", "the_sentinel_b.html", "The Sentinel B source", "The Sentinel B source", "The The Sentinel B source file in The Sentinel", "the_sentinel-index", "source_all_source", "the_sentinel_b", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_a.html">The Sentinel A source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_c.html">The Sentinel C source</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div><div><div class="headerBlockWrapper"><div class="headerBlock"><a id="header-panlandscapeview" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PanLandscapeView</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pan the landscape and update the landscape view</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/panlandscapeview.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#panlandscapeview">PanLandscapeView</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">viewingObject</span>        <span class="argumentEntry">The number of the object that is viewing the landscape</span>
                        <span class="argumentEntry">(this is always the player object for this routine)</span>

</div></div>
<span class="label">.PanLandscapeView</span><a id="panlandscapeview" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ Set Y to the direction of the last pan key that was</span>
                        <span class="comment">\ pressed (which may not still be held down)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this contains the direction of any scrolling that</span>
                        <span class="comment">\ we need to apply to the landscape, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 = pan right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 1 = pan left</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 2 = pan up</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 3 = pan down</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use this as an index into various tables, to look</span>
                        <span class="comment">\ up the correct values for the direction in which we</span>
                        <span class="comment">\ want to scroll</span>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the object number of the viewer, which we set</span>
                        <span class="comment">\ to the player object in MainGameLoop</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ If the panning direction in Y is up or down, jump to</span>
 <span class="mne">BCS</span> <a class="popup destination">lpan3</a>              <span class="comment">\ lpan3 to pan vertically</span>

                        <span class="comment">\ If we get here then Y is 0 or 1 and the panning</span>
                        <span class="comment">\ direction is right or left</span>

 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Rotate the player's gaze so that when we draw the</span>
 <span class="mne">CLC</span>                    <span class="comment">\ updated view, the new part of the landscape that we</span>
 <span class="mne">ADC</span> <a class="popup variable">panAngleToUpdate</a>,<span class="register">Y</span> <span class="comment">\ need to scroll in from the side goes into the screen</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ buffer (as the screen buffer is mapped to the left</span>
                        <span class="comment">\ portion of the view that we are drawing)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">25</span>                <span class="comment">\ Set A = 25 to pass to FillScreen, so we fill the</span>
                        <span class="comment">\ screen buffer (as opposed to screen memory)</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">24</span>                <span class="comment">\ Set Y = 24 to pass to FillScreen, so we fill 24</span>
                        <span class="comment">\ character rows of the screen buffer</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">16</span>                <span class="comment">\ Set X = 16 to pass to FillScreen, so we fill 16</span>
                        <span class="comment">\ character columns in the screen buffer</span>

 <span class="mne">STX</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Set bufferColumns to 16 so we can refer to the buffer</span>
                        <span class="comment">\ width during the drawing process</span>

 <span class="mne">JSR</span> <a class="popup destination">FillScreen</a>         <span class="comment">\ Call FillScreen to fill the screen buffer with the</span>
                        <span class="comment">\ background specified in screenBackground</span>
                        <span class="comment">\</span>
                        <span class="comment">\ screenBackground variable is zeroed in DrawTitleView</span>
                        <span class="comment">\ before the gameplay starts, so all calls to the</span>
                        <span class="comment">\ FillScreen routine during gameplay fill the buffer</span>
                        <span class="comment">\ with alternating colour 0/1 (blue/black) pixel rows,</span>
                        <span class="comment">\ for the sky</span>

 <span class="mne">JSR</span> <a class="popup destination">UseColumnBuffer</a>    <span class="comment">\ Configure the column buffer for use so we draw the</span>
                        <span class="comment">\ updated part of the landscape view into the correct</span>
                        <span class="comment">\ buffer type for a left or right pan</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeView</a>  <span class="comment">\ Draw the landscape view into the screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the player held down the panning key throughout the</span>
                        <span class="comment">\ drawing process and the whole landscape was drawn,</span>
                        <span class="comment">\ then the C flag will be clear, otherwise the C flag</span>
                        <span class="comment">\ will be set</span>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the object number of the viewer, which we set</span>
                        <span class="comment">\ to the player object in MainGameLoop</span>

 <span class="mne">LDY</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ Set Y to the direction of the last pan key that was</span>
                        <span class="comment">\ pressed (which may not still be held down)</span>

 <span class="mne">BCS</span> <a class="popup destination">lpan2</a>              <span class="comment">\ If the call to DrawLandscapeView set the C flag then</span>
                        <span class="comment">\ the landscape drawing process was aborted, so jump to</span>
                        <span class="comment">\ lpan2 to revert the change to the player's yaw angle</span>
                        <span class="comment">\ and return from the subroutine without updating the</span>
                        <span class="comment">\ on-screen landscape view</span>

 <span class="mne">BNE</span> <a class="popup destination">lpan1</a>              <span class="comment">\ If Y &lt;> 0 then Y must be 1, in which case the pan</span>
                        <span class="comment">\ angle we fetched from the panAngleToUpdate table</span>
                        <span class="comment">\ doesn't need correcting, so jump to lpan1 to skip the</span>
                        <span class="comment">\ following</span>

                        <span class="comment">\ If we get here then Y = 0, so we added 20 to the</span>
                        <span class="comment">\ player's yaw angle so it would draw the new part of</span>
                        <span class="comment">\ the view into the screen buffer, so we now need to</span>
                        <span class="comment">\ subtract 12 from the player's yaw angle so they end up</span>
                        <span class="comment">\ looking in the correct direction, i.e. a net rotation</span>
                        <span class="comment">\ of +8 rather than +20 yaw angles</span>

 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Subtract 12 from the player's yaw angle</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">12</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>

<span class="label">.lpan1</span><a id="lpan1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">16</span>                <span class="comment">\ We now need to scroll the contents of the screen</span>
 <span class="mne">JSR</span> <a class="popup destination">StartScrollingView</a> <span class="comment">\ buffer into the side of the on-screen landscape view,</span>
                        <span class="comment">\ so call StartScrollingView to configure a background</span>
                        <span class="comment">\ task to scroll 16 character columns from the screen</span>
                        <span class="comment">\ buffer onto the screen, using the interrupt handler</span>
                        <span class="comment">\ to do it in the background</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.lpan2</span><a id="lpan2" class="anchor"></a>

                        <span class="comment">\ If we get here then the panning process was aborted</span>
                        <span class="comment">\ before the landscape was drawn</span>

 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Reverse the rotation that we applied to the player's</span>
 <span class="mne">SEC</span>                    <span class="comment">\ yaw angle for the pan, so this puts it back to the</span>
 <span class="mne">SBC</span> <a class="popup variable">panAngleToUpdate</a>,<span class="register">Y</span> <span class="comment">\ value it had before we started the panning process</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.lpan3</span><a id="lpan3" class="anchor"></a>

                        <span class="comment">\ If we get here then Y is 2 or 3 and the panning</span>
                        <span class="comment">\ direction is up or down</span>

 <span class="mne">LDA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span>     <span class="comment">\ If the player's pitch angle is equal to either</span>
 <span class="mne">CMP</span> <a class="popup variable">highestPitchAngle</a><span class="operator">-</span><span class="decimal">2</span>,<span class="register">Y</span>  <span class="comment">\ highestPitchAngle (if we are panning up) or</span>
 <span class="mne">BEQ</span> <a class="popup destination">lpan6</a>                  <span class="comment">\ lowestPitchAngle (if we are panning down) then the</span>
                            <span class="comment">\ player is already pitched as far back or down as</span>
                            <span class="comment">\ possible, so jump to lpan6 to return from the</span>
                            <span class="comment">\ subroutine without panning the landscape view, as</span>
                            <span class="comment">\ we can't pan any further</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Rotate the player's gaze so that when we draw the</span>
 <span class="mne">ADC</span> <a class="popup variable">panAngleToUpdate</a>,<span class="register">Y</span> <span class="comment">\ updated view, the new part of the landscape that we</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span> <span class="comment">\ need to scroll in from above or below goes into the</span>
                        <span class="comment">\ screen buffer (as the screen buffer is mapped to the</span>
                        <span class="comment">\ top portion of the view that we are drawing)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">25</span>                <span class="comment">\ Set A = 25 to pass to FillScreen, so we fill the</span>
                        <span class="comment">\ screen buffer (as opposed to screen memory)</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set Y = 8 to pass to FillScreen, so we fill 8</span>
                        <span class="comment">\ character rows of the screen buffer</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">40</span>                <span class="comment">\ Set X = 40 to pass to FillScreen, so we fill 40</span>
                        <span class="comment">\ character columns in the screen buffer</span>

 <span class="mne">STX</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Set bufferColumns to 40 so we can refer to the buffer</span>
                        <span class="comment">\ width during the drawing process</span>

 <span class="mne">JSR</span> <a class="popup destination">FillScreen</a>         <span class="comment">\ Call FillScreen to fill the screen buffer with the</span>
                        <span class="comment">\ background specified in screenBackground</span>
                        <span class="comment">\</span>
                        <span class="comment">\ screenBackground variable is zeroed in DrawTitleView</span>
                        <span class="comment">\ before the gameplay starts, so all calls to the</span>
                        <span class="comment">\ FillScreen routine during gameplay fill the buffer</span>
                        <span class="comment">\ with alternating colour 0/1 (blue/black) pixel rows,</span>
                        <span class="comment">\ for the sky</span>

 <span class="mne">JSR</span> <a class="popup destination">UseRowBuffer</a>       <span class="comment">\ Configure the row buffer for use so we draw the</span>
                        <span class="comment">\ updated part of the landscape view into the correct</span>
                        <span class="comment">\ buffer type for an up or down pan</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeView</a>  <span class="comment">\ Draw the landscape view into the screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the player held down the panning key throughout the</span>
                        <span class="comment">\ drawing process and the whole landscape was drawn,</span>
                        <span class="comment">\ then the C flag will be clear, otherwise the C flag</span>
                        <span class="comment">\ will be set</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set X to the object number of the player</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This should really be an LDX viewingObject instruction</span>
                        <span class="comment">\ to be consistent with the rest of the routine, but it</span>
                        <span class="comment">\ doesn't make any difference as they are the same at</span>
                        <span class="comment">\ this point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Perhaps at some point this routine allowed panning of</span>
                        <span class="comment">\ the view from viewing objects other than the player,</span>
                        <span class="comment">\ which would have been interesting...</span>

 <span class="mne">LDY</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ Set Y to the direction of the last pan key that was</span>
                        <span class="comment">\ pressed (which may not still be held down)</span>

 <span class="mne">BCS</span> <a class="popup destination">lpan7</a>              <span class="comment">\ If the call to DrawLandscapeView set the C flag then</span>
                        <span class="comment">\ the landscape drawing process was aborted, so jump to</span>
                        <span class="comment">\ lpan7 to revert the change to the player's pitch angle</span>
                        <span class="comment">\ and return from the subroutine without updating the</span>
                        <span class="comment">\ on-screen landscape view</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ If Y &lt;> 3 then Y must be 2, in which case the pan</span>
 <span class="mne">BNE</span> <a class="popup destination">lpan4</a>              <span class="comment">\ angle we fetched from the panAngleToUpdate table</span>
                        <span class="comment">\ doesn't need correcting, so jump to lpan4 to skip the</span>
                        <span class="comment">\ following</span>

                        <span class="comment">\ If we get here then Y = 3, so we subtracted 12 from</span>
                        <span class="comment">\ the player's pitch angle so it would draw the new part</span>
                        <span class="comment">\ of the view into the screen buffer, so we now need to</span>
                        <span class="comment">\ add 8 to the player's pitch angle so they end up</span>
                        <span class="comment">\ looking in the correct direction, i.e. a net rotation</span>
                        <span class="comment">\ of -4 rather than -12 pitch angles</span>

 <span class="mne">LDA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span> <span class="comment">\ Add 8 to the player's pitch angle</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">8</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span>

<span class="label">.lpan4</span><a id="lpan4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ We now need to scroll the contents of the screen</span>
 <span class="mne">JSR</span> <a class="popup destination">StartScrollingView</a> <span class="comment">\ buffer into the top or bottom of the on-screen</span>
                        <span class="comment">\ landscape view, so call StartScrollingView to</span>
                        <span class="comment">\ configure a background task to scroll 8 character rows</span>
                        <span class="comment">\ from the screen buffer onto the screen, using the</span>
                        <span class="comment">\ interrupt handler to do it in the background</span>

<span class="label">.lpan5</span><a id="lpan5" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">SetColumnBufferMax</a> <span class="comment">\ Call SetColumnBufferMax to set the maximum and minimum</span>
                        <span class="comment">\ pitch angles for the column buffer</span>

<span class="label">.lpan6</span><a id="lpan6" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.lpan7</span><a id="lpan7" class="anchor"></a>

                        <span class="comment">\ If we get here then the panning process was aborted</span>
                        <span class="comment">\ before the landscape was drawn</span>

 <span class="mne">LDA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span> <span class="comment">\ Reverse the rotation that we applied to the player's</span>
 <span class="mne">SEC</span>                    <span class="comment">\ pitch angle for the pan, so this puts it back to the</span>
 <span class="mne">SBC</span> <a class="popup variable">panAngleToUpdate</a>,<span class="register">Y</span> <span class="comment">\ value it had before we started the panning process</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span>

 <span class="mne">JMP</span> <a class="popup destination">lpan5</a>              <span class="comment">\ Jump to SetColumnBufferMax via lpan5 to set the</span>
                        <span class="comment">\ maximum and minimum pitch angles for the column buffer</span>
                        <span class="comment">\ and return from the subroutine via a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-highestpitchangle" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">highestPitchAngle</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sights</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The pitch angle of the highest point that the player can look at</span>
             <span class="headerEntry">with the sights</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/highestpitchangle.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/movesightsupdown.html">MoveSightsUpDown</a> uses <a href="#highestpitchangle">highestPitchAngle</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> uses <a href="#highestpitchangle">highestPitchAngle</a></span>
</div>
</div></div>
<span class="label">.highestPitchAngle</span><a id="highestpitchangle" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">53</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-lowestpitchangle" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">lowestPitchAngle</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sights</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The pitch angle of the lowest point that the player can look at</span>
             <span class="headerEntry">with the sights</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/lowestpitchangle.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/movesightsupdown.html">MoveSightsUpDown</a> uses <a href="#lowestpitchangle">lowestPitchAngle</a></span>
</div>
</div></div>
<span class="label">.lowestPitchAngle</span><a id="lowestpitchangle" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">-51</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-resetvariables" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ResetVariables</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main title Loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Reset all the game's main variables</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/resetvariables.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#resetvariables">ResetVariables</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#resetvariables">ResetVariables</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/secretcodeerror.html">SecretCodeError</a> calls <a href="#resetvariables">ResetVariables</a></span>
</div>
</div></div>
<span class="label">.ResetVariables</span><a id="resetvariables" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of gameInProgress to indicate that a game is</span>
 <span class="mne">ROR</span> <a class="popup variable">gameInProgress</a>     <span class="comment">\ not currently in progress and that we are in the title</span>
                        <span class="comment">\ and preview screens (so the interrupt handler doesn't</span>
                        <span class="comment">\ update the game)</span>

                        <span class="comment">\ We now zero the following variable blocks:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0000 to &008F (Zero page workspace)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0100 to &01BF (Stack variables workspace)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0900 to &09EF (xObject)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0A00 to &0AEF (yObjectLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0C00 to &0CE3 (Main variable workspace)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and set the following variable block to %10000000:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0CE4 to &0CEF (Main variable workspace)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set X to use as a byte counter to run from 0 to &EF</span>

<span class="label">.rese1</span><a id="rese1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so we can zero the following variable blocks</span>

 <span class="mne">STA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ Zero the X-th byte of xObject</span>

 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\ Zero the X-th byte of yObjectLo</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&90</span>               <span class="comment">\ If X >= &90 then skip the following instruction</span>
 <span class="mne">BCS</span> <a class="popup destination">rese2</a>

 <span class="mne">STA</span> <span class="hex">&0000</span>,<span class="register">X</span>            <span class="comment">\ Zero the X-th byte of zero page</span>

<span class="label">.rese2</span><a id="rese2" class="anchor"></a>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&C0</span>               <span class="comment">\ If X >= &C0 then skip the following instruction</span>
 <span class="mne">BCS</span> <a class="popup destination">rese3</a>

 <span class="mne">STA</span> <span class="hex">&0100</span>,<span class="register">X</span>            <span class="comment">\ Zero the X-th byte of &0100</span>

<span class="label">.rese3</span><a id="rese3" class="anchor"></a>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&E4</span>               <span class="comment">\ If X &lt; &E4 then skip the following instruction,</span>
 <span class="mne">BCC</span> <a class="popup destination">rese4</a>              <span class="comment">\ leaving A = 0, so we zero &0C00 to &0CE3</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ If we get here then X >= &E4, so set A = %10000000 to</span>
                        <span class="comment">\ set bit 7 of &0CE4 to &0CEF</span>

<span class="label">.rese4</span><a id="rese4" class="anchor"></a>

 <span class="mne">STA</span> <span class="hex">&0C00</span>,<span class="register">X</span>            <span class="comment">\ Set the X-th byte of &0CE4 to A</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the byte counter</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&F0</span>               <span class="comment">\ Loop back until we have processed X from &E4 to &EF</span>
 <span class="mne">BCC</span> <a class="popup destination">rese1</a>              <span class="comment">\ to set &0CE4 to &0CEF to &80</span>

                        <span class="comment">\ Fall through into ResetTilesObjects to reset the tile</span>
                        <span class="comment">\ visibility table and deallocate all object numbers</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-resettilesobjects" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ResetTilesObjects</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main title Loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Reset the tile visibility table and deallocate all object numbers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/resettilesobjects.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#resettilesobjects">ResetTilesObjects</a></span>
</div>
</div></div>
<span class="label">.ResetTilesObjects</span><a id="resettilesobjects" class="anchor"></a>

                        <span class="comment">\ We now set the following variable block to %11111111</span>
                        <span class="comment">\ to indicate that all tiles are visible:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileVisibility to tileVisibility+127</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the following variable block to %10000000 to</span>
                        <span class="comment">\ deallocate all the object numbers:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * objectFlags to objectFlags+63</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set X to use as a byte counter to run from 63 to 0,</span>
                        <span class="comment">\ so we can initialise the 64-byte objectFlags table and</span>
                        <span class="comment">\ the 128-byte tileVisibility table</span>

<span class="label">.resv1</span><a id="resv1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ Set the X-th and X+64-th bytes of tileVisibility to</span>
 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a>,<span class="register">X</span>   <span class="comment">\ all set bits, to indicate visible tiles</span>
 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a><span class="operator">+</span><span class="decimal">64</span>,<span class="register">X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of the X-th byte of objectFlags, to denote</span>
 <span class="mne">STA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ that object #X is not allocated to an object</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">resv1</a>              <span class="comment">\ Loop back until we have processed X from &3F to 0</span>

 <span class="mne">INC</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ Set bit 16 of the five-byte linear feedback shift</span>
                        <span class="comment">\ register in seedNumberLFSR(4 3 2 1 0), as we need a</span>
                        <span class="comment">\ non-zero element for the seed number generator to</span>
                        <span class="comment">\ work (as otherwise the EOR feedback will not affect</span>
                        <span class="comment">\ the contents of the shift register and it won't start</span>
                        <span class="comment">\ generating non-zero numbers)</span>

 <span class="mne">JSR</span> <a class="popup destination">SetColumnBufferMax</a> <span class="comment">\ Call SetColumnBufferMax to set the maximum and minimum</span>
                        <span class="comment">\ pitch angles for the column buffer</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checkforkeypresses" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckForKeyPresses</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Check for various game key presses and update the key logger and</span>
             <span class="headerEntry">relevant variables (during the interrupt handler)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checkforkeypresses.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/irqhandler.html">IRQHandler</a> calls <a href="#checkforkeypresses">CheckForKeyPresses</a></span>
</div>
</div></div>
<span class="label">.CheckForKeyPresses</span><a id="checkforkeypresses" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of panKeyBeingPressed to indicate that no</span>
 <span class="mne">STA</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ pan key is being pressed (we will update this below</span>
                        <span class="comment">\ if a pan key is being pressed)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&8E</span>               <span class="comment">\ Scan the keyboard to see if function key f1 is being</span>
 <span class="mne">JSR</span> <a class="popup destination">ScanKeyboard</a>       <span class="comment">\ pressed ("Quit game")</span>

 <span class="mne">BNE</span> <a class="popup destination">ckey1</a>              <span class="comment">\ If function key f1 is not being pressed, jump to ckey1</span>
                        <span class="comment">\ to skip the following</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Function key f1 is not being pressed, which quits the</span>
 <span class="mne">ROR</span> <a class="popup variable">quitGame</a>           <span class="comment">\ game, so set bit 7 of quitGame so that when we return</span>
                        <span class="comment">\ to the start of the main game loop it jumps to the</span>
                        <span class="comment">\ main title loop to restart the game</span>

<span class="label">.ckey1</span><a id="ckey1" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&9D</span>               <span class="comment">\ Scan the keyboard to see if SPACE is being pressed</span>
 <span class="mne">JSR</span> <a class="popup destination">ScanKeyboard</a>       <span class="comment">\ ("Toggle sights on/off")</span>

 <span class="mne">BNE</span> <a class="popup destination">ckey4</a>              <span class="comment">\ If SPACE is not being pressed, jump to ckey4 to reset</span>
                        <span class="comment">\ the value of spaceKeyDebounce to flag that SPACE is</span>
                        <span class="comment">\ not being pressed</span>

                        <span class="comment">\ If we get here then SPACE is being pressed</span>

 <span class="mne">LDA</span> <a class="popup variable">spaceKeyDebounce</a>   <span class="comment">\ If spaceKeyDebounce is non-zero then we have already</span>
 <span class="mne">BNE</span> <a class="popup destination">ckey6</a>              <span class="comment">\ toggled the sights but the player is still holding</span>
                        <span class="comment">\ down SPACE, so jump to ckey6 to avoid toggling the</span>
                        <span class="comment">\ sights again</span>

 <span class="mne">LDA</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ Flip bit 7 of sightsAreVisible to toggle the sights on</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ and off</span>
 <span class="mne">STA</span> <a class="popup variable">sightsAreVisible</a>

 <span class="mne">BPL</span> <a class="popup destination">ckey2</a>              <span class="comment">\ If bit 7 is now clear then we just turned the sights</span>
                        <span class="comment">\ off, so jump to ckey2 to remove them from the screen</span>

                        <span class="comment">\ Otherwise bit 7 is now set, so we need to show the</span>
                        <span class="comment">\ sights</span>

 <span class="mne">JSR</span> <a class="popup destination">InitialiseSights</a>   <span class="comment">\ Initialise the variables used to manage the sights, so</span>
                        <span class="comment">\ the sights appear in the middle of the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawSights</a>         <span class="comment">\ Draw the sights on the screen</span>

 <span class="mne">JMP</span> <a class="popup destination">ckey3</a>              <span class="comment">\ Jump to ckey3 to skip the following</span>

<span class="label">.ckey2</span><a id="ckey2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">RemoveSights</a>       <span class="comment">\ Remove the sights from the screen</span>

<span class="label">.ckey3</span><a id="ckey3" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of A to store in spaceKeyDebounce, to flag</span>
                        <span class="comment">\ that we have toggled the sights (so we can make sure</span>
                        <span class="comment">\ we don't keep toggling the sights if SPACE is being</span>
                        <span class="comment">\ held down)</span>

 <span class="mne">BNE</span> <a class="popup destination">ckey5</a>              <span class="comment">\ Jump to ckey5 to set spaceKeyDebounce to the value of</span>
                        <span class="comment">\ A in (this BNE is effectively a JMP as A is never</span>
                        <span class="comment">\ zero)</span>

<span class="label">.ckey4</span><a id="ckey4" class="anchor"></a>

                        <span class="comment">\ If we get here then SPACE is not being pressed</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Clear bit 7 of spaceKeyDebounce to record that SPACE</span>
                        <span class="comment">\ is not being pressed</span>

<span class="label">.ckey5</span><a id="ckey5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">spaceKeyDebounce</a>   <span class="comment">\ Set spaceKeyDebounce to the value of A, so we record</span>
                        <span class="comment">\ whether or not SPACE is being pressed to make sure</span>
                        <span class="comment">\ we don't keep toggling the sights if SPACE is held</span>
                        <span class="comment">\ down</span>

<span class="label">.ckey6</span><a id="ckey6" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">14</span>                <span class="comment">\ Scan the keyboard for all 14 game keys in the gameKeys</span>
 <span class="mne">JSR</span> <a class="popup destination">ScanForGameKeys</a>    <span class="comment">\ table</span>

 <span class="mne">BPL</span> <a class="popup destination">ckey7</a>              <span class="comment">\ ScanForGameKeys will clear bit 7 of the result if at</span>
                        <span class="comment">\ least one pan key is being pressed, in which case jump</span>
                        <span class="comment">\ to ckey7 to skip the following, so pan keys take</span>
                        <span class="comment">\ precedence over the other game keys (which are ignored</span>
                        <span class="comment">\ while panning is taking place)</span>

                        <span class="comment">\ If we get here then no pan keys are being pressed</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01101011</span>         <span class="comment">\ Set a bit pattern in sightsInitialMoves to control the</span>
 <span class="mne">STA</span> <a class="popup variable">sightsInitialMoves</a> <span class="comment">\ initial movement of the sights when a pan key is</span>
                        <span class="comment">\ pressed and held down</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, this value is shifted left once on each</span>
                        <span class="comment">\ call to this routine, with a zero shifted into bit 0,</span>
                        <span class="comment">\ and we only move the sights when a zero is shifted out</span>
                        <span class="comment">\ of bit 7</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that when we start moving the sights, they</span>
                        <span class="comment">\ move like this, with each step happening on one call</span>
                        <span class="comment">\ of the interrupt handler:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   0 = Move</span>
                        <span class="comment">\   1 = Pause</span>
                        <span class="comment">\   1 = Pause</span>
                        <span class="comment">\   0 = Move</span>
                        <span class="comment">\   1 = Pause</span>
                        <span class="comment">\   0 = Move</span>
                        <span class="comment">\   1 = Pause</span>
                        <span class="comment">\   1 = Pause</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ...and then we move on every subsequent shift, as by</span>
                        <span class="comment">\ now all bits of sightsInitialMoves are clear</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means the sights move more slowly at the start,</span>
                        <span class="comment">\ with a slight judder, before speeding up fully after</span>
                        <span class="comment">\ eight steps (so this applies a bit of inertia to the</span>
                        <span class="comment">\ movement of the sights)</span>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">1</span>        <span class="comment">\ Set A to the key logger entry for "A", "Q", "R", "T",</span>
                        <span class="comment">\ "B", "H", or "U" (absorb, transfer, create robot,</span>
                        <span class="comment">\ create tree, create boulder, hyperspace, U-turn)</span>

 <span class="mne">BPL</span> <a class="popup destination">FocusOnKeyAction</a>   <span class="comment">\ If there is a key press in the key logger entry, jump</span>
                        <span class="comment">\ to FocusOnKeyAction to start focusing effort on</span>
                        <span class="comment">\ implementing the relevant action after returning from</span>
                        <span class="comment">\ the subroutine using a tail call</span>

                        <span class="comment">\ If we get here then the player is not pressing "A",</span>
                        <span class="comment">\ "Q", "R", "T", "B", "H", or "U" (absorb, transfer,</span>
                        <span class="comment">\ create robot, create tree, create boulder, hyperspace,</span>
                        <span class="comment">\ U-turn)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ Set bit 6 of uTurnStatus so that when the "U" key is</span>
 <span class="mne">STA</span> <a class="popup variable">uTurnStatus</a>        <span class="comment">\ next pressed, this will trigger a U-turn in the</span>
                        <span class="comment">\ ProcessActionKeys routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This implements debounce so that holding down "U" will</span>
                        <span class="comment">\ not continuously perform U-turns, and instead the</span>
                        <span class="comment">\ player has to release "U" before they can do a second</span>
                        <span class="comment">\ U-turn</span>
                        <span class="comment">\</span>
                        <span class="comment">\ A U-turn is only performed in ProcessActionKeys when</span>
                        <span class="comment">\ bit 6 of uTurnStatus is set, at which point bit 6 is</span>
                        <span class="comment">\ cleared, and this is the only place where bit 6 is</span>
                        <span class="comment">\ set, so this ensures only one U-turn is performed</span>
                        <span class="comment">\ until we get here again, when "U" has been released</span>

 <span class="mne">BNE</span> <a class="popup destination">focu1</a>              <span class="comment">\ Jump to focu1 to return from the subroutine (this BNE</span>
                        <span class="comment">\ is effectively a JMP as A is never zero)</span>

<span class="label">.ckey7</span><a id="ckey7" class="anchor"></a>

                        <span class="comment">\ If we get here then at least one pan key is being</span>
                        <span class="comment">\ pressed</span>

 <span class="mne">LDX</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ If bit 7 of sightsAreVisible is clear then the sights</span>
 <span class="mne">BPL</span> <a class="popup destination">ckey8</a>              <span class="comment">\ are not being shown, so jump to ckey8 to skip the</span>
                        <span class="comment">\ following, as we don't need to move the sights when</span>
                        <span class="comment">\ they aren't on-screen</span>

                        <span class="comment">\ If we get here then the sights are visible, so the pan</span>
                        <span class="comment">\ keys move the sights rather than panning the view</span>

 <span class="mne">ASL</span> <a class="popup variable">sightsInitialMoves</a> <span class="comment">\ Shift sightsInitialMoves to the left, so we pull the</span>
                        <span class="comment">\ next bit from the pattern that determines the initial</span>
                        <span class="comment">\ movement of the sights</span>

 <span class="mne">BCS</span> <a class="popup destination">focu1</a>              <span class="comment">\ If we shifted a 1 out of bit 7 of sightsInitialMoves,</span>
                        <span class="comment">\ jump to focu1 to return from the subroutine without</span>
                        <span class="comment">\ moving the sights, as a set bit indicates a pause in</span>
                        <span class="comment">\ the initial movement of the sights</span>

 <span class="mne">JSR</span> <a class="popup destination">MoveSights</a>         <span class="comment">\ Move the sights according to the pan key presses in</span>
                        <span class="comment">\ the key logger</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the player moves the sights off the edge of the</span>
                        <span class="comment">\ screen, this routine will set panKeyBeingPressed to</span>
                        <span class="comment">\ "press" the relevant pan key so that the screen</span>
                        <span class="comment">\ scrolls in the same direction to bring the sights</span>
                        <span class="comment">\ back into view</span>

 <span class="mne">JMP</span> <a class="popup destination">ckey10</a>             <span class="comment">\ Jump to ckey10 to process any pan "key press" from the</span>
                        <span class="comment">\ call to MoveSights</span>

<span class="label">.ckey8</span><a id="ckey8" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a>          <span class="comment">\ Set A to the key logger entry for "S" and "D" (pan</span>
                        <span class="comment">\ left, pan right), which are used to move the sights</span>

 <span class="mne">BPL</span> <a class="popup destination">ckey9</a>              <span class="comment">\ If there is a key press in the key logger entry, jump</span>
                        <span class="comment">\ to ckey9 to store this value in panKeyBeingPressed (so</span>
                        <span class="comment">\ panning left or right takes precedence over panning up</span>
                        <span class="comment">\ or down)</span>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">2</span>        <span class="comment">\ Set A to the key logger entry for "L" and "," (pan</span>
                        <span class="comment">\ up, pan down), which are used to move the sights</span>

 <span class="mne">BMI</span> <a class="popup destination">focu1</a>              <span class="comment">\ If there is no key press in the key logger entry then</span>
                        <span class="comment">\ no pan keys are being pressed, so jump to focu1 to</span>
                        <span class="comment">\ return from the subroutine without recording a pan key</span>
                        <span class="comment">\ press in panKeyBeingPressed</span>

<span class="label">.ckey9</span><a id="ckey9" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ Set panKeyBeingPressed to the key logger value of the</span>
                        <span class="comment">\ pan key that's being pressed, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 = pan right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 1 = pan left</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 2 = pan up</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 3 = pan down</span>

<span class="label">.ckey10</span><a id="ckey10" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ If bit 7 of panKeyBeingPressed is set then no pan keys</span>
 <span class="mne">BMI</span> <a class="popup destination">focu1</a>              <span class="comment">\ are being pressed, so jump to focu1 to return from the</span>
                        <span class="comment">\ subroutine</span>

 <span class="mne">STA</span> <a class="popup variable">latestPanKeyPress</a>  <span class="comment">\ Set latestPanKeyPress to the key logger value of the</span>
                        <span class="comment">\ pan key that's being pressed, so it contains the most</span>
                        <span class="comment">\ recent pan key press (i.e. the current one)</span>

                        <span class="comment">\ Fall through into FocusOnKeyAction to start focusing</span>
                        <span class="comment">\ effort on the pan that the player wants us to do</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-focusonkeyaction" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">FocusOnKeyAction</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Tell the game to start focusing effort on the action that has been</span>
             <span class="headerEntry">initiated, such as a pan of the landscape, absorb, transfer etc.</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/focusonkeyaction.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> calls <a href="#focusonkeyaction">FocusOnKeyAction</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/performhyperspace.html">PerformHyperspace</a> calls <a href="#focusonkeyaction">FocusOnKeyAction</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_1_of_2.html">ProcessActionKeys (Part 1 of 2)</a> calls <a href="#focusonkeyaction">FocusOnKeyAction</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#focusonkeyaction">FocusOnKeyAction</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> calls via <a href="#focu1">focu1</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">focu1</span>                <span class="argumentEntry">Store the current setting of focusOnKeyAction in the</span>
                        <span class="argumentEntry">previousFocus variable so we can detect (in the</span>
                        <span class="argumentEntry">ProcessGameplay routine) whether the player is still</span>
                        <span class="argumentEntry">holding down a pan key after we finish scrolling the</span>
                        <span class="argumentEntry">screen for the previous pan... and then return from the</span>
                        <span class="argumentEntry">subroutine</span>

</div></div>
<span class="label">.FocusOnKeyAction</span><a id="focusonkeyaction" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of focusOnKeyAction to tell the game to</span>
 <span class="mne">STA</span> <a class="popup variable">focusOnKeyAction</a>   <span class="comment">\ focus effort on implementing the key action that has</span>
                        <span class="comment">\ just been initiated, such as a pan of the landscape</span>
                        <span class="comment">\ view, absorb, transfer and so on</span>

 <span class="mne">STA</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ Set bit 7 of doNotDitherObject to disable updating of</span>
                        <span class="comment">\ objects on-screen using a dithered effect, so we don't</span>
                        <span class="comment">\ dither any object changes onto the screen while we are</span>
                        <span class="comment">\ focusing on processing the action, which itself might</span>
                        <span class="comment">\ need to update the screen when it's done</span>

<span class="label">.focu1</span><a id="focu1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">focusOnKeyAction</a>   <span class="comment">\ Set previousFocus = focusOnKeyAction so we can detect</span>
 <span class="mne">STA</span> <a class="popup variable">previousFocus</a>      <span class="comment">\ whether the value of focusOnKeyAction changes</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used by the ProcessGameplay routine to detect</span>
                        <span class="comment">\ whether the player is still holding the same pan key</span>
                        <span class="comment">\ down after we finish scrolling the screen for the pan</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checkforsamepankey" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckForSamePanKey</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Check to see whether the same pan key is being held down compared</span>
             <span class="headerEntry">to the last time we checked</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checkforsamepankey.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_2_of_3.html">DrawLandscapeView (Part 2 of 3)</a> calls <a href="#checkforsamepankey">CheckForSamePanKey</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#checkforsamepankey">CheckForSamePanKey</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">Z flag</span>               <span class="argumentEntry">Determines whether the same pan key is being held down</span>
                        <span class="argumentEntry">compared to the last time we checked:</span>

                        <span class="argumentEntry">  * Z flag will be set if the same pan key is being held</span>
                        <span class="argumentEntry">    down (so a BEQ branch will be taken)</span>

                        <span class="argumentEntry">  * Z flag will be clear otherwise (so a BNE branch will</span>
                        <span class="argumentEntry">    be taken)</span>

</div></div>
<span class="label">.CheckForSamePanKey</span><a id="checkforsamepankey" class="anchor"></a>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so the key logger doesn't get</span>
                        <span class="comment">\ updated while we check it for pan key presses</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Scan the keyboard for the first four game keys ("S",</span>
 <span class="mne">JSR</span> <a class="popup destination">ScanForGameKeys</a>    <span class="comment">\ "D", "L" and ",", for pan left, right up and down)</span>

 <span class="mne">LDA</span> <a class="popup variable">latestPanKeyPress</a>  <span class="comment">\ Set A to the key logger value of the latest pan key</span>
                        <span class="comment">\ press, which will either be a current key press or the</span>
                        <span class="comment">\ value from the last pan key press to be made</span>

 <span class="mne">CMP</span> <a class="popup variable">keyLogger</a>          <span class="comment">\ Compare with the key logger entry for "S" and "D"</span>
                        <span class="comment">\ (pan left and right)</span>

 <span class="mne">BEQ</span> <a class="popup destination">cpan1</a>              <span class="comment">\ If the key logger entry is unchanged from the previous</span>
                        <span class="comment">\ pan key press in latestPanKeyPress, then the same pan</span>
                        <span class="comment">\ key is being held down, so jump to cpan1 with the</span>
                        <span class="comment">\ Z flag set accordingly</span>

 <span class="mne">CMP</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">2</span>        <span class="comment">\ Compare with the key logger entry for "L" and ","</span>
                        <span class="comment">\ (pan up and down), so the Z flag will be set if the</span>
                        <span class="comment">\ same pan key is being held down</span>

<span class="label">.cpan1</span><a id="cpan1" class="anchor"></a>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spacekeydebounce" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">spaceKeyDebounce</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A variable to flag whether the SPACE key has been pressed, so we</span>
             <span class="headerEntry">can implement debounce</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/spacekeydebounce.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> uses <a href="#spacekeydebounce">spaceKeyDebounce</a></span>
</div>
</div></div>
<span class="label">.spaceKeyDebounce</span><a id="spacekeydebounce" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>

 <span class="mne">EQUB</span> <span class="hex">&00</span>               <span class="comment">\ This byte appears to be unused</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-placeobjectbelow" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PlaceObjectBelow</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Attempt to place an object on a tile that is below the maximum</span>
             <span class="headerEntry">altitude specified in A</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/placeobjectbelow.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/expendenemyenergy.html">ExpendEnemyEnergy</a> calls <a href="#placeobjectbelow">PlaceObjectBelow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/performhyperspace.html">PerformHyperspace</a> calls <a href="#placeobjectbelow">PlaceObjectBelow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnplayer.html">SpawnPlayer</a> calls <a href="#placeobjectbelow">PlaceObjectBelow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntrees.html">SpawnTrees</a> calls <a href="#placeobjectbelow">PlaceObjectBelow</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The maximum desired altitude of the object (though we</span>
                        <span class="argumentEntry">may end up placing the object higher than this)</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the object to add to the tile</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag:</span>

                        <span class="argumentEntry">  * Clear if the object was successfully placed on a</span>
                        <span class="argumentEntry">    tile</span>

                        <span class="argumentEntry">  * Set if the object was not placed on a suitable tile</span>

</div></div>
<span class="label">.PlaceObjectBelow</span><a id="placeobjectbelow" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ Store the maximum altitude in tileAltitude</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now loop through the landscape tiles, trying to</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ find a suitable location for the object, so set a</span>
                        <span class="comment">\ loop counter to count 255 iterations for each loop</span>

<span class="label">.objb1</span><a id="objb1" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BNE</span> <a class="popup destination">objb2</a>              <span class="comment">\ If we have not counted all 255 iterations yet, jump to</span>
                        <span class="comment">\ objb2 to skip the following</span>

                        <span class="comment">\ If we get here then we have tried 255 tiles at the</span>
                        <span class="comment">\ altitude in tileAltitude, but without success, so we</span>
                        <span class="comment">\ move to a higher altitude and try again</span>

 <span class="mne">INC</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ Increment the altitude in tileAltitude to move up by</span>
                        <span class="comment">\ one coordinate (where a tile-sized cube is one</span>
                        <span class="comment">\ coordinate across)</span>

 <span class="mne">LDA</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ If we just incremented tileAltitude to 12 then we have</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">12</span>                <span class="comment">\ gone past the highest altitude possible, so jump to</span>
 <span class="mne">BCS</span> <a class="popup destination">objb3</a>              <span class="comment">\ objb3 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set to indicate failure</span>

                        <span class="comment">\ Otherwise keep going to look for a suitable tile at</span>
                        <span class="comment">\ the new, higher altitude</span>

<span class="label">.objb2</span><a id="objb2" class="anchor"></a>

                        <span class="comment">\ We now try to pick a tile in the landscape that might</span>
                        <span class="comment">\ be suitable for placing our object</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeed0To30</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to the range 0 to 30</span>

 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set xTile to this seed number, so it points to a</span>
                        <span class="comment">\ tile corner that anchors a tile (so the tile corner</span>
                        <span class="comment">\ isn't along the right edge of the landscape)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeed0To30</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to the range 0 to 30</span>

 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ Set zTile to this seed number, so it points to a</span>
                        <span class="comment">\ tile corner that anchors a tile (so the tile corner</span>
                        <span class="comment">\ isn't along the far edge of the landscape)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), setting the C flag if the tile</span>
                        <span class="comment">\ contains an object</span>

 <span class="mne">BCS</span> <a class="popup destination">objb1</a>              <span class="comment">\ If the tile already contains an object, jump to objb1</span>
                        <span class="comment">\ to try another tile from the landscape's sequence of</span>
                        <span class="comment">\ seed numbers</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ If the tile shape in the low nibble of the tile data</span>
 <span class="mne">BNE</span> <a class="popup destination">objb1</a>              <span class="comment">\ is non-zero, then the tile is not flat, so jump to</span>
                        <span class="comment">\ objb1 to try another tile from the landscape's</span>
                        <span class="comment">\ sequence of seed numbers</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set A to the tile altitude, which is in the top nibble</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ of the tile data</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>

 <span class="mne">CMP</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ If the altitude of the chosen tile is equal to or</span>
 <span class="mne">BCS</span> <a class="popup destination">objb1</a>              <span class="comment">\ higher than the minimum altitude in tileAltitude, then</span>
                        <span class="comment">\ this tile is too high, so jump to objb1 to try another</span>
                        <span class="comment">\ tile from the landscape's sequence of seed numbers</span>

                        <span class="comment">\ If we get here then we have found a tile that is below</span>
                        <span class="comment">\ the altitude in tileAltitude and which doesn't already</span>
                        <span class="comment">\ contain an object, so we can use this for placing our</span>
                        <span class="comment">\ object</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectOnTile</a>  <span class="comment">\ Place object #X on the tile anchored at (xTile, zTile)</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have successfully</span>
                        <span class="comment">\ placed the object on a tile</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.objb3</span><a id="objb3" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that we have failed to</span>
                        <span class="comment">\ place the object on a suitable tile</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getnextseed0to30" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetNextSeed0To30</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set A to the next number from the landscape's sequence of seed</span>
             <span class="headerEntry">numbers, converted to the range 0 to 30</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getnextseed0to30.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/placeobjectbelow.html">PlaceObjectBelow</a> calls <a href="#getnextseed0to30">GetNextSeed0To30</a></span>
</div>
</div></div>
<span class="label">.GetNextSeed0To30</span><a id="getnextseed0to30" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Convert A into a number into the range 0 to 31</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ If A >= 31 or greater, repeat the process until we</span>
 <span class="mne">BCS</span> <a class="popup destination">GetNextSeed0To30</a>   <span class="comment">\ get a number in the range 0 to 30</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processgameplay" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessGameplay</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A gameplay loop that processes all game key presses, returning to</span>
             <span class="headerEntry">the main game loop when the player moves, quits, loses or pans</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processgameplay.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#processgameplay">ProcessGameplay</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag on exit:</span>

                        <span class="argumentEntry">  * Clear if we have just finished processing a pan of</span>
                        <span class="argumentEntry">    the landscape view, and the player is still holding</span>
                        <span class="argumentEntry">    down a pan key</span>

                        <span class="argumentEntry">  * Set if any of the following are true:</span>

                        <span class="argumentEntry">    * The Sentinel has won</span>

                        <span class="argumentEntry">    * The player has moved to a new tile</span>

                        <span class="argumentEntry">    * The player has pressed the quit game key</span>

</div></div>
<span class="label">.ProcessGameplay</span><a id="processgameplay" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Clear bit 7 of focusOnKeyAction to tell the game to</span>
 <span class="mne">STA</span> <a class="popup variable">focusOnKeyAction</a>   <span class="comment">\ stop focusing effort on implementing any key actions</span>
                        <span class="comment">\ such as landscape pans, as we are now looking at the</span>
                        <span class="comment">\ gameplay</span>

 <span class="mne">STA</span> <a class="popup variable">uTurnStatus</a>        <span class="comment">\ Clear bits 6 and 7 of uTurnStatus to clear any record</span>
                        <span class="comment">\ of a U-turn being in progress, and to prevent the "U"</span>
                        <span class="comment">\ key from performing a U-turn, so that the "U" key has</span>
                        <span class="comment">\ to be released (if applicable) before a second U-turn</span>
                        <span class="comment">\ can be performed</span>

<span class="label">.play1</span><a id="play1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">focusOnKeyAction</a>   <span class="comment">\ If bit 7 of focusOnKeyAction is set then the game is</span>
 <span class="mne">BMI</span> <a class="popup destination">play5</a>              <span class="comment">\ focusing effort on a key action such as a landscape</span>
                        <span class="comment">\ pan, so jump to play5 to go straight to processing any</span>
                        <span class="comment">\ action key presses, skipping all the key press logic</span>
                        <span class="comment">\ below</span>

                        <span class="comment">\ We now check whether we have just finished processing</span>
                        <span class="comment">\ a landscape pan, and if so whether the player is still</span>
                        <span class="comment">\ holding down the same pan key</span>

 <span class="mne">LSR</span> <a class="popup variable">samePanKeyPress</a>    <span class="comment">\ Clear bit 7 of samePanKeyPress to record that the same</span>
                        <span class="comment">\ pan key is not being held down, which we will change</span>
                        <span class="comment">\ below if this is not the case</span>

 <span class="mne">LDA</span> <a class="popup variable">previousFocus</a>      <span class="comment">\ If bit 7 of previousFocus is clear then it matches</span>
 <span class="mne">BPL</span> <a class="popup destination">play2</a>              <span class="comment">\ the current value of focusOnKeyAction, so the value</span>
                        <span class="comment">\ of focusOnKeyAction has not changed since the last</span>
                        <span class="comment">\ time we were in the FocusOnKeyAction routine, and at</span>
                        <span class="comment">\ that point we were not focusing effort on implementing</span>
                        <span class="comment">\ a key action such as a landscape pan</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So jump to play2 to skip the following check for pan</span>
                        <span class="comment">\ keys, as it isn't relevant</span>

                        <span class="comment">\ If we get here then bit 7 of focusOnKeyAction is</span>
                        <span class="comment">\ clear and bit 7 of previousFocus is set, so we must</span>
                        <span class="comment">\ have called the ProcessGameplay routine just after</span>
                        <span class="comment">\ implementing a key action such as a landscape pan</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So let's check to see whether the same pan key is</span>
                        <span class="comment">\ still being held down from the pan we just finished</span>

 <span class="mne">JSR</span> <a class="popup destination">CheckForSamePanKey</a> <span class="comment">\ Check to see whether the same pan key is being held</span>
                        <span class="comment">\ down compared to the last time we checked</span>

 <span class="mne">BNE</span> <a class="popup destination">play2</a>              <span class="comment">\ If the same pan key is not being held down, jump to</span>
                        <span class="comment">\ play2 to skip the following</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The same pan key is still being held down, so set bit</span>
 <span class="mne">ROR</span> <a class="popup variable">samePanKeyPress</a>    <span class="comment">\ 7 of samePanKeyPress to record this fact for use in</span>
                        <span class="comment">\ the CheckObjVisibility routine, so we can work out</span>
                        <span class="comment">\ whether it is safe to update objects without</span>
                        <span class="comment">\ corrupting any ongoing pans in the landscape view</span>

<span class="label">.play2</span><a id="play2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ApplyEnemyTactics</a>  <span class="comment">\ Apply tactics to the enemy object in enemyObject</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This call also moves enemyObject on to the next enemy</span>
                        <span class="comment">\ object (in the range 0 to 7), so the next time we</span>
                        <span class="comment">\ reach this point in the gameplay loop, this call will</span>
                        <span class="comment">\ apply tactics to the next enemy number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If there is no enemy object allocated to the object</span>
                        <span class="comment">\ number (which may be the case if the landscape has</span>
                        <span class="comment">\ fewer than eight enemies, or if an enemy has been</span>
                        <span class="comment">\ absorbed), then no tactics are applied and the object</span>
                        <span class="comment">\ number in enemyObject moves on by one, ready for the</span>
                        <span class="comment">\ next time we reach this point in the gameplay loop</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we process each enemy once every eight iterations</span>
                        <span class="comment">\ of the gameplay loop, irrespective of the number of</span>
                        <span class="comment">\ enemies in the landscape</span>

 <span class="mne">LDA</span> <a class="popup variable">sentinelHasWon</a>     <span class="comment">\ If bit 7 of sentinelHasWon is clear then the player</span>
 <span class="mne">BEQ</span> <a class="popup destination">play4</a>              <span class="comment">\ has not been absorbed by the Sentinel, so jump to</span>
                        <span class="comment">\ play4 to progress the game</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ The Sentinel has won, so display the game over screen</span>
 <span class="mne">JSR</span> <a class="popup destination">ShowGameOverScreen</a> <span class="comment">\ with A = 30, so we decay the screen to black with a</span>
                        <span class="comment">\ mass of 30 * 2400 = 72,000 randomly placed black dots</span>

<span class="label">.play3</span><a id="play3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">FocusOnKeyAction</a>   <span class="comment">\ Tell the game to start focusing effort on the key</span>
                        <span class="comment">\ action that has been initiated (be it a pan of the</span>
                        <span class="comment">\ landscape view or an action like absorb or transfer)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that one of the following</span>
                        <span class="comment">\ is true:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The Sentinel has won</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has moved to a new tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has pressed the quit game key</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so the main game loop can process this action</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.play4</span><a id="play4" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">playerHasMovedTile</a> <span class="comment">\ Shift bit 7 of playerHasMovedTile into the C flag so</span>
                        <span class="comment">\ we can check it in the next instruction, and clear bit</span>
                        <span class="comment">\ 7 to clear the flag as we are about to process any</span>
                        <span class="comment">\ tile move that has occurred</span>

 <span class="mne">BCS</span> <a class="popup destination">play3</a>              <span class="comment">\ If the C flag is set then bit 7 of playerHasMovedTile</span>
                        <span class="comment">\ was set before we cleared it, which indicates that the</span>
                        <span class="comment">\ player has moved to a new tile, so jump to play3 to</span>
                        <span class="comment">\ return from the subroutine with the C flag set</span>

 <span class="mne">BIT</span> <a class="popup variable">quitGame</a>           <span class="comment">\ If bit 7 of quitGame is set then the player has</span>
 <span class="mne">BMI</span> <a class="popup destination">play3</a>              <span class="comment">\ pressed function key f1 to quit the game, so jump to</span>
                        <span class="comment">\ play3 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set</span>

 <span class="mne">JSR</span> <a class="popup destination">GetPlayerDrain</a>     <span class="comment">\ Calculate whether the player is being scanned by an</span>
                        <span class="comment">\ enemy and whether the enemy can see the player's tile</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessPauseKeys</a>   <span class="comment">\ Pause or unpause the game when COPY or DELETE are</span>
                        <span class="comment">\ pressed</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessVolumeKeys</a>  <span class="comment">\ Adjust the volume of the sound envelopes when the</span>
                        <span class="comment">\ volume keys are pressed</span>

 <span class="mne">JMP</span> <a class="popup destination">play1</a>              <span class="comment">\ Jump back to play1 to repeat the main game loop</span>

<span class="label">.play5</span><a id="play5" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ If no pan key is currently being pressed, jump to</span>
 <span class="mne">BMI</span> <a class="popup destination">play6</a>              <span class="comment">\ play6 to process any action key presses</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we just finished a</span>
                        <span class="comment">\ landscape pan and the player is still holding down a</span>
                        <span class="comment">\ pan key, so the main game loop can process a new pan</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.play6</span><a id="play6" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">1</span>        <span class="comment">\ Set A to the key logger entry for "A", "Q", "R", "T",</span>
                        <span class="comment">\ "B", "H", or "U" (absorb, transfer, create robot,</span>
                        <span class="comment">\ create tree, create boulder, hyperspace, U-turn)</span>

 <span class="mne">BMI</span> <a class="popup destination">play9</a>              <span class="comment">\ If there is no key press in the key logger entry, jump</span>
                        <span class="comment">\ back to the start of the routine via play9 to keep</span>
                        <span class="comment">\ checking for key presses</span>

                        <span class="comment">\ If we get here then the player is pressing "A", "Q",</span>
                        <span class="comment">\ "R", "T", "B", "H" or "U" (absorb, transfer, create</span>
                        <span class="comment">\ robot, create tree, create boulder, hyperspace,</span>
                        <span class="comment">\ U-turn), so the possible values for A are:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0  for key press "R" (Create robot)</span>
                        <span class="comment">\   * 2  for key press "T" (Create tree)</span>
                        <span class="comment">\   * 3  for key press "B" (Create boulder)</span>
                        <span class="comment">\   * 32 for key press "A" (Absorb)</span>
                        <span class="comment">\   * 33 for key press "Q" (Transfer)</span>
                        <span class="comment">\   * 34 for key press "H" (Hyperspace)</span>
                        <span class="comment">\   * 35 for key press "U" (U-turn)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">34</span>                <span class="comment">\ If A >= 34 then "H" (hyperspace) or "U" (U-turn) is</span>
 <span class="mne">BCS</span> <a class="popup destination">play7</a>              <span class="comment">\ being pressed, so jump to play7 to skip the following</span>
                        <span class="comment">\ check, as we can hyperspace and U-turn at any point,</span>
                        <span class="comment">\ irrespective of whether the sights are being shown</span>

 <span class="mne">BIT</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ If bit 7 of sightsAreVisible is clear then the sights</span>
 <span class="mne">BPL</span> <a class="popup destination">play9</a>              <span class="comment">\ are not being shown, so jump back to the start of the</span>
                        <span class="comment">\ routine via play9 to keep checking for key presses, as</span>
                        <span class="comment">\ we can only create, absorb and transfer when the</span>
                        <span class="comment">\ sights are visible</span>

                        <span class="comment">\ If we get here then the sights are being shown, so we</span>
                        <span class="comment">\ can process the key press</span>

<span class="label">.play7</span><a id="play7" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">keyPress</a>           <span class="comment">\ Record the value from the key logger in keyPress, so</span>
                        <span class="comment">\ we can refer to it in the call to ProcessActionKeys</span>

 <span class="mne">LSR</span> <a class="popup variable">activateSentinel</a>   <span class="comment">\ The player has pressed a key that expends or absorbs</span>
                        <span class="comment">\ energy, which activates the Sentinel at the very start</span>
                        <span class="comment">\ of each level (the Sentinel and Sentries are inactive</span>
                        <span class="comment">\ until this point, giving the player time to get their</span>
                        <span class="comment">\ bearings when they first start a landscape)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So clear bit 7 of activateSentinel to indicate that</span>
                        <span class="comment">\ the Sentinel is activated and the game has started</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessActionKeys</a>  <span class="comment">\ Process any key presses in key logger entry 1, which</span>
                        <span class="comment">\ is where action key presses are stored (absorb,</span>
                        <span class="comment">\ transfer, create, hyperspace, U-turn)</span>

 <span class="mne">BCS</span> <a class="popup destination">play8</a>              <span class="comment">\ If the call to ProcessActionKeys returned with the C</span>
                        <span class="comment">\ flag set, then it didn't add or remove any objects, so</span>
                        <span class="comment">\ jump to play8 to skip the following</span>

                        <span class="comment">\ If we get here then the call to ProcessActionKeys</span>
                        <span class="comment">\ added or removed an object, so we now need to make the</span>
                        <span class="comment">\ appropriate sound and draw the updated object</span>
                        <span class="comment">\ on-screen</span>

 <span class="mne">JSR</span> <a class="popup destination">FlushSoundBuffer0</a>  <span class="comment">\ Flush the sound channel 0 buffer</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Make sound #2 (create/absorb object white noise)</span>
 <span class="mne">JSR</span> <a class="popup destination">MakeSound</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set bits 6 and 7 of ditherObjectSights so we dither</span>
 <span class="mne">STA</span> <a class="popup variable">ditherObjectSights</a> <span class="comment">\ the updated object onto the screen (bit 6) and remove</span>
                        <span class="comment">\ the sights before updating (bit 7) in the call to the</span>
                        <span class="comment">\ DrawUpdatedObject routine</span>

 <span class="mne">LSR</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ Clear bit 7 of doNotDitherObject to enable objects to</span>
                        <span class="comment">\ be updated on the screen with a dithered effect</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawUpdatedObject</a>  <span class="comment">\ Draw the updated object (or the landscape where the</span>
                        <span class="comment">\ object used to be) into the screen buffer and dither</span>
                        <span class="comment">\ it onto the screen, pixel by pixel and randomly</span>

 <span class="mne">JSR</span> <a class="popup destination">FlushSoundBuffer0</a>  <span class="comment">\ Flush the sound channel 0 buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">UpdateIconsScanner</a> <span class="comment">\ Update the icons in the top-left corner of the screen</span>
                        <span class="comment">\ to show the player's current energy level and redraw</span>
                        <span class="comment">\ the scanner box</span>

<span class="label">.play8</span><a id="play8" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">playerHasMovedTile</a> <span class="comment">\ Shift bit 7 of playerHasMovedTile into the C flag so</span>
                        <span class="comment">\ we can check it in the next instruction, and clear bit</span>
                        <span class="comment">\ 7 to clear the flag as we are about to process any</span>
                        <span class="comment">\ tile move that has occurred</span>

 <span class="mne">BCC</span> <a class="popup destination">play9</a>              <span class="comment">\ If bit 7 of playerHasMovedTile was clear before we</span>
                        <span class="comment">\ cleared it, then the player has not moved to a new</span>
                        <span class="comment">\ tile, so jump back to the start of the routine via</span>
                        <span class="comment">\ play9 to continue processing the gameplay</span>

                        <span class="comment">\ If we get here then bit 7 of playerHasMovedTile was</span>
                        <span class="comment">\ set before we cleared it, which indicates that the</span>
                        <span class="comment">\ player has moved to a new tile, so return from the</span>
                        <span class="comment">\ subroutine with the C flag set</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.play9</span><a id="play9" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">ProcessGameplay</a>    <span class="comment">\ Jump back to the start of the ProcessGameplay routine</span>
                        <span class="comment">\ to keep processing the gameplay</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updateenemytimers" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UpdateEnemyTimers</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the timers that control the enemy tactics</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/updateenemytimers.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/irqhandler.html">IRQHandler</a> calls <a href="#updateenemytimers">UpdateEnemyTimers</a></span>
</div>
</div></div>
<span class="label">.UpdateEnemyTimers</span><a id="updateenemytimers" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">updateTimer</a>        <span class="comment">\ If updateTimer is non-zero, jump to time3 to skip</span>
 <span class="mne">BNE</span> <a class="popup destination">time3</a>              <span class="comment">\ updating the enemy timers and run down the update</span>
                        <span class="comment">\ timer</span>

                        <span class="comment">\ If we get here then updateTimer is zero, so we</span>
                        <span class="comment">\ update the enemy timers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The update timer loops through 2, 1, 0, so this means</span>
                        <span class="comment">\ we decrement the timers on one out of every three</span>
                        <span class="comment">\ calls to the UpdateEnemyTimers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ UpdateEnemyTimers is called from the interrupt handler</span>
                        <span class="comment">\ at IRQHandler, but only once the game has started and</span>
                        <span class="comment">\ the Sentinel is active</span>
                        <span class="comment">\</span>
                        <span class="comment">\ IRQHandler performs its actions 50 times a second, so</span>
                        <span class="comment">\ this means the counters tick down at a rate of 16.7</span>
                        <span class="comment">\ times a second, or once every 0.06 seconds</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So setting a timer to n means it will count down in</span>
                        <span class="comment">\ 3 * n / 50 = 3 * 0.06 seconds</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">23</span>                <span class="comment">\ There are 24 bytes of enemy timers, split into three</span>
                        <span class="comment">\ timers keeping track of up to eight enemies each:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * enemyDrainTimer</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * enemyTacticTimer</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * enemyTimer3</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So set a byte counter in X to update all the timers</span>
                        <span class="comment">\ in one loop</span>

<span class="label">.time1</span><a id="time1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ If the X-th timer is less than 2 then it has already</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ counted down to 1, so jump to time2 to leave the timer</span>
 <span class="mne">BCC</span> <a class="popup destination">time2</a>              <span class="comment">\ alone as it is inactive</span>

                        <span class="comment">\ So the timers count down until they reach 1, at which</span>
                        <span class="comment">\ point they stay put, inactive until they are reset</span>

 <span class="mne">DEC</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ The X-th timer is actively counting down, so decrement</span>
                        <span class="comment">\ the timer</span>

<span class="label">.time2</span><a id="time2" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">time1</a>              <span class="comment">\ Loop back until we have decremented all the active</span>
                        <span class="comment">\ enemy timers</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set updateTimer = 2 so it loops back to the start to</span>
 <span class="mne">STA</span> <a class="popup variable">updateTimer</a>        <span class="comment">\ count through 2, 1, 0 again</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.time3</span><a id="time3" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">updateTimer</a>        <span class="comment">\ Decrement the update timer</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-resetscreenaddress" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ResetScreenAddress</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Reset the address of the start of screen memory</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/resetscreenaddress.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/clearscreen.html">ClearScreen</a> calls <a href="#resetscreenaddress">ResetScreenAddress</a></span>
</div>
<hr class="light">
 This routine sets the screen addresses as follows:

   * Address of the start of screen memory in the 6845 CRTC registers = &7F80

   * Address of the icon and scanner row at the top of the screen in
     iconRowAddr(1 0) = &7F80

   * Address of the player's scrolling landscape view in viewScreenAddr(1 0) =
     &60C0

 Note that &7F80 + 320 = &60C0, when the wrapping of screen memory is taken
 into consideration, so the player's scrolling landscape view in memory is one
 character line after the icon and scanner row at the top of the screen.

</div></div>
<span class="label">.ResetScreenAddress</span><a id="resetscreenaddress" class="anchor"></a>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so we can update the 6845 registers</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&C0</span>               <span class="comment">\ Set viewScreenAddr(1 0) = &60C0</span>
 <span class="mne">STA</span> <a class="popup variable">viewScreenAddr</a>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&60</span>
 <span class="mne">STA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">JSR</span> <a class="popup destination">GetIconRowAddress</a>  <span class="comment">\ Set iconRowAddr(1 0) to the address in screen memory</span>
                        <span class="comment">\ of the icon and scanner row at the top of the screen</span>

                        <span class="comment">\ We now set the address of screen memory to &7F80</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&0F</span>               <span class="comment">\ Store &0F on the stack to use as the value of R12 in</span>
 <span class="mne">PHA</span>                    <span class="comment">\ the following</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&F0</span>               <span class="comment">\ Set 6845 register R13 = &F0, for the low byte</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">13</span>                <span class="comment">\</span>
 <span class="mne">STX</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\ We do this by writing the register number (13) to</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ SHEILA &00, and then the value (&F0) to SHEILA &01</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Set 6845 register R12 = &0F, for the high byte</span>
 <span class="mne">STX</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\</span>
 <span class="mne">PLA</span>                    <span class="comment">\ We do this by writing the register number (12) to</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ SHEILA &00, and then the value (&0F) to SHEILA &01</span>

                        <span class="comment">\ This sets 6845 registers (R12 R13) = &0FF0 to point</span>
                        <span class="comment">\ to the start of screen memory in terms of character</span>
                        <span class="comment">\ rows. There are 8 pixel lines in each character row,</span>
                        <span class="comment">\ so to get the actual address of the start of screen</span>
                        <span class="comment">\ memory, we multiply by 8:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   &0FF0 * 8 = &7F80</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this sets the start of screen memory to &7F80</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-initialisesights" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">InitialiseSights</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sights</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Initialise the variables used to manage the sights, so the sights</span>
             <span class="headerEntry">appear in the middle of the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/initialisesights.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> calls <a href="#initialisesights">InitialiseSights</a></span>
</div>
</div></div>
<span class="label">.InitialiseSights</span><a id="initialisesights" class="anchor"></a>

                        <span class="comment">\ We start by calculating the screen address for the</span>
                        <span class="comment">\ sights when they are in the middle of the screen,</span>
                        <span class="comment">\ which is where we initialise them</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The base screen address has already been set up in</span>
                        <span class="comment">\ viewScreenAddr(1 0), and we want to place the sights</span>
                        <span class="comment">\ halfway down and halfway across the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The custom screen mode 5 used by the game contains 25</span>
                        <span class="comment">\ character rows, each of which is eight pixels high</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The top character row is used for the energy icon and</span>
                        <span class="comment">\ scanner, and viewScreenAddr(1 0) points to the start</span>
                        <span class="comment">\ of screen memory just below this top row, so the</span>
                        <span class="comment">\ player's view is 24 character rows high and row 12 is</span>
                        <span class="comment">\ halfway down the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Each character row in screen mode 5 takes up 320 bytes</span>
                        <span class="comment">\ (40 character blocks of eight bytes each), so the</span>
                        <span class="comment">\ offset within screen memory of the start of row 12 is</span>
                        <span class="comment">\ 12 * 320, and we can move halfway along that row by</span>
                        <span class="comment">\ adding a further 160, so that's an offset of:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   12 * 320 + 160 = 4000</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the address of the sights in screen memory is:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   viewScreenAddr(1 0) + 4000</span>
                        <span class="comment">\</span>
                        <span class="comment">\ which is what we calculate now</span>

 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a>     <span class="comment">\ Calculate the following:</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&A0</span>               <span class="comment">\   (A sightsScreenAddr) = viewScreenAddr(1 0) + &0FA0</span>
 <span class="mne">STA</span> <a class="popup variable">sightsScreenAddr</a>   <span class="comment">\                        = viewScreenAddr(1 0) + 4000</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ And then the high bytes</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&0F</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">sesi1</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.sesi1</span><a id="sesi1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">sightsScreenAddr</a><span class="operator">+</span><span class="decimal">1</span> <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   sightsScreenAddr(1 0) = viewScreenAddr(1 0) + 4000</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">80</span>                <span class="comment">\ Set the on-screen x-coordinate of the sights to 80,</span>
 <span class="mne">STA</span> <a class="popup variable">xSights</a>            <span class="comment">\ which is in the middle of the 160-pixel wide screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">95</span>                <span class="comment">\ Set the on-screen y-coordinate of the sights to 95,</span>
 <span class="mne">STA</span> <a class="popup variable">ySights</a>            <span class="comment">\ which is in the middle of the 192-pixel high player's</span>
                        <span class="comment">\ view (which is the whole screen apart from the energy</span>
                        <span class="comment">\ icon and scanner row at the top)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scanforgamekeys" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ScanForGameKeys</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Scan for game key presses and update the key logger</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/scanforgamekeys.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> calls <a href="#scanforgamekeys">ScanForGameKeys</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforsamepankey.html">CheckForSamePanKey</a> calls <a href="#scanforgamekeys">ScanForGameKeys</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/irqhandler.html">IRQHandler</a> calls <a href="#scanforgamekeys">ScanForGameKeys</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The offset within gameKeys where we start the scan, with</span>
                        <span class="argumentEntry">the scan working towards the start of gameKeys</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">N flag</span>               <span class="argumentEntry">Determines whether a pan key is being pressed:</span>

                        <span class="argumentEntry">  * Bit 7 of A will be set if no pan keys are being</span>
                        <span class="argumentEntry">    pressed (so a BMI branch will be taken)</span>

                        <span class="argumentEntry">  * Bit 7 of A will be clear if at least one pan key is</span>
                        <span class="argumentEntry">    being pressed (so a BPL branch will be taken)</span>

</div></div>
<span class="label">.ScanForGameKeys</span><a id="scanforgamekeys" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ We start by resetting the key logger, so set a loop</span>
                        <span class="comment">\ counter in X for resetting all four entries</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set A = %10000000 to reset all four entries, as the</span>
                        <span class="comment">\ set bit 7 indicates an empty entry in the logger</span>

<span class="label">.gkey1</span><a id="gkey1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">keyLogger</a>,<span class="register">X</span>        <span class="comment">\ Reset the X-th entry in the key logger</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">gkey1</a>              <span class="comment">\ Loop back until we have reset all four entries</span>

                        <span class="comment">\ We now work our way backwards through the gameKey</span>
                        <span class="comment">\ table, starting at offset Y, and checking to see if</span>
                        <span class="comment">\ each key is being pressed and logging the results in</span>
                        <span class="comment">\ the key logger</span>

<span class="label">.gkey2</span><a id="gkey2" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">gameKeys</a>,<span class="register">Y</span>         <span class="comment">\ Set X to the internal key number for the Y-th key in</span>
                        <span class="comment">\ the gameKey table</span>

 <span class="mne">JSR</span> <a class="popup destination">ScanKeyboard</a>       <span class="comment">\ Scan the keyboard to see if this key is being pressed</span>

 <span class="mne">BNE</span> <a class="popup destination">gkey3</a>              <span class="comment">\ If the key in X is not being pressed, jump to gkey3 to</span>
                        <span class="comment">\ move on to the next key in the table</span>

 <span class="mne">LDA</span> <a class="popup variable">keyLoggerConfig</a>,<span class="register">Y</span>  <span class="comment">\ Set X to the key logger entry where we should store</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ this key press, which is in bits 0 and 1 of the</span>
 <span class="mne">TAX</span>                    <span class="comment">\ corresponding entry in the keyLoggerConfig table</span>

 <span class="mne">LDA</span> <a class="popup variable">keyLoggerConfig</a>,<span class="register">Y</span>  <span class="comment">\ Set A to the value to store in the key logger for this</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ key, which is in bits 2 to 7 of the corresponding</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ entry in the keyLoggerConfig table</span>

 <span class="mne">STA</span> <a class="popup variable">keyLogger</a>,<span class="register">X</span>        <span class="comment">\ Store the configured value in the configured entry</span>
                        <span class="comment">\ for this key press</span>

<span class="label">.gkey3</span><a id="gkey3" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the index in Y to move on to the next key</span>
                        <span class="comment">\ in the gameKey table</span>

 <span class="mne">BPL</span> <a class="popup destination">gkey2</a>              <span class="comment">\ Loop back until we have checked all the keys up to the</span>
                        <span class="comment">\ start of the gameKey table</span>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a>          <span class="comment">\ Combine the key logger entry for "S" and "D" (pan left</span>
 <span class="mne">AND</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">2</span>        <span class="comment">\ and right) with the key logger entry for "L" and ","</span>
                        <span class="comment">\ (pan left and right and set the status flags according</span>
                        <span class="comment">\ to the result</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, if bit 7 is set in both entries, then no</span>
                        <span class="comment">\ pan keys are being pressed, so a BMI following the</span>
                        <span class="comment">\ call to ScanForGameKeys will be taken</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If, however, bit 7 is clear in either entry, then at</span>
                        <span class="comment">\ least one pan key is being pressed, so a BPL following</span>
                        <span class="comment">\ the call to ScanForGameKeys will be taken</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gamekeys" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">gameKeys</span>                                                <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Negative inkey values for the game keys</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/gamekeys.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scanforgamekeys.html">ScanForGameKeys</a> uses <a href="#gamekeys">gameKeys</a></span>
</div>
<hr class="light">
 For a full list of negative inkey values, see Appendix C of the "Advanced User
 Guide for the BBC Micro" by Bray, Dickens and Holmes.

</div></div>
<span class="label">.gameKeys</span><a id="gamekeys" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="hex">&AE</span>               <span class="comment">\ Negative inkey value for "S" (pan left)</span>
 <span class="mne">EQUB</span> <span class="hex">&CD</span>               <span class="comment">\ Negative inkey value for "D" (pan right)</span>
 <span class="mne">EQUB</span> <span class="hex">&A9</span>               <span class="comment">\ Negative inkey value for "L" (pan up)</span>
 <span class="mne">EQUB</span> <span class="hex">&99</span>               <span class="comment">\ Negative inkey value for "," (pan down)</span>
 <span class="mne">EQUB</span> <span class="hex">&BE</span>               <span class="comment">\ Negative inkey value for "A" (absorb)</span>
 <span class="mne">EQUB</span> <span class="hex">&EF</span>               <span class="comment">\ Negative inkey value for "Q" (transfer)</span>
 <span class="mne">EQUB</span> <span class="hex">&CC</span>               <span class="comment">\ Negative inkey value for "R" (create robot)</span>
 <span class="mne">EQUB</span> <span class="hex">&DC</span>               <span class="comment">\ Negative inkey value for "T" (create tree)</span>
 <span class="mne">EQUB</span> <span class="hex">&9B</span>               <span class="comment">\ Negative inkey value for "B" (create boulder)</span>
 <span class="mne">EQUB</span> <span class="hex">&AB</span>               <span class="comment">\ Negative inkey value for "H" (hyperspace)</span>
 <span class="mne">EQUB</span> <span class="hex">&DB</span>               <span class="comment">\ Negative inkey value for "7" (volume down)</span>
 <span class="mne">EQUB</span> <span class="hex">&EA</span>               <span class="comment">\ Negative inkey value for "8" (volume up)</span>
 <span class="mne">EQUB</span> <span class="hex">&96</span>               <span class="comment">\ Negative inkey value for COPY (pause)</span>
 <span class="mne">EQUB</span> <span class="hex">&A6</span>               <span class="comment">\ Negative inkey value for DELETE (unpause)</span>
 <span class="mne">EQUB</span> <span class="hex">&CA</span>               <span class="comment">\ Negative inkey value for "U" (U-turn)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-keyloggerconfig" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">keyLoggerConfig</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The configuration table for storing keys the key logger</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/keyloggerconfig.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scanforgamekeys.html">ScanForGameKeys</a> uses <a href="#keyloggerconfig">keyLoggerConfig</a></span>
</div>
<hr class="light">
 Each game key has an entry in the keyLoggerConfig table that corresponds with
 the internal key number in the gameKeys table.

 Bits 0 and 1 determine the entry in the four-byte key logger where we should
 record each key press (entry numbers are 0 to 3).

 Bits 2 to 7 contain the value to store in the key logger at that entry.

 The key logger entries fall into four categories:

   * Entry 0 is for sideways movement keys (pan left, pan right)

   * Entry 1 is for action keys (absorb, transfer, create, hyperspace, U-turn)

   * Entry 2 is for vertical movement keys (pan up, pan down)

   * Entry 3 is for utility keys (volume control, pause)

</div></div>
<span class="label">.keyLoggerConfig</span><a id="keyloggerconfig" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span> <span class="operator">+</span>  <span class="decimal">1</span> << <span class="decimal">2</span>       <span class="comment">\ Put  1 in logger entry 0 for "S" (pan left)</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> <span class="operator">+</span>  <span class="decimal">0</span> << <span class="decimal">2</span>       <span class="comment">\ Put  0 in logger entry 0 for "D" (pan right)</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span> <span class="operator">+</span>  <span class="decimal">2</span> << <span class="decimal">2</span>       <span class="comment">\ Put  2 in logger entry 2 for "L" (pan up)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> <span class="operator">+</span>  <span class="decimal">3</span> << <span class="decimal">2</span>       <span class="comment">\ Put  3 in logger entry 2 for "," (pan down)</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span> <span class="decimal">32</span> << <span class="decimal">2</span>       <span class="comment">\ Put 32 in logger entry 1 for "A" (absorb)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span> <span class="decimal">33</span> << <span class="decimal">2</span>       <span class="comment">\ Put 33 in logger entry 1 for "Q" (transfer)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span>  <span class="decimal">0</span> << <span class="decimal">2</span>       <span class="comment">\ Put  0 in logger entry 1 for "R" (create robot)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span>  <span class="decimal">2</span> << <span class="decimal">2</span>       <span class="comment">\ Put  2 in logger entry 1 for "T" (create tree)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span>  <span class="decimal">3</span> << <span class="decimal">2</span>       <span class="comment">\ Put  3 in logger entry 1 for "B" (create boulder)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span> <span class="decimal">34</span> << <span class="decimal">2</span>       <span class="comment">\ Put 34 in logger entry 1 for "H" (hyperspace)</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span> <span class="operator">+</span>  <span class="decimal">0</span> << <span class="decimal">2</span>       <span class="comment">\ Put  0 in logger entry 3 for "7" (volume down)</span>
 <span class="mne">EQUB</span> <span class="decimal">3</span> <span class="operator">+</span>  <span class="decimal">1</span> << <span class="decimal">2</span>       <span class="comment">\ Put  1 in logger entry 3 for "8" (volume up)</span>
 <span class="mne">EQUB</span> <span class="decimal">3</span> <span class="operator">+</span>  <span class="decimal">2</span> << <span class="decimal">2</span>       <span class="comment">\ Put  2 in logger entry 3 for COPY (pause)</span>
 <span class="mne">EQUB</span> <span class="decimal">3</span> <span class="operator">+</span>  <span class="decimal">3</span> << <span class="decimal">2</span>       <span class="comment">\ Put  3 in logger entry 3 for DELETE (unpause)</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">+</span> <span class="decimal">35</span> << <span class="decimal">2</span>       <span class="comment">\ Put 35 in logger entry 1 for "U" (U-turn)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawtitleview" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTitleView</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the main title screen, the secret code screen or the</span>
             <span class="headerEntry">landscape preview</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawtitleview.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#drawtitleview">DrawTitleView</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#drawtitleview">DrawTitleView</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The object to draw on the title screen:</span>

                        <span class="argumentEntry">  * 0 = draw a robot on the right of the screen for the</span>
                        <span class="argumentEntry">        secret code screen</span>

                        <span class="argumentEntry">  * 5 = draw the Sentinel on the right of the screen for</span>
                        <span class="argumentEntry">        the main title screen</span>

                        <span class="argumentEntry">  * &80 = draw the landscape preview</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The screen background:</span>

                        <span class="argumentEntry">  * 1 = fill with solid colour 0 (blue) for the main</span>
                        <span class="argumentEntry">        title screen</span>

                        <span class="argumentEntry">  * 3 = fill with solid colour 1 (black) and draw 240</span>
                        <span class="argumentEntry">        randomly positioned stars in colour 2 (white,</span>
                        <span class="argumentEntry">        yellow, cyan or red), for the secret code screen</span>
                        <span class="argumentEntry">        and landscape preview</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The view type:</span>

                        <span class="argumentEntry">  * 0 = landscape preview</span>

                        <span class="argumentEntry">  * 1 = main title screen or secret code screen</span>

</div></div>
<span class="label">.DrawTitleView</span><a id="drawtitleview" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ Set titleObjectToDraw to the object that we are</span>
                        <span class="comment">\ drawing so we can refer to it throughout the title</span>
                        <span class="comment">\ routines</span>

 <span class="mne">STX</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ Set screenBackground to the type of background to draw</span>
                        <span class="comment">\ for the title screen or landscape preview</span>

                        <span class="comment">\ We start by setting the correct colour for any drop</span>
                        <span class="comment">\ shadow text on the title screen (i.e. text that uses</span>
                        <span class="comment">\ the standard font and which is printed twice with an</span>
                        <span class="comment">\ offset to give a drop-shadow effect, as opposed to the</span>
                        <span class="comment">\ large 3D text which is drawn as 3D objects)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the background type</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set X = 2 to use as the colour for the rear character</span>
                        <span class="comment">\ of a drop shadow (this is red on the title screens or</span>
                        <span class="comment">\ white/yellow/cyan/red in the landscape preview)</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Update the VDU codes at vduShadowFront so the front</span>
 <span class="mne">STA</span> <a class="popup variable">vduShadowFront</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ character of the dropdown text is printed in colour</span>
                        <span class="comment">\ A EOR 3, so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 2 (red) for the solid blue background</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 0 (blue) for the star background</span>

 <span class="mne">BEQ</span> <a class="popup destination">tvew1</a>              <span class="comment">\ If we just set the colour of the front character to</span>
                        <span class="comment">\ blue, skip the following instruction</span>

 <span class="mne">INX</span>                    <span class="comment">\ Set X = 3 to use as the colour for the rear character</span>
                        <span class="comment">\ of a drop shadow (this is yellow on the title screens</span>
                        <span class="comment">\ green/red/yellow/cyan in the landscape preview)</span>

<span class="label">.tvew1</span><a id="tvew1" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">vduShadowRear</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ Update the VDU codes at vduShadowRear so the rear</span>
                        <span class="comment">\ character of the dropdown text is printed in colour X,</span>
                        <span class="comment">\ so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 3 (yellow) for the solid blue background</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 2 for the star background, which is red for</span>
                        <span class="comment">\     the secret code screen, or white/yellow/cyan/red</span>
                        <span class="comment">\     in the landscape preview)</span>

 <span class="mne">STY</span> <a class="popup variable">viewType</a>           <span class="comment">\ Set viewType to the view type so we can use it as an</span>
                        <span class="comment">\ index into the screen configuration tables to set up</span>
                        <span class="comment">\ the correct perspective depending on whether this is</span>
                        <span class="comment">\ a landscape preview (Y = 0) or a title screen (Y = 1)</span>

                        <span class="comment">\ We now set up object #16 to use as the viewing object</span>
                        <span class="comment">\ for the large 3D text blocks, using the values from</span>
                        <span class="comment">\ the configuration tables</span>

 <span class="mne">LDA</span> <a class="popup variable">yTextViewer</a>,<span class="register">Y</span>      <span class="comment">\ Set the y-coordinate of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectHi</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">textViewerPitch</a>,<span class="register">Y</span>  <span class="comment">\ Set the pitch angle of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">xTextViewer</a>,<span class="register">Y</span>      <span class="comment">\ Set the x-coordinate of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">xObject</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">zTextViewer</a>,<span class="register">Y</span>      <span class="comment">\ Set the z-coordinate of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">zObject</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">textViewerYaw</a>,<span class="register">Y</span>    <span class="comment">\ Set the yaw angle of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">titleOffset</a>,<span class="register">Y</span>      <span class="comment">\ Store the title offset on the stack so we can retrieve</span>
 <span class="mne">PHA</span>                    <span class="comment">\ it below</span>

 <span class="mne">JSR</span> <a class="popup destination">ClearScreen</a>        <span class="comment">\ Clear the screen to the screen background specified in</span>
                        <span class="comment">\ screenBackground (so that's blue for the main title</span>
                        <span class="comment">\ screen or black with stars for the secret code screen</span>
                        <span class="comment">\ or landscape preview)</span>

 <span class="mne">LDA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ If bit 7 of titleObjectToDraw is set then we are</span>
 <span class="mne">BMI</span> <a class="popup destination">tvew2</a>              <span class="comment">\ drawing the landscape preview, so skip the following</span>
                        <span class="comment">\ instruction as there is no 3D object on the right of</span>
                        <span class="comment">\ the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTitleObjects</a>   <span class="comment">\ Otherwise call DrawTitleObjects to draw an object of</span>
                        <span class="comment">\ type A (so that's 0 for a robot or 5 for the Sentinel)</span>
                        <span class="comment">\ standing on top of a tower on the right side of the</span>
                        <span class="comment">\ screen</span>

<span class="label">.tvew2</span><a id="tvew2" class="anchor"></a>

 <span class="mne">PLA</span>                    <span class="comment">\ Set xTitleOffset to the title offset, which will only</span>
 <span class="mne">STA</span> <a class="popup variable">xTitleOffset</a>       <span class="comment">\ be non-zero when we are drawing the large 3D text on</span>
                        <span class="comment">\ the main title screen or secret code screen</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">16</span>                <span class="comment">\ Set the viewing object to object #16</span>
 <span class="mne">STX</span> <a class="popup variable">viewingObject</a>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeView</a>  <span class="comment">\ Draw the landscape view to display the large 3D text</span>
                        <span class="comment">\ (for the title screens) or draw the landscape preview</span>

 <span class="mne">LDA</span> <a class="popup variable">viewType</a>           <span class="comment">\ If viewType is non-zero then this is the main title</span>
 <span class="mne">BNE</span> <a class="popup destination">tvew4</a>              <span class="comment">\ screen or secret code screen, so jump to tvew4 to skip</span>
                        <span class="comment">\ the following</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">127</span>               <span class="comment">\ We just drew the landscape preview, so we now reset</span>
                        <span class="comment">\ the tile visibilities so we're ready to play the game,</span>
                        <span class="comment">\ so set a byte counter in X to work through the 128</span>
                        <span class="comment">\ bytes in the tileVisibility table</span>

 <span class="mne">STX</span> <a class="popup variable">viewType</a>           <span class="comment">\ Set viewType to a non-zero value (it doesn't matter</span>
                        <span class="comment">\ what) so the GetObjectAngles routine will process</span>
                        <span class="comment">\ angles for the game's landscape from now on</span>

<span class="label">.tvew3</span><a id="tvew3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a>,<span class="register">X</span>   <span class="comment">\ Zero the X-th byte in the tileVisibility table</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">tvew3</a>              <span class="comment">\ Loop back until we have zeroed the whole</span>
                        <span class="comment">\ tileVisibility table</span>

<span class="label">.tvew4</span><a id="tvew4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set xTitleOffset = 0 to remove the x-coordinate offset</span>
 <span class="mne">STA</span> <a class="popup variable">xTitleOffset</a>       <span class="comment">\ that we used for the text, as is it not needed during</span>
                        <span class="comment">\ gameplay</span>

 <span class="mne">STA</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ Set screenBackground = 0 so if we start the game after</span>
                        <span class="comment">\ showing this title screen, the FillScreen routine will</span>
                        <span class="comment">\ clear the screen buffers to the blue and black sky,</span>
                        <span class="comment">\ which is the only screen background we need during</span>
                        <span class="comment">\ gameplay</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ytextviewer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">yTextViewer</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The y-coordinate of the viewer for the large 3D text on the title</span>
             <span class="headerEntry">screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/ytextviewer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#ytextviewer">yTextViewer</a></span>
</div>
</div></div>
<span class="label">.yTextViewer</span><a id="ytextviewer" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">33</span>                <span class="comment">\ Landscape preview</span>

 <span class="mne">EQUB</span> <span class="decimal">75</span>                <span class="comment">\ Title screen or secret code screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-textviewerpitch" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">textViewerPitch</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The pitch angle of the viewer for the large 3D text on the title</span>
             <span class="headerEntry">screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/textviewerpitch.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#textviewerpitch">textViewerPitch</a></span>
</div>
</div></div>
<span class="label">.textViewerPitch</span><a id="textviewerpitch" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">-22</span>               <span class="comment">\ Landscape preview</span>

 <span class="mne">EQUB</span> <span class="decimal">-39</span>               <span class="comment">\ Title screen or secret code screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-xtextviewer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">xTextViewer</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The x-coordinate of the viewer for the large 3D text on the title</span>
             <span class="headerEntry">screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/xtextviewer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#xtextviewer">xTextViewer</a></span>
</div>
</div></div>
<span class="label">.xTextViewer</span><a id="xtextviewer" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">15</span>                <span class="comment">\ Landscape preview</span>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Title screen or secret code screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-titleoffset" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">titleOffset</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">An offset to apply to the large 3D text for the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/titleoffset.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#titleoffset">titleOffset</a></span>
</div>
</div></div>
<span class="label">.titleOffset</span><a id="titleoffset" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Landscape preview</span>

 <span class="mne">EQUB</span> <span class="decimal">-17</span>               <span class="comment">\ Title screen or secret code screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ztextviewer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">zTextViewer</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The z-coordinate of the viewer for the large 3D text on the title</span>
             <span class="headerEntry">screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/ztextviewer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#ztextviewer">zTextViewer</a></span>
</div>
</div></div>
<span class="label">.zTextViewer</span><a id="ztextviewer" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">194</span>               <span class="comment">\ Landscape preview</span>

 <span class="mne">EQUB</span> <span class="decimal">191</span>               <span class="comment">\ Title screen or secret code screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-textvieweryaw" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">textViewerYaw</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The yaw angle of the viewer for the large 3D text on the title</span>
             <span class="headerEntry">screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/textvieweryaw.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#textvieweryaw">textViewerYaw</a></span>
</div>
</div></div>
<span class="label">.textViewerYaw</span><a id="textvieweryaw" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Landscape preview</span>

 <span class="mne">EQUB</span> <span class="decimal">18</span>                <span class="comment">\ Title screen or secret code screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-viewtype" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">viewType</span>                                                <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Storage for the type of title view we are drawing in DrawTitleView</span>
             <span class="headerEntry">(title screen or landscape preview)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/viewtype.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> uses <a href="#viewtype">viewType</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getobjectangles.html">GetObjectAngles</a> uses <a href="#viewtype">viewType</a></span>
</div>
</div></div>
<span class="label">.viewType</span><a id="viewtype" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">1</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawnenemies" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnEnemies</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the number of enemies for this landscape, add them to</span>
             <span class="headerEntry">the landscape and set the palette accordingly</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawnenemies.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#spawnenemies">SpawnEnemies</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#spawnenemies">SpawnEnemies</a></span>
</div>
</div></div>
<span class="label">.SpawnEnemies</span><a id="spawnenemies" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If this is not landscape 0000, jump to popu1 to</span>
 <span class="mne">BNE</span> <a class="popup destination">popu1</a>              <span class="comment">\ calculate the number of enemies to spawn</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ This is landscape 0000, so set A = 1 to use for the</span>
                        <span class="comment">\ total number of enemies</span>

 <span class="mne">BNE</span> <a class="popup destination">popu2</a>              <span class="comment">\ Jump to popu2 to set numberOfEnemies to the value of A</span>

<span class="label">.popu1</span><a id="popu1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetEnemyCount</a>      <span class="comment">\ Set A to the enemy count for this landscape, which is</span>
                        <span class="comment">\ derived from the top digit of the landscape number and</span>
                        <span class="comment">\ the next number in the landscape's sequence of seed</span>
                        <span class="comment">\ numbers, so it is always the same value for the same</span>
                        <span class="comment">\ landscape number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At this point A is in the range 1 to 8, with higher</span>
                        <span class="comment">\ values for higher landscape numbers</span>

 <span class="mne">CMP</span> <a class="popup variable">maxNumberOfEnemies</a> <span class="comment">\ If A &lt; maxNumberOfEnemies then skip the following</span>
 <span class="mne">BCC</span> <a class="popup destination">popu2</a>              <span class="comment">\ instruction</span>

 <span class="mne">LDA</span> <a class="popup variable">maxNumberOfEnemies</a> <span class="comment">\ Set A = maxNumberOfEnemies, so the number of enemies</span>
                        <span class="comment">\ does not exceed the value of maxNumberOfEnemies that</span>
                        <span class="comment">\ we set in the InitialiseSeeds routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So landscapes 0000 to 0009 have a maximum enemy count</span>
                        <span class="comment">\ of 1, landscapes 0010 to 0019 have a maximum enemy</span>
                        <span class="comment">\ count of 2, and so on up to landscapes 0070 and up,</span>
                        <span class="comment">\ which have a maximum enemy count of 8</span>

<span class="label">.popu2</span><a id="popu2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ Store the number of enemies for this landscape in</span>
                        <span class="comment">\ numberOfEnemies</span>

 <span class="mne">JSR</span> <a class="popup destination">AddEnemiesToTiles</a>  <span class="comment">\ Add the required number of enemies to the landscape,</span>
                        <span class="comment">\ starting from the highest altitude and working down,</span>
                        <span class="comment">\ with no more than one enemy on each contour</span>

                        <span class="comment">\ We now update colours 2 and 3 in the first palette in</span>
                        <span class="comment">\ colourPalettes according to the number of enemies</span>

 <span class="mne">LDA</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ Set X = (numberOfEnemies - 1) mod 8</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ The mod 8 is not strictly necessary as numberOfEnemies</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ is in the range 1 to 8, but doing this ensures we can</span>
 <span class="mne">TAX</span>                    <span class="comment">\ safely use X as an index into the landscapeColour</span>
                        <span class="comment">\ tables</span>

 <span class="mne">LDA</span> <a class="popup variable">landscapeColour3</a>,<span class="register">X</span> <span class="comment">\ Set colour 3 in the game palette to the X-th entry</span>
 <span class="mne">STA</span> <a class="popup variable">colourPalettes</a><span class="operator">+</span><span class="decimal">3</span>   <span class="comment">\ from landscapeColour3</span>

 <span class="mne">LDA</span> <a class="popup variable">landscapeColour2</a>,<span class="register">X</span> <span class="comment">\ Set colour 2 in the game palette to the X-th entry</span>
 <span class="mne">STA</span> <a class="popup variable">colourPalettes</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ from landscapeColour2</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawnplayer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnPlayer</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Add the player object to the landscape, ideally placing it below</span>
             <span class="headerEntry">all the enemies and in the bottom half of the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawnplayer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#spawnplayer">SpawnPlayer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#spawnplayer">SpawnPlayer</a></span>
</div>
</div></div>
<span class="label">.SpawnPlayer</span><a id="spawnplayer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Spawn the player's robot (an object of type 0),</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnObject</a>        <span class="comment">\ returning the object number of the new object in X</span>
                        <span class="comment">\ and currentObject</span>

 <span class="mne">STX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set playerObject to the object number of the newly</span>
                        <span class="comment">\ spawned object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ Set the player's energy level to 10</span>
 <span class="mne">STA</span> <a class="popup variable">playerEnergy</a>

 <span class="mne">LDA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If the landscape number is not 0000, jump to sply1</span>
 <span class="mne">BNE</span> <a class="popup destination">sply1</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set (xTile, zTile) = (8, 17)</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">17</span>                <span class="comment">\ So the player always starts on this tile in the first</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ landscape</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectOnTile</a>  <span class="comment">\ Place object #X on the tile anchored at (xTile, zTile)</span>

 <span class="mne">JMP</span> <a class="popup destination">SpawnTrees</a>         <span class="comment">\ Jump to SpawnTrees to add trees to the landscape and</span>
                        <span class="comment">\ move towards playing the game</span>

<span class="label">.sply1</span><a id="sply1" class="anchor"></a>

                        <span class="comment">\ If we get here then this is not landscape 0000</span>

 <span class="mne">LDA</span> <a class="popup variable">minEnemyAltitude</a>   <span class="comment">\ Set A to the altitude of the lowest enemy on the</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ If A >= 6 then set A = 6</span>
 <span class="mne">BCC</span> <a class="popup destination">sply2</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ So A = min(6, minEnemyAltitude)</span>

<span class="label">.sply2</span><a id="sply2" class="anchor"></a>

                        <span class="comment">\ By this point A contains an altitude that is no higher</span>
                        <span class="comment">\ than any enemies and is no greater than 6</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can use this as a cap on the player's starting</span>
                        <span class="comment">\ altitude to ensure that the player starts below all</span>
                        <span class="comment">\ the enemies, and in the bottom half of the landscape</span>
                        <span class="comment">\ (which ranges from altitude 1 to 11)</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectBelow</a>   <span class="comment">\ Attempt to place the player object on a tile that is</span>
                        <span class="comment">\ below the maximum altitude specified in A (though we</span>
                        <span class="comment">\ may end up placing the object higher than this)</span>

 <span class="mne">BCS</span> <a class="popup destination">sply1</a>              <span class="comment">\ If the call to PlaceObjectBelow sets the C flag then</span>
                        <span class="comment">\ the object has not been successfully placed, so loop</span>
                        <span class="comment">\ back to sply1 to keep trying, working through the</span>
                        <span class="comment">\ landscape's sequence of seed numbers until we do</span>
                        <span class="comment">\ manage to place the player on a tile</span>

                        <span class="comment">\ Otherwise we have placed the player object on a tile,</span>
                        <span class="comment">\ so now we fall through into SpawnTrees to add trees to</span>
                        <span class="comment">\ the landscape</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawntrees" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnTrees</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Add trees to the landscape, ideally placing them below all the</span>
             <span class="headerEntry">enemies in the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawntrees.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnplayer.html">SpawnPlayer</a> calls <a href="#spawntrees">SpawnTrees</a></span>
</div>
</div></div>
<span class="label">.SpawnTrees</span><a id="spawntrees" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">48</span>                <span class="comment">\ Set U = 48 - 3 * numberOfEnemies</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ We use this to cap the number of trees we add to the</span>
 <span class="mne">SBC</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ landscape (though it only affects higher levels)</span>
 <span class="mne">SBC</span> <a class="popup variable">numberOfEnemies</a>
 <span class="mne">STA</span> <a class="popup variable">U</a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeed0To22</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to the range 0 to 22</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A to this number, converted to the range 10 to 32</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">10</span>

 <span class="mne">CMP</span> <a class="popup variable">U</a>                  <span class="comment">\ If A >= U then set A = U</span>
 <span class="mne">BCC</span> <a class="popup destination">tree1</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ So A = min(U, A)</span>

<span class="label">.tree1</span><a id="tree1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">treeCounter</a>        <span class="comment">\ By this point A contains a value in the range 10 to 32</span>
                        <span class="comment">\ that's no greater than 48 - 3 * numberOfEnemies</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So when numberOfEnemies is six or more, this reduces</span>
                        <span class="comment">\ the value of A as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When numberOfEnemies = 6, range is 10 to 30</span>
                        <span class="comment">\   * When numberOfEnemies = 7, range is 10 to 27</span>
                        <span class="comment">\   * When numberOfEnemies = 8, range is 10 to 24</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As the number of trees determines the total amount of</span>
                        <span class="comment">\ energy in the landscape, this makes the levels get</span>
                        <span class="comment">\ even more difficult when there are higher enemy counts</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now try to add this number of trees to the</span>
                        <span class="comment">\ landscape, so store the result in treeCounter to use</span>
                        <span class="comment">\ as a counter in the following loop</span>

<span class="label">.tree2</span><a id="tree2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Spawn a tree (an object of type 2), returning the</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnObject</a>        <span class="comment">\ object number of the new object in X and currentObject</span>

 <span class="mne">LDA</span> <a class="popup variable">minEnemyAltitude</a>   <span class="comment">\ Set A to the altitude of the lowest enemy on the</span>
                        <span class="comment">\ landscape, so we try to spawn all the trees at a lower</span>
                        <span class="comment">\ altitude to the enemies</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectBelow</a>   <span class="comment">\ Attempt to place the player object on a tile that is</span>
                        <span class="comment">\ below the maximum altitude specified in A (though we</span>
                        <span class="comment">\ may end up placing the object higher than this)</span>

 <span class="mne">BCS</span> <a class="popup destination">tree3</a>              <span class="comment">\ If the call to PlaceObjectBelow sets the C flag then</span>
                        <span class="comment">\ the object has not been successfully placed, so jump</span>
                        <span class="comment">\ to tree3 to stop adding trees to the landscape</span>

 <span class="mne">DEC</span> <a class="popup variable">treeCounter</a>        <span class="comment">\ Decrement the tree counter</span>

 <span class="mne">BNE</span> <a class="popup destination">tree2</a>              <span class="comment">\ Loop back until we have spawned the number of trees</span>
                        <span class="comment">\ in treeCounter</span>

<span class="label">.tree3</span><a id="tree3" class="anchor"></a>

                        <span class="comment">\ We have now placed all the objects on the landscape,</span>
                        <span class="comment">\ so now we fall through into CheckSecretCode to check</span>
                        <span class="comment">\ that the player entered the correct secret code for</span>
                        <span class="comment">\ this landscape</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checksecretcode-part-1-of-2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckSecretCode (Part 1 of 2)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Generate the secret code for this landscape and optionally check</span>
             <span class="headerEntry">it against the entered code in the keyboard input buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checksecretcode_part_1_of_2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
<hr class="light">
 At this point we have generated the landscape and populated it with enemies,
 the player and trees, all using the landscape's sequence of seed numbers. This
 sequence will be different for each individual level, but will be exactly the
 same sequence every time we generate a specific level.

 We now keep generating the landscape's sequence of seed numbers to get the
 landscape's secret code, as follows:

   * Generate another 38 numbers from the sequence

   * The next four numbers in the sequence form the secret code

 To get a secret code of the form 12345678, we take the last four numbers and
 convert them into binary coded decimal (BCD) by using the GetNextSeedAsBCD
 routine. These four two-digit pairs then form the secret code, with each of
 the four numbers producing a pair of digits, building up the secret code from
 left to right (so in the order that they are written down).

 If we are displaying the landscape number on-screen at the end of a level,
 then the last four numbers are generated in the SpawnSecretCode3D routine, but
 if we are checking the secret code entered by the player, then we generate the
 last four numbers in this routine (plus one extra number that is ignored).
 This behaviour is controlled by the doNotPlayLandscape variable.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">doNotPlayLandscape</span>   <span class="argumentEntry">Controls how we generate the secret code and how we</span>
                        <span class="argumentEntry">return from the subroutine:</span>

                        <span class="argumentEntry">  * If bit 7 is set, return from part 1 of the routine</span>
                        <span class="argumentEntry">    after generating the secret code sequence up to, but</span>
                        <span class="argumentEntry">    not including, the last four BCD numbers (i.e. the</span>
                        <span class="argumentEntry">    secret code itself), so these can be generated and</span>
                        <span class="argumentEntry">    drawn by the SpawnSecretCode3D routine</span>

                        <span class="argumentEntry">  * If bit 7 is clear, jump to part 2 after generating</span>
                        <span class="argumentEntry">    the whole secret code sequence, plus one more code,</span>
                        <span class="argumentEntry">    checking the generated code against the code entered</span>
                        <span class="argumentEntry">    into the input buffer as we go</span>

                        <span class="argumentEntry">The first one is used when displaying a landscape number</span>
                        <span class="argumentEntry">for a completed level, while the second is used to check</span>
                        <span class="argumentEntry">an entered secret code before playing the landscape</span>

</div></div>
<span class="label">.CheckSecretCode</span><a id="checksecretcode" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">170</span>               <span class="comment">\ Set X = 170 to use as a loop counter for when we</span>
                        <span class="comment">\ calculate the secret code, so the following loop</span>
                        <span class="comment">\ counts down from 170 to 128 (inclusive, so that's a</span>
                        <span class="comment">\ total of 38 + 4 + 1 iterations)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the value for when bit 7 of doNotPlayLandscape</span>
                        <span class="comment">\ is clear, so that's when we are about to play the game</span>
                        <span class="comment">\ and we need to generate the secret code in the</span>
                        <span class="comment">\ following loop so we can check it against the code</span>
                        <span class="comment">\ entered by the player (which is still in the keyboard</span>
                        <span class="comment">\ input buffer from when they typed it in)</span>

 <span class="mne">LDY</span> <a class="popup variable">stashOffset</a><span class="operator">-</span><span class="decimal">170</span>,<span class="register">X</span>  <span class="comment">\ Set Y = stashOffset</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value of stashOffset is set in the SetSecretStash</span>
                        <span class="comment">\ routine during the landscape drawing process, where it</span>
                        <span class="comment">\ is set to a value that is unique and consistent for</span>
                        <span class="comment">\ each individual landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use it as an offset into the secretCodeStash list</span>
                        <span class="comment">\ below, so the stash moves around in memory depending</span>
                        <span class="comment">\ on the landscape number, making this whole process</span>
                        <span class="comment">\ harder to follow (and therefore harder to crack)</span>

 <span class="mne">BIT</span> <a class="popup variable">doNotPlayLandscape</a> <span class="comment">\ If bit 7 of doNotPlayLandscape is clear then the next</span>
 <span class="mne">BPL</span> <a class="popup destination">srct1</a>              <span class="comment">\ step is to play the landscape, so skip the following</span>
                        <span class="comment">\ to leave X set to 170</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">165</span>               <span class="comment">\ Set X = 165 to use as a loop counter for when we</span>
                        <span class="comment">\ calculate the secret code, so the following loop</span>
                        <span class="comment">\ counts down from 165 to 128 (inclusive, so that's a</span>
                        <span class="comment">\ total of 38 iterations)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the value for when bit 7 of doNotPlayLandscape</span>
                        <span class="comment">\ is set, so that's when we are not going to play the</span>
                        <span class="comment">\ game but are just generating the secret code, in which</span>
                        <span class="comment">\ case we stop iterating just before the secret code is</span>
                        <span class="comment">\ generated so the SpawnSecretCode3D can finish the job</span>

                        <span class="comment">\ We now loop through a number of iterations, counting</span>
                        <span class="comment">\ X down towards 128</span>
                        <span class="comment">\</span>
                        <span class="comment">\ On each iteration we do three things:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We generate the next number from the landscape's</span>
                        <span class="comment">\     sequence of seed numbers, converted to BCD</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We test this against the contents of memory from</span>
                        <span class="comment">\     either &0D19 or &0D14 down to &0CEF and rotate the</span>
                        <span class="comment">\     result into bit 0 of secretCodeChecks (the result</span>
                        <span class="comment">\     is only relevant if we are checking the secret</span>
                        <span class="comment">\     code against an entered code)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We add the objectFlags for the Sentinel (which is</span>
                        <span class="comment">\     simply a way of incorporating a known value, in</span>
                        <span class="comment">\     this case %01111111) and store the results in the</span>
                        <span class="comment">\     table at secretCodeStash, from the offset in Y</span>
                        <span class="comment">\     onwards, i.e. from offset stashOffset onwards</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we are checking the code against an entered code,</span>
                        <span class="comment">\ then the second step is the important part, and this</span>
                        <span class="comment">\ is how it works</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The inputBuffer is at &0CF0, and it still holds the</span>
                        <span class="comment">\ code that the player entered in &0CF0 to &0CF3, with</span>
                        <span class="comment">\ the first two digits of the code in &0CF3 and the last</span>
                        <span class="comment">\ two digits in &0CF0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that when X = 170, the last five checks in</span>
                        <span class="comment">\ each iteration test against the four BCD numbers in</span>
                        <span class="comment">\ the entered code, in the correct order, with one extra</span>
                        <span class="comment">\ generation and check that is ignored (presumably to</span>
                        <span class="comment">\ make this whole process harder to follow)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if bits 1 to 4 of secretCodeChecks are set by the</span>
                        <span class="comment">\ end of the process, the secret code in the keyboard</span>
                        <span class="comment">\ input buffer matches the secret code that we just</span>
                        <span class="comment">\ generated for this level</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The third step is only relevant if we are going on to</span>
                        <span class="comment">\ play the game, as this feeds into a second secret code</span>
                        <span class="comment">\ check that is performed in the GetRowVisibility</span>
                        <span class="comment">\ routine, which is only run during gameplay</span>

<span class="label">.srct1</span><a id="srct1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedAsBCD</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to a binary coded decimal</span>
                        <span class="comment">\ (BCD) number</span>

                        <span class="comment">\ We now compare this generated number with the contents</span>
                        <span class="comment">\ of memory, working our way down towards the keyboard</span>
                        <span class="comment">\ input buffer (towards the end of the iterations)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ X counts down to 128, and for each iteration we check</span>
                        <span class="comment">\ the generated number against a location in memory</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For the checks to work, we need the last five bytes</span>
                        <span class="comment">\ to be the four secret code numbers in inputBuffer,</span>
                        <span class="comment">\ plus one more, so:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X > 132, we are checking against memory that</span>
                        <span class="comment">\     comes after the inputBuffer, and we can safely</span>
                        <span class="comment">\     ignore the results</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X = 132, 131, 130 and 129 we need to be</span>
                        <span class="comment">\     checking against the four numbers in inputBuffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X = 128, we are doing the very last check,</span>
                        <span class="comment">\     which we can also ignore</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The comparison is done by subtracting the contents of</span>
                        <span class="comment">\ the memory location we are checking from the BCD</span>
                        <span class="comment">\ number we just generated</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is done with a SBC byteToCheck,X instruction</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To work out what byteToCheck should be, consider that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X = 129, we check the byte at inputBuffer</span>
                        <span class="comment">\                   (i.e. the last 2 digits of the code</span>
                        <span class="comment">\                   when written down or typed in)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X = 130, we check the byte at inputBuffer+1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X = 131, we check the byte at inputBuffer+2</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When X = 132, we check the byte at inputBuffer+3</span>
                        <span class="comment">\                   (i.e. the first 2 digits of the code</span>
                        <span class="comment">\                   when written down or typed in)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To make this work, then, we need this instruction:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   SBC inputBuffer-129,X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that for BeebAsm to parse this properly, we need</span>
                        <span class="comment">\ to wrap the inputBuffer-129 part in brackets, and we</span>
                        <span class="comment">\ have to use square brackets so it doesn't look like an</span>
                        <span class="comment">\ indirect address instruction</span>

 <span class="mne">SEC</span>                        <span class="comment">\ Subtract the byte from memory that we are checking</span>
 <span class="mne">SBC</span> <span class="bracket">[</span><a class="popup variable">inputBuffer</a><span class="operator">-</span><span class="decimal">129</span><span class="bracket">]</span>,<span class="register">X</span>    <span class="comment">\ from the generated number</span>

 <span class="mne">BEQ</span> <a class="popup destination">srct2</a>              <span class="comment">\ If A = 0 then we have a match between the number in</span>
                        <span class="comment">\ memory and the generated number, so jump to srct2 to</span>
                        <span class="comment">\ keep the C flag set, so we can rotate this into</span>
                        <span class="comment">\ secretCodeChecks to indicate a success</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Otherwise we do not have a match, so clear the C flag</span>
                        <span class="comment">\ and rotate this into secretCodeChecks to indicate a</span>
                        <span class="comment">\ failure</span>

<span class="label">.srct2</span><a id="srct2" class="anchor"></a>

 <span class="mne">ROL</span> <a class="popup variable">secretCodeChecks</a>   <span class="comment">\ Rotate the C flag into bit 0 of secretCodeChecks, so</span>
                        <span class="comment">\ secretCodeChecks contains a record of the last eight</span>
                        <span class="comment">\ matches between memory and the generated sequence of</span>
                        <span class="comment">\ numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We only care about the last five comparisons, of which</span>
                        <span class="comment">\ we ignore the very last, as the preceding four results</span>
                        <span class="comment">\ are for the four BCD numbers in the keyboard input</span>
                        <span class="comment">\ buffer (i.e. the entered number)</span>

                        <span class="comment">\ We now move on to populate the secret code stash,</span>
                        <span class="comment">\ which contains the result of each of the comparisons</span>
                        <span class="comment">\ with %01111111 added to them</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The stash is checked in the GetRowVisibility routine</span>
                        <span class="comment">\ and will abort the game if the values aren't correct,</span>
                        <span class="comment">\ so this enables a second secret code check once the</span>
                        <span class="comment">\ game has started</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The secret stash adds a known value into the mix, by</span>
                        <span class="comment">\ fetching the value of objectFlags, which contains the</span>
                        <span class="comment">\ object flags for object #0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object #0 is always the Sentinel, and the Sentinel</span>
                        <span class="comment">\ is always placed on top of the Sentinel's tower, so</span>
                        <span class="comment">\ the object flags for the Sentinel are constructed as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 0-5 = the number of the object beneath this</span>
                        <span class="comment">\                one</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 6 = set to indicate that this object is on top</span>
                        <span class="comment">\             of another object</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 = clear to indicate that this object number</span>
                        <span class="comment">\             is allocated to an object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The Sentinel's tower is always the first object to be</span>
                        <span class="comment">\ spawned, and object numbers are allocated from 63 and</span>
                        <span class="comment">\ down, so this means the tower is always object #63, or</span>
                        <span class="comment">\ %111111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The Sentinel's object flags are therefore %01111111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ See the PlaceObjectOnTile routine for details of how</span>
                        <span class="comment">\ the Sentinel's object flags are constructed</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + %01111111</span>
 <span class="mne">ADC</span> <a class="popup variable">objectFlags</a>

 <span class="mne">STA</span> <a class="popup variable">secretCodeStash</a>,<span class="register">Y</span>  <span class="comment">\ Store A in the Y-th entry in the secretCodeStash list</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The addition above means that an entry of %01111111 in</span>
                        <span class="comment">\ that stash indicates that A was zero before the</span>
                        <span class="comment">\ addition, which also indicates a match</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the entered code matches the generated sequence of</span>
                        <span class="comment">\ numbers (i.e. it matches the landscape's secret code)</span>
                        <span class="comment">\ then the four corresponding entries in secretCodeStash</span>
                        <span class="comment">\ will be %01111111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ See the GetRowVisibility routine to see this in action</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y so we build the stash upwards</span>
                        <span class="comment">\ in memory</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter so the comparisons move</span>
                        <span class="comment">\ down in memory, towards inputBuffer</span>

 <span class="mne">BMI</span> <a class="popup destination">srct1</a>              <span class="comment">\ Look back to compare the next byte until we have</span>
                        <span class="comment">\ compared the bytes all the way down to X = 128</span>

 <span class="mne">ASL</span> <a class="popup variable">doNotPlayLandscape</a> <span class="comment">\ Set the C flag to bit 7 of doNotPlayLandscape and</span>
                        <span class="comment">\ clear bit 7 of doNotPlayLandscape, so from this point</span>
                        <span class="comment">\ on any calls to GenerateLandscape will preview and</span>
                        <span class="comment">\ play the game</span>

 <span class="mne">BCC</span> <a class="popup destination">srct4</a>              <span class="comment">\ If bit 7 of doNotPlayLandscape was clear then jump to</span>
                        <span class="comment">\ part 2 to check the secret code and either show the</span>
                        <span class="comment">\ "WRONG SECRET CODE" error or play the game</span>

                        <span class="comment">\ Otherwise bit 7 of doNotPlayLandscape was set, so we</span>
                        <span class="comment">\ return from the subroutine normally without playing</span>
                        <span class="comment">\ the game</span>

<span class="label">.srct3</span><a id="srct3" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We get to this point by calling the SpawnPlayer</span>
                        <span class="comment">\ routine from one of two places:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * PreviewLandscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * FinishLandscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and then either failing the secret code checks or</span>
                        <span class="comment">\ finishing the current landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we got here from PreviewLandscape, then the next</span>
                        <span class="comment">\ instruction jumps to SecretCodeError to display the</span>
                        <span class="comment">\ "WRONG SECRET CODE" error, wait for a key press and</span>
                        <span class="comment">\ rejoin the main title loop</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we got here from FinishLandscape, then the next</span>
                        <span class="comment">\ instructions display the landscape's secret code on</span>
                        <span class="comment">\ completion of the level</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-landscapecolour3" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">landscapeColour3</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Physical colours for colour 3 in the game palette for the</span>
             <span class="headerEntry">different numbers of enemies</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/landscapecolour3.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a> uses <a href="#landscapecolour3">landscapeColour3</a></span>
</div>
</div></div>
<span class="label">.landscapeColour3</span><a id="landscapecolour3" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">2</span>                 <span class="comment">\ Enemy count = 1: blue, black, white, green</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Enemy count = 2: blue, black, yellow, red</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Enemy count = 3: blue, black, cyan, yellow</span>

 <span class="mne">EQUB</span> <span class="decimal">6</span>                 <span class="comment">\ Enemy count = 4: blue, black, red, cyan</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Enemy count = 5: blue, black, white, red</span>

 <span class="mne">EQUB</span> <span class="decimal">6</span>                 <span class="comment">\ Enemy count = 6: blue, black, yellow, cyan</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Enemy count = 7: blue, black, cyan, red</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Enemy count = 8: blue, black, red, yellow</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checksecretcode-part-2-of-2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckSecretCode (Part 2 of 2)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Check the results of the secret code matching process, and if the</span>
             <span class="headerEntry">secret codes match, jump to PlayGame to play the game</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checksecretcode_part_2_of_2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.srct4</span><a id="srct4" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">secretCodeChecks</a>   <span class="comment">\ If bits 1 to 4 of secretCodeChecks are not all set,</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00011110</span>         <span class="comment">\ then one or more of the four BCD bytes in the secret</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00011110</span>         <span class="comment">\ code do not match, so jump to srct3 to return from the</span>
 <span class="mne">BNE</span> <a class="popup destination">srct3</a>              <span class="comment">\ subroutine normally, to display the "WRONG SECRET</span>
                        <span class="comment">\ CODE" error page</span>

                        <span class="comment">\ If get here then bits 1 to 4 of secretCodeChecks are</span>
                        <span class="comment">\ all set, so the entered secret entry code matches the</span>
                        <span class="comment">\ generated code, so we can now proceed to playing the</span>
                        <span class="comment">\ landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The following code simply jumps to the PlayGame</span>
                        <span class="comment">\ routine, but in an obfuscated way that changes the</span>
                        <span class="comment">\ return address on the stack to PlayGame-1, so the RTS</span>
                        <span class="comment">\ instruction will jump to PlayGame (as that's how the</span>
                        <span class="comment">\ RTS instruction works)</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Remove the return address from the stack and discard</span>
 <span class="mne">PLA</span>                    <span class="comment">\ it</span>

                        <span class="comment">\ In the following we use the value in objectFlags,</span>
                        <span class="comment">\ which contains the object flags for the object #0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object #0 is always the Sentinel, and the Sentinel</span>
                        <span class="comment">\ is always placed on top of the Sentinel's tower, so</span>
                        <span class="comment">\ the object flags for the Sentinel are constructed as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 0-5 = the number of the object beneath this</span>
                        <span class="comment">\                one</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 6 = set to indicate that this object is on top</span>
                        <span class="comment">\             of another object</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 = clear to indicate that this object number</span>
                        <span class="comment">\             is allocated to an object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The Sentinel's tower is always the first object to be</span>
                        <span class="comment">\ spawned, and object numbers are allocated from 63 and</span>
                        <span class="comment">\ down, so this means the tower is always object #63, or</span>
                        <span class="comment">\ %111111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The Sentinel's object flags are therefore %01111111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The following code uses this fact to push the address</span>
                        <span class="comment">\ of PlayGame-1 onto the stack, but in a totally</span>
                        <span class="comment">\ obfuscated manner</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It calculates the high byte as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\     objectFlags + HI(PlayGame-1) - %01111111</span>
                        <span class="comment">\   = %01111111 + HI(PlayGame-1) - %01111111</span>
                        <span class="comment">\   = HI(PlayGame-1)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the low byte as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\     high byte + LO(PlayGame-1) - HI(PlayGame-1)</span>
                        <span class="comment">\   = HI(PlayGame-1) + LO(PlayGame-1) - HI(PlayGame-1)</span>
                        <span class="comment">\   = LO(PlayGame-1)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For the first calculation, we need to apply a little</span>
                        <span class="comment">\ hack to the code to get around a limitation in BeebAsm</span>
                        <span class="comment">\ that rejects negative constants</span>
                        <span class="comment">\</span>
                        <span class="comment">\ HI(PlayGame-1) - %01111111 in the first calculation is</span>
                        <span class="comment">\ negative, so to persuade BeebAsm to accept it as a</span>
                        <span class="comment">\ constant, we can wrap it in LO() to convert it into</span>
                        <span class="comment">\ a two's complement value that BeebAsm will accept</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The LO() part is effectively applying MOD 256 in a way</span>
                        <span class="comment">\ that works with negative arguments</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Push PlayGame-1 onto the stack, high byte first</span>
 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">PlayGame</a><span class="operator">-</span><span class="decimal">1</span><span class="bracket">)</span> <span class="operator">-</span> <span class="binary">%01111111</span><span class="bracket">)</span>
 <span class="mne">PHA</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">PlayGame</a><span class="operator">-</span><span class="decimal">1</span><span class="bracket">)</span> <span class="operator">-</span> HI(PlayGame<span class="operator">-</span><span class="decimal">1</span><span class="bracket">)</span>
 <span class="mne">PHA</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine, which will take the</span>
                        <span class="comment">\ address off the stack, increment it and jump to that</span>
                        <span class="comment">\ address</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this jumps to PlayGame to play the actual game</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-landscapecolour2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">landscapeColour2</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Physical colours for colour 2 in the game palette for the</span>
             <span class="headerEntry">different numbers of enemies</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/landscapecolour2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a> uses <a href="#landscapecolour2">landscapeColour2</a></span>
</div>
</div></div>
<span class="label">.landscapeColour2</span><a id="landscapecolour2" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">7</span>                 <span class="comment">\ Enemy count = 1: blue, black, white, green</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Enemy count = 2: blue, black, yellow, red</span>

 <span class="mne">EQUB</span> <span class="decimal">6</span>                 <span class="comment">\ Enemy count = 3: blue, black, cyan, yellow</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Enemy count = 4: blue, black, red, cyan</span>

 <span class="mne">EQUB</span> <span class="decimal">7</span>                 <span class="comment">\ Enemy count = 5: blue, black, white, red</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Enemy count = 6: blue, black, yellow, cyan</span>

 <span class="mne">EQUB</span> <span class="decimal">6</span>                 <span class="comment">\ Enemy count = 7: blue, black, cyan, red</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Enemy count = 8: blue, black, red, yellow</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-addenemiestotiles" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">AddEnemiesToTiles</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Add the required number of enemies to the landscape, starting from</span>
             <span class="headerEntry">the highest altitude and working down, with one enemy per contour</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/addenemiestotiles.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a> calls <a href="#addenemiestotiles">AddEnemiesToTiles</a></span>
</div>
</div></div>
<span class="label">.AddEnemiesToTiles</span><a id="addenemiestotiles" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetHighestTiles</a>    <span class="comment">\ Calculate both the highest tiles in each 4x4 block of</span>
                        <span class="comment">\ tiles in the landscape and the altitude of the highest</span>
                        <span class="comment">\ tile, putting the results in the following variables:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * maxAltitude contains the altitude of the highest</span>
                        <span class="comment">\     tile in each 4x4 block in the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xTileMaxAltitude contains the tile x-coordinate of</span>
                        <span class="comment">\     the highest tile in each 4x4 block in the</span>
                        <span class="comment">\     landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * zTileMaxAltitude contains the tile z-coordinate of</span>
                        <span class="comment">\     the highest tile in each 4x4 block in the</span>
                        <span class="comment">\     landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileAltitude contains the altitude of the highest</span>
                        <span class="comment">\     tile in the entire landscape</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now loop through the number of enemies, adding one</span>
                        <span class="comment">\ enemy for each loop and iterating numberOfEnemies</span>
                        <span class="comment">\ times, so set an enemy counter in X to count the</span>
                        <span class="comment">\ enemies as we add them</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If this is a level with only one enemy, then that</span>
                        <span class="comment">\ enemy must be the Sentinel, so when X = 0, we add the</span>
                        <span class="comment">\ Sentinel to the landscape, otherwise we add a sentry</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Enemies are allocated object numbers from 0 to 7, with</span>
                        <span class="comment">\ the Sentinel in object #0, and sentries from object #1</span>
                        <span class="comment">\ to object #7 (if there are any)</span>

<span class="label">.aden1</span><a id="aden1" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">enemyCounter</a>       <span class="comment">\ Set enemyCounter to the enemy counter in X, so we can</span>
                        <span class="comment">\ retrieve it later in the loop</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set the object type for object #X to type 1, which</span>
 <span class="mne">STA</span> <a class="popup variable">objectTypes</a>,<span class="register">X</span>      <span class="comment">\ denotes a sentry, so we spawn sentries in objects #1</span>
                        <span class="comment">\ to #numberOfEnemies (this also sets the type for</span>
                        <span class="comment">\ object #0 to type 1, but this gets overridden when</span>
                        <span class="comment">\ the Sentinel is spawned as object #0 below)</span>

                        <span class="comment">\ We now work down the landscape, from the highest peaks</span>
                        <span class="comment">\ down to lower altitudes, looking for suitable tile</span>
                        <span class="comment">\ blocks to place an enemy</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To do this we start with tile blocks that are at an</span>
                        <span class="comment">\ altitude of tileAltitude (which we set above to the</span>
                        <span class="comment">\ altitude of the highest tile in the landscape), and we</span>
                        <span class="comment">\ work down in steps of 16</span>

<span class="label">.aden2</span><a id="aden2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTilesAtAltitude</a> <span class="comment">\ Set tilesAtAltitude to a list of tile block numbers</span>
                        <span class="comment">\ whose highest tiles in the 4x4 block are at an</span>
                        <span class="comment">\ altitude of tileAltitude, returning the length of the</span>
                        <span class="comment">\ list in T and a bit mask in bitMask that has a</span>
                        <span class="comment">\ matching number of leading zeroes as T</span>

 <span class="mne">BCC</span> <a class="popup destination">aden3</a>              <span class="comment">\ If the call to GetTilesAtAltitude returns at least one</span>
                        <span class="comment">\ tile block at this altitude then the C flag will be</span>
                        <span class="comment">\ clear, so jump to aden3 to add an enemy to one of the</span>
                        <span class="comment">\ matched tile blocks</span>

 <span class="mne">LDA</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ Otherwise we didn't find any tile blocks at this</span>
 <span class="mne">SEC</span>                    <span class="comment">\ altitude, so subtract 1 from the high nibble of</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="binary">%00010000</span>         <span class="comment">\ tileAltitude to move down one level (we subtract from</span>
 <span class="mne">STA</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ the high nibble because tileAltitude contains tile</span>
                        <span class="comment">\ data, which has the tile altitude in the high nibble</span>
                        <span class="comment">\ and the tile shape in the low nibble)</span>

 <span class="mne">BNE</span> <a class="popup destination">aden2</a>              <span class="comment">\ Loop back to check for tile blocks at the lower</span>
                        <span class="comment">\ altitude until we have reached an altitude of zero</span>

 <span class="mne">STX</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ When the GetTilesAtAltitude routine returns with no</span>
                        <span class="comment">\ matching tile blocks, it also returns a value of &FF</span>
                        <span class="comment">\ in X, so this sets numberOfEnemies to -1</span>

 <span class="mne">JMP</span> <a class="popup destination">aden6</a>              <span class="comment">\ Jump to aden6 to set the value of minEnemyAltitude</span>
                        <span class="comment">\ and return from the subroutine</span>

<span class="label">.aden3</span><a id="aden3" class="anchor"></a>

                        <span class="comment">\ If we get here then we have found at least one tile</span>
                        <span class="comment">\ block at the current altitude, so we now pick one of</span>
                        <span class="comment">\ them, using the next seed number to choose which one,</span>
                        <span class="comment">\ and we then add an enemy to the highest tile in the</span>
                        <span class="comment">\ block</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We only pick one tile at this altitude so that the</span>
                        <span class="comment">\ enemies are spread out over various altitudes</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">AND</span> <a class="popup variable">bitMask</a>            <span class="comment">\ The call to GetTilesAtAltitude above sets bitMask to a</span>
                        <span class="comment">\ bit mask that has a matching number of leading zeroes</span>
                        <span class="comment">\ as the number of tile blocks at this altitude, so this</span>
                        <span class="comment">\ instruction converts A into a number with the same</span>
                        <span class="comment">\ range of non-zero bits as T</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If A >= T then jump back to fetch another seed number</span>
 <span class="mne">BCS</span> <a class="popup destination">aden3</a>

                        <span class="comment">\ When we get here, A is a seed number and A &lt; T, so</span>
                        <span class="comment">\ A can be used as an offset into the list of tile</span>
                        <span class="comment">\ blocks in tilesAtAltitude (which contains T entries)</span>

 <span class="mne">TAY</span>                    <span class="comment">\ Set Y to the seed number in A so we can use it as an</span>
                        <span class="comment">\ index in the following instruction</span>

 <span class="mne">LDX</span> <a class="popup variable">tilesAtAltitude</a>,<span class="register">Y</span>  <span class="comment">\ Set X to the Y-th tile block number in the list of</span>
                        <span class="comment">\ tile blocks at an altitude of tilesAtAltitude</span>

                        <span class="comment">\ We now zero the maximum tile altitudes for tile block</span>
                        <span class="comment">\ X and the eight surrounding tile blocks, so that</span>
                        <span class="comment">\ further calls to GetTilesAtAltitude won't match these</span>
                        <span class="comment">\ tiles, so we therefore won't put any enemies on those</span>
                        <span class="comment">\ blocks (this ensures we don't create enemies too close</span>
                        <span class="comment">\ to each other)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so we can zero the maximum tile altitudes</span>
                        <span class="comment">\ for tile block X and the eight surrounding blocks</span>

 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">-</span><span class="decimal">9</span>,<span class="register">X</span>    <span class="comment">\ Zero the altitudes of the three tile blocks in the row</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">-</span><span class="decimal">8</span>,<span class="register">X</span>    <span class="comment">\ in front of tile block X</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">-</span><span class="decimal">7</span>,<span class="register">X</span>

 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">-</span><span class="decimal">1</span>,<span class="register">X</span>    <span class="comment">\ Zero the altitudes of tile block X and the two blocks</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a>,<span class="register">X</span>      <span class="comment">\ to the left and right</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>

 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">+</span><span class="decimal">7</span>,<span class="register">X</span>    <span class="comment">\ Zero the altitudes of the three tile blocks in the row</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">+</span><span class="decimal">8</span>,<span class="register">X</span>    <span class="comment">\ behind tile block X</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a><span class="operator">+</span><span class="decimal">9</span>,<span class="register">X</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileMaxAltitude</a>,<span class="register">X</span> <span class="comment">\ Set (xTile, zTile) to the tile coordinates of the</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ highest tile in the tile block, which is where we can</span>
 <span class="mne">LDA</span> <a class="popup variable">zTileMaxAltitude</a>,<span class="register">X</span> <span class="comment">\ place an enemy</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>

 <span class="mne">LDX</span> <a class="popup variable">enemyCounter</a>       <span class="comment">\ Set X to the loop counter that we stored above</span>

 <span class="mne">BNE</span> <a class="popup destination">aden4</a>              <span class="comment">\ If the loop number is non-zero then we are adding a</span>
                        <span class="comment">\ sentry, so jump to aden4</span>

                        <span class="comment">\ If we get here then the enemy counter is zero, so we</span>
                        <span class="comment">\ are adding the Sentinel and the Sentinel's tower</span>

 <span class="mne">STA</span> <a class="popup variable">zTileSentinel</a>      <span class="comment">\ Set (xTileSentinel, zTileSentinel) to the tile</span>
 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ coordinates of the highest tile in the tile block,</span>
 <span class="mne">STA</span> <a class="popup variable">xTileSentinel</a>      <span class="comment">\ which we put in (xTile, zTile) above, so this is the</span>
                        <span class="comment">\ tile coordinate where we now spawn the Sentinel</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\ Set the object type for object #0 to type 5, which</span>
 <span class="mne">STA</span> <a class="popup variable">objectTypes</a>        <span class="comment">\ denotes the Sentinel (so the Sentinel is always</span>
                        <span class="comment">\ object #0, while other objects that are spawned are</span>
                        <span class="comment">\ allocated to object #63 and work down the numbers)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Spawn the Sentinel's tower (an object of type 6),</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnObject</a>        <span class="comment">\ returning the object number of the new object in X</span>
                        <span class="comment">\ and currentObject</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectOnTile</a>  <span class="comment">\ Place object #X on the tile anchored at (xTile, zTile)</span>
                        <span class="comment">\ to place the tower on the landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set the tower object's objectYawAngle to 0, so it's</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ facing forwards and into the screen</span>

 <span class="mne">LDX</span> <a class="popup variable">enemyCounter</a>       <span class="comment">\ Set X to the enemy counter, so X now contains the</span>
                        <span class="comment">\ object number of the Sentinel (which is always zero</span>
                        <span class="comment">\ as we only add the Sentinel on the first iteration of</span>
                        <span class="comment">\ the loop)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now place the Sentinel object on the tile, which</span>
                        <span class="comment">\ therefore places the Sentinel on top of the tower</span>

<span class="label">.aden4</span><a id="aden4" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectOnTile</a>  <span class="comment">\ Place object #X on the tile anchored at (xTile, zTile)</span>
                        <span class="comment">\ to place the Sentinel or sentry in the correct place</span>
                        <span class="comment">\ on the landscape</span>

 <span class="mne">JSR</span> <a class="popup destination">ResetMeanieScan</a>    <span class="comment">\ Reset the data stored for any meanie scans that the</span>
                        <span class="comment">\ enemy has tried in the past, so the enemy can start</span>
                        <span class="comment">\ looking for potential meanies with a clean slate</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set the C flag to bit 7 of A (this also clears bit 7</span>
                        <span class="comment">\ of A but that doesn't matter as we are about to clear</span>
                        <span class="comment">\ it in the next instruction anyway)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set A to a number in the range 5 to 63</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="decimal">5</span>

 <span class="mne">STA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">X</span> <span class="comment">\ Set the enemy's tactics timer to the number in A, so</span>
                        <span class="comment">\ we wait for A * 0.06 seconds before applying tactics</span>
                        <span class="comment">\ to this enemy in the ApplyTactics routine (so that's</span>
                        <span class="comment">\ somewhere between 5 * 0.06 = 0.3 seconds and</span>
                        <span class="comment">\ 63 * 0.06 = 3.8 seconds)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">20</span>                <span class="comment">\ Set A to either 20 or 236, depending on the value that</span>
 <span class="mne">BCC</span> <a class="popup destination">aden5</a>              <span class="comment">\ we gave to the C flag above</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">236</span>

<span class="label">.aden5</span><a id="aden5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">enemyYawStep</a>,<span class="register">X</span>     <span class="comment">\ Set enemyYawStep for the enemy to the value of A,</span>
                        <span class="comment">\ so this sets the yaw step (i.e. the rate of rotation)</span>
                        <span class="comment">\ to either 20 or 236</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The degree system in the Sentinel looks like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\            0</span>
                        <span class="comment">\      -32   |   +32         Overhead view of object</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /             0 = looking straight ahead</span>
                        <span class="comment">\           \|/              +64 = looking sharp right</span>
                        <span class="comment">\   -64 -----+----- +64      -64 = looking sharp left</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment">\          / | \</span>
                        <span class="comment">\         /  |  \</span>
                        <span class="comment">\      -96   |   +96</span>
                        <span class="comment">\           128</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The enemyYawStep speed is the angle through which the</span>
                        <span class="comment">\ enemy rotates on each rotation, so this means we are</span>
                        <span class="comment">\ setting the rotation speed to +20 degrees (a clockwise</span>
                        <span class="comment">\ turn) or -20 degrees (an anticlockwise turn)</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the enemy loop counter in X</span>

 <span class="mne">CPX</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ If we have added a total of numberOfEnemies enemies,</span>
 <span class="mne">BCS</span> <a class="popup destination">aden6</a>              <span class="comment">\ jump to aden6 to finish off</span>

 <span class="mne">JMP</span> <a class="popup destination">aden1</a>              <span class="comment">\ Otherwise loop back to add another enemy</span>

<span class="label">.aden6</span><a id="aden6" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ Extract the altitude from tileAltitude, which is in</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ the high nibble (as tileAltitude contains tile data,</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ which has the tile altitude in the high nibble and</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ the tile shape in the low nibble)</span>
 <span class="mne">LSR</span> <span class="register">A</span>

 <span class="mne">STA</span> <a class="popup variable">minEnemyAltitude</a>   <span class="comment">\ Store the result in minEnemyAltitude, so it contains</span>
                        <span class="comment">\ the lowest altitude of the enemies we just added to</span>
                        <span class="comment">\ the landscape</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag (though this has no effect as the C</span>
                        <span class="comment">\ flag is set as soon as we return to the SpawnEnemies</span>
                        <span class="comment">\ routine)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettilesataltitude" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTilesAtAltitude</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Return a list of tile blocks at a specified altitude</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettilesataltitude.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/addenemiestotiles.html">AddEnemiesToTiles</a> calls <a href="#gettilesataltitude">GetTilesAtAltitude</a></span>
</div>
<hr class="light">
 Argument:

   tileAltitude        The altitude to search for

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag:</span>

                        <span class="argumentEntry">  * Clear if at least one tile block is at an altitude</span>
                        <span class="argumentEntry">    of tileAltitude</span>

                        <span class="argumentEntry">  * Set if no tile blocks are at an altitude of</span>
                        <span class="argumentEntry">    tileAltitude, in which case X is set to &FF</span>

   <span class="argumentLabel">tilesAtAltitude</span>      <span class="argumentEntry">A list of tile block numbers whose highest tiles match</span>
                        <span class="argumentEntry">the altitude in tileAltitude</span>

   <span class="argumentLabel">T</span>                    <span class="argumentEntry">The number of entries in the list at tilesAtAltitude</span>

   <span class="argumentLabel">bitMask</span>              <span class="argumentEntry">A bit mask with a matching number of leading zeroes as T</span>

</div></div>
<span class="label">.GetTilesAtAltitude</span><a id="gettilesataltitude" class="anchor"></a>

                        <span class="comment">\ We start by fetching all the 4x4 tile blocks from the</span>
                        <span class="comment">\ landscape whose altitude matches tileAltitude (so</span>
                        <span class="comment">\ that's all the 4x4 blocks whose highest tile is at an</span>
                        <span class="comment">\ altitude of tileAltitude)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set an index in X to work through all 4x4 tile blocks,</span>
                        <span class="comment">\ of which there are 64</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 to count the number of tile blocks whose</span>
                        <span class="comment">\ altitude matches tileAltitude</span>

<span class="label">.galt1</span><a id="galt1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">maxAltitude</a>,<span class="register">X</span>      <span class="comment">\ If the highest tile in the X-th tile block does not</span>
 <span class="mne">CMP</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ have an altitude of tileAltitude, jump to galt2 to</span>
 <span class="mne">BNE</span> <a class="popup destination">galt2</a>              <span class="comment">\ move on to the next tile block</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Store the number of the tile block in the Y-th byte of</span>
 <span class="mne">STA</span> <a class="popup variable">tilesAtAltitude</a>,<span class="register">Y</span>  <span class="comment">\ tilesAtAltitude, so we end up compiling a list of all</span>
                        <span class="comment">\ the tile blocks that have an altitude of tileAltitude</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the counter in Y as we have just added a</span>
                        <span class="comment">\ block number to tilesAtAltitude</span>

<span class="label">.galt2</span><a id="galt2" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the block counter in X</span>

 <span class="mne">BPL</span> <a class="popup destination">galt1</a>              <span class="comment">\ Loop back until we have checked the altitudes of all</span>
                        <span class="comment">\ the tile blocks</span>

                        <span class="comment">\ By this point we have all the tile blocks with an</span>
                        <span class="comment">\ altitude of tileAltitude in a list of length Y at</span>
                        <span class="comment">\ tilesAtAltitude</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set A to the length of the list at tilesAtAltitude</span>

 <span class="mne">BEQ</span> <a class="popup destination">galt4</a>              <span class="comment">\ If the list is empty then jump to galt4 return from</span>
                        <span class="comment">\ the subroutine with the C flag clear</span>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set T to the length of the list at tilesAtAltitude</span>

                        <span class="comment">\ We now set bitMask to a bit mask that covers all the</span>
                        <span class="comment">\ non-zero bits in the list length in A, so if A is of</span>
                        <span class="comment">\ the form %001xxxxx, for example, then bitMask will</span>
                        <span class="comment">\ contain %00111111, while A being like %000001xx will</span>
                        <span class="comment">\ give a bitMask of %00000111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To do this we count the number of continuous clear</span>
                        <span class="comment">\ bits at the top of A, and then use this as an index</span>
                        <span class="comment">\ into the leadingBitMask table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we count zeroes from bit 7 down until we hit a 1,</span>
                        <span class="comment">\ and put the result into Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Set Y = -1 so the following loop counts the number of</span>
                        <span class="comment">\ zeroes correctly</span>

<span class="label">.galt3</span><a id="galt3" class="anchor"></a>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift A to the left, moving the top bit into the C</span>
                        <span class="comment">\ flag</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the zero counter in Y</span>

 <span class="mne">BCC</span> <a class="popup destination">galt3</a>              <span class="comment">\ Loop back to keep shifting and counting zeroes until</span>
                        <span class="comment">\ we shift a 1 out of bit 7, at which point Y contains</span>
                        <span class="comment">\ the length of the run of zeroes in bits 7 to 0 of the</span>
                        <span class="comment">\ length of the list at tilesAtAltitude</span>

 <span class="mne">LDA</span> <a class="popup variable">leadingBitMask</a>,<span class="register">Y</span>   <span class="comment">\ Set bitMask to the Y-th entry from the leadingBitMask</span>
 <span class="mne">STA</span> <a class="popup variable">bitMask</a>            <span class="comment">\ table, which will give us a bit mask with a matching</span>
                        <span class="comment">\ number of leading zeroes as A</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have successfully</span>
                        <span class="comment">\ found at least one tile block that matches the</span>
                        <span class="comment">\ altitude in tileAltitude</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.galt4</span><a id="galt4" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ If we get here then we have checked all 64 tile blocks</span>
                        <span class="comment">\ and none of them are at an altitude of tileAltitude,</span>
                        <span class="comment">\ so set the C flag to indicate that the returned list</span>
                        <span class="comment">\ is empty</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-leadingbitmask" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">leadingBitMask</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table for converting the number of leading clear bits in a</span>
             <span class="headerEntry">number into a bit mask with the same number of leading zeroes</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/leadingbitmask.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> uses <a href="#leadingbitmask">leadingBitMask</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilesataltitude.html">GetTilesAtAltitude</a> uses <a href="#leadingbitmask">leadingBitMask</a></span>
</div>
</div></div>
<span class="label">.leadingBitMask</span><a id="leadingbitmask" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%11111111</span>
 <span class="mne">EQUB</span> <span class="binary">%01111111</span>
 <span class="mne">EQUB</span> <span class="binary">%00111111</span>
 <span class="mne">EQUB</span> <span class="binary">%00011111</span>
 <span class="mne">EQUB</span> <span class="binary">%00001111</span>
 <span class="mne">EQUB</span> <span class="binary">%00000111</span>
 <span class="mne">EQUB</span> <span class="binary">%00000011</span>
 <span class="mne">EQUB</span> <span class="binary">%00000001</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gethighesttiles" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetHighestTiles</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate both the highest tiles in each 4x4 block of tiles in the</span>
             <span class="headerEntry">landscape and the altitude of the highest tile in the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gethighesttiles.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/addenemiestotiles.html">AddEnemiesToTiles</a> calls <a href="#gethighesttiles">GetHighestTiles</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">maxAltitude</span>          <span class="argumentEntry">The altitude (i.e. y-coordinate) of the highest tile in</span>
                        <span class="argumentEntry">each 4x4 block in the landscape</span>

   <span class="argumentLabel">xTileMaxAltitude</span>     <span class="argumentEntry">The tile x-coordinate of the highest tile in each 4x4</span>
                        <span class="argumentEntry">block in the landscape</span>

   <span class="argumentLabel">zTileMaxAltitude</span>     <span class="argumentEntry">The tile z-coordinate of the highest tile in each 4x4</span>
                        <span class="argumentEntry">block in the landscape</span>

   <span class="argumentLabel">tileAltitude</span>         <span class="argumentEntry">The altitude of the highest tile in the landscape</span>

</div></div>
<span class="label">.GetHighestTiles</span><a id="gethighesttiles" class="anchor"></a>

                        <span class="comment">\ This routine works through the tile corners in the</span>
                        <span class="comment">\ landscape in 4x4 blocks and finds the highest flat</span>
                        <span class="comment">\ tile within each block, so we can consider putting an</span>
                        <span class="comment">\ enemy there</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To do this we split the 32x32-corner landscape up into</span>
                        <span class="comment">\ 8x8 blocks of 4x4 tile corners each, iterating along</span>
                        <span class="comment">\ each row of 4x4 blocks from left to right, and then</span>
                        <span class="comment">\ moving back four rows to the next row of 4x4 blocks</span>
                        <span class="comment">\ behind</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Because the tile corners along the right and back</span>
                        <span class="comment">\ edges of the landscape don't have tile altitudes</span>
                        <span class="comment">\ associated with them, we ignore those corners</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set X to loop from 0 to 63, to use as a block counter</span>
                        <span class="comment">\ while we work through the landscape in blocks of 4x4</span>
                        <span class="comment">\ tiles, of which there are 64 in total</span>

 <span class="mne">STX</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ Set tileAltitude = 0 so we can use it to store the</span>
                        <span class="comment">\ maximum tile altitude as we work through the landscape</span>
                        <span class="comment">\ (so that's the altitude of the landscape's highest</span>
                        <span class="comment">\ tile)</span>

<span class="label">.high1</span><a id="high1" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = X mod 8</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\</span>
                        <span class="comment">\ The 32x32-tile landscape splits up into 8x8 blocks of</span>
                        <span class="comment">\ 4x4 tiles each, so this sets A to the number of the</span>
                        <span class="comment">\ block along the left-to-right x-axis row that we are</span>
                        <span class="comment">\ working along (so A goes from 0 to 7 and around again)</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set xBlock = A * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xBlock</a>             <span class="comment">\ So xBlock is the tile x-coordinate of the tile in the</span>
                        <span class="comment">\ front-left corner of the 4x4 block we are analysing</span>
                        <span class="comment">\ (so xBlock goes 0, 4, 8 ... 24, 28)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = X div 8</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111000</span>         <span class="comment">\</span>
                        <span class="comment">\ X is in the range 0 to 64, so this instruction has the</span>
                        <span class="comment">\ same effect as AND #%11111000, which is equivalent to</span>
                        <span class="comment">\ a div 8 operation</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The 32x32-tile landscape splits up into 8x8 blocks of</span>
                        <span class="comment">\ 4x4 tiles each, so this sets A to the number of the</span>
                        <span class="comment">\ row of 4x4 blocks along the front-to-back z-axis row</span>
                        <span class="comment">\ that we are working along (so A goes 0, 8, 16 ... 56)</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set zBlock = A / 2</span>
 <span class="mne">STA</span> <a class="popup variable">zBlock</a>             <span class="comment">\</span>
                        <span class="comment">\ So zBlock is the tile z-coordinate of the tile in the</span>
                        <span class="comment">\ front-left corner of each of the 4x4 blocks in the row</span>
                        <span class="comment">\ that we are analysing (so zBlock goes 0, 4, 8 ... 24,</span>
                        <span class="comment">\ 28)</span>

                        <span class="comment">\ Essentially, by this point we have converted the loop</span>
                        <span class="comment">\ counter in X from the sequence 0 to 63 into an inner</span>
                        <span class="comment">\ loop of xBlock and an outer loop of zBlock, with both</span>
                        <span class="comment">\ variables counting 0, 4, 8 ... 24, 28</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can now use (xBlock, zBlock) as a tile coordinate</span>
                        <span class="comment">\ and we can store the highest tile altitude within each</span>
                        <span class="comment">\ 4x4 block using the index in X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the X-th entry in the maxAltitude table, which</span>
 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a>,<span class="register">X</span>      <span class="comment">\ is where we will store the highest tile altitude</span>
                        <span class="comment">\ within block X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set zCounter = 4 to iterate along the z-axis through</span>
 <span class="mne">STA</span> <a class="popup variable">zCounter</a>           <span class="comment">\ each tile in the 4x4 block we are analysing, so</span>
                        <span class="comment">\ zCounter iterates from 4 down to 1</span>

 <span class="mne">LDA</span> <a class="popup variable">zBlock</a>             <span class="comment">\ Set zTile = zBlock</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\</span>
                        <span class="comment">\ So we can use zTile as the tile z-coordinate of the</span>
                        <span class="comment">\ tile to analyse within the 4x4 block</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">28</span>                <span class="comment">\ If zBlock &lt; 28 then then we are not on the tile row at</span>
 <span class="mne">BCC</span> <a class="popup destination">high2</a>              <span class="comment">\ the back of the landscape, so jump to high2 to skip</span>
                        <span class="comment">\ the following instruction</span>

 <span class="mne">DEC</span> <a class="popup variable">zCounter</a>           <span class="comment">\ We are on the tile row at the back of the landscape,</span>
                        <span class="comment">\ so set zCounter = 3 so it iterates from 3 down to 1</span>
                        <span class="comment">\ for this block, because the blocks along the back row</span>
                        <span class="comment">\ are only three tiles deep (as the landscape is 31</span>
                        <span class="comment">\ tiles deep)</span>

<span class="label">.high2</span><a id="high2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set xCounter = 4 to iterate along the x-axis through</span>
 <span class="mne">STA</span> <a class="popup variable">xCounter</a>           <span class="comment">\ each tile in the 4x4 block we are analysing, so</span>
                        <span class="comment">\ xCounter iterates from 4 down to 1</span>

 <span class="mne">LDA</span> <a class="popup variable">xBlock</a>             <span class="comment">\ Set xTile = xBlock</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\</span>
                        <span class="comment">\ So we can use xTile as the tile x-coordinate of the</span>
                        <span class="comment">\ tile to analyse within the 4x4 block</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">28</span>                <span class="comment">\ If xBlock &lt; 28 then we are not at the right end of the</span>
 <span class="mne">BCC</span> <a class="popup destination">high3</a>              <span class="comment">\ tile row, so jump to high3 to skip the following</span>
                        <span class="comment">\ instruction</span>

 <span class="mne">DEC</span> <a class="popup variable">xCounter</a>           <span class="comment">\ We are at the right end of the tile row, so set</span>
                        <span class="comment">\ xCounter = 3 so it iterates from 3 down to 1 for this</span>
                        <span class="comment">\ block, because the last block on the row is only three</span>
                        <span class="comment">\ tiles across (as the landscape is 31 tiles across)</span>

<span class="label">.high3</span><a id="high3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also sets the tile page in tileDataPage and the</span>
                        <span class="comment">\ tile number in Y, so tileDataPage+Y now points to the</span>
                        <span class="comment">\ tile data entry in the tileData table</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Set A to the tile shape for the tile, which is in the</span>
                        <span class="comment">\ bottom nibble of the tile data</span>

 <span class="mne">BNE</span> <a class="popup destination">high5</a>              <span class="comment">\ If the shape is non-zero then the tile is not flat, so</span>
                        <span class="comment">\ jump to high5 to move on to the next tile in the</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11110000</span>         <span class="comment">\ Set A to the tile altitude, which is in the top nibble</span>
                        <span class="comment">\ of the tile data</span>

 <span class="mne">CMP</span> <a class="popup variable">maxAltitude</a>,<span class="register">X</span>      <span class="comment">\ If the altitude of the tile we are analysing is lower</span>
 <span class="mne">BCC</span> <a class="popup destination">high5</a>              <span class="comment">\ than the altitude we have currently stored in the</span>
                        <span class="comment">\ maxAltitude table for this 4x4 tile block, jump to</span>
                        <span class="comment">\ high5 to move on to the next tile, as this one isn't</span>
                        <span class="comment">\ the highest in either this block or the landscape</span>

 <span class="mne">STA</span> <a class="popup variable">maxAltitude</a>,<span class="register">X</span>      <span class="comment">\ If we get here then the tile we are analysing is the</span>
                        <span class="comment">\ highest in the 4x4 block so far, so store the altitude</span>
                        <span class="comment">\ in the maxAltitude table for this 4x4 tile block so</span>
                        <span class="comment">\ the table ends up recording the highest tile altitude</span>
                        <span class="comment">\ in each 4x4 block</span>

 <span class="mne">CMP</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ Set tileAltitude = max(tileAltitude, A)</span>
 <span class="mne">BCC</span> <a class="popup destination">high4</a>              <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">tileAltitude</a>       <span class="comment">\ So tileAltitude contains the altitude of the highest</span>
                        <span class="comment">\ tile that we've analysed so far, which means that</span>
                        <span class="comment">\ tileAltitude ends up being set to the highest value</span>
                        <span class="comment">\ in the entire landscape, which is the altitude of the</span>
                        <span class="comment">\ highest tile of all</span>

<span class="label">.high4</span><a id="high4" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the x-coordinate of the highest tile corner in</span>
 <span class="mne">STA</span> <a class="popup variable">xTileMaxAltitude</a>,<span class="register">X</span> <span class="comment">\ this block (so far) in the xTileMaxAltitude table</span>
                        <span class="comment">\ entry for this 4x4 block</span>

 <span class="mne">LDA</span> <a class="popup variable">zTile</a>              <span class="comment">\ Store the z-coordinate of the highest tile corner in</span>
 <span class="mne">STA</span> <a class="popup variable">zTileMaxAltitude</a>,<span class="register">X</span> <span class="comment">\ this block (so far) in the zTileMaxAltitude table</span>
                        <span class="comment">\ entry for this 4x4 block</span>

<span class="label">.high5</span><a id="high5" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Increment xTile to move on to the next tile to the</span>
                        <span class="comment">\ right, for the inner loop</span>

 <span class="mne">DEC</span> <a class="popup variable">xCounter</a>           <span class="comment">\ Decrement the x-axis counter within this 4x4 block</span>

 <span class="mne">BNE</span> <a class="popup destination">high3</a>              <span class="comment">\ Loop back until we have processed all the tiles in the</span>
                        <span class="comment">\ 4x4 block, working from left to right</span>

 <span class="mne">INC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Increment zTile to move on to the next tile towards</span>
                        <span class="comment">\ the back, for the outer loop</span>

 <span class="mne">DEC</span> <a class="popup variable">zCounter</a>           <span class="comment">\ Decrement the z-axis counter within this 4x4 block</span>

 <span class="mne">BNE</span> <a class="popup destination">high2</a>              <span class="comment">\ Loop back until we have processed all the tile rows in</span>
                        <span class="comment">\ the 4x4 block, working from front to back</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the block counter in X</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ Loop back until we have processed all 63 4x4 blocks</span>
 <span class="mne">BCC</span> <a class="popup destination">high1</a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updatescanner" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UpdateScanner</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the scanner, if required</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/updatescanner.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/irqhandler.html">IRQHandler</a> calls <a href="#updatescanner">UpdateScanner</a></span>
</div>
</div></div>
<span class="label">.UpdateScanner</span><a id="updatescanner" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">scannerUpdate</a>      <span class="comment">\ If scannerUpdate is non-zero then the scanner is</span>
 <span class="mne">BNE</span> <a class="popup destination">UpdateScannerNow</a>   <span class="comment">\ configured to update, so jump to UpdateScannerNow to</span>
                        <span class="comment">\ do just that, returning from the subroutine using a</span>
                        <span class="comment">\ tail call</span>

 <span class="mne">CMP</span> <a class="popup variable">lastScannerState</a>   <span class="comment">\ If the scanner state has not changed since the last</span>
 <span class="mne">BEQ</span> <a class="popup destination">scan6</a>              <span class="comment">\ time we updated the scanner, jump to scan6 to return</span>
                        <span class="comment">\ from the subroutine without updating the scanner</span>

                        <span class="comment">\ Otherwise fall through into UpdateScannerNow to update</span>
                        <span class="comment">\ the scanner</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updatescannernow" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UpdateScannerNow</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the scanner to a new state</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/updatescannernow.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processpausekeys.html">ProcessPauseKeys</a> calls <a href="#updatescannernow">UpdateScannerNow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescanner.html">UpdateScanner</a> calls <a href="#updatescannernow">UpdateScannerNow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescanner.html">UpdateScanner</a> calls via <a href="#scan6">scan6</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The new state of the scanner:</span>

                        <span class="argumentEntry">  * 0 = fill scanner with black</span>

                        <span class="argumentEntry">  * 4 = fill the scanner with static in colour 3</span>

                        <span class="argumentEntry">  * 8 = fill scanner with green</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">scan6</span>                <span class="argumentEntry">Contains an RTS</span>

</div></div>
<span class="label">.UpdateScannerNow</span><a id="updatescannernow" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">lastScannerState</a>   <span class="comment">\ Store the new state of the scanner in lastScannerState</span>
                        <span class="comment">\ so we can use this to check for when the scanner state</span>
                        <span class="comment">\ changes in the future</span>

 <span class="mne">STA</span> <a class="popup variable">scannerState</a>       <span class="comment">\ Store the new state of the scanner in scannerState so</span>
                        <span class="comment">\ we can refer to it (and possibly change it) during the</span>
                        <span class="comment">\ routine</span>

                        <span class="comment">\ We start by calculating the screen address of the</span>
                        <span class="comment">\ scanner, which is 79 bytes before the start of the</span>
                        <span class="comment">\ player's scrolling landscape view (79 bytes represents</span>
                        <span class="comment">\ ten character blocks of eight bytes each, less one</span>
                        <span class="comment">\ byte, so the scanner address is the second pixel row</span>
                        <span class="comment">\ in the character block that's ten blocks from the</span>
                        <span class="comment">\ right end of the energy icon and scanner row at the</span>
                        <span class="comment">\ top of the screen (the top pixel row contains the</span>
                        <span class="comment">\ scanner box border)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ viewScreenAddr(1 0) contains the address of the</span>
                        <span class="comment">\ latter, so we can simply subtract 79</span>

 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a>     <span class="comment">\ Set (A screenAddr) = viewScreenAddr(1 0) - &004F</span>
 <span class="mne">SEC</span>                    <span class="comment">\                    = viewScreenAddr(1 0) - 79</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&4F</span>
 <span class="mne">STA</span> <a class="popup variable">screenAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&00</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ If the high byte in A &lt; &60 then the new address is</span>
 <span class="mne">BCS</span> <a class="popup destination">scan1</a>              <span class="comment">\ before the start of screen memory, so add &20 to the</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ high byte so the address wraps around within the range</span>
                        <span class="comment">\ of screen memory between &6000 and &8000</span>

<span class="label">.scan1</span><a id="scan1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">screenAddr</a><span class="operator">+</span><span class="decimal">1</span>       <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   screenAddr(1 0) = viewScreenAddr(1 0) - 79</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ The inside portion of the scanner consists of eight</span>
 <span class="mne">STA</span> <a class="popup variable">scannerBlock</a>       <span class="comment">\ character blocks (the box edges on either side are</span>
                        <span class="comment">\ outside of these eight blocks), so set scannerBlock</span>
                        <span class="comment">\ to 8 so we can use it to count through the character</span>
                        <span class="comment">\ blocks as we draw the scanner</span>
<span class="label">.scan2</span><a id="scan2" class="anchor"></a>

                        <span class="comment">\ Each character block contains one pixel row at the top</span>
                        <span class="comment">\ for the top scanner box edge, then four pixel rows of</span>
                        <span class="comment">\ scanner content, followed by another pixel row for the</span>
                        <span class="comment">\ bottom scanner box edge</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now draw the four pixel rows of scanner content,</span>
                        <span class="comment">\ avoiding drawing over the top and bottom edges</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set Y = 3 to use as a counter for drawing four pixel</span>
                        <span class="comment">\ rows in the drawing loop</span>

 <span class="mne">JSR</span> <a class="popup destination">GetRandomNumber</a>    <span class="comment">\ Set A to a random number to seed the drawing loop, of</span>
                        <span class="comment">\ which we use two bits for each of the four pixel bytes</span>
                        <span class="comment">\ we draw</span>

 <span class="mne">JMP</span> <a class="popup destination">scan4</a>              <span class="comment">\ Jump to scan4 to join the drawing loop</span>

<span class="label">.scan3</span><a id="scan3" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">scannerStatic</a>      <span class="comment">\ Shift the random number in scannerStatic to the right</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ by two places</span>
 <span class="mne">LSR</span> <span class="register">A</span>

<span class="label">.scan4</span><a id="scan4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">scannerStatic</a>      <span class="comment">\ Store the random number in scannerStatic (on the first</span>
                        <span class="comment">\ iteration this is the full random number, while on</span>
                        <span class="comment">\ subsequent iterations the number is shifted right by</span>
                        <span class="comment">\ two places on each loop)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ Extract bits 0 and 1 from the random number, so we</span>
                        <span class="comment">\ get two different random bits on each iteration and</span>
                        <span class="comment">\ a value of A in the range 0 to 3</span>

 <span class="mne">ORA</span> <a class="popup variable">scannerState</a>       <span class="comment">\ Add the scanner state to the two random bits to get</span>
                        <span class="comment">\ the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If scannerState = 0 then this leaves A in the</span>
                        <span class="comment">\     range 0 to 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If scannerState = 4 then this sets A into the</span>
                        <span class="comment">\     range 4 to 7</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If scannerState = 8 then this sets A into the</span>
                        <span class="comment">\     range 8 to 11</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Copy A into X so we can use it as an index into the</span>
                        <span class="comment">\ scannerPixelByte table</span>

 <span class="mne">LDA</span> <a class="popup variable">scannerPixelByte</a>,<span class="register">X</span> <span class="comment">\ Set A to the X-th pixel byte from the relevant part of</span>
                        <span class="comment">\ the scannerPixelByte lookup table, which will return a</span>
                        <span class="comment">\ pixel byte containing black, random static or green,</span>
                        <span class="comment">\ according to the value of scannerState</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">screenAddr</a><span class="bracket">)</span>,<span class="register">Y</span>     <span class="comment">\ Draw the Y-th pixel row for this character block in</span>
                        <span class="comment">\ the scanner</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the pixel row counter in Y</span>

 <span class="mne">BPL</span> <a class="popup destination">scan3</a>              <span class="comment">\ Loop back to scan3 to draw the next pixel row until we</span>
                        <span class="comment">\ have drawn all four pixel rows</span>

                        <span class="comment">\ We now move along the scanner to draw the next</span>
                        <span class="comment">\ character block to the right</span>

 <span class="mne">LDA</span> <a class="popup variable">screenAddr</a>         <span class="comment">\ Set (A screenAddr) = screenAddr(1 0) + 8</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&08</span>
 <span class="mne">STA</span> <a class="popup variable">screenAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">screenAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&00</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">scan5</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.scan5</span><a id="scan5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">screenAddr</a><span class="operator">+</span><span class="decimal">1</span>       <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   screenAddr(1 0) = screenAddr(1 0) + 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This updates screenAddr(1 0) to point to the next</span>
                        <span class="comment">\ character block to the right, so we move along the</span>
                        <span class="comment">\ scanner</span>

 <span class="mne">DEC</span> <a class="popup variable">scannerBlock</a>       <span class="comment">\ Decrement scannerBlock to move on to the next block</span>
                        <span class="comment">\ in the scanner</span>

 <span class="mne">BEQ</span> <a class="popup destination">scan6</a>              <span class="comment">\ If we have drawn all eight columns, jump to scan6 to</span>
                        <span class="comment">\ return</span>

 <span class="mne">LDA</span> <a class="popup variable">scannerBlock</a>       <span class="comment">\ If scannerBlock &lt;> 4 then loop back to scan2 to keep</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ drawing the scanner</span>
 <span class="mne">BNE</span> <a class="popup destination">scan2</a>

                        <span class="comment">\ If we get here then scannerBlock = 4, so we have drawn</span>
                        <span class="comment">\ the left half of the scanner</span>

 <span class="mne">LDA</span> <a class="popup variable">playerTileIsHidden</a> <span class="comment">\ If playerTileIsHidden &lt;> 64 then the player's tile is</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ not hidden from the Sentinel or sentry doing the scan,</span>
 <span class="mne">BNE</span> <a class="popup destination">scan2</a>              <span class="comment">\ so loop back to scan2 to keep drawing the scanner</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ If we get here then playerTileIsHidden = 64, so the</span>
 <span class="mne">STA</span> <a class="popup variable">scannerState</a>       <span class="comment">\ player's tile is hidden from the Sentinel or sentry</span>
                        <span class="comment">\ doing the scan</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We represent this by only filling the left half of the</span>
                        <span class="comment">\ scanner and leaving the right half blank, so set</span>
                        <span class="comment">\ scannerState to zero so the rest of the fill routine</span>
                        <span class="comment">\ fills the right half with black</span>

 <span class="mne">BEQ</span> <a class="popup destination">scan2</a>              <span class="comment">\ Jump back to scan2 to keep drawing the scanner (this</span>
                        <span class="comment">\ BEQ is effectively a JMP as A is always zero)</span>

<span class="label">.scan6</span><a id="scan6" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scannerstatic" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">scannerStatic</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Storage for a random number that's used to generate static in the</span>
             <span class="headerEntry">scanner</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/scannerstatic.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescannernow.html">UpdateScannerNow</a> uses <a href="#scannerstatic">scannerStatic</a></span>
</div>
</div></div>
<span class="label">.scannerStatic</span><a id="scannerstatic" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scannerblock" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">scannerBlock</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A counter for the eight character blocks that make up the scanner</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/scannerblock.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescannernow.html">UpdateScannerNow</a> uses <a href="#scannerblock">scannerBlock</a></span>
</div>
</div></div>
<span class="label">.scannerBlock</span><a id="scannerblock" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scannerstate" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">scannerState</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The current state of the scanner (black, static or green)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/scannerstate.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescannernow.html">UpdateScannerNow</a> uses <a href="#scannerstate">scannerState</a></span>
</div>
</div></div>
<span class="label">.scannerState</span><a id="scannerstate" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ The current state of the scanner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 = fill the scanner with black</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 4 = fill the scanner with static in colour 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 8 = fill the scanner with green</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scannerpixelbyte" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">scannerPixelByte</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pixel bytes for the three states of the scanner (black, static and</span>
             <span class="headerEntry">green)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/scannerpixelbyte.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescannernow.html">UpdateScannerNow</a> uses <a href="#scannerpixelbyte">scannerPixelByte</a></span>
</div>
</div></div>
<span class="label">.scannerPixelByte</span><a id="scannerpixelbyte" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%00001111</span>         <span class="comment">\ Four bytes of colour 1 (black) for scanner state 0</span>
 <span class="mne">EQUB</span> <span class="binary">%00001111</span>
 <span class="mne">EQUB</span> <span class="binary">%00001111</span>
 <span class="mne">EQUB</span> <span class="binary">%00001111</span>

 <span class="mne">EQUB</span> <span class="binary">%10001111</span>         <span class="comment">\ Four bytes of static in colour 3 on a background of</span>
 <span class="mne">EQUB</span> <span class="binary">%01001111</span>         <span class="comment">\ colour 1 (black)</span>
 <span class="mne">EQUB</span> <span class="binary">%00101111</span>
 <span class="mne">EQUB</span> <span class="binary">%00011111</span>

 <span class="mne">EQUB</span> <span class="binary">%11111111</span>         <span class="comment">\ Four bytes of colour 3 (green) for scanner state 8</span>
 <span class="mne">EQUB</span> <span class="binary">%11111111</span>
 <span class="mne">EQUB</span> <span class="binary">%11111111</span>
 <span class="mne">EQUB</span> <span class="binary">%11111111</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applyenemytactics" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyEnemyTactics</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Apply tactics to an enemy object, setting things up so the next</span>
             <span class="headerEntry">call applies tactics to the next enemy object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applyenemytactics.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#applyenemytactics">ApplyEnemyTactics</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">enemyObject</span>          <span class="argumentEntry">The object number of the enemy to which we apply tactics</span>
                        <span class="argumentEntry">(0 to 7)</span>

</div></div>
<span class="label">.ApplyEnemyTactics</span><a id="applyenemytactics" class="anchor"></a>

 <span class="mne">TSX</span>                    <span class="comment">\ Store the stack pointer in gameplayStack, so we can</span>
 <span class="mne">STX</span> <a class="popup variable">gameplayStack</a>      <span class="comment">\ return back to the ProcessGameplay routine from deep</span>
                        <span class="comment">\ within the tactics routines if required</span>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are thinking of applying tactics in this iteration of</span>
                        <span class="comment">\ the gameplay loop (so object #X is the object that we</span>
                        <span class="comment">\ are considering)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectTypes</a>,<span class="register">X</span>      <span class="comment">\ Set A to the type of object #X</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ If we are considering applying tactics to a sentry (an</span>
 <span class="mne">BEQ</span> <a class="popup destination">etac1</a>              <span class="comment">\ object of type 1) then jump to etac1 to apply tactics</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\ If we are not applying tactics to the Sentinel (an</span>
 <span class="mne">BNE</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ object of type 5), then enemyObject is neither a</span>
                        <span class="comment">\ sentry nor the Sentinel</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We only apply tactics to the Sentinel and sentries,</span>
                        <span class="comment">\ so we don't need to apply tactics to this object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So jump to MoveOnToNextEnemy to stop applying tactics</span>
                        <span class="comment">\ to this enemy and set things up so we move on to the</span>
                        <span class="comment">\ next enemy in the next iteration of the gameplay loop</span>

<span class="label">.etac1</span><a id="etac1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ If we get here then we are applying tactics to the</span>
                        <span class="comment">\ Sentinel or a sentry, so set titleObjectToDraw to the</span>
                        <span class="comment">\ corresponding object type so if the enemy causes the</span>
                        <span class="comment">\ player to lose, then the game over screen will show</span>
                        <span class="comment">\ that enemy type to indicate that it was responsible</span>
                        <span class="comment">\ for the player's demise</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ Set A to the object flags for object #X (which is the</span>
                        <span class="comment">\ object that we are applying tactics to)</span>

 <span class="mne">BPL</span> <a class="popup destination">ApplyTactics</a>       <span class="comment">\ If bit 7 of the object flags is clear then this object</span>
                        <span class="comment">\ number is allocated to a valid object, so jump to</span>
                        <span class="comment">\ ApplyTactics to apply tactics to the object and return</span>
                        <span class="comment">\ from the subroutine using a tail call</span>

                        <span class="comment">\ If we get here then bit 7 of the enemy object's flags</span>
                        <span class="comment">\ is clear, so the enemy has been removed from the</span>
                        <span class="comment">\ landscape at some point</span>

 <span class="mne">JSR</span> <a class="popup destination">ExpendEnemyEnergy</a>  <span class="comment">\ Drain one unit of energy from the enemy and expend it</span>
                        <span class="comment">\ onto the landscape by spawning a tree, if possible</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that if an enemy has absorbed energy from</span>
                        <span class="comment">\ somewhere, it always dissipates back into the</span>
                        <span class="comment">\ landscape it when it gets the chance</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we can't spawn a tree because we are about to pan</span>
                        <span class="comment">\ the screen and the tree would spawn in a position that</span>
                        <span class="comment">\ would be visible on-screen, then the routine does not</span>
                        <span class="comment">\ expend energy or spawn a tree, and instead it gives up</span>
                        <span class="comment">\ and aborts applying tactics for this gameplay loop</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we successfully spawned a tree then the object</span>
                        <span class="comment">\ number of the tree is in X</span>

 <span class="mne">BCS</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ If the call to ExpendEnemyEnergy returned with the C</span>
                        <span class="comment">\ flag set, then either the enemy didn't have any energy</span>
                        <span class="comment">\ to expend or we couldn't spawn a tree, so jump to</span>
                        <span class="comment">\ MoveOnToNextEnemy to stop applying tactics to this</span>
                        <span class="comment">\ enemy and set things up so we move on to the next</span>
                        <span class="comment">\ enemy in the next iteration of the gameplay loop</span>

 <span class="mne">JMP</span> <a class="popup destination">tact25</a>             <span class="comment">\ Otherwise jump to tact25 with X set to the object</span>
                        <span class="comment">\ number of the tree to update it on-screen with a</span>
                        <span class="comment">\ dithered effect and return from the subroutine using</span>
                        <span class="comment">\ a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-moveontonextenemy" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">MoveOnToNextEnemy</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update enemyObject so the next time we consider applying enemy</span>
             <span class="headerEntry">tactics, we apply them to the next enemy, looping from 7 to 0</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/moveontonextenemy.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applyenemytactics.html">ApplyEnemyTactics</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_1_of_8.html">ApplyTactics (Part 1 of 8)</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_2_of_8.html">ApplyTactics (Part 2 of 8)</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_5_of_8.html">ApplyTactics (Part 5 of 8)</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_7_of_8.html">ApplyTactics (Part 7 of 8)</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_8_of_8.html">ApplyTactics (Part 8 of 8)</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishenemytactics.html">FinishEnemyTactics</a> calls <a href="#moveontonextenemy">MoveOnToNextEnemy</a></span>
</div>
</div></div>
<span class="label">.MoveOnToNextEnemy</span><a id="moveontonextenemy" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">DEC</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Decrement the number of the enemy object that we are</span>
                        <span class="comment">\ considering for tactics, so the next iteration of the</span>
                        <span class="comment">\ gameplay loop will apply tactics to the next enemy</span>

 <span class="mne">BPL</span> <a class="popup destination">next1</a>              <span class="comment">\ If enemyObject is positive then it is still in the</span>
                        <span class="comment">\ range 0 to 7, so jump to next1 to skip the following</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set enemyObject = 7 to wrap the enemy number back up</span>
 <span class="mne">STA</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ to 7, so it iterates from 7 down to 0 and then back</span>
                        <span class="comment">\ to 7 again</span>

<span class="label">.next1</span><a id="next1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set viewingObject to the object number of the player,</span>
 <span class="mne">STA</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ so any future view calculations are done from the</span>
                        <span class="comment">\ aspect of the player rather than the enemy object</span>
                        <span class="comment">\ (until we return to apply tactics to the next enemy)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-1-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 1 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Apply tactics to the Sentinel or a sentry</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_1_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applyenemytactics.html">ApplyEnemyTactics</a> calls <a href="#applytactics">ApplyTactics</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The object number of the Sentinel or sentry to which we</span>
                        <span class="argumentEntry">apply tactics (0 to 7)</span>

   <span class="argumentLabel">enemyObject</span>          <span class="argumentEntry">Contains the same as X</span>

</div></div>
<span class="label">.ApplyTactics</span><a id="applytactics" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">X</span> <span class="comment">\ If enemyTacticTimer >= 2 for this enemy, then jump to</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ MoveOnToNextEnemy to jump to MoveOnToNextEnemy to</span>
 <span class="mne">BCS</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ stop applying tactics to this enemy and set things up</span>
                        <span class="comment">\ so we move on to the next enemy in the next iteration</span>
                        <span class="comment">\ of the gameplay loop</span>

                        <span class="comment">\ If we get here then enemyTacticTimer for this enemy</span>
                        <span class="comment">\ has counted down to be less than 2, so it's time to</span>
                        <span class="comment">\ apply tactics to the enemy</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set enemyTacticTimer for the enemy to 4 so by default</span>
 <span class="mne">STA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">X</span> <span class="comment">\ we wait for 4 * 0.06 = 0.6 seconds before applying</span>
                        <span class="comment">\ tactics to the enemy again (though we may change this)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">20</span>                <span class="comment">\ Set enemyViewingArc = 20, so the enemy's gaze has a</span>
 <span class="mne">STA</span> <a class="popup variable">enemyViewingArc</a>    <span class="comment">\ viewing arc that's the same width as the screen (as</span>
                        <span class="comment">\ the screen is 20 yaw angles across)</span>

 <span class="mne">LDA</span> <a class="popup variable">enemyMeanieTree</a>,<span class="register">X</span>  <span class="comment">\ Fetch the value of enemyMeanieTree for the enemy we</span>
                        <span class="comment">\ are processing, so A contains tells us whether the</span>
                        <span class="comment">\ enemy has turned a tree into a meanie</span>

 <span class="mne">BPL</span> <a class="popup destination">tact1</a>              <span class="comment">\ If bit 7 of enemyMeanieTree is clear then the enemy</span>
                        <span class="comment">\ has turned a tree into a meanie, so jump to part 2 to</span>
                        <span class="comment">\ apply tactics to the meanie</span>

 <span class="mne">JMP</span> <a class="popup destination">tact6</a>              <span class="comment">\ Bit 7 of enemyMeanieTree is set so the enemy has not</span>
                        <span class="comment">\ turned a tree into a meanie, so jump to part 3 to skip</span>
                        <span class="comment">\ the meanie tactics routine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-2-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 2 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Process the tactics for a meanie</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_2_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact1</span><a id="tact1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ If we get here then the enemy has turned a tree into a</span>
                        <span class="comment">\ meanie and A contains the meanie's object number</span>
                        <span class="comment">\ (which we fetched from enemyMeanieTree in part 1), so</span>
                        <span class="comment">\ this sets the viewing object to the meanie so the gaze</span>
                        <span class="comment">\ checks below are performed from the point of view of</span>
                        <span class="comment">\ the meanie</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyTarget</a>,<span class="register">X</span>      <span class="comment">\ Set Y to the object number in enemyTarget, so when we</span>
                        <span class="comment">\ refer to object #Y, it's the meanie's target object</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">Y</span>      <span class="comment">\ If bit 7 of the object flags for the meanie's target</span>
 <span class="mne">BMI</span> <a class="popup destination">tact4</a>              <span class="comment">\ is set then the target doesn't have an associated</span>
                        <span class="comment">\ object, so the player must have transferred and</span>
                        <span class="comment">\ reabsorbed the original robot that the meanie was</span>
                        <span class="comment">\ targeting, so jump to tact4 to restart the enemy's</span>
                        <span class="comment">\ drain counter and turn the meanie back into a tree</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 to pass to CheckEnemyGaze as the object type</span>
                        <span class="comment">\ of the target (object type 0 being a robot), so we</span>
                        <span class="comment">\ only run the gaze calculations when object #Y is a</span>
                        <span class="comment">\ robot</span>

 <span class="mne">JSR</span> <a class="popup destination">CheckEnemyGaze</a>     <span class="comment">\ Call CheckEnemyGaze to check the gaze of the meanie</span>
                        <span class="comment">\ towards the robot, returning the following if the</span>
                        <span class="comment">\ the object is a robot (an object of type 0):</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * objectViewYaw(Hi Lo) = the yaw angle of the robot</span>
                        <span class="comment">\     relative to the view (i.e. relative to the</span>
                        <span class="comment">\     meanie's view of the world)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * targetVisibility = bit 7 set if the robot's tile</span>
                        <span class="comment">\     is visible, bit 6 set if the robot is visible</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * treeVisibility = bit 7 set if there is a tree in</span>
                        <span class="comment">\     the way of the robot's tile, bit 6 set if there is</span>
                        <span class="comment">\     a tree in the way of the robot</span>

 <span class="mne">LDA</span> <a class="popup variable">objectViewYawHi</a>    <span class="comment">\ If objectViewYawHi >= 20 then the robot is outside of</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">20</span>                <span class="comment">\ the meanie's viewing arc of 20 yaw angles, so jump to</span>
 <span class="mne">BCS</span> <a class="popup destination">tact2</a>              <span class="comment">\ tact2 to rotate the meanie in the direction of the</span>
                        <span class="comment">\ robot</span>

 <span class="mne">CPY</span> <a class="popup variable">playerObject</a>       <span class="comment">\ If the robot is not the player object, then the player</span>
 <span class="mne">BNE</span> <a class="popup destination">tact4</a>              <span class="comment">\ must have transferred to a different robot, so jump to</span>
                        <span class="comment">\ tact4 to restart the enemy's drain counter and turn</span>
                        <span class="comment">\ the meanie back into a tree</span>

 <span class="mne">LDA</span> <a class="popup variable">targetVisibility</a>   <span class="comment">\ If the meanie can't see the robot or the robot's tile</span>
 <span class="mne">BEQ</span> <a class="popup destination">tact5</a>              <span class="comment">\ then targetVisibility will be zero, so jump to tact5</span>
                        <span class="comment">\ to turn the meanie back into a tree</span>

                        <span class="comment">\ If we get here then the meanie is looking at a robot,</span>
                        <span class="comment">\ the robot is within the meanie's viewing arc, the</span>
                        <span class="comment">\ robot is the player object and the meanie can either</span>
                        <span class="comment">\ see the robot's tile or the robot itself</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means the meanie can see the player, so it can</span>
                        <span class="comment">\ force the player into hyperspace</span>

 <span class="mne">JSR</span> <a class="popup destination">PerformHyperspace</a>  <span class="comment">\ Hyperspace the player to a brand new tile</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set titleObjectToDraw to the object type for a meanie,</span>
 <span class="mne">STA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ so if the hyperspace fails because the player doesn't</span>
                        <span class="comment">\ have enough energy, then the game over screen will</span>
                        <span class="comment">\ show a meanie to indicate that it was responsible for</span>
                        <span class="comment">\ the player's demise</span>

 <span class="mne">JMP</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ Jump to MoveOnToNextEnemy to stop applying tactics to</span>
                        <span class="comment">\ this enemy and set things up so we move on to the next</span>
                        <span class="comment">\ enemy in the next iteration of the gameplay loop</span>

<span class="label">.tact2</span><a id="tact2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set A = 8 to use as the value of meanieYawStep when</span>
                        <span class="comment">\ the meanie needs to rotate clockwise towards the</span>
                        <span class="comment">\ player</span>

 <span class="mne">BIT</span> <a class="popup variable">objectViewYawHi</a>    <span class="comment">\ If objectViewYawHi is positive then the player is to</span>
 <span class="mne">BPL</span> <a class="popup destination">tact3</a>              <span class="comment">\ the right of the meanie's viewing arc, so jump to</span>
                        <span class="comment">\ tact3 to set the yaw step to +8 so the meanie rotates</span>
                        <span class="comment">\ right (clockwise( towards the player to the right</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&F8</span>               <span class="comment">\ Otherwise objectViewYawHi is negative and the player</span>
                        <span class="comment">\ is to the left of the meanie's viewing arc, so set A</span>
                        <span class="comment">\ to -8 for the yaw step so the meanie rotates left</span>
                        <span class="comment">\ (anticlockwise) towards the player to the left</span>

<span class="label">.tact3</span><a id="tact3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">meanieYawStep</a>      <span class="comment">\ Store the value of A in meanieYawStep, so we can add</span>
                        <span class="comment">\ it to the meanie's yaw angle below to make it rotate</span>
                        <span class="comment">\ towards the player</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the meanie that we are</span>
 <span class="mne">LDX</span> <a class="popup variable">enemyMeanieTree</a>,<span class="register">Y</span>  <span class="comment">\ processing</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Check to see whether it is safe to redraw the meanie</span>
 <span class="mne">JSR</span> <a class="popup destination">AbortWhenVisible</a>   <span class="comment">\ without risk of corrupting a screen pan (if there is</span>
                        <span class="comment">\ a risk and it can't be updated, then the call to</span>
                        <span class="comment">\ AbortWhenVisible will not return here and will instead</span>
                        <span class="comment">\ abort tactics for this iteration of the gameplay loop)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Add meanieYawStep to the yaw angle for the meanie so</span>
 <span class="mne">CLC</span>                    <span class="comment">\ it rotates towards the player</span>
 <span class="mne">ADC</span> <a class="popup variable">meanieYawStep</a>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ Set enemyTacticTimer for the meanie to 10 so we wait</span>
 <span class="mne">STA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">Y</span> <span class="comment">\ for 10 * 0.06 = 0.6 seconds before applying tactics to</span>
                        <span class="comment">\ the meanie again</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Store the enemy object number on the stack so we can</span>
 <span class="mne">PHA</span>                    <span class="comment">\ retrieve it below</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set X = 3 to pass to MakeSound-6 as the pitch of the</span>
                        <span class="comment">\ first part of the rotating meanie sound</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">70</span>                <span class="comment">\ Set Y = 70 to pass to MakeSound-6 as the pitch of the</span>
                        <span class="comment">\ second part of the rotating meanie sound</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Make sound #1 (rotating meanie) with the pitches in X</span>
 <span class="mne">JSR</span> <a class="popup destination">MakeSound-6</a>        <span class="comment">\ and Y</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the enemy object number from the stack into X</span>
 <span class="mne">TAX</span>

 <span class="mne">JMP</span> <a class="popup destination">tact26</a>             <span class="comment">\ Jump to tact26 to draw the updated object #X without a</span>
                        <span class="comment">\ dithered effect, so the meanie rotates instantly if it</span>
                        <span class="comment">\ is on the screen</span>

<span class="label">.tact4</span><a id="tact4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set enemyDrainTimer = 0 to restart the drain counter</span>
 <span class="mne">STA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ for the enemy in part 5 of ApplyTactics, so it doesn't</span>
                        <span class="comment">\ drain energy for another 120 timer ticks (120 * 0.06 =</span>
                        <span class="comment">\ 7.2 seconds)</span>

<span class="label">.tact5</span><a id="tact5" class="anchor"></a>

                        <span class="comment">\ If we get here then we need to turn the meanie back</span>
                        <span class="comment">\ into a tree</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the meanie that we are</span>
 <span class="mne">LDX</span> <a class="popup variable">enemyMeanieTree</a>,<span class="register">Y</span>  <span class="comment">\ processing</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Check to see whether it is safe to redraw the meanie</span>
 <span class="mne">JSR</span> <a class="popup destination">AbortWhenVisible</a>   <span class="comment">\ without risk of corrupting a screen pan (if there is</span>
                        <span class="comment">\ a risk and it can't be updated, then the call to</span>
                        <span class="comment">\ AbortWhenVisible will not return here and will instead</span>
                        <span class="comment">\ abort tactics for this iteration of the gameplay loop)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of enemyMeanieTree so the enemy that turned</span>
 <span class="mne">STA</span> <a class="popup variable">enemyMeanieTree</a>,<span class="register">Y</span>  <span class="comment">\ a tree into the meanie is no longer flagged as such</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Turn the meanie object back into a tree (an object of</span>
 <span class="mne">STA</span> <a class="popup variable">objectTypes</a>,<span class="register">X</span>      <span class="comment">\ type 2)</span>

 <span class="mne">JMP</span> <a class="popup destination">tact25</a>             <span class="comment">\ Jump to tact25 with X set to the object number of</span>
                        <span class="comment">\ the tree to update it on-screen with a dithered effect</span>
                        <span class="comment">\ and return from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-3-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 3 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">If the enemy has any residual energy, try expending it onto the</span>
             <span class="headerEntry">landscape in the form of a tree (and end tactics if successful)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_3_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact6</span><a id="tact6" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set the viewing object to the enemy we are processing,</span>
                        <span class="comment">\ so everything is done from their viewpoint from now on</span>

 <span class="mne">JSR</span> <a class="popup destination">ExpendEnemyEnergy</a>  <span class="comment">\ Drain one unit of energy from the enemy and expend it</span>
                        <span class="comment">\ onto the landscape by spawning a tree, if possible</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that if an enemy has absorbed energy from</span>
                        <span class="comment">\ somewhere, it always dissipates back into the</span>
                        <span class="comment">\ landscape it when it gets the chance</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we can't spawn a tree because we are about to pan</span>
                        <span class="comment">\ the screen and the tree would spawn in a position that</span>
                        <span class="comment">\ would be visible on-screen, then the routine does not</span>
                        <span class="comment">\ expend energy or spawn a tree, and instead it gives up</span>
                        <span class="comment">\ and aborts applying tactics for this gameplay loop</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we successfully spawned a tree then the object</span>
                        <span class="comment">\ number of the tree is in X</span>

 <span class="mne">BCS</span> <a class="popup destination">tact7</a>              <span class="comment">\ If the call to ExpendEnemyEnergy returned with the C</span>
                        <span class="comment">\ flag set, then either the enemy didn't have any energy</span>
                        <span class="comment">\ to expend or we couldn't spawn a tree, so jump to part</span>
                        <span class="comment">\ 4 to keep applying tactics</span>

 <span class="mne">JMP</span> <a class="popup destination">tact25</a>             <span class="comment">\ Otherwise that's enough tactics for this iteration, so</span>
                        <span class="comment">\ jump to tact25 with X set to the object number of</span>
                        <span class="comment">\ the tree to update it on-screen with a dithered effect</span>
                        <span class="comment">\ and return from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-4-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 4 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">If configured, search the landscape for a suitable target for the</span>
             <span class="headerEntry">enemy to drain of energy</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_4_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact7</span><a id="tact7" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics (so this is now object #X)</span>

 <span class="mne">LDA</span> <a class="popup variable">enemyDrainScan</a>,<span class="register">X</span>   <span class="comment">\ If bit 7 of enemyDrainScan is clear, jump to part 5 to</span>
 <span class="mne">BPL</span> <a class="popup destination">tact9</a>              <span class="comment">\ skip the search for a drainable object</span>

 <span class="mne">JSR</span> <a class="popup destination">FindObjectToDrain</a>  <span class="comment">\ Find a suitable target object for the enemy to drain</span>
                        <span class="comment">\ (i.e. a tree that is stacked on top of another object,</span>
                        <span class="comment">\ or a boulder, which is exposed to the enemy and on a</span>
                        <span class="comment">\ tile that can be seen by the enemy)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If successful, the object number is in targetObject</span>
                        <span class="comment">\ and the C flag is clear, otherwise the C flag is set</span>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics (so this is now object #X)</span>

 <span class="mne">BCS</span> <a class="popup destination">tact8</a>              <span class="comment">\ If FindObjectToDrain set the C flag, then no suitable</span>
                        <span class="comment">\ object was found for the enemy to drain, so jump to</span>
                        <span class="comment">\ tact8 to stop the enemy from searching again and keep</span>
                        <span class="comment">\ applying tactics</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ Set enemyMeanieCheck = 64 for the enemy so if we start</span>
 <span class="mne">STA</span> <a class="popup variable">enemyMeanieScan</a>,<span class="register">X</span>  <span class="comment">\ scanning objects for trees to potentially turn into a</span>
                        <span class="comment">\ meanie, we start from the last object and work down</span>

 <span class="mne">BNE</span> <a class="popup destination">tact15</a>             <span class="comment">\ Jump to tact15 to drain energy from the target object</span>
                        <span class="comment">\ (this BNE is effectively a JMP as A is never zero)</span>

<span class="label">.tact8</span><a id="tact8" class="anchor"></a>

 <span class="mne">LSR</span> <a class="popup variable">enemyDrainScan</a>,<span class="register">X</span>   <span class="comment">\ Clear bit 7 of enemyDrainScan for this enemy to stop</span>
                        <span class="comment">\ it searching for a drainable target for now</span>

                        <span class="comment">\ Fall through into part 5 to keep applying tactics to</span>
                        <span class="comment">\ this enemy</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-5-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 5 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Look for a suitable robot to drain of energy, or look for a</span>
             <span class="headerEntry">drainable tree or boulder if there are no suitable robots</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_5_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact9</span><a id="tact9" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ If enemyDrainTimer for the enemy is zero then jump to</span>
 <span class="mne">BEQ</span> <a class="popup destination">tact11</a>             <span class="comment">\ tact11 to skip the following, as this timer is not in</span>
                        <span class="comment">\ use</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyTarget</a>,<span class="register">X</span>      <span class="comment">\ Set Y to the object number in enemyTarget, so when we</span>
                        <span class="comment">\ refer to object #Y, it's the enemy's target object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If this hasn't been set to a valid object number yet</span>
                        <span class="comment">\ then the call to CheckEnemyGaze will simply say the</span>
                        <span class="comment">\ object is not visible</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call CheckEnemyGaze to check the gaze of the enemy</span>
 <span class="mne">JSR</span> <a class="popup destination">CheckEnemyGaze</a>     <span class="comment">\ towards object #Y, returning the following if the</span>
                        <span class="comment">\ the object is a robot (an object of type 0):</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * targetVisibility = bit 7 set if the object's tile</span>
                        <span class="comment">\     is visible, bit 6 set if the object is visible</span>

 <span class="mne">LDA</span> <a class="popup variable">targetVisibility</a>   <span class="comment">\ If the target is not a robot, or the target is a robot</span>
 <span class="mne">BEQ</span> <a class="popup destination">tact10</a>             <span class="comment">\ but the enemy can't see it, then jump to tact10 to</span>
                        <span class="comment">\ keep applying tactics</span>

 <span class="mne">JMP</span> <a class="popup destination">tact19</a>             <span class="comment">\ Otherwise the target is a robot and the enemy can see</span>
                        <span class="comment">\ at least some of it, so jump to part 7 with the target</span>
                        <span class="comment">\ object number in Y to try draining energy from the</span>
                        <span class="comment">\ robot</span>

<span class="label">.tact10</span><a id="tact10" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ Set enemyDrainTimer = 0 to restart the drain counter</span>
                        <span class="comment">\ for the enemy in part 5 of ApplyTactics, so it doesn't</span>
                        <span class="comment">\ drain energy for another 120 timer ticks (120 * 0.06 =</span>
                        <span class="comment">\ 7.2 seconds)</span>

<span class="label">.tact11</span><a id="tact11" class="anchor"></a>

                        <span class="comment">\ We now loop through every object on the landscape,</span>
                        <span class="comment">\ looking for a robot that the enemy can drain of energy</span>
                        <span class="comment">\ (in other words, a robot whose tile the enemy can see)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the robot turns out to be the player object, then</span>
                        <span class="comment">\ we also check whether the object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of playerTileObscured, so by default the</span>
 <span class="mne">STA</span> <a class="popup variable">playerTileObscured</a> <span class="comment">\ the player object can't be seen at all (though we will</span>
                        <span class="comment">\ change this in the following loop if the enemy can see</span>
                        <span class="comment">\ the partially obscured player object)</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set a counter in Y to work through the object numbers</span>

<span class="label">.tact12</span><a id="tact12" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call CheckEnemyGaze to check the gaze of the enemy</span>
 <span class="mne">JSR</span> <a class="popup destination">CheckEnemyGaze</a>     <span class="comment">\ towards object #Y, returning the following if the</span>
                        <span class="comment">\ the object is a robot (an object of type 0):</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * targetVisibility = bit 7 set if the object's tile</span>
                        <span class="comment">\     is visible, bit 6 set if the object is visible</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * treeVisibility = bit 7 set if there is a tree in</span>
                        <span class="comment">\     the way of the robot's tile, bit 6 set if there is</span>
                        <span class="comment">\     a tree in the way of the robot</span>

 <span class="mne">LDA</span> <a class="popup variable">treeVisibility</a>     <span class="comment">\ If bit 6 of treeVisibility is set then there is a tree</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ in the way between the enemy and the robot, so jump to</span>
 <span class="mne">BNE</span> <a class="popup destination">tact13</a>             <span class="comment">\ tact13 to move on to the next object</span>

 <span class="mne">LDA</span> <a class="popup variable">targetVisibility</a>   <span class="comment">\ If targetVisibility is zero then both bits 6 and 7 are</span>
 <span class="mne">BEQ</span> <a class="popup destination">tact13</a>             <span class="comment">\ clear, so the enemy can't see the robot or the tile</span>
                        <span class="comment">\ it's on, so jump to tact13 to move on to the next</span>
                        <span class="comment">\ object</span>

 <span class="mne">BMI</span> <a class="popup destination">tact19</a>             <span class="comment">\ If bit 7 of targetVisibility is set then the enemy can</span>
                        <span class="comment">\ see the robot's tile, so jump to part 7 with the</span>
                        <span class="comment">\ robot's object number in Y to try draining energy from</span>
                        <span class="comment">\ the robot</span>

 <span class="mne">CPY</span> <a class="popup variable">playerObject</a>       <span class="comment">\ If the robot is not the player object then jump to</span>
 <span class="mne">BNE</span> <a class="popup destination">tact13</a>             <span class="comment">\ tact13 to move on to the next object</span>

 <span class="mne">STY</span> <a class="popup variable">playerTileObscured</a> <span class="comment">\ The robot is the player object and we know that bit 6</span>
                        <span class="comment">\ of targetVisibility must be set (as targetVisibility</span>
                        <span class="comment">\ is non-zero and bit 7 is clear), so this means the</span>
                        <span class="comment">\ enemy can see the player but it can't see the tile</span>
                        <span class="comment">\ that the player is on</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So set playerTileObscured to the object number of the</span>
                        <span class="comment">\ player, so we can process this fact after we have</span>
                        <span class="comment">\ finished looping through the object (assuming the</span>
                        <span class="comment">\ enemy doesn't first get distracted by a different</span>
                        <span class="comment">\ robot whose tile it can see, which will take</span>
                        <span class="comment">\ precedence)</span>

<span class="label">.tact13</span><a id="tact13" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the counter in Y to move on to the next</span>
                        <span class="comment">\ object number</span>

 <span class="mne">BPL</span> <a class="popup destination">tact12</a>             <span class="comment">\ Loop back to tact12 to check the next object number</span>

                        <span class="comment">\ If we get here then we have checked all 64 object</span>
                        <span class="comment">\ numbers and none of them are suitable robots for the</span>
                        <span class="comment">\ enemy to drain, so now we check whether any of them</span>
                        <span class="comment">\ are the partially obscured player object</span>

 <span class="mne">LDY</span> <a class="popup variable">playerTileObscured</a> <span class="comment">\ If bit 7 of playerTileObscured is set then we didn't</span>
 <span class="mne">BMI</span> <a class="popup destination">tact14</a>             <span class="comment">\ change it to the number of the player object in the</span>
                        <span class="comment">\ above loop, so we didn't find a partially obscured</span>
                        <span class="comment">\ player object so jump to tact14 to look for trees</span>
                        <span class="comment">\ and boulders for the enemy to drain instead</span>

                        <span class="comment">\ If we get here then the enemy can see the player</span>
                        <span class="comment">\ but it can't see the tile that the player is on, and</span>
                        <span class="comment">\ the player object number is in Y</span>

 <span class="mne">TYA</span>                    <span class="comment">\ If the value of enemyFailTarget for this enemy matches</span>
 <span class="mne">CMP</span> <a class="popup variable">enemyFailTarget</a>,<span class="register">X</span>  <span class="comment">\ the player object number, then this enemy already</span>
 <span class="mne">BEQ</span> <a class="popup destination">tact14</a>             <span class="comment">\ tried scanning for a tree to turn into a meanie to</span>
                        <span class="comment">\ attack the player and they failed to find one, so jump</span>
                        <span class="comment">\ to tact14 to look for trees and boulders for the enemy</span>
                        <span class="comment">\ to drain instead</span>

 <span class="mne">JSR</span> <a class="popup destination">ResetMeanieScan</a>    <span class="comment">\ Reset the data stored for any meanie scans that the</span>
                        <span class="comment">\ enemy has tried in the past, so the enemy can start</span>
                        <span class="comment">\ looking for potential meanies with a clean slate</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ Set targetVisibility to record that the enemy can see</span>
 <span class="mne">STA</span> <a class="popup variable">targetVisibility</a>   <span class="comment">\ the player object (bit 6 set) but it can't see the</span>
                        <span class="comment">\ tile the player is on (bit 7 clear), so we store this</span>
                        <span class="comment">\ in the enemy's data when we jump to part 7</span>

 <span class="mne">BNE</span> <a class="popup destination">tact19</a>             <span class="comment">\ Jump to part 7 with the target object number in Y to</span>
                        <span class="comment">\ try draining energy from the target object (this BNE</span>
                        <span class="comment">\ is effectively a JMP as A is never zero)</span>

<span class="label">.tact14</span><a id="tact14" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set enemyDrainTimer = 0 to restart the drain counter</span>
 <span class="mne">STA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ for the enemy in part 5 of ApplyTactics, so it doesn't</span>
                        <span class="comment">\ drain energy for another 120 timer ticks (120 * 0.06 =</span>
                        <span class="comment">\ 7.2 seconds)</span>

 <span class="mne">JSR</span> <a class="popup destination">FindObjectToDrain</a>  <span class="comment">\ Find a suitable target object for the enemy to drain</span>
                        <span class="comment">\ (i.e. a tree that is stacked on top of another object,</span>
                        <span class="comment">\ or a boulder, which is exposed to the enemy and on a</span>
                        <span class="comment">\ tile that can be seen by the enemy)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If successful, the object number is in targetObject</span>
                        <span class="comment">\ and the C flag is clear, otherwise the C flag is set</span>

 <span class="mne">BCS</span> <a class="popup destination">tact16</a>             <span class="comment">\ If FindObjectToDrain set the C flag, then no suitable</span>
                        <span class="comment">\ object was found for the enemy to drain, so jump to</span>
                        <span class="comment">\ tact16 to keep applying tactics</span>

<span class="label">.tact15</span><a id="tact15" class="anchor"></a>

                        <span class="comment">\ If we get here then we drain energy from the target</span>
                        <span class="comment">\ object in targetObject</span>

 <span class="mne">JSR</span> <a class="popup destination">DrainObjectEnergy</a>  <span class="comment">\ Drain energy from the target object into the enemy,</span>
                        <span class="comment">\ transforming it into an object with an energy level</span>
                        <span class="comment">\ of one unit less (if applicable)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This updates enemyEnergy with the drained energy, so</span>
                        <span class="comment">\ it can be expended back onto the landscape later on</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It also sets X to the object number of the target that</span>
                        <span class="comment">\ has been drained of energy (and which has therefore</span>
                        <span class="comment">\ been transformed into a different object type)</span>

 <span class="mne">BCS</span> <a class="popup destination">tact17</a>             <span class="comment">\ If DrainObjectEnergy set the C flag then the enemy</span>
                        <span class="comment">\ just drained the player object, so jump to tact17 to</span>
                        <span class="comment">\ move on to the next enemy in the next iteration of</span>
                        <span class="comment">\ the gameplay loop, as we don't need to update the</span>
                        <span class="comment">\ player object on-screen (as we never see the player</span>
                        <span class="comment">\ object)</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set enemyTacticTimer for the enemy to 30 so we wait</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ for 30 * 0.06 = 1.8 seconds before applying tactics</span>
 <span class="mne">STA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">Y</span> <span class="comment">\ to the enemy again</span>

 <span class="mne">JMP</span> <a class="popup destination">tact25</a>             <span class="comment">\ Jump to tact25 with X set to the object number of</span>
                        <span class="comment">\ the enemy to update it on-screen with a dithered</span>
                        <span class="comment">\ effect (as it has now been transformed into a</span>
                        <span class="comment">\ different type of object) and return from the</span>
                        <span class="comment">\ subroutine using a tail call</span>

<span class="label">.tact16</span><a id="tact16" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics (so this is now object #X)</span>

 <span class="mne">LDA</span> <a class="popup variable">enemyRotateTimer</a>,<span class="register">X</span> <span class="comment">\ If the rotation timer for the enemy is less than 2</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ then it has run all the way down, so jump to part 6</span>
 <span class="mne">BCC</span> <a class="popup destination">tact18</a>             <span class="comment">\ to rotate the enemy</span>

<span class="label">.tact17</span><a id="tact17" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ Otherwise jump to MoveOnToNextEnemy to stop applying</span>
                        <span class="comment">\ tactics to this enemy and set things up so we move on</span>
                        <span class="comment">\ to the next enemy in the next iteration of the</span>
                        <span class="comment">\ gameplay loop</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-6-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 6 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Rotate the enemy and make a rotation sound</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_6_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact18</span><a id="tact18" class="anchor"></a>

                        <span class="comment">\ If we get here then we need to rotate enemy #X</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Check to see whether it is safe to redraw object #X</span>
 <span class="mne">JSR</span> <a class="popup destination">AbortWhenVisible</a>   <span class="comment">\ without risk of corrupting a screen pan (if there is</span>
                        <span class="comment">\ a risk and it can't be updated, then the call to</span>
                        <span class="comment">\ AbortWhenVisible will not return here and will instead</span>
                        <span class="comment">\ abort tactics for this iteration of the gameplay loop)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Set objectYawAngle = objectYawAngle + enemyYawStep</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">enemyYawStep</a>,<span class="register">X</span>     <span class="comment">\ So this rotates the enemy by the yaw angle in this</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ enemy's enemyYawStep variable</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">200</span>               <span class="comment">\ Set enemyRotateTimer for the enemy to 200 so we wait</span>
 <span class="mne">STA</span> <a class="popup variable">enemyRotateTimer</a>,<span class="register">X</span> <span class="comment">\ for 200 * 0.06 = 12 seconds before rotating the enemy</span>
                        <span class="comment">\ again</span>

 <span class="mne">JSR</span> <a class="popup destination">ResetMeanieScan</a>    <span class="comment">\ Reset the data stored for any meanie scans that the</span>
                        <span class="comment">\ enemy has tried in the past, so the enemy can start</span>
                        <span class="comment">\ looking for potential meanies with a clean slate</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set X = 7 to pass to MakeSound-6 as the pitch of the</span>
                        <span class="comment">\ first part of the rotating enemy sound</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">120</span>               <span class="comment">\ Set Y = 70 to pass to MakeSound-6 as the pitch of the</span>
                        <span class="comment">\ second part of the rotating enemy sound</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Make sound #0 (rotating enemy) with the pitches in X</span>
 <span class="mne">JSR</span> <a class="popup destination">MakeSound-6</a>        <span class="comment">\ and Y</span>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics</span>

 <span class="mne">JMP</span> <a class="popup destination">tact26</a>             <span class="comment">\ Jump to tact26 to draw the updated object #X without a</span>
                        <span class="comment">\ dithered effect, so the enemy rotates instantly if it</span>
                        <span class="comment">\ is on the screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-7-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 7 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Drain energy from the enemy's target object, or try scanning for</span>
             <span class="headerEntry">a tree to turn into a meanie if the target's tile is obscured</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_7_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact19</span><a id="tact19" class="anchor"></a>

                        <span class="comment">\ If we get here then there is a suitable target for the</span>
                        <span class="comment">\ enemy to drain, and the target's object number is in Y</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Store the target number in enemyTarget in the enemy's</span>
 <span class="mne">STA</span> <a class="popup variable">enemyTarget</a>,<span class="register">X</span>      <span class="comment">\ data, so it is set as the enemy's target going forward</span>

 <span class="mne">LDA</span> <a class="popup variable">targetVisibility</a>   <span class="comment">\ Store the target's visibility in enemyVisibility for</span>
 <span class="mne">STA</span> <a class="popup variable">enemyVisibility</a>,<span class="register">X</span>  <span class="comment">\ this enemy</span>

 <span class="mne">LDA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ If enemyDrainTimer for this enemy is non-zero then it</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ is either counting down or has counted down, so jump</span>
 <span class="mne">BCS</span> <a class="popup destination">tact21</a>             <span class="comment">\ to tact21 to process this</span>

                        <span class="comment">\ If we get here then enemyDrainTimer is zero, so we</span>
                        <span class="comment">\ restart the timer from 120</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">120</span>               <span class="comment">\ Set enemyDrainTimer for this enemy to 120 so the enemy</span>
 <span class="mne">STA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">X</span>  <span class="comment">\ doesn't drain energy for another 120 timer ticks</span>
                        <span class="comment">\ (120 * 0.06 = 7.2 seconds)</span>

<span class="label">.tact20</span><a id="tact20" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ Jump to MoveOnToNextEnemy to stop applying tactics to</span>
                        <span class="comment">\ this enemy and set things up so we move on to the next</span>
                        <span class="comment">\ enemy in the next iteration of the gameplay loop</span>

<span class="label">.tact21</span><a id="tact21" class="anchor"></a>

 <span class="mne">BNE</span> <a class="popup destination">tact20</a>             <span class="comment">\ We jump knowing that the enemyDrainTimer for the enemy</span>
                        <span class="comment">\ is 1 or greater, so this jumps to tact20 to move on to</span>
                        <span class="comment">\ the next enemy when enemyDrainTimer is greater than 1</span>
                        <span class="comment">\ and is still counting down</span>

                        <span class="comment">\ If we get here then enemyDrainTimer for the enemy has</span>
                        <span class="comment">\ counted down to 1, so we need to process that</span>

 <span class="mne">LDA</span> <a class="popup variable">targetVisibility</a>   <span class="comment">\ If bit 7 of targetVisibility is clear then the enemy</span>
 <span class="mne">BPL</span> <a class="popup destination">tact22</a>             <span class="comment">\ can't see the tile containing the enemy's target (but</span>
                        <span class="comment">\ we know it can see the enemy object as otherwise we</span>
                        <span class="comment">\ wouldn't have reached this point), so jump to tact22</span>
                        <span class="comment">\ to consider turning a tree into a meanie</span>

                        <span class="comment">\ If we get here then the enemy can see the tile</span>
                        <span class="comment">\ containing the target, so it can drain its target of</span>
                        <span class="comment">\ energy</span>

 <span class="mne">JSR</span> <a class="popup destination">DrainObjectEnergy</a>  <span class="comment">\ Drain energy from the target object into the enemy,</span>
                        <span class="comment">\ transforming it into an object with an energy level</span>
                        <span class="comment">\ of one unit less (if applicable)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This updates enemyEnergy with the drained energy, so</span>
                        <span class="comment">\ it can be expended back onto the landscape later on</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It also sets X to the object number of the target that</span>
                        <span class="comment">\ has been drained of energy (and which has therefore</span>
                        <span class="comment">\ been transformed into a different object type)</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set enemyTacticTimer for the enemy to 30 so we wait</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ for 30 * 0.06 = 1.8 seconds before applying tactics</span>
 <span class="mne">STA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">Y</span> <span class="comment">\ to the enemy again</span>

 <span class="mne">BCS</span> <a class="popup destination">tact27</a>             <span class="comment">\ If DrainObjectEnergy set the C flag then the enemy</span>
                        <span class="comment">\ just drained the player object, so jump to tact27 to</span>
                        <span class="comment">\ stop applying tactics to this enemy and set things up</span>
                        <span class="comment">\ so we move on to the next enemy in the next iteration</span>
                        <span class="comment">\ of the gameplay loop</span>

 <span class="mne">JMP</span> <a class="popup destination">tact25</a>             <span class="comment">\ Otherwise it wasn't the player object being drained,</span>
                        <span class="comment">\ so jump to tact25 with X set to the number of the</span>
                        <span class="comment">\ object that was drained so we update it on-screen with</span>
                        <span class="comment">\ a dithered effect (as it has now been transformed into</span>
                        <span class="comment">\ a different type of object) and return from the</span>
                        <span class="comment">\ subroutine using a tail call</span>

<span class="label">.tact22</span><a id="tact22" class="anchor"></a>

                        <span class="comment">\ If we get here then the enemy can't see the tile</span>
                        <span class="comment">\ containing the enemy's target, but it can see the</span>
                        <span class="comment">\ target object, so now we consider turning a tree into</span>
                        <span class="comment">\ a meanie</span>

 <span class="mne">JSR</span> <a class="popup destination">ScanForMeanieTree</a>  <span class="comment">\ Scan through the objects in the landscape to see if</span>
                        <span class="comment">\ any of them are trees that are suitable for turning</span>
                        <span class="comment">\ into a meanie to attack the target</span>

 <span class="mne">LDY</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set Y to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics (so this is now object #Y)</span>

 <span class="mne">BCC</span> <a class="popup destination">tact24</a>             <span class="comment">\ If the call to ScanForMeanieTree cleared the C flag</span>
                        <span class="comment">\ then we have successfully turned a tree into a meanie,</span>
                        <span class="comment">\ so jump to tact24 to set up the enemy's tactics timer</span>
                        <span class="comment">\ and redraw the transformed tree on-screen</span>

 <span class="mne">LDA</span> <a class="popup variable">enemyFailCounter</a>,<span class="register">Y</span> <span class="comment">\ If enemyFailCounter for this enemy is two or more then</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ the enemy has failed to find a suitable tree to turn</span>
 <span class="mne">BCS</span> <a class="popup destination">tact23</a>             <span class="comment">\ into a meanie on more than one occasion, so jump to</span>
                        <span class="comment">\ tact23 to have a fairly long pause before applying</span>
                        <span class="comment">\ tactics to this enemy again</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Otherwise set bit 7 of enemyDrainScan so the next time</span>
 <span class="mne">STA</span> <a class="popup variable">enemyDrainScan</a>,<span class="register">Y</span>   <span class="comment">\ we apply tactics to the enemy it will immediately scan</span>
                        <span class="comment">\ for an object to drain</span>

 <span class="mne">BNE</span> <a class="popup destination">tact27</a>             <span class="comment">\ Jump to tact27 to stop applying tactics to this enemy</span>
                        <span class="comment">\ and set things up so we move on to the next enemy in</span>
                        <span class="comment">\ the next iteration of the gameplay loop (this BNE is</span>
                        <span class="comment">\ effectively a JMP as A is always non-zero)</span>

<span class="label">.tact23</span><a id="tact23" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set enemyDrainTimer = 0 to restart the drain counter</span>
 <span class="mne">STA</span> <a class="popup variable">enemyDrainTimer</a>,<span class="register">Y</span>  <span class="comment">\ for the enemy in part 5 of ApplyTactics, so it doesn't</span>
                        <span class="comment">\ drain energy for another 120 timer ticks (120 * 0.06 =</span>
                        <span class="comment">\ 7.2 seconds)</span>

 <span class="mne">BEQ</span> <a class="popup destination">tact27</a>             <span class="comment">\ Jump to tact27 to stop applying tactics to this enemy</span>
                        <span class="comment">\ and set things up so we move on to the next enemy in</span>
                        <span class="comment">\ the next iteration of the gameplay loop (this BEQ is</span>
                        <span class="comment">\ effectively a JMP as A is always zero)</span>

<span class="label">.tact24</span><a id="tact24" class="anchor"></a>

                        <span class="comment">\ If we get here then we have just turned a tree into a</span>
                        <span class="comment">\ meanie and the enemy number is in Y</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">50</span>                <span class="comment">\ Set enemyTacticTimer for the enemy to 50 so we wait</span>
 <span class="mne">STA</span> <a class="popup variable">enemyTacticTimer</a>,<span class="register">Y</span> <span class="comment">\ for 50 * 0.06 = 3.0 seconds before applying tactics to</span>
                        <span class="comment">\ the enemy again</span>

 <span class="mne">LDX</span> <a class="popup variable">enemyMeanieTree</a>,<span class="register">Y</span>  <span class="comment">\ Set X to the object number of the tree that we just</span>
                        <span class="comment">\ turned into a meanie, and fall through into part 8 to</span>
                        <span class="comment">\ redraw the transformed object on the screen with a</span>
                        <span class="comment">\ dithered effect</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-applytactics-part-8-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 8 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Redraw the object on the screen, optionally with a dithered</span>
             <span class="headerEntry">effect</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/applytactics_part_8_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applyenemytactics.html">ApplyEnemyTactics</a> calls via <a href="#tact25">tact25</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_2_of_8.html">ApplyTactics (Part 2 of 8)</a> calls via <a href="#tact25">tact25</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_3_of_8.html">ApplyTactics (Part 3 of 8)</a> calls via <a href="#tact25">tact25</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_5_of_8.html">ApplyTactics (Part 5 of 8)</a> calls via <a href="#tact25">tact25</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_7_of_8.html">ApplyTactics (Part 7 of 8)</a> calls via <a href="#tact25">tact25</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">tact25</span>               <span class="argumentEntry">Dither the updated object #X onto the screen, with bit 7</span>
                        <span class="argumentEntry">of drawLandscape determining whether the object is drawn</span>
                        <span class="argumentEntry">on its own (bit 7 set) or with the surrounding landscape</span>
                        <span class="argumentEntry">(bit 7 clear)</span>

</div></div>
<span class="label">.tact25</span><a id="tact25" class="anchor"></a>

                        <span class="comment">\ We jump here to update object #X on-screen by drawing</span>
                        <span class="comment">\ the object (or the landscape without the object) onto</span>
                        <span class="comment">\ the screen with a dithered effect</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used to show objects being absorbed, for</span>
                        <span class="comment">\ example</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ Clear bit 7 and set bit 6 of ditherObjectSights so the</span>
 <span class="mne">STA</span> <a class="popup variable">ditherObjectSights</a> <span class="comment">\ updated object is dithered onto the screen in the call</span>
                        <span class="comment">\ to DrawUpdatedObject below</span>

<span class="label">.tact26</span><a id="tact26" class="anchor"></a>

                        <span class="comment">\ If we jump here instead of tact25, then we update</span>
                        <span class="comment">\ object #X on-screen, but instantly rather than with a</span>
                        <span class="comment">\ dithered effect</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used to show objects rotating, for example</span>

 <span class="mne">STX</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set the current object to X so the call</span>

 <span class="mne">LDA</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set viewingObject to the object number of the player</span>
 <span class="mne">STA</span> <a class="popup variable">viewingObject</a>

 <span class="mne">JSR</span> <a class="popup destination">DrawUpdatedObject</a>  <span class="comment">\ Draw the updated object (or the landscape where the</span>
                        <span class="comment">\ object used to be) into the screen buffer and dither</span>
                        <span class="comment">\ it onto the screen, pixel by pixel and randomly</span>

<span class="label">.tact27</span><a id="tact27" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">MoveOnToNextEnemy</a>  <span class="comment">\ Jump to MoveOnToNextEnemy to stop applying tactics to</span>
                        <span class="comment">\ this enemy and set things up so we move on to the next</span>
                        <span class="comment">\ enemy in the next iteration of the gameplay loop</span>


</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-abortwhenvisible"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-abortwhenvisible">AbortWhenVisible</a> (category: Gameplay)</div><div class="summary">Abort applying the tactics for this gameplay loop if updating the object on-screen will corrupt a screen pan</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-addenemiestotiles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a> (category: Landscape)</div><div class="summary">Add the required number of enemies to the landscape, starting from the highest altitude and working down, with one enemy per contour</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-applyenemytactics"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-applyenemytactics">ApplyEnemyTactics</a> (category: Gameplay)</div><div class="summary">Apply tactics to an enemy object, setting things up so the next call applies tactics to the next enemy object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-applytactics"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-1-of-8">ApplyTactics (Part 1 of 8)</a> (category: Gameplay)</div><div class="summary">Apply tactics to the Sentinel or a sentry</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-checkenemygaze"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-checkenemygaze-part-1-of-2">CheckEnemyGaze (Part 1 of 2)</a> (category: Gameplay)</div><div class="summary">Check to see whether the current enemy can see a specific target object of a specific type</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-checkforsamepankey"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-checkforsamepankey">CheckForSamePanKey</a> (category: Keyboard)</div><div class="summary">Check to see whether the same pan key is being held down compared to the last time we checked</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-clearscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-clearscreen">ClearScreen</a> (category: Graphics)</div><div class="summary">Clear the screen to a specified background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drainobjectenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-drainobjectenergy">DrainObjectEnergy</a> (category: Gameplay)</div><div class="summary">Drain energy from an object into an enemy, transforming it into an object with an energy level of one unit less (if applicable)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscapeview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-1-of-3">DrawLandscapeView (Part 1 of 3)</a> (category: Drawing the landscape)</div><div class="summary">Set up a number of variables for drawing the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-drawsights">DrawSights</a> (category: Sights)</div><div class="summary">Draw the sights on the screen, saving the existing screen contents in the sights pixel byte stash</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtitleobjects"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-drawtitleobjects">DrawTitleObjects</a> (category: Title screen)</div><div class="summary">Draw an object on top of a tower on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawupdatedobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a> (category: Drawing objects)</div><div class="summary">Draw an updated object on-screen, optionally with a dithered effect, and with or without the surrounding landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-expendenemyenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-expendenemyenergy">ExpendEnemyEnergy</a> (category: Gameplay)</div><div class="summary">Drain one unit of energy from an enemy and expend it onto the landscape by spawning a tree, if possible</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fillscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a> (category: Graphics)</div><div class="summary">Fill a rectangular in screen memory or the screen buffer with the specified background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-findobjecttodrain"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-findobjecttodrain">FindObjectToDrain</a> (category: Gameplay)</div><div class="summary">Find a suitable target object for an enemy to drain</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-flushsoundbuffer0"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-flushsoundbuffer0">FlushSoundBuffer0</a> (category: Sound)</div><div class="summary">Flush the sound channel 0 buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-focusonkeyaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-focusonkeyaction">FocusOnKeyAction</a> (category: Keyboard)</div><div class="summary">Tell the game to start focusing effort on the action that has been initiated, such as a pan of the landscape, absorb, transfer etc.</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getenemycount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-getenemycount">GetEnemyCount</a> (category: Landscape)</div><div class="summary">Calculate the number of enemies for the current landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gethighesttiles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-gethighesttiles">GetHighestTiles</a> (category: Landscape)</div><div class="summary">Calculate both the highest tiles in each 4x4 block of tiles in the landscape and the altitude of the highest tile in the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-geticonrowaddress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-geticonrowaddress">GetIconRowAddress</a> (category: Scanner/energy row)</div><div class="summary">Calculate the address in screen memory of the icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseed0to22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-getnextseed0to22">GetNextSeed0To22</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to the next number from the landscape's sequence of seed numbers, converted to the range 0 to 22</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseed0to30"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-getnextseed0to30">GetNextSeed0To30</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to the next number from the landscape's sequence of seed numbers, converted to the range 0 to 30</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseedasbcd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-getnextseedasbcd">GetNextSeedAsBCD</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to the next number from the landscape's sequence of seed numbers, converted to a binary coded decimal (BCD) number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseednumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-getnextseednumber">GetNextSeedNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a seed number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getplayerdrain"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-getplayerdrain">GetPlayerDrain</a> (category: Gameplay)</div><div class="summary">Calculate whether the player is being scanned by an enemy and whether the enemy can see the player's tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getrandomnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-getrandomnumber">GetRandomNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a random number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettiledata">GetTileData</a> (category: Landscape)</div><div class="summary">Get the tile data and tile data address for a specific tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettilesataltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-gettilesataltitude">GetTilesAtAltitude</a> (category: Landscape)</div><div class="summary">Return a list of tile blocks at a specified altitude</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-initialisesights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-initialisesights">InitialiseSights</a> (category: Sights)</div><div class="summary">Initialise the variables used to manage the sights, so the sights appear in the middle of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-makesound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">MakeSound</a> (category: Sound)</div><div class="summary">Make a sound</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-makesound-6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_g.html#makesound">MakeSound-6</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">MakeSound</a> (category: Sound)</div><div class="summary">Make a two-part sound at the pitches defined in X and Y, where X is the pitch for sound data block #0 and Y is the pitch for sound data block #1</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-moveontonextenemy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-moveontonextenemy">MoveOnToNextEnemy</a> (category: Gameplay)</div><div class="summary">Update enemyObject so the next time we consider applying enemy tactics, we apply them to the next enemy, looping from 7 to 0</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-movesights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-movesights">MoveSights</a> (category: Sights)</div><div class="summary">Check for up/down/left/right key presses and move the sights accordingly, panning the screen if they go past the screen edges</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-performhyperspace"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-performhyperspace">PerformHyperspace</a> (category: Gameplay)</div><div class="summary">Hyperspace the player to a brand new tile, ideally at the same altitude as the current tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-placeobjectbelow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-placeobjectbelow">PlaceObjectBelow</a> (category: 3D objects)</div><div class="summary">Attempt to place an object on a tile that is below the maximum altitude specified in A</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-placeobjectontile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a> (category: 3D objects)</div><div class="summary">Place an object on a tile, putting it on top of any existing boulders or towers</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playgame"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-playgame">PlayGame</a> (category: Main game loop)</div><div class="summary">Start playing the generated landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processactionkeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-processactionkeys-part-1-of-2">ProcessActionKeys (Part 1 of 2)</a> (category: Keyboard)</div><div class="summary">Process an action key press from key logger entry 1 (absorb, transfer, create, hyperspace, U-turn)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processgameplay"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a> (category: Gameplay)</div><div class="summary">A gameplay loop that processes all game key presses, returning to the main game loop when the player moves, quits, loses or pans</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processpausekeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processpausekeys">ProcessPauseKeys</a> (category: Keyboard)</div><div class="summary">Pause or unpause the game when COPY or DELETE are pressed</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processsound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a> (category: Sound)</div><div class="summary">Process any sound effects that have been configured so they play in the background (this is called regularly throughout gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processvolumekeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a> (category: Sound)</div><div class="summary">Adjust the volume of the sound envelopes when the volume keys are pressed</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-removesights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-removesights">RemoveSights</a> (category: Sights)</div><div class="summary">Remove the sights from the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-resetmeaniescan"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-resetmeaniescan">ResetMeanieScan</a> (category: Gameplay)</div><div class="summary">Reset the data stored for any meanie scans that the enemy has tried in the past, so we can start looking with a clean slate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sheila"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#sheila">SHEILA</a></div><div class="summary">Memory-mapped space for accessing internal hardware, such as the video ULA, 6845 CRTC and 6522 VIAs (also known as SHEILA)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scanforgamekeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-scanforgamekeys">ScanForGameKeys</a> (category: Keyboard)</div><div class="summary">Scan for game key presses and update the key logger</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scanformeanietree"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-scanformeanietree">ScanForMeanieTree</a> (category: Gameplay)</div><div class="summary">Scan through the objects in the landscape to see if any of them are trees that are suitable for turning into a meanie</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scankeyboard"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-scankeyboard">ScanKeyboard</a> (category: Keyboard)</div><div class="summary">Scan the keyboard for a specific key press</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setcolumnbuffermax"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-setcolumnbuffermax">SetColumnBufferMax</a> (category: Screen buffer)</div><div class="summary">Set the maximum and minimum pitch angles for the column buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-showgameoverscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-showgameoverscreen">ShowGameOverScreen</a> (category: Title screen)</div><div class="summary">Display the game over screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-spawnobject">SpawnObject</a> (category: 3D objects)</div><div class="summary">Add a new object of the specified type to the objectTypes table</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawntrees"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-spawntrees">SpawnTrees</a> (category: Landscape)</div><div class="summary">Add trees to the landscape, ideally placing them below all the enemies in the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-startscrollingview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-startscrollingview">StartScrollingView</a> (category: Screen buffer)</div><div class="summary">Start a scroll process in the background by setting the number of scroll steps and the address to start copying new content from</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#t">T</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#u">U</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateiconsscanner"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a> (category: Scanner/energy row)</div><div class="summary">Update the icons in the top-left corner of the screen to show the player's current energy level and redraw the scanner box</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updatescannernow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a> (category: Scanner/energy row)</div><div class="summary">Update the scanner to a new state</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-usecolumnbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-usecolumnbuffer">UseColumnBuffer</a> (category: Screen buffer)</div><div class="summary">Configure the column buffer for use</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-userowbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-userowbuffer">UseRowBuffer</a> (category: Screen buffer)</div><div class="summary">Configure the row buffer for use</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-activatesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#activatesentinel">activateSentinel</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record when the Sentinel is activated at the start of the game (by the player pressing a key that expends or absorbs energy</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-aden1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#aden1">aden1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-aden2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#aden2">aden2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-aden3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#aden3">aden3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-aden4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#aden4">aden4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-aden5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#aden5">aden5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-aden6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#aden6">aden6</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-addenemiestotiles">AddEnemiesToTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bitmask">bitMask</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Used to return a bit mask from the GetTilesAtAltitude routine that has a matching number of leading zeroes as the number of tile blocks at a specific altitude</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffercolumns"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#buffercolumns">bufferColumns</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of character columns in the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey1">ckey1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey10">ckey10</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey2">ckey2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey3">ckey3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey4">ckey4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey5">ckey5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey6">ckey6</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey7">ckey7</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey8">ckey8</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ckey9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#ckey9">ckey9</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-colourpalettes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-colourpalettes">colourPalettes</a> (category: Graphics)</div><div class="summary">The logical colours for two mode 5 palettes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-cpan1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#cpan1">cpan1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checkforsamepankey">CheckForSamePanKey</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-currentobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#currentobject">currentObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the object we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherobjectsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ditherobjectsights">ditherObjectSights</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Configures how an updated object is drawn onto the screen in the DrawUpdatedObject routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotditherobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotditherobject">doNotDitherObject</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the DitherScreenBuffer routine can update an object on the screen using a dithered effect</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotplaylandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotplaylandscape">doNotPlayLandscape</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that controls whether we preview and play the landscape after generating it</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemycounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#enemycounter">enemyCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Used as a loop counter when adding enemies to the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemydrainscan"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemydrainscan">enemyDrainScan</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Enemy will perform a scan for a drainable object (one</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemydraintimer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemydraintimer">enemyDrainTimer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A timer for each enemy that counts down every 0.06</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyfailcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemyfailcounter">enemyFailCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Enemy failed to find meanie: counter (one byte per</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyfailtarget"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemyfailtarget">enemyFailTarget</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Enemy failed to find meanie: target object (one byte</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemymeaniescan"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemymeaniescan">enemyMeanieScan</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Enemy meanie scan object counter (one byte per enemy)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemymeanietree"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemymeanietree">enemyMeanieTree</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Enemy has turned a tree into a meanie (one byte per</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#enemyobject">enemyObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The object number of the enemy to which we are applying tactics in this iteration around the main loop (0-7)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyrotatetimer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemyrotatetimer">enemyRotateTimer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A timer for each enemy that counts down every 0.06</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemytactictimer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemytactictimer">enemyTacticTimer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A timer for each enemy that counts down every 0.06</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemytarget"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemytarget">enemyTarget</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The object number of the enemy's target (one byte per</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyviewingarc"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemyviewingarc">enemyViewingArc</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The viewing arc of the enemy that is being processed in the ApplyTactics routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyvisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#enemyvisibility">enemyVisibility</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Visibility of the enemy's target (one byte per enemy)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyyawstep"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-enemyyawstep">enemyYawStep</a> (category: 3D objects)</div><div class="summary">The yaw angle through which each enemy rotates on each scheduled rotation</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-etac1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#etac1">etac1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applyenemytactics">ApplyEnemyTactics</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-focu1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_b.html#focu1">focu1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-focusonkeyaction">FocusOnKeyAction</a> (category: Keyboard)</div><div class="summary">Store the current setting of focusOnKeyAction in the previousFocus variable so we can detect (in the ProcessGameplay routine) whether the player is still holding down a pan key after we finish scrolling the screen for the previous pan... and then return from the subroutine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-focusonkeyaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#focusonkeyaction">focusOnKeyAction</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that determines whether the game should focus effort on implementing a key action, such as a pan of the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-galt1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#galt1">galt1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gettilesataltitude">GetTilesAtAltitude</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-galt2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#galt2">galt2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gettilesataltitude">GetTilesAtAltitude</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-galt3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#galt3">galt3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gettilesataltitude">GetTilesAtAltitude</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-galt4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#galt4">galt4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gettilesataltitude">GetTilesAtAltitude</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameinprogress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gameinprogress">gameInProgress</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Flags whether or not a game is in progress (i.e. the player is playing a landscape rather than interacting with the title and preview screens)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gamekeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-gamekeys">gameKeys</a> (category: Keyboard)</div><div class="summary">Negative inkey values for the game keys</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameplaystack"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gameplaystack">gameplayStack</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The value of the stack pointer at the start of the ApplyEnemyTactics routine, so we can return back to the ProcessGameplay routine from deep within the tactics routines if required</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gkey1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#gkey1">gkey1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-scanforgamekeys">ScanForGameKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gkey2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#gkey2">gkey2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-scanforgamekeys">ScanForGameKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gkey3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#gkey3">gkey3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-scanforgamekeys">ScanForGameKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-high1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#high1">high1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gethighesttiles">GetHighestTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-high2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#high2">high2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gethighesttiles">GetHighestTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-high3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#high3">high3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gethighesttiles">GetHighestTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-high4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#high4">high4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gethighesttiles">GetHighestTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-high5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#high5">high5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-gethighesttiles">GetHighestTiles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-highestpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-highestpitchangle">highestPitchAngle</a> (category: Sights)</div><div class="summary">The pitch angle of the highest point that the player can look at with the sights</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-inputbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#inputbuffer">inputBuffer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The eight-byte keyboard input buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keylogger"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#keylogger">keyLogger</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The four-byte key logger for logging game key presses</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keyloggerconfig"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-keyloggerconfig">keyLoggerConfig</a> (category: Keyboard)</div><div class="summary">The configuration table for storing keys the key logger</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keypress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#keypress">keyPress</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The key logger value for a key press</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapecolour2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-landscapecolour2">landscapeColour2</a> (category: Landscape)</div><div class="summary">Physical colours for colour 2 in the game palette for the different numbers of enemies</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapecolour3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-landscapecolour3">landscapeColour3</a> (category: Landscape)</div><div class="summary">Physical colours for colour 3 in the game palette for the different numbers of enemies</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapezero"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#landscapezero">landscapeZero</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that is set depending on whether we are playing landscape 0000</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lastpankeypressed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#lastpankeypressed">lastPanKeyPressed</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The direction of the last pan key that was pressed (which may not still be held down)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lastscannerstate"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#lastscannerstate">lastScannerState</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The state of the scanner the last time that it was updated</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-latestpankeypress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#latestpankeypress">latestPanKeyPress</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The key logger value of the latest pan key press, which will either be a current key press or the value from the last pan key press to be made</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-leadingbitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-leadingbitmask">leadingBitMask</a> (category: Landscape)</div><div class="summary">A table for converting the number of leading clear bits in a number into a bit mask with the same number of leading zeroes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-loopcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#loopcounter">loopCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A general-purpose loop counter</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan1">lpan1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan2">lpan2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan3">lpan3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan4">lpan4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan5">lpan5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan6">lpan6</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lpan7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#lpan7">lpan7</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxaltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-maxaltitude">maxAltitude</a> (category: Landscape)</div><div class="summary">The maximum tile altitude for each 4x4 block of tiles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxnumberofenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#maxnumberofenemies">maxNumberOfEnemies</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The maximum number of enemies that can appear on the current landscape, which is calculated as follows</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-meanieyawstep"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#meanieyawstep">meanieYawStep</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw angle through which we rotate a meanie as it searches for the player in the ApplyTactics routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-minenemyaltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#minenemyaltitude">minEnemyAltitude</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The altitude of the lowest enemy on the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-next1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#next1">next1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-moveontonextenemy">MoveOnToNextEnemy</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-numberofenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#numberofenemies">numberOfEnemies</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of enemies in the current landscape, including the Sentinel (in the range 1 to 8)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objb1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#objb1">objb1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-placeobjectbelow">PlaceObjectBelow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objb2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#objb2">objb2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-placeobjectbelow">PlaceObjectBelow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objb3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#objb3">objb3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-placeobjectbelow">PlaceObjectBelow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectflags"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectflags">objectFlags</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">Object flags for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectpitchangle">objectPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">The pitch angle for each object (i.e. the vertical direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttypes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objecttypes">objectTypes</a> (category: 3D objects)</div><div class="summary">The object types table for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectviewyawhi">objectViewYawHi</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw angle of the object being analysed, relative to the current viewer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectyawangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objectyawangle">objectYawAngle</a> (category: 3D objects)</div><div class="summary">The yaw angle for each object (i.e. the horizontal direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-panangletoupdate"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-panangletoupdate">panAngleToUpdate</a> (category: Drawing the landscape)</div><div class="summary">Pitch and yaw angles for panning the landscape view, so the output of DrawLandscapeView will be the bit we add when updating the view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pankeybeingpressed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pankeybeingpressed">panKeyBeingPressed</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The direction in which the player is currently panning</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play1">play1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play2">play2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play3">play3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play4">play4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play5">play5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play6">play6</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play7">play7</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play8">play8</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-play9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#play9">play9</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playerenergy">playerEnergy</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The player's energy level (in the range 0 to 63)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerhasmovedtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playerhasmovedtile">playerHasMovedTile</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether the player has moved to a new tile by transferring or hyperspacing, so we can decide whether to regenerate the player's landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#playerobject">playerObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the player object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playertileishidden"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playertileishidden">playerTileIsHidden</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that records when the player is being scanned but the player's tile is hidden from the Sentinel or sentry doing the scan</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playertileobscured"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#playertileobscured">playerTileObscured</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Records when an enemy can see the player object but can't see the tile that the player is on</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-popu1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#popu1">popu1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawnenemies">SpawnEnemies</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-popu2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#popu2">popu2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawnenemies">SpawnEnemies</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-previousfocus"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#previousfocus">previousFocus</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The previous setting of focusOnKeyAction, so we can detect (in the ProcessGameplay routine) whether the player is still holding down a pan key after we finish scrolling the screen for the previous pan</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-quitgame"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#quitgame">quitGame</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether the player has pressed function key f1 to quit the game</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#rese1">rese1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-resetvariables">ResetVariables</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#rese2">rese2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-resetvariables">ResetVariables</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#rese3">rese3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-resetvariables">ResetVariables</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#rese4">rese4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-resetvariables">ResetVariables</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-resv1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#resv1">resv1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-resettilesobjects">ResetTilesObjects</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-samepankeypress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#samepankeypress">samePanKeyPress</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Records whether the same pan key is being held down after we have just finished panning the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scan1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#scan1">scan1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scan2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#scan2">scan2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scan3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#scan3">scan3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scan4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#scan4">scan4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scan5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#scan5">scan5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scan6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_b.html#scan6">scan6</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a> (category: Scanner/energy row)</div><div class="summary">Contains an RTS</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scannerblock"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-scannerblock">scannerBlock</a> (category: Scanner/energy row)</div><div class="summary">A counter for the eight character blocks that make up the scanner</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scannerpixelbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-scannerpixelbyte">scannerPixelByte</a> (category: Scanner/energy row)</div><div class="summary">Pixel bytes for the three states of the scanner (black, static and green)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scannerstate"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-scannerstate">scannerState</a> (category: Scanner/energy row)</div><div class="summary">The current state of the scanner (black, static or green)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scannerstatic"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-scannerstatic">scannerStatic</a> (category: Scanner/energy row)</div><div class="summary">Storage for a random number that's used to generate static in the scanner</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scannerupdate"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#scannerupdate">scannerUpdate</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to control whether the scanner gets updated</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenaddr">screenAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Storage for a screen address</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbackground"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#screenbackground">screenBackground</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The type of screen background when clearing the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-secretcodechecks"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#secretcodechecks">secretCodeChecks</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Bits 1 to 4 store the results of checking each of the four two-digit numbers in a landscape's secret entry code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-secretcodestash"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-secretcodestash">secretCodeStash</a> (category: Landscape)</div><div class="summary">A stash for calculated values for each iteration in the CheckSecretCode routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sentinelhaswon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sentinelhaswon">sentinelHasWon</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record when the player runs out of energy (i.e. the energy level goes negative), at which point the Sentinel wins</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sesi1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#sesi1">sesi1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-initialisesights">InitialiseSights</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsarevisible"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsarevisible">sightsAreVisible</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the sights are being shown</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsinitialmoves"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsinitialmoves">sightsInitialMoves</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls the initial movement of the sights over the first eight calls to the CheckForKeyPresses routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsscreenaddr">sightsScreenAddr</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The screen address of the sights</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spacekeydebounce"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-spacekeydebounce">spaceKeyDebounce</a> (category: Keyboard)</div><div class="summary">A variable to flag whether the SPACE key has been pressed, so we can implement debounce</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sply1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#sply1">sply1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawnplayer">SpawnPlayer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sply2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#sply2">sply2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawnplayer">SpawnPlayer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-srct1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#srct1">srct1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checksecretcode-part-1-of-2">CheckSecretCode (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-srct2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#srct2">srct2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checksecretcode-part-1-of-2">CheckSecretCode (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-srct3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#srct3">srct3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checksecretcode-part-1-of-2">CheckSecretCode (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-srct4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#srct4">srct4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-checksecretcode-part-2-of-2">CheckSecretCode (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stashoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#stashoffset">stashOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The offset into the secretCodeStash where we store a set of generated values for later checking in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact1">tact1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-2-of-8">ApplyTactics (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact10">tact10</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact11">tact11</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact12">tact12</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact13">tact13</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact14">tact14</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact15">tact15</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact16">tact16</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact17">tact17</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact18">tact18</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-6-of-8">ApplyTactics (Part 6 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact19">tact19</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-7-of-8">ApplyTactics (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact2">tact2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-2-of-8">ApplyTactics (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact20"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact20">tact20</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-7-of-8">ApplyTactics (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact21"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact21">tact21</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-7-of-8">ApplyTactics (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact22">tact22</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-7-of-8">ApplyTactics (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact23"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact23">tact23</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-7-of-8">ApplyTactics (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact24"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact24">tact24</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-7-of-8">ApplyTactics (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact25"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_b.html#tact25">tact25</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-8-of-8">ApplyTactics (Part 8 of 8)</a> (category: Gameplay)</div><div class="summary">Dither the updated object #X onto the screen, with bit 7 of drawLandscape determining whether the object is drawn on its own (bit 7 set) or with the surrounding landscape (bit 7 clear)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact26"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact26">tact26</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-8-of-8">ApplyTactics (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact27"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact27">tact27</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-8-of-8">ApplyTactics (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact3">tact3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-2-of-8">ApplyTactics (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact4">tact4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-2-of-8">ApplyTactics (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact5">tact5</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-2-of-8">ApplyTactics (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact6">tact6</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-3-of-8">ApplyTactics (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact7">tact7</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-4-of-8">ApplyTactics (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact8">tact8</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-4-of-8">ApplyTactics (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tact9">tact9</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-5-of-8">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-targetvisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#targetvisibility">targetVisibility</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Reports whether a target object is visible from an enemy in the CheckEnemyGaze routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-textviewerpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-textviewerpitch">textViewerPitch</a> (category: Title screen)</div><div class="summary">The pitch angle of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-textvieweryaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-textvieweryaw">textViewerYaw</a> (category: Title screen)</div><div class="summary">The yaw angle of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilealtitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tilealtitude">tileAltitude</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The altitude of the tile that we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledatapage"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tiledatapage">tileDataPage</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address of the tileData page containing the current tile's data</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-tilevisibility">tileVisibility</a> (category: Drawing the landscape)</div><div class="summary">A table for storing the visibility of each tile from the player's point of view, with one bit per tile (1 = visible, 0 = hidden)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilesataltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-tilesataltitude">tilesAtAltitude</a> (category: Landscape)</div><div class="summary">Storage for tile blocks at specific altitudes for placing enemies on the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-time1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#time1">time1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updateenemytimers">UpdateEnemyTimers</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-time2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#time2">time2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updateenemytimers">UpdateEnemyTimers</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-time3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#time3">time3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-updateenemytimers">UpdateEnemyTimers</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleobjecttodraw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#titleobjecttodraw">titleObjectToDraw</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The object we are drawing in the DrawTitleView routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-titleoffset">titleOffset</a> (category: Title screen)</div><div class="summary">An offset to apply to the large 3D text for the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tree1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tree1">tree1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawntrees">SpawnTrees</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tree2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tree2">tree2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawntrees">SpawnTrees</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tree3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tree3">tree3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-spawntrees">SpawnTrees</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-treecounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#treecounter">treeCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter for the number of trees that are added to the landscape in the SpawnTrees routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-treevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#treevisibility">treeVisibility</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Reports whether a gaze is interrupted by a tree in the CheckEnemyGaze routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tvew1">tvew1</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">DrawTitleView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tvew2">tvew2</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">DrawTitleView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tvew3">tvew3</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">DrawTitleView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_b.html#tvew4">tvew4</a> in subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">DrawTitleView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-uturnstatus"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#uturnstatus">uTurnStatus</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether we are performing or have just performed a U-turn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updatetimer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#updatetimer">updateTimer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter that ensures the enemy timers are updated on one of every three calls to the interrupt handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-vdushadowfront"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-vdushadowfront">vduShadowFront</a> (category: Text)</div><div class="summary">VDU commands for printing the front character of a drop shadow</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-vdushadowrear"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-vdushadowrear">vduShadowRear</a> (category: Text)</div><div class="summary">VDU commands for printing the rear character of a drop shadow</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#viewscreenaddr">viewScreenAddr</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The screen address of the player's scrolling landscape view, which is just below the icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewtype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-viewtype">viewType</a> (category: Title screen)</div><div class="summary">Storage for the type of title view we are drawing in DrawTitleView (title screen or landscape preview)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingobject">viewingObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xblock"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xblock">xBlock</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile x-coordinate of the tile we are analysing when calculating the highest tile in a block</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xcounter">xCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter to iterate along tiles in the x-axis</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-xobject">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xsights">xSights</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The pixel x-coordinate of the sights on-screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtextviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-xtextviewer">xTextViewer</a> (category: Title screen)</div><div class="summary">The x-coordinate of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtile">xTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner x-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilemaxaltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-xtilemaxaltitude">xTileMaxAltitude</a> (category: Landscape)</div><div class="summary">The tile x-coordinate of the highest tile within each 4x4 block of tiles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtilesentinel">xTileSentinel</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The tile x-coordinate of the Sentinel</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtitleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtitleoffset">xTitleOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">An x-coordinate offset for drawing the title screen this is zero during gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjecthi">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjectlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjectlo">yObjectLo</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ysights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ysights">ySights</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The pixel y-coordinate of the sights on-screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ytextviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-ytextviewer">yTextViewer</a> (category: Title screen)</div><div class="summary">The y-coordinate of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zblock"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zblock">zBlock</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile z-coordinate of the tile we are analysing when calculating the highest tile in a block</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zcounter">zCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter to iterate along tiles in the z-axis</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-zobject">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztextviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-ztextviewer">zTextViewer</a> (category: Title screen)</div><div class="summary">The z-coordinate of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ztile">zTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilemaxaltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-ztilemaxaltitude">zTileMaxAltitude</a> (category: Landscape)</div><div class="summary">The tile z-coordinate of the highest tile within each 4x4 block of tiles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ztilesentinel">zTileSentinel</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The tile z-coordinate of the Sentinel</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_a.html">The Sentinel A source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_c.html">The Sentinel C source</a></nav>
				</div>
			</article>

<?php
include_once("../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
