<?php
include_once("../../templates/template_functions.php");
page_header("all_source", "the_sentinel_f.html", "The Sentinel F source", "The Sentinel F source", "The The Sentinel F source file in The Sentinel", "the_sentinel-index", "source_all_source", "the_sentinel_f", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_e.html">The Sentinel E source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_g.html">The Sentinel G source</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div><div><div class="headerBlockWrapper"><div class="headerBlock"><a id="header-smoothtilecorners-part-1-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SmoothTileCorners (Part 1 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Smooth a row or column of tile corners (a "strip of tiles")</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/smoothtilecorners_part_1_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/smoothtiledata.html">SmoothTileData</a> calls <a href="#smoothtilecorners">SmoothTileCorners</a></span>
</div>
<hr class="light">
 This part copies the row or column of tile corners to a temporary workspace.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">Controls which tile corners we smooth in the tile data:</span>

                        <span class="argumentEntry">  * Bit 7 clear = smooth the row of tile corners at</span>
                        <span class="argumentEntry">                  z-coordinate zTile</span>

                        <span class="argumentEntry">  * Bit 7 set = smooth the column of tile corners at</span>
                        <span class="argumentEntry">                x-coordinate xTile</span>

</div></div>
<span class="label">.SmoothTileCorners</span><a id="smoothtilecorners" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">smoothingAction</a>    <span class="comment">\ We configured the smoothing action in bit 6 of</span>
 <span class="mne">STA</span> <a class="popup variable">processAction</a>      <span class="comment">\ smoothingAction in the SmoothTileData routine before</span>
                        <span class="comment">\ calling this routine, and bit 7 of A tells us whether</span>
                        <span class="comment">\ to smooth a row or a column of tile corners, so this</span>
                        <span class="comment">\ combines both configurations from bit 6 and bit 7 into</span>
                        <span class="comment">\ one byte that we store in processAction</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">34</span>                <span class="comment">\ We start by copying the tile data for the row/column</span>
                        <span class="comment">\ that we want to smooth into the stripData workspace,</span>
                        <span class="comment">\ so we can process it before copying it back into the</span>
                        <span class="comment">\ tileData table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In the following commentary I will refer to this</span>
                        <span class="comment">\ copied row or column of tile corners as a "strip of</span>
                        <span class="comment">\ tiles", as saying "row or column of tile corners"</span>
                        <span class="comment">\ every time is a bit of a mouthful</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We actually create a strip of tile data containing 35</span>
                        <span class="comment">\ tile corners, with offsets 0 to 31 being the tile data</span>
                        <span class="comment">\ for the strip we are smoothing and offsets 32 to 34</span>
                        <span class="comment">\ being repeats of the data for tile corners 0 to 2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we effectively duplicate the first three tile</span>
                        <span class="comment">\ corners onto the end of the strip so we can wrap the</span>
                        <span class="comment">\ smoothing calculations around past the end of the</span>
                        <span class="comment">\ strip</span>

<span class="label">.stri1</span><a id="stri1" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = X mod 32</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\</span>
                        <span class="comment">\ This ensures that for X = 32 to 34, we copy the tile</span>
                        <span class="comment">\ data for tiles 0 to 2 (as A = 0 to 2 for X = 32 to 34)</span>

 <span class="mne">BIT</span> <a class="popup variable">processAction</a>      <span class="comment">\ If bit 7 of processAction is clear then we are</span>
 <span class="mne">BPL</span> <a class="popup destination">stri2</a>              <span class="comment">\ smoothing a row of tiles at z-coordinate zTile, so</span>
                        <span class="comment">\ jump to stri2 to iterate across xTile</span>

 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ If we get here then we are smoothing a column of tiles</span>
                        <span class="comment">\ so set zTile to the counter in X so we iterate along</span>
                        <span class="comment">\ the z-coordinate (i.e. coming out of the screen)</span>

 <span class="mne">JMP</span> <a class="popup destination">stri3</a>              <span class="comment">\ Jump to stri3 to skip the following</span>

<span class="label">.stri2</span><a id="stri2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ If we get here then we are smoothing a row of tiles</span>
                        <span class="comment">\ so set xTile to the counter in X so we iterate along</span>
                        <span class="comment">\ the x-coordinate (i.e. from right to left)</span>

<span class="label">.stri3</span><a id="stri3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">STA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Store the tile data for (xTile, zTile) into the X-th</span>
                        <span class="comment">\ byte in our temporary workspace</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the tile counter in X</span>

 <span class="mne">BPL</span> <a class="popup destination">stri1</a>              <span class="comment">\ Loop back until we have copied tile data for all 32</span>
                        <span class="comment">\ tiles in the strip, plus three more tiles on the end</span>

 <span class="mne">BIT</span> <a class="popup variable">processAction</a>      <span class="comment">\ If bit 6 of processAction is clear then we need to</span>
 <span class="mne">BVC</span> <a class="popup destination">stri11</a>             <span class="comment">\ smooth the strip by averaging tile altitudes, so jump</span>
                        <span class="comment">\ to part 3 to implement this</span>

                        <span class="comment">\ Otherwise fall through into part 2 to smooth the strip</span>
                        <span class="comment">\ by moving outlier tiles</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-smoothtilecorners-part-2-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SmoothTileCorners (Part 2 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Smooth a strip by moving each outlier tile corner to the altitude</span>
             <span class="headerEntry">of its closest immediate neighbour (in terms of altitude)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/smoothtilecorners_part_2_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
<hr class="light">
 This part smoothes the strip by working along the strip and applying the
 following algorithm:

   * If this tile corner is higher than both its neighbours, move it down

   * If this tile corner is lower than both its neighbours, move it up

 In each case, we move the tile corner until it is level with the closest one
 to its original altitude. This has the effect of smoothing out single-point
 spikes or troughs in the strip.

</div></div>
                        <span class="comment">\ If we get here then bit 6 of processAction is set, so</span>
                        <span class="comment">\ we smooth the tile strip by moving each outlier tile</span>
                        <span class="comment">\ to the altitude of its closest immediate neighbour (in</span>
                        <span class="comment">\ terms of altitude)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This smoothes out single-point spikes or troughs</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ We now work our way along the strip, smoothing the</span>
                        <span class="comment">\ altitudes of tiles 1 to 32, so set a tile counter in X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that we smooth tiles 1 to 32 rather than tiles</span>
                        <span class="comment">\ 0 to 31 (tile 0 remains unchanged by the smoothing</span>
                        <span class="comment">\ process)</span>

<span class="label">.stri4</span><a id="stri4" class="anchor"></a>

                        <span class="comment">\ In the following, we are processing the tile at</span>
                        <span class="comment">\ position X + 1, i.e. stripData+1,X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We smooth a tile by looking at the altitudes of the</span>
                        <span class="comment">\ two tiles either side of that tile, i.e. stripData,X</span>
                        <span class="comment">\ and stripData+2,X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We are smoothing from high values of X to low values,</span>
                        <span class="comment">\ so by this point the tile at stripData+2,X has already</span>
                        <span class="comment">\ been smoothed</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Let's name the tiles as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * stripData+2,X = "previous tile" (as it has already</span>
                        <span class="comment">\                     been smoothed)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * stripData+1,X = "this tile" (as this is the tile</span>
                        <span class="comment">\                      we are smoothing)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * stripData,X   = "next tile" (as this is the tile</span>
                        <span class="comment">\                      we will be smoothing next)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The smoothing algorithm is implemented as follows,</span>
                        <span class="comment">\ where we are comparing the altitude of each tile (as</span>
                        <span class="comment">\ at this stage tileData only contains tile altitudes):</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If this = previous, do nothing</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If this &lt; previous and this >= next, do nothing</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If this &lt; previous and this &lt; next, set</span>
                        <span class="comment">\     this = min(previous, next)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If this > previous and this &lt;= next, do nothing</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If this > previous and this > next, set</span>
                        <span class="comment">\     this = max(previous, next)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Or to simplify:</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * If this tile is higher than both its neighbours,</span>
                        <span class="comment">\    move it down until it isn't</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * If this tile is lower than both its neighbours,</span>
                        <span class="comment">\    move it up until it isn't</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this algorithm smoothes the landscape by squeezing</span>
                        <span class="comment">\ the landscape into a flatter shape, moving outlier</span>
                        <span class="comment">\ tiles closer to the landscape's overall line</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>      <span class="comment">\ If this tile is at the same altitude as the previous</span>
 <span class="mne">CMP</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">2</span>,<span class="register">X</span>      <span class="comment">\ tile, jump to stri9 to move on to smoothing the next</span>
 <span class="mne">BEQ</span> <a class="popup destination">stri9</a>              <span class="comment">\ tile, as the transition from the previous tile to this</span>
                        <span class="comment">\ tile is already flat</span>

 <span class="mne">BCS</span> <a class="popup destination">stri5</a>              <span class="comment">\ If this tile is higher than the previous tile, jump to</span>
                        <span class="comment">\ stri5</span>

                        <span class="comment">\ If we get here then this tile is lower than the</span>
                        <span class="comment">\ previous tile</span>

 <span class="mne">CMP</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ If this tile is at the same altitude or higher than</span>
 <span class="mne">BEQ</span> <a class="popup destination">stri9</a>              <span class="comment">\ the next tile, jump to stri9 to move on to smoothing</span>
 <span class="mne">BCS</span> <a class="popup destination">stri9</a>              <span class="comment">\ the next tile</span>

                        <span class="comment">\ If we get here then this tile is lower than the</span>
                        <span class="comment">\ previous tile and lower than the next tile</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">2</span>,<span class="register">X</span>      <span class="comment">\ Set the flags from comparing the previous and next</span>
 <span class="mne">CMP</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ tiles (so in stri6, tile A is the previous tile and</span>
                        <span class="comment">\ tile B is the next tile)</span>

 <span class="mne">JMP</span> <a class="popup destination">stri6</a>              <span class="comment">\ Jump to stri6, so that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If previous &lt; next, set this = previous</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If previous >= next, set this = next</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, set:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   this = min(previous, next)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ before moving on to the next tile</span>

<span class="label">.stri5</span><a id="stri5" class="anchor"></a>

                        <span class="comment">\ If we get here then this tile is higher than the</span>
                        <span class="comment">\ previous tile</span>

 <span class="mne">CMP</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ If this tile is at the same altitude or lower than the</span>
 <span class="mne">BEQ</span> <a class="popup destination">stri9</a>              <span class="comment">\ next tile jump to stri9 to move on to smoothing the</span>
 <span class="mne">BCC</span> <a class="popup destination">stri9</a>              <span class="comment">\ next tile</span>

                        <span class="comment">\ If we get here then this tile is higher than the</span>
                        <span class="comment">\ previous tile and this tile is higher than the next</span>
                        <span class="comment">\ tile</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Set the flags from comparing the next and previous</span>
 <span class="mne">CMP</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">2</span>,<span class="register">X</span>      <span class="comment">\ tiles (so in stri6, tile A is the next tile and</span>
                        <span class="comment">\ tile B is the previous tile)</span>

                        <span class="comment">\ Fall through into stri6, so that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If next &lt; previous, set this = previous</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If next >= previous, set this = next</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, set:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   this = max(previous, next)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ before moving on to the next tile</span>
<span class="label">.stri6</span><a id="stri6" class="anchor"></a>

                        <span class="comment">\ We get here after comparing two tiles; let's call them</span>
                        <span class="comment">\ tile A and tile B</span>

 <span class="mne">BCC</span> <a class="popup destination">stri7</a>              <span class="comment">\ If tile A is lower than tile B, jump to stri7 to set</span>
                        <span class="comment">\ the altitude of this tile to the altitude of the</span>
                        <span class="comment">\ previous tile</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Set A to the altitude of the next tile and jump to</span>
 <span class="mne">JMP</span> <a class="popup destination">stri8</a>              <span class="comment">\ stri8 to set the altitude of this tile to the altitude</span>
                        <span class="comment">\ of the next tile</span>

<span class="label">.stri7</span><a id="stri7" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">2</span>,<span class="register">X</span>      <span class="comment">\ Set A to the altitude of the previous tile</span>

<span class="label">.stri8</span><a id="stri8" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>      <span class="comment">\ Set the altitude of this tile to the value in A</span>

<span class="label">.stri9</span><a id="stri9" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the strip tile counter in X</span>

 <span class="mne">BPL</span> <a class="popup destination">stri4</a>              <span class="comment">\ Loop back until we have worked our way through the</span>
                        <span class="comment">\ whole strip</span>

 <span class="mne">BIT</span> <a class="popup variable">doNotPlayLandscape</a> <span class="comment">\ If bit 7 of doNotPlayLandscape is set then we do not</span>
 <span class="mne">BMI</span> <a class="popup destination">stri10</a>             <span class="comment">\ want to play the landscape after generating it, so</span>
                        <span class="comment">\ jump to stri10 to skip the following, leaving the</span>
                        <span class="comment">\ stack unmodified</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the JSR GenerateLandscape instruction</span>
                        <span class="comment">\ that got us here will return normally, so the RTS at</span>
                        <span class="comment">\ the end of the GenerateLandscape routine will behave</span>
                        <span class="comment">\ as expected, like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If we called GenerateLandscape from the</span>
                        <span class="comment">\     MainTitleLoop routine, then we return there to</span>
                        <span class="comment">\     fall through into SecretCodeError, which displays</span>
                        <span class="comment">\     the "WRONG SECRET CODE" error message for when the</span>
                        <span class="comment">\     player enters an incorrect secret code</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If we called GenerateLandscape from the</span>
                        <span class="comment">\     FinishLandscape routine, then we return there to</span>
                        <span class="comment">\     display the landscape's secret entry code</span>
                        <span class="comment">\     on-screen, for when the player completes a level</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If bit 7 of doNotPlayLandscape is clear then we keep</span>
                        <span class="comment">\ going to modify the return address on the stack, so</span>
                        <span class="comment">\ that the RTS at the end of the GenerateLandscape takes</span>
                        <span class="comment">\ us to the PreviewLandscape routine</span>

                        <span class="comment">\ The above loop ended with X set to &FF, so &0100 + X</span>
                        <span class="comment">\ in the following points to the top of the stack at</span>
                        <span class="comment">\ &01FF</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">JumpToPreview</a><span class="bracket">)</span> <span class="comment">\ Set the return address on the bottom of the stack at</span>
 <span class="mne">STA</span> <span class="hex">&0100</span>,<span class="register">X</span>            <span class="comment">\ (&01FE &01FF) to JumpToPreview</span>
 <span class="mne">DEX</span>                    <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">JumpToPreview</a><span class="bracket">)</span> <span class="comment">\ Note that when an RTS instruction is executed, it pops</span>
 <span class="mne">STA</span> <span class="hex">&0100</span>,<span class="register">X</span>            <span class="comment">\ the address off the top of the stack and then jumps to</span>
                        <span class="comment">\ that address + 1, so putting the JumpToPreview address</span>
                        <span class="comment">\ on the stack means that the RTS at the end of the</span>
                        <span class="comment">\ GenerateLandscape routine will actually send us to</span>
                        <span class="comment">\ address JumpToPreview+1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is intentional and is intended to confuse any</span>
                        <span class="comment">\ crackers who might have reached this point, because</span>
                        <span class="comment">\ the JumpToPreview routine not only contains a JMP</span>
                        <span class="comment">\ instruction at JumpToPreview, but it also contains a</span>
                        <span class="comment">\ BMI instruction at JumpToPreview+1, if our crackers</span>
                        <span class="comment">\ forgot about this subtlety of the RTS instruction,</span>
                        <span class="comment">\ they might end up going down a rabbit hole</span>

<span class="label">.stri10</span><a id="stri10" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">stri16</a>             <span class="comment">\ Jump to stri16 to copy the tile data for the smoothed</span>
                        <span class="comment">\ strip back into the tileData table</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-smoothtilecorners-part-3-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SmoothTileCorners (Part 3 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Smooth a strip by setting the tile corner altitudes to the average</span>
             <span class="headerEntry">of the current tile corner altitude and three following corners</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/smoothtilecorners_part_3_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
<hr class="light">
 This part smoothes the strip by working along the strip and replacing the
 altitude of each tile corner with the average of that corner's altitude plus
 the next three corners, working along rows from left to right and columns
 from near to far.

</div></div>
<span class="label">.stri11</span><a id="stri11" class="anchor"></a>

                        <span class="comment">\ If we get here then bit 6 of processAction is clear,</span>
                        <span class="comment">\ so we smooth the tile strip by working our way along</span>
                        <span class="comment">\ the strip and setting each tile's altitude to the</span>
                        <span class="comment">\ average of its altitude with the three following tiles</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now work our way along the strip, smoothing the</span>
                        <span class="comment">\ altitudes of tiles 0 to 31, so set a tile counter in X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We work along rows from left to right and columns from</span>
                        <span class="comment">\ near to far</span>

<span class="label">.stri12</span><a id="stri12" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set U = 0 to use as the high byte of (U A), which we</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ will use to calculate the sum of the neighbouring tile</span>
                        <span class="comment">\ altitudes</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Set A to the altitude of the tile we are smoothing</span>
                        <span class="comment">\ (the one at index X)</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Add the altitude of the next tile along</span>
 <span class="mne">ADC</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>

 <span class="mne">BCC</span> <a class="popup destination">stri13</a>             <span class="comment">\ If the addition overflowed then increment the high</span>
 <span class="mne">CLC</span>                    <span class="comment">\ byte in U, so we have the correct result of the sum</span>
 <span class="mne">INC</span> <a class="popup variable">U</a>                  <span class="comment">\ in (U A)</span>

<span class="label">.stri13</span><a id="stri13" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">2</span>,<span class="register">X</span>      <span class="comment">\ Add the altitude of the next tile along</span>

 <span class="mne">BCC</span> <a class="popup destination">stri14</a>             <span class="comment">\ If the addition overflowed then increment the high</span>
 <span class="mne">CLC</span>                    <span class="comment">\ byte in U, so we have the correct result of the sum</span>
 <span class="mne">INC</span> <a class="popup variable">U</a>                  <span class="comment">\ in (U A)</span>

<span class="label">.stri14</span><a id="stri14" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">3</span>,<span class="register">X</span>      <span class="comment">\ Add the altitude of the next tile along</span>

 <span class="mne">BCC</span> <a class="popup destination">stri15</a>             <span class="comment">\ If the addition overflowed then increment the high</span>
 <span class="mne">CLC</span>                    <span class="comment">\ byte in U, so we have the correct result of the sum</span>
 <span class="mne">INC</span> <a class="popup variable">U</a>                  <span class="comment">\ in (U A)</span>

<span class="label">.stri15</span><a id="stri15" class="anchor"></a>

                        <span class="comment">\ So by this point (U A) contains the sum of the</span>
                        <span class="comment">\ altitudes of the tile we are smoothing, and the next</span>
                        <span class="comment">\ three tiles along the strip</span>

 <span class="mne">LSR</span> <a class="popup variable">U</a>                  <span class="comment">\ Set (U A) = (U A) / 4</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <a class="popup variable">U</a>                  <span class="comment">\ So (U A) contains the average of the four altitudes,</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ and we know that the high byte in U will be zero as</span>
                        <span class="comment">\ each of the four elements of the sum fits into one</span>
                        <span class="comment">\ byte</span>

 <span class="mne">STA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Set the altitude of the tile we are smoothing to the</span>
                        <span class="comment">\ average that we just calculated</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the tile counter to move along the strip</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Loop back until we have worked our way through the</span>
 <span class="mne">BCC</span> <a class="popup destination">stri12</a>             <span class="comment">\ strip and have smoothed tiles 0 to 31</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that when we exit the loop, X = 32</span>

                        <span class="comment">\ We now have a very short interlude to set up some of</span>
                        <span class="comment">\ the anti-cracker code before continuing the smoothing</span>
                        <span class="comment">\ process in part 4</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-setcrackerseed" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SetCrackerSeed</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set up anti-cracker tile-related data that can be checked in the</span>
             <span class="headerEntry">CheckCrackerSeed routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/setcrackerseed.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.SetCrackerSeed</span><a id="setcrackerseed" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a><span class="operator">+</span><span class="decimal">78</span><span class="operator">-</span><span class="decimal">32</span>,<span class="register">X</span>  <span class="comment">\ Copy the contents of stripData+78 into the operand of</span>
 <span class="mne">STA</span> <a class="popup variable">CrackerSeed</a><span class="operator">+</span><span class="decimal">1</span><span class="operator">-</span><span class="decimal">32</span>,<span class="register">X</span> <span class="comment">\ the unused LDA #0 instruction at CrackerSeed (this</span>
                        <span class="comment">\ location is presumably disguised as an instruction to</span>
                        <span class="comment">\ obfuscate this process)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At this point stripData+78 contains the third seed</span>
                        <span class="comment">\ number to be generated at the start of the</span>
                        <span class="comment">\ GenerateLandscape routine, where 81 seed numbers are</span>
                        <span class="comment">\ generated and stored at stripData</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This third seed contains the high byte of the BCD</span>
                        <span class="comment">\ landscape number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is because the seed generator is initialised</span>
                        <span class="comment">\ using the landscape number, and the third number out</span>
                        <span class="comment">\ of the shift register is unchanged and still contains</span>
                        <span class="comment">\ the initial value of that byte - see the</span>
                        <span class="comment">\ InitialiseSeeds routine for more details)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This value is altered in the AlterCrackerSeed routine</span>
                        <span class="comment">\ that runs as part of the gameplay routines, and is</span>
                        <span class="comment">\ checked in the CheckCrackerSeed routine that runs as</span>
                        <span class="comment">\ part of the SpawnCharacter3D routine when drawing the</span>
                        <span class="comment">\ landscape's secret code</span>

                        <span class="comment">\ Fall through into part 4 of SmoothTileCorners to</span>
                        <span class="comment">\ continue with the smoothing process</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-smoothtilecorners-part-4-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SmoothTileCorners (Part 4 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Copy the smoothed strip data back into the tileData table</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/smoothtilecorners_part_4_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
<hr class="light">
 This part copies the smoothed strip back into the tileData table.

</div></div>
<span class="label">.stri16</span><a id="stri16" class="anchor"></a>

                        <span class="comment">\ By this point we have smoothed the whole strip, so we</span>
                        <span class="comment">\ can now copy the smoothed tile data back into the</span>
                        <span class="comment">\ tileData table</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set A counter in X to work through the tile data for</span>
                        <span class="comment">\ the 32 tiles in the strip we just smoothed</span>

<span class="label">.stri17</span><a id="stri17" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the tile index</span>

 <span class="mne">BIT</span> <a class="popup variable">processAction</a>      <span class="comment">\ If bit 7 of processAction is clear then we are</span>
 <span class="mne">BPL</span> <a class="popup destination">stri18</a>             <span class="comment">\ smoothing a row of tiles at z-coordinate zTile, so</span>
                        <span class="comment">\ jump to stri18 to iterate across xTile</span>

 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ If we get here then we are smoothing a column of tiles</span>
                        <span class="comment">\ so set zTile to the counter in X so we iterate along</span>
                        <span class="comment">\ the z-coordinate (i.e. coming out of the screen)</span>

 <span class="mne">JMP</span> <a class="popup destination">stri19</a>             <span class="comment">\ Jump to stri19 to skip the following</span>

<span class="label">.stri18</span><a id="stri18" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ If we get here then we are smoothing a row of tiles</span>
                        <span class="comment">\ so set xTile to the counter in X so we iterate along</span>
                        <span class="comment">\ the x-coordinate (i.e. from right to left)</span>

<span class="label">.stri19</span><a id="stri19" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), which we ignore, but this also sets</span>
                        <span class="comment">\ the tile page in tileDataPage and the index in Y, so</span>
                        <span class="comment">\ tileDataPage+Y now points to the tile data entry in</span>
                        <span class="comment">\ the tileData table</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Copy the X-th byte of tile data from the smoothed</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ strip into the corresponding entry for (xTile, zTile)</span>
                        <span class="comment">\ in the tileData table</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the tile counter in X so we work our way</span>
                        <span class="comment">\ along to the next tile in the strip we are smoothing</span>

 <span class="mne">BPL</span> <a class="popup destination">stri17</a>             <span class="comment">\ Loop back to smooth the next tile until we have</span>
                        <span class="comment">\ smoothed the whole strip</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileshape" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileShape</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the shape of the tile anchored at (xTile, zTile)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileshape.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/generatelandscape.html">GenerateLandscape</a> calls <a href="#gettileshape">GetTileShape</a></span>
</div>
<hr class="light">
 Given a tile at altitude S, with neighbouring altitudes T, U and V:

      ^           [T]  [U]
      |
      |           [S]  [V]
   z-axis
    into
   screen      x-axis from left to right ---&gt;

 The shape is calculated as follows, where:

   * 0 and 1 represent arbitrary altitudes that are in that order, with 1 being
     higher than 0

   * a, b represent arbitrary altitudes where a &lt;&gt; b &lt;&gt; 1

 These are all the different types of shape (note there is no shape 8, and
 shapes 4 and 12 can have multiple layouts):

   Shape   S vs V      S vs T      S vs U      U vs V      U vs T      Layout
   -----   ------      ------      ------      ------      ------      ------

   0       S == V      S == T      S == U                              1 1
                                                                       1 1

   1       S == V      S &lt;&gt; T                  U &lt;  V      U == T      0 0
                                                                       1 1

   2       S &lt;&gt; V      S &lt;&gt; T      S &lt;= U      U == V      U == T      1 1
                                                                       0 1

   3       S == V      S == T      S &gt;  U                              1 0
                                                                       1 1

   4a      S &lt;&gt; V      S &lt;&gt; T                  U == V      U &lt;&gt; T      a 1
                                                                       b 1

   4b      S &lt;&gt; V      S == T                  U &lt;&gt; V      U &lt;&gt; T      1 a
                                                                       1 b

   5       S &lt;&gt; V      S == T                  U == V      U &lt;  T      1 0
                                                                       1 0

   6       S == V      S &lt;&gt; T                  U == V      U &lt;  T      1 0
                                                                       0 0

   7       S &lt;&gt; V      S == T                  U &gt;= V      U == T      1 1
                                                                       1 0

   9       S == V      S &lt;&gt; T                  U &gt;= V      U == T      1 1
                                                                       0 0

   10      S == V      S == T      S &lt;  U                              0 1
                                                                       0 0

   11      S &lt;&gt; V      S &lt;&gt; T      S &gt;  U      U == V      U == T      0 0
                                                                       1 0

   12a     S &lt;&gt; V      S &lt;&gt; T                  U &lt;&gt; V                  1 1
                                                                       a b

   12b     S == V      S &lt;&gt; T                  U &lt;&gt; V      U &lt;&gt; T      a b
                                                                       1 1

   13      S &lt;&gt; V      S == T                  U == V      U &gt;= T      0 1
                                                                       0 1

   14      S &lt;&gt; V      S == T                  U &lt;  V      U == T      0 0
                                                                       0 1

   15      S == V      S &lt;&gt; T                  U == V      U &gt;= T      0 1
                                                                       1 1

 Note that for shape 12a, the top-right corner could in theory be a different
 altitude to a, b and 1, and the comparisons would still fit. However, the way
 the landscape gets smoothed ensures that every tile has at least one
 horizontal edge, so this means the top-right corner must be at altitude 1.

 It is worth noting that:

   * Shape 0 has four horizontal edges

   * Shapes 4 and 12 have one horizontal edge and three sloping edges

   * Shape 8 is unused

   * All other shapes (1, 2, 3, 5, 6, 7, 9, 10, 11, 14 and 15) have two
     horizontal edges and two sloping edges

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The shape of the tile anchored at (xTile, zTile)</span>

</div></div>
<span class="label">.GetTileShape</span><a id="gettileshape" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Extract the tile altitude from the low nibble and</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\ store it in S</span>

 <span class="mne">INC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Move along the x-axis to fetch the next tile to the</span>
                        <span class="comment">\ right</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Extract the tile altitude from the low nibble and</span>
 <span class="mne">STA</span> <a class="popup variable">V</a>                  <span class="comment">\ store it in V</span>

 <span class="mne">INC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Move along the x-axis to fetch the next tile into the</span>
                        <span class="comment">\ screen</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Extract the tile altitude from the low nibble and</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ store it in U</span>

 <span class="mne">DEC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Move back along the x-axis to fetch the next tile to</span>
                        <span class="comment">\ the left</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Extract the tile altitude from the low nibble and</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ store it in T</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Move out of the screen, back along the z-axis to take</span>
                        <span class="comment">\ us back to the tile we are processing</span>

                        <span class="comment">\ So at this point we have the altitudes of four tile</span>
                        <span class="comment">\ corners, as follows, with the view from above:</span>
                        <span class="comment">\</span>
                        <span class="comment">\      ^           [T]  [U]</span>
                        <span class="comment">\      |</span>
                        <span class="comment">\      |           [S]  [V]</span>
                        <span class="comment">\   z-axis</span>
                        <span class="comment">\    into</span>
                        <span class="comment diff">\   screen      x-axis from left to right ---></span>
                        <span class="comment">\</span>
                        <span class="comment">\ S is the altitude of the tile corner that anchors the</span>
                        <span class="comment">\ tile for which we are calculating the shape, and T, U</span>
                        <span class="comment">\ and V are the altitudes of the tile's other three</span>
                        <span class="comment">\ corners, so now we can analyse the shape of the tile</span>

 <span class="mne">LDA</span> <a class="popup variable">S</a>                  <span class="comment">\ If S = V then jump to shap10</span>
 <span class="mne">CMP</span> <a class="popup variable">V</a>
 <span class="mne">BEQ</span> <a class="popup destination">shap10</a>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If S = T then jump to shap4</span>
 <span class="mne">BEQ</span> <a class="popup destination">shap4</a>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ If U = V then jump to shap2</span>
 <span class="mne">CMP</span> <a class="popup variable">V</a>
 <span class="mne">BEQ</span> <a class="popup destination">shap2</a>

<span class="label">.shap1</span><a id="shap1" class="anchor"></a>

                        <span class="comment">\ If we get here then we either fell through from above:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U &lt;> V</span>
                        <span class="comment">\</span>
                        <span class="comment">\ or we jumped here from shap10 and:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U &lt;> T</span>
                        <span class="comment">\   * U &lt;> V</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">12</span>                <span class="comment">\ Return a shape value of 12 in X</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap2</span><a id="shap2" class="anchor"></a>

                        <span class="comment">\ If we get here then then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U == V</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If U &lt;> T then jump to shap5</span>
 <span class="mne">BNE</span> <a class="popup destination">shap5</a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U == V</span>
                        <span class="comment">\   * U == T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set X = 2 to return as the shape if U >= S</span>

 <span class="mne">CMP</span> <a class="popup variable">S</a>                  <span class="comment">\ If U >= S then jump to shap3 to return a shape value</span>
 <span class="mne">BCS</span> <a class="popup destination">shap3</a>              <span class="comment">\ of 2</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">11</span>                <span class="comment">\ U &lt; S so return a shape value of 11 in X</span>

<span class="label">.shap3</span><a id="shap3" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap4</span><a id="shap4" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S == T</span>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ If U = V then jump to shap8</span>
 <span class="mne">CMP</span> <a class="popup variable">V</a>
 <span class="mne">BEQ</span> <a class="popup destination">shap8</a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S == T</span>
                        <span class="comment">\   * U &lt;> V</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If U = T then jump to shap6</span>
 <span class="mne">BEQ</span> <a class="popup destination">shap6</a>

<span class="label">.shap5</span><a id="shap5" class="anchor"></a>

                        <span class="comment">\ If we get here then either we jumped from shap2:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U == V</span>
                        <span class="comment">\   * U &lt;> T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ or we fell through from above:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S == T</span>
                        <span class="comment">\   * U &lt;> V</span>
                        <span class="comment">\   * U &lt;> T</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Return a shape value of 4 in X</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap6</span><a id="shap6" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S == T</span>
                        <span class="comment">\   * U &lt;> V</span>
                        <span class="comment">\   * U == T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">14</span>                <span class="comment">\ Set X = 14 to return as the shape if U &lt; V</span>

 <span class="mne">CMP</span> <a class="popup variable">V</a>                  <span class="comment">\ If U &lt; V then jump to shap7 to return a shape value</span>
 <span class="mne">BCC</span> <a class="popup destination">shap7</a>              <span class="comment">\ of 14</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ U >= V so return a shape value of 7 in X</span>

<span class="label">.shap7</span><a id="shap7" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap8</span><a id="shap8" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S &lt;> V</span>
                        <span class="comment">\   * S == T</span>
                        <span class="comment">\   * U == V</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\ Set X = 5 to return as the shape if U &lt; T</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If U &lt; T then jump to shap7 to return a shape value</span>
 <span class="mne">BCC</span> <a class="popup destination">shap9</a>              <span class="comment">\ of 5</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">13</span>                <span class="comment">\ U >= T so return a shape value of 13 in X</span>

<span class="label">.shap9</span><a id="shap9" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap10</span><a id="shap10" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to S</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If S = T then jump to shap14</span>
 <span class="mne">BEQ</span> <a class="popup destination">shap14</a>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ If U = T then jump to shap12</span>
 <span class="mne">CMP</span> <a class="popup variable">T</a>
 <span class="mne">BEQ</span> <a class="popup destination">shap12</a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U &lt;> T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">CMP</span> <a class="popup variable">V</a>                  <span class="comment">\ If U &lt;> V then jump to shap1</span>
 <span class="mne">BNE</span> <a class="popup destination">shap1</a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U &lt;> T</span>
                        <span class="comment">\   * U == V</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Set X = 6 to return as the shape if U &lt; T</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If U &lt; T then jump to shap11 to return a shape value</span>
 <span class="mne">BCC</span> <a class="popup destination">shap11</a>             <span class="comment">\ of 6</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">15</span>                <span class="comment">\ U >= T so return a shape value of 15 in X</span>

<span class="label">.shap11</span><a id="shap11" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap12</span><a id="shap12" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\   * S &lt;> T</span>
                        <span class="comment">\   * U == T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to U</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set X = 1 to return as the shape if U &lt; V</span>

 <span class="mne">CMP</span> <a class="popup variable">V</a>                  <span class="comment">\ If U &lt; V then jump to shap11 to return a shape value</span>
 <span class="mne">BCC</span> <a class="popup destination">shap13</a>             <span class="comment">\ of 1</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">9</span>                 <span class="comment">\ U >= V so return a shape value of 9 in X</span>

<span class="label">.shap13</span><a id="shap13" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap14</span><a id="shap14" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\   * S == T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A is set to S</span>

 <span class="mne">CMP</span> <a class="popup variable">U</a>                  <span class="comment">\ If S = U then jump to shap16</span>
 <span class="mne">BEQ</span> <a class="popup destination">shap16</a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ Set X = 10 to return as the shape if S &lt; U</span>

 <span class="mne">BCC</span> <a class="popup destination">shap15</a>             <span class="comment">\ If S &lt; U then jump to shap15 to return a shape value</span>
                        <span class="comment">\ of 10</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ S > U so return a shape value of 93 in X</span>

<span class="label">.shap15</span><a id="shap15" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.shap16</span><a id="shap16" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * S == V</span>
                        <span class="comment">\   * S == T</span>
                        <span class="comment">\   * S == U</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Return a shape value of 0 in X</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-trianglepointadd" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">trianglePointAdd</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The value to add to the second point number to get the third point</span>
             <span class="headerEntry">number when drawing a tile face as two triangles</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/trianglepointadd.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getpolygonlines_part_1_of_6.html">GetPolygonLines (Part 1 of 6)</a> uses <a href="#trianglepointadd">trianglePointAdd</a></span>
</div>
</div></div>
<span class="label">.trianglePointAdd</span><a id="trianglepointadd" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Add when triangleStartPoint = 0 and we are drawing the</span>
                        <span class="comment">\ first of the two triangles</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">+</span> <span class="decimal">1</span>            <span class="comment">\ Add when triangleStartPoint = 1 and we are drawing the</span>
                        <span class="comment">\ first of the two triangles</span>

 <span class="mne">EQUB</span> <span class="decimal">-1</span>                <span class="comment">\ Add when triangleStartPoint = 0 and we are drawing the</span>
                        <span class="comment">\ second of the two triangles</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">-</span> <span class="decimal">1</span>            <span class="comment">\ Add when triangleStartPoint = 1 and we are drawing the</span>
                        <span class="comment">\ second of the two triangles</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tileshapecolour" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">tileShapeColour</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Tile colours by shape and the orientation of the viewer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/tileshapecolour.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a> uses <a href="#tileshapecolour">tileShapeColour</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtwofacetile.html">DrawTwoFaceTile</a> uses <a href="#tileshapecolour">tileShapeColour</a></span>
</div>
<hr class="light">
 The colours shown in the comments below are for landscape 0000, which has the
 following palette:

   * Colour 0 = blue

   * Colour 1 = black

   * Colour 2 = white

   * Colour 3 = green

 Colours 2 and 3 can be altered depending on the context (for gameplay, the
 palette changes depending on the number of enemies, for example). The range of
 colours is as follows:

   * Colour 2 can be white, yellow, cyan or red

   * Colour 3 can be green, red, yellow or cyan

 Note that all the tiles have an edge colour of 0 (blue) apart from the first
 one, which has an edge colour of colour 3 (green, red, yellow or cyan) to
 match the fill colour.

</div></div>
<span class="label">.tileShapeColour</span><a id="tileshapecolour" class="anchor"></a>

                        <span class="comment">\ Colours for the first face in a two-face tile, or the</span>
                        <span class="comment">\ only face in a one-face tile</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">3</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  0: fill colour 3 (green), edge colour 3 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  1: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  2: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  3: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  4: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  5: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  6: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  7: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  8 = unused</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  9: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 10: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 11: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 12: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 13: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 14: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 15: fill colour 1 (black), edge colour 0 (blue)</span>

                        <span class="comment">\ Colours for the second face in a two-face tile</span>

 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  0: fill colour 3 (green), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  1: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  2: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  3: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  4: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  5: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  6: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  7: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  8 = unused</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape  9: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 10: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 11: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 12: fill colour 1 (black), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 13: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 14: fill colour 2 (white), edge colour 0 (blue)</span>
 <span class="mne">EQUB</span> <span class="decimal">2</span> << <span class="decimal">2</span> <span class="operator">+</span> <span class="decimal">0</span> << <span class="decimal">4</span>   <span class="comment">\ Shape 15: fill colour 1 (black), edge colour 0 (blue)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-trianglestart" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">triangleStart</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The number of the first point in each two-face shape that is drawn</span>
             <span class="headerEntry">as a pair of triangles</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/trianglestart.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawslopingtile.html">DrawSlopingTile</a> uses <a href="#trianglestart">triangleStart</a></span>
</div>
</div></div>
<span class="label">.triangleStart</span><a id="trianglestart" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  0 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  1 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  2 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  3 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  4 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  5 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Shape  6 starts with point 1</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Shape  7 starts with point 1</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  8 is unused</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape  9 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape 10 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape 11 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape 12 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Shape 13 starts with point 0</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Shape 14 starts with point 1</span>
 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Shape 15 starts with point 1</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getpolygonlines-part-1-of-6" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 1 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the points in a two-face tile polygon when it consists</span>
             <span class="headerEntry">of a pair of triangles</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getpolygonlines_part_1_of_6.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.gpol1</span><a id="gpol1" class="anchor"></a>

                        <span class="comment">\ If we get here then we are drawing a two-face tile as</span>
                        <span class="comment">\ a pair of triangles and A contains the offset of the</span>
                        <span class="comment">\ rear left tile corner in the drawing tables</span>

                        <span class="comment">\ For a triangle, we number the points like this: ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\   1. Rear left</span>
                        <span class="comment">\                        3. Point 2 + trianglePointAdd,Y</span>
                        <span class="comment">\   2. Front left</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also set point 4 to be the same as point 1, so that</span>
                        <span class="comment">\ the third edge from point 3 to point 4 is effectively</span>
                        <span class="comment">\ from point 3 to point 1</span>

 <span class="mne">LDY</span> <a class="popup variable">triangleStartPoint</a> <span class="comment">\ Set Y to the number of the starting point for this</span>
                        <span class="comment">\ tile shape ???</span>

 <span class="mne">BVC</span> <a class="popup destination">gpol2</a>              <span class="comment">\ If bit 6 of polygonType is clear then we are drawing</span>
                        <span class="comment">\ the first triangle in a two-face tile, so jump to</span>
                        <span class="comment">\ gpol2 to do this</span>

                        <span class="comment">\ If we get here then bit 6 and 7 of polygonType are</span>
                        <span class="comment">\ both set, so we are drawing the second triangle in a</span>
                        <span class="comment">\ two-face file</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = (A + 32 + 1) mod 64</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">33</span>                <span class="comment">\</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ So this moves diagonally from top-left to bottom-right</span>
                        <span class="comment">\ or bottom-left to top-right:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset x          offset x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset 32 + x     offset 32 + x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ???</span>

 <span class="mne">INY</span>                    <span class="comment">\ Set Y = Y + 2</span>
 <span class="mne">INY</span>                    <span class="comment">\</span>
                        <span class="comment">\ to give 2 or 3 ???</span>

<span class="label">.gpol2</span><a id="gpol2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a>       <span class="comment">\ Set the first triangle point to A</span>

 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">3</span>     <span class="comment">\ Set the fourth triangle point to A, so the third edge</span>
                        <span class="comment">\ in the triangle joins with the start of the first</span>
                        <span class="comment">\ edge</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set the second triangle point to the equivalent to A</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">1</span>     <span class="comment">\ but in the other drawing table offset</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the third triangle point to A + the Y-th entry</span>
 <span class="mne">ADC</span> <a class="popup variable">trianglePointAdd</a>,<span class="register">Y</span> <span class="comment">\ from trianglePointAdd, mod 64 ???</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">63</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">2</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set X = 3 to set as the value of polygonEdgeCount as</span>
                        <span class="comment">\ there are three edges in a triangle polygon</span>

 <span class="mne">BNE</span> <a class="popup destination">gpol3</a>              <span class="comment">\ Jump to gpol3 in part 1 to set polygonEdgeCount = 3</span>
                        <span class="comment">\ and move on to part 4</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getpolygonlines-part-2-of-6" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 2 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The main entry point for the routine to calculate the horizontal</span>
             <span class="headerEntry">lines in filled polygon and prepare them for drawing on-screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getpolygonlines_part_2_of_6.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygon.html">DrawPolygon</a> calls <a href="#getpolygonlines">GetPolygonLines</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">polygonType</span>          <span class="argumentEntry">The polygon type</span>

   <span class="argumentLabel">triangleStartPoint</span>   <span class="argumentEntry">When drawing a two-face tile as a pair of triangles,</span>
                        <span class="argumentEntry">this is the number of the starting point to use (0 or 1)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag:</span>

                        <span class="argumentEntry">  * Clear if the polygon is visible in the current</span>
                        <span class="argumentEntry">    screen buffer and should be drawn</span>

                        <span class="argumentEntry">  * Set if the polygon is not visible in the current</span>
                        <span class="argumentEntry">    screen buffer and should not be drawn</span>

   <span class="argumentLabel">yPolygonTop</span>          <span class="argumentEntry">The y-coordinate of the top of the polygon (where higher</span>
                        <span class="argumentEntry">y-coordinates are up the screen)</span>

   <span class="argumentLabel">yPolygonBottom</span>       <span class="argumentEntry">The y-coordinate of the bottom of the polygon (where</span>
                        <span class="argumentEntry">higher y-coordinates are up the screen)</span>

   <span class="argumentLabel">xPolygonLeft</span>         <span class="argumentEntry">The pixel x-coordinates of the left edges of each pixel</span>
                        <span class="argumentEntry">line in the polygon</span>

   <span class="argumentLabel">xPolygonRight</span>        <span class="argumentEntry">The pixel x-coordinates of the right edges of each pixel</span>
                        <span class="argumentEntry">line in the polygon</span>

</div></div>
<span class="label">.GetPolygonLines</span><a id="getpolygonlines" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Set A to the drawing table offset plus the column</span>
 <span class="mne">ORA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ number of the tile we are currently drawing, so if we</span>
                        <span class="comment">\ are drawing a tile, this is the offset of the first</span>
                        <span class="comment">\ point of the tile in the drawing tables</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A is the position in the drawViewYaw(Hi Lo) and</span>
                        <span class="comment">\ drawViewPitch(Hi Lo) tables of the tile corners</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The four points are laid out with the front edge in</span>
                        <span class="comment">\ one drawing table offset (0 or 32) and the back edge</span>
                        <span class="comment">\ in the other drawing table offset (32 or 0), and the</span>
                        <span class="comment">\ left-right points are together in the same offset</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, the four tile corners will be offset in</span>
                        <span class="comment">\ the drawing tables in one of two layouts</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the layout when drawingTableOffset = 0:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset x          offset x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset 32 + x     offset 32 + x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ where x is xTileToDraw and the top row is the back row</span>
                        <span class="comment">\ away from the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ And this is the layout when drawingTableOffset = 32:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset 32 + x     offset 32 + x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset x          offset x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the offset in A will point to the drawing data for</span>
                        <span class="comment">\ the top-left point above, i.e. the rear left tile</span>
                        <span class="comment">\ corner from the perspective of the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Also, consider the above layouts and how we can move</span>
                        <span class="comment">\ between the corners:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We can move from left to right by adding 1 to the</span>
                        <span class="comment">\     offset, and from right to left by subtracting 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We can move between the top and bottom rows by</span>
                        <span class="comment">\     using EOR #32 on the offset, as this will flip</span>
                        <span class="comment">\     between x and x + 32</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use these calculations to work out which points in</span>
                        <span class="comment">\ the drawing table we should map to points 1 to 5 in</span>
                        <span class="comment">\ polygonPoint for use in the polygon-drawing process</span>

 <span class="mne">BIT</span> <a class="popup variable">polygonType</a>        <span class="comment">\ If bit 7 of polygonType is set then we are drawing a</span>
 <span class="mne">BMI</span> <a class="popup destination">gpol1</a>              <span class="comment">\ two-face tile as a pair of triangles, so jump to gpol1</span>
                        <span class="comment">\ to do this</span>

 <span class="mne">BVS</span> <a class="popup destination">gpol7</a>              <span class="comment">\ If bit 7 of polygonType is clear and bit 6 is set then</span>
                        <span class="comment">\ we are drawing an object, so jump to part 4 as the</span>
                        <span class="comment">\ point numbers in polygonPoint are already set up</span>
                        <span class="comment">\ correctly for the polygon</span>

                        <span class="comment">\ If we get here then both bits 6 and 7 of polygonType</span>
                        <span class="comment">\ are clear, so we are drawing a tile as a four-sided</span>
                        <span class="comment">\ shape (quadrilateral) and A contains the offset of the</span>
                        <span class="comment">\ rear left tile corner in the drawing tables</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For a quadrilateral, we number the points like</span>
                        <span class="comment">\ this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   1. Rear left       4. Rear right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   2. Front left      3. Front right</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also set point 5 to be the same as point 1, so that</span>
                        <span class="comment">\ the fourth edge from point 4 to point 5 is effectively</span>
                        <span class="comment">\ from point 4 to point 1</span>

 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a>       <span class="comment">\ Set the first quadrilateral point to the rear-left</span>
                        <span class="comment">\ tile corner</span>

 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">4</span>     <span class="comment">\ Set the fifth quadrilateral point to A, so the fourth</span>
                        <span class="comment">\ edge in the quadrilateral joins with the start of the</span>
                        <span class="comment">\ first edge</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set the second quadrilateral point to the front-left</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">1</span>     <span class="comment">\ tile corner</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the third quadrilateral point to the front-right</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ tile corner</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">2</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set the fourth quadrilateral point to the rear-right</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">3</span>     <span class="comment">\ tile corner</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set X = 4 to set as the value of polygonEdgeCount as</span>
                        <span class="comment">\ there are four edges in a quadrilateral</span>

<span class="label">.gpol3</span><a id="gpol3" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ Set polygonEdgeCount to the value in X</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol7</a>              <span class="comment">\ Jump to part 4 to continue analysing the polygon</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getpolygonlines-part-3-of-6" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 3 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Convert all the polygon point yaw angles into pixel x-coordinates</span>
             <span class="headerEntry">(for larger yaw angles that convert into a 16-bit x-coordinate)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getpolygonlines_part_3_of_6.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.gpol4</span><a id="gpol4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set bit 6 of xPolygonPointScale to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonPointScale</a> <span class="comment">\ pixel x-coordinate of this polygon point needs to be</span>
                        <span class="comment">\ stored as a two-byte number</span>

 <span class="mne">LDY</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ We now loop through all the points in the polygon, so</span>
                        <span class="comment">\ set Y to count through the number of edges in the</span>
                        <span class="comment">\ polygon that we are drawing (as that's also the number</span>
                        <span class="comment">\ of unique points in the polygon)</span>

<span class="label">.gpol5</span><a id="gpol5" class="anchor"></a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">drawViewAngles</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ Set X to the offset within the drawing tables of the</span>
 <span class="mne">TAX</span>                    <span class="comment">\ Y-th point in the polygon</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawLo</a>,<span class="register">X</span>    <span class="comment">\ Set the following:</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">bufferOriginLo</a>     <span class="comment">\   (A T) = drawViewYaw(Hi Lo) + bufferOrigin(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">X</span>    <span class="comment">\ for the Y-th polygon point, so this adds the yaw angle</span>
 <span class="mne">ADC</span> <a class="popup variable">bufferOriginHi</a>     <span class="comment">\ offset in bufferOrigin(Hi Lo) to the polygon point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The yaw angles in drawViewYaw(Hi Lo) are relative to</span>
                        <span class="comment">\ the origin in the centre of the screen (i.e. the</span>
                        <span class="comment">\ direction of the viewer's gaze), so this converts the</span>
                        <span class="comment">\ yaw angle from having the origin in the centre to</span>
                        <span class="comment">\ having the origin on the left edge of the buffer</span>

 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ Set (A T) = (A T) * 8</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ROL</span> <a class="popup variable">T</a>                  <span class="comment">\ So (A T) contains the yaw angle in pixels, which is</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ the same as a pixel x-coordinate, with the integer</span>
 <span class="mne">ROL</span> <a class="popup variable">T</a>                  <span class="comment">\ part in A and the fractional part in T</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\</span>
                        <span class="comment">\ Also, the top three bits of the original A are in the</span>
                        <span class="comment">\ bottom two bits of T and the C flag, as all but the</span>
                        <span class="comment">\ first instruction are rotations rather than shifts</span>

 <span class="mne">STA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Store the pixel x-coordinate for the Y-th point of the</span>
                        <span class="comment">\ polygon in the xPolygonPointLo table, storing the</span>
                        <span class="comment">\ result at the offset given in the drawViewAngles table</span>
                        <span class="comment">\ (i.e. in the correct place for the polygon point</span>
                        <span class="comment">\ number in Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This stores the low byte of the two-byte value in</span>
                        <span class="comment">\ (A T) * 8, so now we calculate and store the high byte</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Rotate the C flag into bit 0 of T and put the result</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ in A, so top three bits of the original A are now in</span>
                        <span class="comment">\ the bottom three bits of A</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000111</span>         <span class="comment">\ Clear all the other bits in A, so A just contains the</span>
                        <span class="comment">\ top three bits of the original A</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, A now contains the overflow from the</span>
                        <span class="comment">\ left-shifted (A T), which spilled out into a third top</span>
                        <span class="comment">\ byte when the multiplication was applied</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00000100</span>         <span class="comment">\ If bit 2 of A is set then bit 7 of the original A must</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol6</a>              <span class="comment">\ have been set so the original yaw angle must have been</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%11111000</span>         <span class="comment">\ negative, so set bits 3 to 7 of the top byte</span>

<span class="label">.gpol6</span><a id="gpol6" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ Store the pixel x-coordinate for the Y-th point of the</span>
                        <span class="comment">\ polygon in the xPolygonPointHi table, storing the</span>
                        <span class="comment">\ result at the offset given in the drawViewAngles table</span>
                        <span class="comment">\ (i.e. in the correct place for the polygon point</span>
                        <span class="comment">\ number in Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This stores the high byte of the two-byte value in</span>
                        <span class="comment">\ (A T) * 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this calculation is for polygon points that have a</span>
                        <span class="comment">\ pixel x-coordinate greater than 255 (as recorded by</span>
                        <span class="comment">\ the set bit 6 in xPolygonPointScale)</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the point counter in Y</span>

 <span class="mne">BPL</span> <a class="popup destination">gpol5</a>              <span class="comment">\ Loop back until we have converted all the polygon</span>
                        <span class="comment">\ point yaw angles into pixel x-coordinates</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol9</a>              <span class="comment">\ Jump to part 5 to continue analysing the polygon</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getpolygonlines-part-4-of-6" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 4 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Convert all the polygon point yaw angles into pixel x-coordinates</span>
             <span class="headerEntry">(for smaller yaw angles that convert into an 8-bit x-coordinate)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getpolygonlines_part_4_of_6.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.gpol7</span><a id="gpol7" class="anchor"></a>

                        <span class="comment">\ By this point the point numbers in the polygon have</span>
                        <span class="comment">\ been set up as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * polygonPoint to polygonPoint+3 (when drawing a</span>
                        <span class="comment">\     triangle)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * polygonPoint to polygonPoint+4 (when drawing a</span>
                        <span class="comment">\     quadrilateral)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Each point number is given as an offset within the</span>
                        <span class="comment">\ drawing tables</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now calculate the pixel x-coordinates for each of</span>
                        <span class="comment">\ these points, storing the results in xPolygonPointLo</span>
                        <span class="comment">\ or xPolygonPoint(Hi Lo), depending on whether the</span>
                        <span class="comment">\ pixel x-coordinates fit into one byte (when they are</span>
                        <span class="comment">\ all in the range 0 to 255) or two bytes (when at least</span>
                        <span class="comment">\ one x-coordinate is 256 or more)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Clear bit 6 of xPolygonPointScale to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonPointScale</a> <span class="comment">\ pixel x-coordinate of this polygon point fits into one</span>
                        <span class="comment">\ byte (we will change this if the x-coordinate ends up</span>
                        <span class="comment">\ being too large to fit into the range 0 to 255)</span>

 <span class="mne">LDY</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ We now loop through all the points in the polygon, so</span>
                        <span class="comment">\ set Y to count through the number of edges in the</span>
                        <span class="comment">\ polygon that we are drawing (as that's also the number</span>
                        <span class="comment">\ of unique points in the polygon)</span>

<span class="label">.gpol8</span><a id="gpol8" class="anchor"></a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">drawViewAngles</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ Set X to the offset within the drawing tables of the</span>
 <span class="mne">TAX</span>                    <span class="comment">\ Y-th point in the polygon</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawLo</a>,<span class="register">X</span>    <span class="comment">\ Set the following:</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">bufferOriginLo</a>     <span class="comment">\   (A T) = drawViewYaw(Hi Lo) + bufferOrigin(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">X</span>    <span class="comment">\ for the Y-th polygon point, so this adds the yaw angle</span>
 <span class="mne">ADC</span> <a class="popup variable">bufferOriginHi</a>     <span class="comment">\ offset in bufferOrigin(Hi Lo) to the polygon point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The yaw angles in drawViewYaw(Hi Lo) are relative to</span>
                        <span class="comment">\ the origin in the centre of the screen (i.e. the</span>
                        <span class="comment">\ direction of the viewer's gaze), so this converts the</span>
                        <span class="comment">\ yaw angle from having the origin in the centre to</span>
                        <span class="comment">\ having the origin on the left edge of the buffer</span>

                        <span class="comment">\ We now convert the point's yaw angle in (A T) into a</span>
                        <span class="comment">\ pixel x-coordinate by multiplying the yaw angle by 8,</span>
                        <span class="comment">\ as there are 20 yaw angles in a screen width, the</span>
                        <span class="comment">\ screen is 160 pixels across, and 20 * 8 = 160</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00100000</span>         <span class="comment">\ If the high byte in A is %00100000 or more then</span>
 <span class="mne">BCS</span> <a class="popup destination">gpol4</a>              <span class="comment">\ multiplying by 8 will overflow (as three left shifts</span>
                        <span class="comment">\ will spill out of the end of the high byte), so jump</span>
                        <span class="comment">\ up to part 3 to redo the x-coordinate calculations for</span>
                        <span class="comment">\ all the polygon points, but this time storing the</span>
                        <span class="comment">\ results in 16-bit numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ After the calculations in part 3 are done, we will</span>
                        <span class="comment">\ then jump straight on to part 5</span>

                        <span class="comment">\ If we get here then the high byte in A is less than</span>
                        <span class="comment">\ %00100000, so we can multiply by 8 without risk of</span>
                        <span class="comment">\ overflow</span>

 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ Set (A T) = (A T) * 8</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ So (A T) contains the yaw angle in pixels, which is</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ the same as a pixel x-coordinate, with the integer</span>
 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ part in A and the fractional part in T</span>
 <span class="mne">ROL</span> <span class="register">A</span>

 <span class="mne">STA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Store the pixel x-coordinate for the Y-th point of the</span>
                        <span class="comment">\ polygon in the xPolygonPointLo table, storing the</span>
                        <span class="comment">\ result at the offset given in the drawViewAngles table</span>
                        <span class="comment">\ (i.e. in the correct place for the polygon point</span>
                        <span class="comment">\ number in Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this calculation is for polygon points that have a</span>
                        <span class="comment">\ pixel x-coordinate in the range 0 to 255 (as recorded</span>
                        <span class="comment">\ by the clear bit 6 in xPolygonPointScale)</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the point counter in Y</span>

 <span class="mne">BPL</span> <a class="popup destination">gpol8</a>              <span class="comment">\ Loop back until we have converted all the polygon</span>
                        <span class="comment">\ point yaw angles into pixel x-coordinates</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getpolygonlines-part-5-of-6" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 5 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Loop through all the edges in the polygon and call the correct</span>
             <span class="headerEntry">routines to process one-byte, two-byte or horizontal edges</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.gpol9</span><a id="gpol9" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set yPolygonTop = 0 to record the y-coordinate of the</span>
 <span class="mne">STA</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ top of the polygon, where higher y-coordinates are up</span>
                        <span class="comment">\ the screen (so this sets the top of the polygon to the</span>
                        <span class="comment">\ bottom of the screen, so we can bump it up as we work</span>
                        <span class="comment">\ through the polygon)</span>

 <span class="mne">STA</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ Set xMaxHorizontal = 0 so we can use it to keep track</span>
                        <span class="comment">\ of the maximum x-coordinates of any polygon edges that</span>
                        <span class="comment">\ are horizontal</span>

 <span class="mne">STA</span> <a class="popup variable">horizontalEdges</a>    <span class="comment">\ Set horizontalEdges = 0 so we can use it to keep track</span>
                        <span class="comment">\ of how many polygon edges are horizontal</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ Set yPolygonBottom = 255 to record the y-coordinate of</span>
 <span class="mne">STA</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ the bottom of the polygon, where higher y-coordinates</span>
                        <span class="comment">\ are up the screen (so this sets the bottom of the</span>
                        <span class="comment">\ polygon to the top of the screen, so we can move it</span>
                        <span class="comment">\ down as we work through the polygon)</span>

 <span class="mne">STA</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ Set xMinHorizontal = 255 so we can use it to keep</span>
                        <span class="comment">\ track of the minimum x-coordinates of any polygon</span>
                        <span class="comment">\ edges that are horizontal</span>

 <span class="mne">STA</span> <a class="popup variable">drawPolygon</a>        <span class="comment">\ Set drawPolygon to a non-zero value, so by default the</span>
                        <span class="comment">\ polygon will not be drawn, though we will set this to</span>
                        <span class="comment">\ zero later if the polygon should be drawn</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now loop through all the edges of the polygon, so</span>
                        <span class="comment">\ set a loop counter in Y to work through all the edges</span>
                        <span class="comment">\ of the polygon (three for a triangle, four for a</span>
                        <span class="comment">\ quadrilateral)</span>

<span class="label">.gpol10</span><a id="gpol10" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">polygonEdge</a>        <span class="comment">\ Store the polygon edge number that we are about to</span>
                        <span class="comment">\ process in polygonEdge, so we can retrieve it at the</span>
                        <span class="comment">\ end of the loop</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">drawViewAngles</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ Set X to the offset within the drawing tables of the</span>
 <span class="mne">TAX</span>                    <span class="comment">\ Y-th point in the polygon</span>

 <span class="mne">INY</span>                    <span class="comment">\ Set Y to the offset within the drawing tables of the</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">drawViewAngles</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ Y+1-st point in the polygon</span>
 <span class="mne">TAY</span>

                        <span class="comment">\ So Y and X are the offsets within the drawing tables</span>
                        <span class="comment">\ of the start and end points for the polygon edge that</span>
                        <span class="comment">\ we are processing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">xPolygonLeft</a><span class="bracket">)</span>  <span class="comment">\ Set xPolygonAddrHi to the high byte of the address of</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ the xPolygonLeft table, so this value can be used to</span>
                        <span class="comment">\ modify the instructions for storing the polygon line</span>
                        <span class="comment">\ x-coordinates as we process them</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The default is therefore to store the x-coordinate of</span>
                        <span class="comment">\ the left end of the polygon line at xPolygonLeft</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>  <span class="comment">\ Set (A yEdgeDeltaLo) to the following:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\       drawViewPitch(Hi Lo) for point #Y</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\                 - drawViewPitch(Hi Lo) for point #X</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ So (A yEdgeDeltaLo) contains the difference in pitch</span>
                        <span class="comment">\ angle between the two points, or the delta along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">BPL</span> <a class="popup destination">gpol11</a>             <span class="comment">\ If the result in (A yEdgeDeltaLo) is positive then</span>
                        <span class="comment">\ point #Y is higher than point #X and (A yEdgeDeltaLo)</span>
                        <span class="comment">\ already has the correct sign for the absolute value,</span>
                        <span class="comment">\ so jump to gpol11 to skip the following</span>

                        <span class="comment">\ If we get here then point #X is higher than point #Y,</span>
                        <span class="comment">\ so we swap them around</span>

 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set yEdgeDelta(Hi Lo) = (A yEdgeDeltaLo)</span>

 <span class="mne">INC</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ Increment xPolygonAddrHi to HI(xPolygonRight), so when</span>
                        <span class="comment">\ we modify the instructions for storing the polygon</span>
                        <span class="comment">\ line x-coordinates, they are stored in the table for</span>
                        <span class="comment">\ the right end of the polygon line at xPolygonRight ???</span>

 <span class="mne">STX</span> <a class="popup variable">T</a>                  <span class="comment">\ Swap X and Y around, so point #Y is now higher than</span>
 <span class="mne">STY</span> <a class="popup variable">U</a>                  <span class="comment">\ point #X</span>
 <span class="mne">LDX</span> <a class="popup variable">U</a>
 <span class="mne">LDY</span> <a class="popup variable">T</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set (A yEdgeDeltaLo) = -yEdgeDelta(Hi Lo)</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ So yEdgeDelta(Hi Lo) is now positive</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaLo</a>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaHi</a>

<span class="label">.gpol11</span><a id="gpol11" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set yEdgeDelta(Hi Lo) = (A yEdgeDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So point #Y is higher than point #X, and we have a</span>
                        <span class="comment">\ positive value in yEdgeDelta(Hi Lo) that contains the</span>
                        <span class="comment">\ y-axis delta between the two points</span>
                        <span class="comment">\</span>
                        <span class="comment">\ xPolygonAddrHi will also point to the correct table</span>
                        <span class="comment">\ for storing the polygon line (left or right) ???</span>

 <span class="mne">BIT</span> <a class="popup variable">xPolygonPointScale</a> <span class="comment">\ If bit 6 of xPolygonPointScale is clear then the pixel</span>
 <span class="mne">BVC</span> <a class="popup destination">gpol13</a>             <span class="comment">\ x-coordinates of all the polygon points fit into</span>
                        <span class="comment">\ single-byte numbers, so jump to gpol13 to process the</span>
                        <span class="comment">\ edge accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">Y</span>  <span class="comment">\ If both of the high bytes for point #X and point #Y</span>
 <span class="mne">ORA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ are zero then the x-coordinates for these particular</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol13</a>             <span class="comment">\ points happen to fit into single-byte numbers, so</span>
                        <span class="comment">\ jump to gpol13 to process the edge accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ If yEdgeDeltaHi is non-zero then the y-axis delta is</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol12</a>             <span class="comment">\ non-zero, so jump to part 6 via gpol12 to process the</span>
                        <span class="comment">\ edge accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ If yEdgeDeltaLo = 0 then we know yEdgeDelta(Hi Lo)</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol15</a>             <span class="comment">\ must be zero as we passed through the BNE above, so</span>
                        <span class="comment">\ the polygon edge is horizontal and we jump to gpol15</span>
                        <span class="comment">\ to move on to the next polygon edge ???</span>

<span class="label">.gpol12</span><a id="gpol12" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">gpol22</a>             <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     two-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is non-zero</span>
                        <span class="comment">\     and positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we jump to part 6 to process this edge accordingly</span>

<span class="label">.gpol13</span><a id="gpol13" class="anchor"></a>

                        <span class="comment">\ If we get here then the x-coordinates for points #X</span>
                        <span class="comment">\ and #Y fit into single-byte numbers</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ If yEdgeDeltaHi is zero then the y-axis delta also</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol14</a>             <span class="comment">\ fits into a single-byte number, so jump to gpol14</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the high bytes for both points' x-coordinates,</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">Y</span>  <span class="comment">\ because we are about to process the edge using</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ two-byte calculations, and the high bytes don't get</span>
                        <span class="comment">\ written when the x-coordinates of all the polygon</span>
                        <span class="comment">\ points fit into single-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this just ensures that the high bytes are correctly</span>
                        <span class="comment">\ set up so we can use the value of xPolygonPoint(Hi Lo)</span>
                        <span class="comment">\ in the calculations and get the correct x-coordinate</span>
                        <span class="comment">\ values</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol22</a>             <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     single-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y have had</span>
                        <span class="comment">\     their high bytes zeroed so they can be used as</span>
                        <span class="comment">\     two-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is a</span>
                        <span class="comment">\     two-byte number that is non-zero and positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we jump to part 6 to process this edge accordingly</span>

<span class="label">.gpol14</span><a id="gpol14" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     single-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is a</span>
                        <span class="comment">\     single-byte number and is therefore equal to</span>
                        <span class="comment">\     yEdgeDeltaLo</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ If yEdgeDeltaLo = 0 then yEdgeDelta(Hi Lo) = 0, so</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol19</a>             <span class="comment">\ jump to gpol19 to process this</span>

                        <span class="comment">\ We now set up the start and end points so that the</span>
                        <span class="comment">\ edge is either horizontal or slopes downwards when</span>
                        <span class="comment">\ moving from the start to the end, as that's what the</span>
                        <span class="comment">\ TracePolygonEdge routine expects</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We know that point #Y is higher than point #X as we</span>
                        <span class="comment">\ set that up above, so we trace along the line from</span>
                        <span class="comment">\ the start at point #Y to the end at point #X</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\ Set yEdgeStart(Hi Lo) = drawViewPitch(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>  <span class="comment">\ So this sets the y-coordinate of the start point in</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ point #Y (the lower point)</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ Set yEdgeEnd(Hi Lo) = drawViewPitch(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndHi</a>         <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\ So this sets the y-coordinate of the end point in</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ point #X (the higher point)</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">Y</span>  <span class="comment">\ Set xEdgeStart(Hi Lo) = (0 xPolygonPointLo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\</span>
                        <span class="comment">\ So this sets the x-coordinate of the start point in</span>
                        <span class="comment">\ point #Y (the lower point), starting with the low</span>
                        <span class="comment">\ bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Set xEdgeEnd(Hi Lo) = (0 xPolygonPointLo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\</span>
                        <span class="comment">\ So this sets the x-coordinate of the start point in</span>
                        <span class="comment">\ point #Y (the lower point), starting with the low</span>
                        <span class="comment">\ bytes</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the high bytes of xEdgeStart(Hi Lo) and</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ xEdgeEnd(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">JSR</span> <a class="popup destination">TracePolygonEdge</a>   <span class="comment">\ Trace the polygon edge, populating the xPolygonRight</span>
                        <span class="comment">\ or xPolygonLeft table with the x-coordinate of the</span>
                        <span class="comment">\ edge for each y-coordinate</span>

<span class="label">.gpol15</span><a id="gpol15" class="anchor"></a>

                        <span class="comment">\ We now move on to the next edge in the polygon</span>

 <span class="mne">LDY</span> <a class="popup variable">polygonEdge</a>        <span class="comment">\ Set Y to the number of the polygon edge that we have</span>
                        <span class="comment">\ been processing</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to move on to the next edge in the polygon</span>

 <span class="mne">CPY</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ If we have processed all the edges in the polygon then</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol16</a>             <span class="comment">\ jump to gpol16 to keep going</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol10</a>             <span class="comment">\ Otherwise loop back to gpol10 to process the next edge</span>
                        <span class="comment">\ in the polygon</span>

<span class="label">.gpol16</span><a id="gpol16" class="anchor"></a>

                        <span class="comment">\ We have processed all the edges in the polygon, so now</span>
                        <span class="comment">\ we work out whether the polygon is visible in the</span>
                        <span class="comment">\ current screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">horizontalEdges</a>    <span class="comment">\ If horizontalEdges does not match polygonEdgeCount</span>
 <span class="mne">CMP</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ then not every edge in the polygon was horizontal, so</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol17</a>             <span class="comment">\ jump to gpol17 to skip the following</span>

                        <span class="comment">\ If we get here then every edge in the polygon is</span>
                        <span class="comment">\ horizontal, so the entire polygon appears within a</span>
                        <span class="comment">\ single horizontal line</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ If the high byte of the view-relative pitch angle for</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol17</a>             <span class="comment">\ point #X is non-zero then point #X is definitely not</span>
                        <span class="comment">\ on-screen, and so neither is the horizontal line, so</span>
                        <span class="comment">\ jump to gpol17 to skip the following</span>

 <span class="mne">LDY</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\ Set Y to the low byte of the view-relative pitch angle</span>
                        <span class="comment">\ for point #X (and therefore the pitch angle for the</span>
                        <span class="comment">\ horizontal line)</span>

 <span class="mne">CPY</span> <a class="popup variable">minPitchAngle</a>      <span class="comment">\ If Y &lt; minPitchAngle then the line is not within the</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol17</a>             <span class="comment">\ screen buffer as the pitch angle is below the minimum</span>
                        <span class="comment">\ value in the buffer, so jump to gpol17 to skip the</span>
                        <span class="comment">\ following</span>

 <span class="mne">CPY</span> <a class="popup variable">maxPitchAngle</a>      <span class="comment">\ If Y >= maxPitchAngle hen the line is not within the</span>
 <span class="mne">BCS</span> <a class="popup destination">gpol17</a>             <span class="comment">\ screen buffer as the pitch angle is above the maximum</span>
                        <span class="comment">\ value in the buffer, so jump to gpol17 to skip the</span>
                        <span class="comment">\ following</span>

                        <span class="comment">\ If we get here then the polygon is a single horizontal</span>
                        <span class="comment">\ line and it appears within the screen buffer, so we</span>
                        <span class="comment">\ configure the result to return a single polygon line</span>
                        <span class="comment">\ with the y-coordinate of single horizontal line, and</span>
                        <span class="comment">\ with the maximum and minimum x-coordinates that we</span>
                        <span class="comment">\ have been calculating in xMinHorizontal and</span>
                        <span class="comment">\ xMaxHorizontal</span>

 <span class="mne">STY</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ Set both the top and bottom polygon y-coordinates to</span>
 <span class="mne">STY</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ the low byte of the view-relative pitch angle for</span>
                        <span class="comment">\ point #X</span>

 <span class="mne">LDA</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ Set the left edge of the polygon line to the</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">Y</span>     <span class="comment">\ x-coordinate in xMinHorizontal</span>

 <span class="mne">LDA</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ Set the right edge of the polygon line to the</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonRight</a>,<span class="register">Y</span>    <span class="comment">\ x-coordinate in xMaxHorizontal</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set drawPolygon = 0 so the polygon gets drawn</span>
 <span class="mne">STA</span> <a class="popup variable">drawPolygon</a>

<span class="label">.gpol17</span><a id="gpol17" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">drawPolygon</a>        <span class="comment">\ If drawPolygon is non-zero then the polygon should not</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol18</a>             <span class="comment">\ be drawn, so jump to gpol18 to return from the</span>
                        <span class="comment">\ subroutine with the C flag set</span>

 <span class="mne">LDA</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ If yPolygonTop &lt; yPolygonBottom then there are no</span>
 <span class="mne">CMP</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ visible lines to draw in the polygon, so jump to</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol18</a>             <span class="comment">\ gpol18 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that the polygon is</span>
                        <span class="comment">\ visible in the current screen buffer and should be</span>
                        <span class="comment">\ drawn</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.gpol18</span><a id="gpol18" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that the polygon is not</span>
                        <span class="comment">\ visible in the current screen buffer and should not be</span>
                        <span class="comment">\ drawn</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.gpol19</span><a id="gpol19" class="anchor"></a>

                        <span class="comment">\ If we get here then yEdgeDelta(Hi Lo) = 0, so this</span>
                        <span class="comment">\ polygon edge is horizontal</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Set A = xPolygonPointLo for point #X</span>

 <span class="mne">CMP</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ Set xMaxHorizontal = max(xMaxHorizontal, A)</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol20</a>             <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ So xMaxHorizontal keeps track of the maximum</span>
                        <span class="comment">\ x-coordinate of all the horizontal polygon edges</span>

<span class="label">.gpol20</span><a id="gpol20" class="anchor"></a>

 <span class="mne">CMP</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ Set xMinHorizontal = min(xMinHorizontal, A)</span>
 <span class="mne">BCS</span> <a class="popup destination">gpol21</a>             <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ So xMinHorizontal keeps track of the minimum</span>
                        <span class="comment">\ x-coordinate of all the horizontal polygon edges</span>

<span class="label">.gpol21</span><a id="gpol21" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">horizontalEdges</a>    <span class="comment">\ Increment horizontalEdges so we keep a count of all</span>
                        <span class="comment">\ the horizontal polygon edges</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol15</a>             <span class="comment">\ Jump to gpol15 to move on to the next polygon edge</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-1-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 1 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge, populating xPolygonRight or xPolygonLeft</span>
             <span class="headerEntry">with the x-coordinate of the edge for each y-coordinate</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_1_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html">GetPolygonLines (Part 5 of 6)</a> calls <a href="#tracepolygonedge">TracePolygonEdge</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">GetPolygonLines (Part 6 of 6)</a> calls <a href="#tracepolygonedge">TracePolygonEdge</a></span>
</div>
<hr class="light">
 This routine traces a polygon edge.

 For this to work the start point must have a bigger y-coordinate than the end
 point, so the edge is either horizontal or slopes downwards when tracing the
 edge from start to end.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">xEdgeStart(Hi Lo)</span>    <span class="argumentEntry">The x-coordinate of the start of the edge to trace</span>

   <span class="argumentLabel">yEdgeStart(Hi Lo)</span>    <span class="argumentEntry">The y-coordinate of the start of the edge to trace</span>

   <span class="argumentLabel">xEdgeEnd(Hi Lo)</span>      <span class="argumentEntry">The x-coordinate of the end of the edge to trace</span>

   <span class="argumentLabel">yEdgeEnd(Hi Lo)</span>      <span class="argumentEntry">The y-coordinate of the start of the edge to trace</span>

   <span class="argumentLabel">yEdgeDeltaLo</span>         <span class="argumentEntry">The y-axis delta along the edge</span>

   <span class="argumentLabel">yPolygonTop</span>          <span class="argumentEntry">The y-coordinate of the top of the polygon (where higher</span>
                        <span class="argumentEntry">y-coordinates are up the screen)</span>

   <span class="argumentLabel">yPolygonBottom</span>       <span class="argumentEntry">The y-coordinate of the bottom of the polygon (where</span>
                        <span class="argumentEntry">higher y-coordinates are up the screen)</span>

   <span class="argumentLabel">xPolygonAddrHi</span>       <span class="argumentEntry">The high byte of either xPolygonLeft or xPolygonRight</span>
                        <span class="argumentEntry">to determine which of the resulting tables is written to</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">xPolygonLeft</span>         <span class="argumentEntry">The pixel x-coordinates of the left edges of each pixel</span>
                        <span class="argumentEntry">line in the polygon (when xPolygonAddrHi is the high</span>
                        <span class="argumentEntry">byte of xPolygonLeft)</span>

   <span class="argumentLabel">xPolygonRight</span>        <span class="argumentEntry">The pixel x-coordinates of the right edges of each pixel</span>
                        <span class="argumentEntry">line in the polygon (when xPolygonAddrHi is the high</span>
                        <span class="argumentEntry">byte of xPolygonRight)</span>

</div></div>
<span class="label">.tred1</span><a id="tred1" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">tred35</a>             <span class="comment">\ Jump to part 6 to trace an edge with two-byte start or</span>
                        <span class="comment">\ end point x-coordinates</span>

<span class="label">.tred2</span><a id="tred2" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.TracePolygonEdge</span><a id="tracepolygonedge" class="anchor"></a>

                        <span class="comment">\ We start by updating yPolygonBottom so it covers the</span>
                        <span class="comment">\ y-coordinate of the end point of the edge, as the end</span>
                        <span class="comment">\ point has the lower y-coordinate</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeEndHi</a>         <span class="comment">\ If yEdgeEnd(Hi Lo) is negative then the end point is</span>
 <span class="mne">BMI</span> <a class="popup destination">tred3</a>              <span class="comment">\ in the lower half of the screen, so jump to tred3 to</span>
                        <span class="comment">\ set yPolygonBottom to the lowest point in the screen</span>
                        <span class="comment">\ buffer, i.e. minPitchAngle</span>

 <span class="mne">BNE</span> <a class="popup destination">tred2</a>              <span class="comment">\ If yEdgeEndHi > 0 then the end point is off the top of</span>
                        <span class="comment">\ the screen, so jump to tred2 to return from the</span>
                        <span class="comment">\ subroutine</span>

                        <span class="comment">\ If we get here then yEdgeEndHi = 0, so now we analyse</span>
                        <span class="comment">\ the low byte of yEdgeEnd(Hi Lo)</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ If yEdgeEndLo >= maxPitchAngle then the edge ends</span>
 <span class="mne">CMP</span> <a class="popup variable">maxPitchAngle</a>      <span class="comment">\ beyond the top of the screen buffer, so jump to tred2</span>
 <span class="mne">BCS</span> <a class="popup destination">tred2</a>              <span class="comment">\ to return from the subroutine</span>

 <span class="mne">CMP</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ If yEdgeEndLo >= yPolygonBottom then yPolygonBottom</span>
 <span class="mne">BCS</span> <a class="popup destination">tred5</a>              <span class="comment">\ already covers the y-coordinate, so jump to tred5 to</span>
                        <span class="comment">\ move on to the next calculation</span>

                        <span class="comment">\ If we get here then yEdgeEndLo &lt; yPolygonBottom, so we</span>
                        <span class="comment">\ need to reduce yPolygonBottom to cater for this new</span>
                        <span class="comment">\ y-coordinate</span>

 <span class="mne">CMP</span> <a class="popup variable">minPitchAngle</a>      <span class="comment">\ If yEdgeEndLo >= minPitchAngle, then the y-coordinate</span>
 <span class="mne">BCS</span> <a class="popup destination">tred4</a>              <span class="comment">\ in yEdgeEndLo is inside the screen buffer, so jump</span>
                        <span class="comment">\ to tred4 to store this as the new value of</span>
                        <span class="comment">\ yPolygonBottom</span>

                        <span class="comment">\ Otherwise yEdgeEndLo is below the bottom of the screen</span>
                        <span class="comment">\ buffer, so we need to clip yPolygonBottom to the</span>
                        <span class="comment">\ y-coordinate of the bottom of the screen buffer</span>

<span class="label">.tred3</span><a id="tred3" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">minPitchAngle</a>      <span class="comment">\ Set A = minPitchAngle, so A is clipped to the bottom</span>
                        <span class="comment">\ of the screen buffer</span>

<span class="label">.tred4</span><a id="tred4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ Set yPolygonBottom to the clipped value of yEdgeEndLo</span>
                        <span class="comment">\ as this is the lowest y-coordinate we have found yet</span>

<span class="label">.tred5</span><a id="tred5" class="anchor"></a>

                        <span class="comment">\ Next we update yPolygonTop so it covers the</span>
                        <span class="comment">\ y-coordinate of the start point of the edge</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ If yEdgeStart(Hi Lo) is negative then the start point</span>
 <span class="mne">BMI</span> <a class="popup destination">tred2</a>              <span class="comment">\ is off the bottom of the screen, so jump to tred2 to</span>
                        <span class="comment">\ return from the subroutine</span>

 <span class="mne">BNE</span> <a class="popup destination">tred6</a>              <span class="comment">\ If 0 &lt; yEdgeStartHi &lt; 128 then the start point is</span>
                        <span class="comment">\ beyond the top of the screen, so jump to tred6 to set</span>
                        <span class="comment">\ yPolygonTop to the highest point in the screen buffer,</span>
                        <span class="comment">\ i.e. maxPitchAngle</span>

                        <span class="comment">\ If we get here then yEdgeStartHi = 0, so now we</span>
                        <span class="comment">\ analyse the low byte of yEdgeStart(Hi Lo)</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ If yEdgeStartLo &lt; minPitchAngle then the edge starts</span>
 <span class="mne">CMP</span> <a class="popup variable">minPitchAngle</a>      <span class="comment">\ below the bottom of the screen buffer, so jump to</span>
 <span class="mne">BCC</span> <a class="popup destination">tred2</a>              <span class="comment">\ tred2 to return from the subroutine</span>

 <span class="mne">CMP</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ If yEdgeStartLo &lt; yPolygonTop then yPolygonTop already</span>
 <span class="mne">BCC</span> <a class="popup destination">tred8</a>              <span class="comment">\ caters for the y-coordinate, so jump to tred8 to move</span>
                        <span class="comment">\ on to the next calculation</span>

                        <span class="comment">\ If we get here then yEdgeStartLo >= yPolygonTop, so we</span>
                        <span class="comment">\ need to bump up yPolygonTop to cater for this new</span>
                        <span class="comment">\ y-coordinate</span>

 <span class="mne">CMP</span> <a class="popup variable">maxPitchAngle</a>      <span class="comment">\ If yEdgeStartLo &lt; maxPitchAngle, then the y-coordinate</span>
 <span class="mne">BCC</span> <a class="popup destination">tred7</a>              <span class="comment">\ in yEdgeStartLo is inside the screen buffer, so jump</span>
                        <span class="comment">\ to tred7 to store this as the new value of yPolygonTop</span>

                        <span class="comment">\ Otherwise yEdgeStartLo is beyond the top of the screen</span>
                        <span class="comment">\ buffer, so we need to clip yPolygonTop to the</span>
                        <span class="comment">\ y-coordinate of the top of the screen buffer</span>

<span class="label">.tred6</span><a id="tred6" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">maxPitchAngle</a>      <span class="comment">\ Set A = maxPitchAngle - 1, so A is clipped to the top</span>
 <span class="mne">SEC</span>                    <span class="comment">\ of the screen buffer</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>

<span class="label">.tred7</span><a id="tred7" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ Set yPolygonTop to the clipped value of yEdgeStartLo</span>
                        <span class="comment">\ as this is the highest y-coordinate we have found yet</span>

<span class="label">.tred8</span><a id="tred8" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ If either of the start or end points have a non-zero</span>
 <span class="mne">ORA</span> <a class="popup variable">xEdgeEndHi</a>         <span class="comment">\ high byte in their x-coordinates, jump to part 4 via</span>
 <span class="mne">BNE</span> <a class="popup destination">tred1</a>              <span class="comment">\ tred1 to trace the polygon edge accordingly</span>

                        <span class="comment">\ If we get here then both xEdgeStartHi and xEdgeEndHi</span>
                        <span class="comment">\ are zero, so the x-coordinates for the polygon edge</span>
                        <span class="comment">\ are all in the range 0 to 255</span>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set A = xEdgeStartLo - xEdgeEndLo</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ So A contains the x-axis delta along the edge we are</span>
                        <span class="comment">\ tracing</span>

 <span class="mne">BCS</span> <a class="popup destination">tred9</a>              <span class="comment">\ If the subtraction didn't underflow, jump to tred9 to</span>
                        <span class="comment">\ store the result in xEdgeDelta, as it is already the</span>
                        <span class="comment">\ correct sign for the absolute value</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Negate A using two's complement, so that A is now</span>
 <span class="mne">CLC</span>                    <span class="comment">\ positive and contains the absolute value of the</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ distance in the x-axis between the two points</span>

 <span class="mne">STA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Store the result in xEdgeDelta, so xEdgeDelta is the</span>
                        <span class="comment">\ positive absolute of the x-axis delta, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xEdgeDelta = |xEdgeStartLo - xEdgeEndLo|</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&E8</span>               <span class="comment">\ Set A to the opcode for the INX instruction, so we</span>
                        <span class="comment">\ trace along the edge by incrementing X</span>

 <span class="mne">BNE</span> <a class="popup destination">tred10</a>             <span class="comment">\ Jump to tred10 to keep going (this BNE is effectively</span>
                        <span class="comment">\ a JMP as X is never zero)</span>

<span class="label">.tred9</span><a id="tred9" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set xEdgeDelta to the positive x-axis delta, so this</span>
                        <span class="comment">\ is the case:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xEdgeDelta = |xEdgeStartLo - xEdgeEndLo|</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&CA</span>               <span class="comment">\ Set A to the opcode for the DEX instruction, so we</span>
                        <span class="comment">\ trace along the edge by decrementing X</span>

<span class="label">.tred10</span><a id="tred10" class="anchor"></a>

                        <span class="comment">\ By this point we have the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xEdgeDelta = |xEdgeStartLo - xEdgeEndLo|</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * X is the correct opcode for tred12 (DEX or INX)</span>

 <span class="mne">LDY</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set the status flags on the comparison of xEdgeDelta</span>
 <span class="mne">CPY</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ and yEdgeDeltaLo, so we can decide which axis has the</span>
                        <span class="comment">\ longer side along the polygon edge (and therefore</span>
                        <span class="comment">\ which axis we should step along when tracing the edge)</span>

 <span class="mne">LDY</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ Set (A Y) = (xPolygonAddrHi yEdgeStartLo) to use as</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ the storage address in the modification below</span>

 <span class="mne">BCS</span> <a class="popup destination">tred18</a>             <span class="comment">\ If xEdgeDelta >= yEdgeDeltaLo then the x-axis delta is</span>
                        <span class="comment">\ the biggest and the edge has a shallow gradient, so</span>
                        <span class="comment">\ jump to part 3 to trace the edge by stepping along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ Otherwise the edge has a steep gradient, so fall</span>
                        <span class="comment">\ through into part 2 to trace the edge by stepping</span>
                        <span class="comment">\ along the y-axis</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-2-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 2 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge with a steep gradient by stepping along the</span>
             <span class="headerEntry">y-axis</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_2_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ If we get here then xEdgeDelta &lt; yEdgeDeltaLo, so the</span>
                        <span class="comment">\ y-axis delta is the biggest and the polygon edge has a</span>
                        <span class="comment">\ steep gradient</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore step along the y-axis one pixel at a time</span>
                        <span class="comment">\ and cumulatively add the gradient to calculate the</span>
                        <span class="comment">\ x-coordinate at each step</span>

 <span class="mne">STA</span> <a class="popup variable">tred13</a><span class="operator">+</span><span class="decimal">2</span>           <span class="comment">\ Modify the instruction at tred13 to use the address in</span>
 <span class="mne">STY</span> <a class="popup variable">tred13</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ (A Y), so it becomes:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   STX into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ xPolygonAddrHi is set to the high byte of either</span>
                        <span class="comment">\ xPolygonLeft or xPolygonRight, and both of these</span>
                        <span class="comment">\ tables start on a page boundary, so this sets the</span>
                        <span class="comment">\ address to offset yEdgeStartLo within the table</span>
                        <span class="comment">\ specified by xPolygonAddrHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will decrement this address for each step along the</span>
                        <span class="comment">\ edge, so we step along the y-axis as we trace the edge</span>

 <span class="mne">STX</span> <a class="popup variable">tred12</a>             <span class="comment">\ Modify the instruction at tred12 to use the opcode</span>
                        <span class="comment">\ specified in X, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX when xEdgeStartLo - xEdgeEndLo is positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX when xEdgeStartLo - xEdgeEndLo is negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We store the x-coordinate in X, so this ensures that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step left when required with DEX, for when the</span>
                        <span class="comment">\     start point is to the right of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step right when required with INX, for when the</span>
                        <span class="comment">\     start point is to the left of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will run this instruction when we need to step</span>
                        <span class="comment">\ along the x-axis, according to the cumulative value of</span>
                        <span class="comment">\ the slope error</span>

 <span class="mne">LDY</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Set Y = yEdgeDeltaLo + 1</span>
 <span class="mne">INY</span>                    <span class="comment">\</span>
                        <span class="comment">\ We can use this as a pixel counter when stepping along</span>
                        <span class="comment">\ the polygon edge's y-axis delta one pixel at a time,</span>
                        <span class="comment">\ as there are yEdgeDeltaLo + 1 pixels along the edge</span>
                        <span class="comment">\ (the additional one ensures we include the pixels at</span>
                        <span class="comment">\ both ends)</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Set A = ~(yEdgeDeltaLo / 2)</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ We use A to keep track of the slope error ???</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the first addition we do in the</span>
                        <span class="comment">\ following loop will work correctly</span>

                        <span class="comment">\ We already ensured in part 1 that yEdgeStart(Hi Lo)</span>
                        <span class="comment">\ is positive, so the following check only matches</span>
                        <span class="comment">\ yEdgeStartHi when it's in the range 1 to 127</span>

 <span class="mne">LDX</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ If 0 &lt; yEdgeStartHi &lt; 128 then the start point is</span>
 <span class="mne">BNE</span> <a class="popup destination">tred26</a>             <span class="comment">\ beyond the top of the screen, so jump to part 4 to</span>
                        <span class="comment">\ trace the edge from the start until it reaches the</span>
                        <span class="comment">\ screen, but without storing the results</span>
                        <span class="comment">\</span>
                        <span class="comment">\ When the tracing reaches the top of the screen, part 4</span>
                        <span class="comment">\ will jump into the loop below at tred14 to continue</span>
                        <span class="comment">\ the normal tracing process</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

 <span class="mne">JMP</span> <a class="popup destination">tred13</a>             <span class="comment">\ Jump into the middle of the loop at tred13</span>

<span class="label">.tred11</span><a id="tred11" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Add the x-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">BCC</span> <a class="popup destination">tred13</a>             <span class="comment">\ If the addition didn't overflow then we have not moved</span>
                        <span class="comment">\ into a new x-coordinate with this step along the</span>
                        <span class="comment">\ y-axis, so jump to tred13 so we do not move along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ If we get here then the addition overflowed and the</span>
                        <span class="comment">\ cumulative slope error along the x-axis has added up</span>
                        <span class="comment">\ to a whole pixel, so we now need to step along the</span>
                        <span class="comment">\ x-axis by a pixel</span>

 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Set A = A - yEdgeDeltaLo ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

<span class="label">.tred12</span><a id="tred12" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

<span class="label">.tred13</span><a id="tred13" class="anchor"></a>

                        <span class="comment">\ This is the entry point for the tracing loop and the</span>
                        <span class="comment">\ point where we record the current pixel in the edge</span>
                        <span class="comment">\ that we are tracing</span>

 <span class="mne">STX</span> <a class="popup variable">xPolygonRight</a><span class="operator">+</span><span class="hex">&9F</span>  <span class="comment">\ This instruction is modified above to the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   STX into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this stores the current x-coordinate as we step</span>
                        <span class="comment">\ along the edge, storing the coordinate in either the</span>
                        <span class="comment">\ xPolygonRight or xPolygonLeft table, and storing the</span>
                        <span class="comment">\ coordinate in the offset given by the y-coordinate</span>
                        <span class="comment">\ of the current position along the edge we are tracing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The original value of xPolygonRight+&9F is just</span>
                        <span class="comment">\ workspace noise and has no meaning, as it is modified</span>
                        <span class="comment">\ before we get here</span>

 <span class="mne">DEC</span> <a class="popup variable">tred13</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the</span>
                        <span class="comment">\ instruction above so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred17</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis,</span>
                        <span class="comment">\ so jump to tred17 to finish off</span>

<span class="label">.tred14</span><a id="tred14" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the pixel counter in Y</span>

 <span class="mne">BNE</span> <a class="popup destination">tred11</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ y-axis</span>

                        <span class="comment">\ If we get here then we have finished tracing the edge</span>
                        <span class="comment">\ and Y = 0, so we can now finish off</span>

<span class="label">.tred15</span><a id="tred15" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">drawPolygon</a>        <span class="comment">\ Set drawPolygon = 0 so the polygon gets drawn</span>

<span class="label">.tred16</span><a id="tred16" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.tred17</span><a id="tred17" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 to store as the value of drawPolygon so the</span>
                        <span class="comment">\ polygon gets drawn</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred15</a>             <span class="comment">\ Jump to tred15 to set drawPolygon and return from the</span>
                        <span class="comment">\ subroutine (this BEQ is effectively a JMP as Y is</span>
                        <span class="comment">\ always zero)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-3-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 3 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge with a shallow gradient by stepping along the</span>
             <span class="headerEntry">x-axis</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tred18</span><a id="tred18" class="anchor"></a>

                        <span class="comment">\ If we get here then xEdgeDelta >= yEdgeDeltaLo, so the</span>
                        <span class="comment">\ x-axis delta is the biggest and the polygon edge has a</span>
                        <span class="comment">\ shallow gradient</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore step along the x-axis one pixel at a time</span>
                        <span class="comment">\ and cumulatively add the gradient to calculate the</span>
                        <span class="comment">\ y-coordinate at each step</span>

 <span class="mne">STA</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">2</span>           <span class="comment">\ Modify the instruction at tred24 to use the address in</span>
 <span class="mne">STY</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ (A Y), so it becomes:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   STX into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ xPolygonAddrHi is set to the high byte of either</span>
                        <span class="comment">\ xPolygonLeft or xPolygonRight, and both of these</span>
                        <span class="comment">\ tables start on a page boundary, so this sets the</span>
                        <span class="comment">\ address to offset yEdgeStartLo within the table</span>
                        <span class="comment">\ specified by xPolygonAddrHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will decrement this address when we need to step</span>
                        <span class="comment">\ along the y-axis, according to the cumulative value of</span>
                        <span class="comment">\ the slope error</span>

 <span class="mne">STX</span> <a class="popup variable">tred22</a>             <span class="comment">\ Modify the instruction at tred12 to use the opcode</span>
                        <span class="comment">\ specified in X, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX when xEdgeStartLo - xEdgeEndLo is positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX when xEdgeStartLo - xEdgeEndLo is negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We store the x-coordinate in X, so this ensures that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step left when required with DEX, for when the</span>
                        <span class="comment">\     start point is to the right of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step right when required with INX, for when the</span>
                        <span class="comment">\     start point is to the left of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will run this instruction for each step along the</span>
                        <span class="comment">\ edge, so we step along the x-axis as we trace the edge</span>

 <span class="mne">LDY</span> <span class="hash">#</span><a class="popup variable">tred24</a><span class="operator">-</span><a class="popup variable">tred23</a><span class="operator">-</span><span class="decimal">2</span>   <span class="comment">\ Set Y to the operand required to modify the BCC</span>
                        <span class="comment">\ instruction at tred23 to the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   BCC tred24</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">xPolygonLeft</a><span class="bracket">)</span>  <span class="comment">\ If we are tracing a left edge of the polygon, jump to</span>
 <span class="mne">BEQ</span> <a class="popup destination">tred19</a>             <span class="comment">\ tred19</span>

                        <span class="comment">\ If we get here then we are tracing a right edge of the</span>
                        <span class="comment">\ polygon</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&CA</span>               <span class="comment">\ If we are going to be stepping along the x-axis with a</span>
 <span class="mne">BEQ</span> <a class="popup destination">tred20</a>             <span class="comment">\ DEX instruction (opcode &DA), jump to tred20 so we can</span>
                        <span class="comment">\ modify the instruction at tred23 to BCC tred25</span>

 <span class="mne">BNE</span> <a class="popup destination">tred21</a>             <span class="comment">\ Otherwise we are going to be stepping along the x-axis</span>
                        <span class="comment">\ with an INX instruction, so jump to tred21 to modify</span>
                        <span class="comment">\ the instruction at tred23 to BCC tred24 (this BNE is</span>
                        <span class="comment">\ effectively a JMP as we just passed through a BEQ)</span>

<span class="label">.tred19</span><a id="tred19" class="anchor"></a>

                        <span class="comment">\ If we get here then we are tracing a left edge of the</span>
                        <span class="comment">\ polygon</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&CA</span>               <span class="comment">\ If we are going to be stepping along the x-axis with a</span>
 <span class="mne">BEQ</span> <a class="popup destination">tred21</a>             <span class="comment">\ DEX instruction (opcode &DA), jump to tred21 so we can</span>
                        <span class="comment">\ modify the instruction at tred23 to BCC tred24</span>

<span class="label">.tred20</span><a id="tred20" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><a class="popup variable">tred25</a><span class="operator">-</span><a class="popup variable">tred23</a><span class="operator">-</span><span class="decimal">2</span>   <span class="comment">\ Set Y to the operand required to modify the BCC</span>
                        <span class="comment">\ instruction at tred23 to the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   BCC tred25</span>

<span class="label">.tred21</span><a id="tred21" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">tred23</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Modify the instruction at tred23 to use the operand</span>
                        <span class="comment">\ specified in Y, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BCC tred24 when we are tracing a right edge and</span>
                        <span class="comment">\     stepping along the x-axis with INX or a left edge</span>
                        <span class="comment">\     and stepping along with DEX</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BCC tred25 when we are tracing a right edge and</span>
                        <span class="comment">\     stepping along the x-axis with DEX or a left edge</span>
                        <span class="comment">\     and stepping along with INX</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that we store the x-coordinate of the</span>
                        <span class="comment">\ outermost pixel along the edge for each horizontal</span>
                        <span class="comment">\ polygon line (see tred23 below for details)</span>

 <span class="mne">LDY</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set Y = xEdgeDelta + 1</span>
 <span class="mne">INY</span>                    <span class="comment">\</span>
                        <span class="comment">\ We can use this as a pixel counter when stepping along</span>
                        <span class="comment">\ the polygon edge's x-axis delta one pixel at a time,</span>
                        <span class="comment">\ as there are xEdgeDelta + 1 pixels along the edge</span>
                        <span class="comment">\ (the additional one ensures we include the pixels at</span>
                        <span class="comment">\ both ends)</span>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set A = ~(xEdgeDelta / 2)</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ We use A to keep track of the slope error ???</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the first addition we do in the</span>
                        <span class="comment">\ following loop will work correctly</span>

                        <span class="comment">\ We already ensured in part 1 that yEdgeStart(Hi Lo)</span>
                        <span class="comment">\ is positive, so the following check only matches</span>
                        <span class="comment">\ yEdgeStartHi when it's in the range 1 to 127</span>

 <span class="mne">LDX</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ If 0 &lt; yEdgeStartHi &lt; 128 then the start point is</span>
 <span class="mne">BNE</span> <a class="popup destination">tred31</a>             <span class="comment">\ beyond the top of the screen, so jump to part 5 to</span>
                        <span class="comment">\ trace the edge from the start until it reaches the</span>
                        <span class="comment">\ screen, but without storing the results</span>
                        <span class="comment">\</span>
                        <span class="comment">\ When the tracing reaches the top of the screen, part 4</span>
                        <span class="comment">\ will jump into the loop below at tred14 to continue</span>
                        <span class="comment">\ the normal tracing process</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

 <span class="mne">JMP</span> <a class="popup destination">tred24</a>             <span class="comment">\ Jump into the middle of the loop at tred24</span>

<span class="label">.tred22</span><a id="tred22" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">ADC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Add the y-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ x-axis</span>

<span class="label">.tred23</span><a id="tred23" class="anchor"></a>

 <span class="mne">BCC</span> <a class="popup destination">tred25</a>             <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BCC tred24 when we are tracing a right edge with</span>
                        <span class="comment">\     INX or a left edge with DEX</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BCC tred25 when we are tracing a right edge with</span>
                        <span class="comment">\     DEX or a left edge with INX</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if the addition didn't overflow then we have not</span>
                        <span class="comment">\ moved into a new y-coordinate with this step along the</span>
                        <span class="comment">\ x-axis, so jump to tred24 or tred25 so we do not move</span>
                        <span class="comment">\ along the y-axis</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The difference in the two branches is as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BCC tred24 stores the coordinate</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BCC tred25 does not store the coordinate</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So when we are tracing a right edge with DEX and we</span>
                        <span class="comment">\ are moving left along the x-axis, then we only</span>
                        <span class="comment">\ update the coordinate when the slope error overflows,</span>
                        <span class="comment">\ so we store the x-coordinate for the rightmost pixel</span>
                        <span class="comment">\ there is more than one pixel along the x-axis for this</span>
                        <span class="comment">\ step (so we store the rightmost pixels from the edge,</span>
                        <span class="comment">\ which is what we want)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The same is true when we are tracing a left edge with</span>
                        <span class="comment">\ INX and we are moving right along the x-axis, but in</span>
                        <span class="comment">\ this case we store the x-coordinate for the leftmost</span>
                        <span class="comment">\ pixel for each step (so we store the leftmost pixels</span>
                        <span class="comment">\ from this edge, which is what we want)</span>

 <span class="mne">SBC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set A = A - xEdgeDelta ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

 <span class="mne">DEC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the</span>
                        <span class="comment">\ instruction below so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred17</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis,</span>
                        <span class="comment">\ so jump to tred17 in part 2 to finish off</span>

<span class="label">.tred24</span><a id="tred24" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">xPolygonRight</a><span class="operator">+</span><span class="hex">&9E</span>  <span class="comment">\ This instruction is modified above to the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   STX into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this stores the current x-coordinate as we step</span>
                        <span class="comment">\ along the edge, storing the coordinate in either the</span>
                        <span class="comment">\ xPolygonRight or xPolygonLeft table, and storing the</span>
                        <span class="comment">\ coordinate in the offset given by the y-coordinate</span>
                        <span class="comment">\ of the current position along the edge we are tracing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The original value of xPolygonRight+&9E is just</span>
                        <span class="comment">\ workspace noise and has no meaning, as it is modified</span>
                        <span class="comment">\ before we get here</span>

<span class="label">.tred25</span><a id="tred25" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the pixel counter in Y</span>

 <span class="mne">BNE</span> <a class="popup destination">tred22</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ If we get here then we have finished tracing the edge</span>
                        <span class="comment">\ and Y = 0, so we can now finish off by setting the</span>
                        <span class="comment">\ value of drawPolygon to zero so the polygon gets drawn</span>

 <span class="mne">JMP</span> <a class="popup destination">tred15</a>             <span class="comment">\ Jump to tred15 to set drawPolygon and return from the</span>
                        <span class="comment">\ subroutine (this BEQ is effectively a JMP as Y is</span>
                        <span class="comment">\ always zero)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-4-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 4 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a steep edge that starts off-screen, without storing the</span>
             <span class="headerEntry">coordinates, until we reach the screen and return to part 2</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_4_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tred26</span><a id="tred26" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">tred13</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Increment the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred13 to balance out the additional</span>
                        <span class="comment">\ DEC tred13+1 that we do below when we rejoin the</span>
                        <span class="comment">\ loop in part 2</span>

 <span class="mne">LDX</span> <a class="popup variable">tred12</a>             <span class="comment">\ Modify the instruction at tred28 so it matches the</span>
 <span class="mne">STX</span> <a class="popup variable">tred28</a>             <span class="comment">\ modified instruction at tred12, so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

                        <span class="comment">\ The loop below has the same structure as the loop in</span>
                        <span class="comment">\ part 2 between tred11 and tred15, and which we enter</span>
                        <span class="comment">\ via tred13, but in this version of the loop we do not</span>
                        <span class="comment">\ store the coordinates of the edge, as the portion we</span>
                        <span class="comment">\ are currently tracing is off-screen</span>

 <span class="mne">JMP</span> <a class="popup destination">tred29</a>             <span class="comment">\ Jump into the middle of the loop at tred29 to trace</span>
                        <span class="comment">\ the edge but without storing the results</span>

<span class="label">.tred27</span><a id="tred27" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Add the x-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">BCC</span> <a class="popup destination">tred29</a>             <span class="comment">\ If the addition didn't overflow then we have not moved</span>
                        <span class="comment">\ into a new x-coordinate with this step along the</span>
                        <span class="comment">\ y-axis, so jump to tred29 so we do not move along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ If we get here then the addition overflowed and the</span>
                        <span class="comment">\ cumulative slope error along the x-axis has added up</span>
                        <span class="comment">\ to a whole pixel, so we now need to step along the</span>
                        <span class="comment">\ x-axis by a pixel</span>

 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Set A = A - yEdgeDeltaLo ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

<span class="label">.tred28</span><a id="tred28" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

<span class="label">.tred29</span><a id="tred29" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">tred13</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred13 so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred30</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis</span>
                        <span class="comment">\ for this value of the high byte, so the next address</span>
                        <span class="comment">\ we decrement it to will be on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore jump to tred30 to set the address for the</span>
                        <span class="comment">\ top of the screen and rejoin the edge-tracing loop in</span>
                        <span class="comment">\ part 2 to keep tracing the edge</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the pixel counter in Y</span>

 <span class="mne">BNE</span> <a class="popup destination">tred27</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ If we get here then we have finished tracing the edge</span>
                        <span class="comment">\ and we didn't reach an on-screen portion, so jump to</span>
                        <span class="comment">\ tred16 to return from the subroutine without changing</span>
                        <span class="comment">\ drawPolygon (as we didn't draw anything in this</span>
                        <span class="comment">\ routine)</span>

<span class="label">.tred30</span><a id="tred30" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">tred13</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred13 to &FF (as we only get here when</span>
                        <span class="comment">\ we have just decremented it to zero), so it now points</span>
                        <span class="comment">\ to the address for the top line of the screen at a</span>
                        <span class="comment">\ y-coordinate of 255</span>

 <span class="mne">JMP</span> <a class="popup destination">tred14</a>             <span class="comment">\ Jump to tred25 to rejoin the normal edge-tracing loop</span>
                        <span class="comment">\ in part 2 so we trace the rest of the edge</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-5-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 5 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a shallow edge that starts off-screen, without storing the</span>
             <span class="headerEntry">coordinates, until we reach the screen and return to part 3</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_5_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tred31</span><a id="tred31" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Increment the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred24 to balance out the additional</span>
                        <span class="comment">\ DEC tred24+1 that we do below when we rejoin the</span>
                        <span class="comment">\ loop in part 3</span>

 <span class="mne">LDX</span> <a class="popup variable">tred22</a>             <span class="comment">\ Modify the instruction at tred32 so it matches the</span>
 <span class="mne">STX</span> <a class="popup variable">tred32</a>             <span class="comment">\ modified instruction at tred22, so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

                        <span class="comment">\ The loop below has the same structure as the loop in</span>
                        <span class="comment">\ part 3 between tred22 and tred25, and which we enter</span>
                        <span class="comment">\ via tred24, but in this version of the loop we do not</span>
                        <span class="comment">\ store the coordinates of the edge, as the portion we</span>
                        <span class="comment">\ are currently tracing is off-screen</span>

 <span class="mne">JMP</span> <a class="popup destination">tred33</a>             <span class="comment">\ Jump into the middle of the loop at tred33 to trace</span>
                        <span class="comment">\ the edge but without storing the results</span>

<span class="label">.tred32</span><a id="tred32" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">ADC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Add the y-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ x-axis</span>

 <span class="mne">BCC</span> <a class="popup destination">tred33</a>             <span class="comment">\ If the addition didn't overflow then we have not</span>
                        <span class="comment">\ moved into a new y-coordinate with this step along the</span>
                        <span class="comment">\ x-axis, so jump to tred33 so we do not move along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">SBC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set A = A - xEdgeDelta ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

 <span class="mne">DEC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred24 so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred34</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis</span>
                        <span class="comment">\ for this value of the high byte, so the next address</span>
                        <span class="comment">\ we decrement it to will be on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore jump to tred34 to set the address for the</span>
                        <span class="comment">\ top of the screen and rejoin the edge-tracing loop in</span>
                        <span class="comment">\ part 3 to keep tracing the edge</span>

<span class="label">.tred33</span><a id="tred33" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the pixel counter in Y</span>

 <span class="mne">BNE</span> <a class="popup destination">tred32</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ x-axis</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ If we get here then we have finished tracing the edge</span>
                        <span class="comment">\ and we didn't reach an on-screen portion, so jump to</span>
                        <span class="comment">\ tred16 to return from the subroutine without changing</span>
                        <span class="comment">\ drawPolygon (as we didn't draw anything in this</span>
                        <span class="comment">\ routine)</span>

<span class="label">.tred34</span><a id="tred34" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred24 to &FF (as we only get here when</span>
                        <span class="comment">\ we have just decremented it to zero), so it now points</span>
                        <span class="comment">\ to the address for the top line of the screen at a</span>
                        <span class="comment">\ y-coordinate of 255</span>

 <span class="mne">JMP</span> <a class="popup destination">tred25</a>             <span class="comment">\ Jump to tred25 to rejoin the normal edge-tracing loop</span>
                        <span class="comment">\ in part 3 so we trace the rest of the edge</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getpolygonlines-part-6-of-6" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 6 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Split polygon edges whose coordinates are stored in two-byte</span>
             <span class="headerEntry">numbers into smaller sections for processing</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.gpol22</span><a id="gpol22" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     two-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is non-zero</span>
                        <span class="comment">\     and a two-byte number, and it is also positive</span>

 <span class="mne">STX</span> <a class="popup variable">pointX</a>             <span class="comment">\ Store the number of point #X in pointX so we can</span>
                        <span class="comment">\ retrieve it below</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set scaleFactor = 0 so we can use it to record the</span>
 <span class="mne">STA</span> <a class="popup variable">scaleFactor</a>        <span class="comment">\ scale factor we apply to the x-axis and y-axis deltas</span>
                        <span class="comment">\ below when fitting them into single-byte numbers</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">Y</span>  <span class="comment">\ Set (A T) to the following:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\   xPolygonPoint(Hi Lo) for point #Y</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\                 - xPolygonPoint(Hi Lo) for point #X</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">Y</span>  <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ So (A T) contains the difference in the x-axis between</span>
                        <span class="comment">\ the two polygon points</span>

 <span class="mne">STA</span> <a class="popup variable">xPointDeltaHi</a>      <span class="comment">\ Store the high byte in xPointDeltaHi so we can test</span>
                        <span class="comment">\ the sign below</span>

 <span class="mne">JSR</span> <a class="popup destination">Absolute16Bit</a>      <span class="comment">\ Set (U T) = |A T|</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\</span>
                        <span class="comment">\ So by this point we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The absolute x-axis delta in (U T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The positive y-axis delta in yEdgeDelta(Hi Lo)</span>

 <span class="mne">ORA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set A = U OR yEdgeDeltaHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the highest set bit in A matches the position of</span>
                        <span class="comment">\ the highest set bit across the two high bytes of the</span>
                        <span class="comment">\ two deltas</span>

 <span class="mne">BEQ</span> <a class="popup destination">gpol24</a>             <span class="comment">\ If both U and yEdgeDeltaHi are zero then both deltas</span>
                        <span class="comment">\ fit into one byte (the low byte), so jump to gpol24</span>

                        <span class="comment">\ If we get here then at least one of the deltas does</span>
                        <span class="comment">\ not fit into a single byte, so we now scale both of</span>
                        <span class="comment">\ the deltas down</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We do this by shifting both deltas to the right, and</span>
                        <span class="comment">\ at the same time we shift A to the right, repeating</span>
                        <span class="comment">\ the process until there are no more set bits in A, by</span>
                        <span class="comment">\ which time we will have shifted the deltas by the</span>
                        <span class="comment">\ minimum number of shifts required to zero both high</span>
                        <span class="comment">\ bytes</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also record the number of shifts in scaleFactor in</span>
                        <span class="comment">\ the form of one set bit for each shift</span>

<span class="label">.gpol23</span><a id="gpol23" class="anchor"></a>

 <span class="mne">LSR</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Shift the y-axis delta in yEdgeDelta(Hi Lo) to the</span>
 <span class="mne">ROR</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ right by one place to scale it down by half</span>

 <span class="mne">LSR</span> <a class="popup variable">U</a>                  <span class="comment">\ Shift the x-axis delta in (U T) to the right by one</span>
 <span class="mne">ROR</span> <a class="popup variable">T</a>                  <span class="comment">\ place to scale it down by half</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Rotate a set bit into bit 0 of scaleFactor, so we</span>
 <span class="mne">ROL</span> <a class="popup variable">scaleFactor</a>        <span class="comment">\ build up a sequence of set bits in the bottom part</span>
                        <span class="comment">\ of scaleFactor that matches the number of shifts,</span>
                        <span class="comment">\ effectively giving us the total cumulative scale</span>
                        <span class="comment">\ factor of the shifts (in fact scaleFactor will end</span>
                        <span class="comment">\ up being the cumulative scale factor minus 1, but</span>
                        <span class="comment">\ that's good enough for our needs)</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Shift A to the right to move the highest set bit</span>
                        <span class="comment">\ towards bit 0</span>

 <span class="mne">BNE</span> <a class="popup destination">gpol23</a>             <span class="comment">\ If there is still a set bit in A then at least one of</span>
                        <span class="comment">\ the high bytes in the deltas is non-zero, so loop back</span>
                        <span class="comment">\ to perform another shift until both high bytes are</span>
                        <span class="comment">\ zero</span>

<span class="label">.gpol24</span><a id="gpol24" class="anchor"></a>

                        <span class="comment">\ By this point we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The scaled absolute x-axis delta in T</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The scaled positive y-axis delta in yEdgeDeltaLo</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The scale factor in scaleFactor</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now ensure that bit 7 is clear in both low bytes,</span>
                        <span class="comment">\ to make sure the single-byte values are both positive</span>

 <span class="mne">LDX</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ If yEdgeDeltaLo = 255 then jump back to gpol23 to</span>
 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ scale both deltas down by one more shift</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol23</a>

 <span class="mne">LDX</span> <a class="popup variable">T</a>                  <span class="comment">\ If T = 255 then jump back to gpol23 to scale both</span>
 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ deltas down by one more shift</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol23</a>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set (A T) = (U T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This effectively sets (A T) to the two-byte value of</span>
                        <span class="comment">\ the x-axis delta, though by this point U will always</span>
                        <span class="comment">\ be zero</span>

 <span class="mne">BIT</span> <a class="popup variable">xPointDeltaHi</a>      <span class="comment">\ We set xPointDeltaHi to the high byte of the original</span>
                        <span class="comment">\ x-axis delta subtraction, so this sets the N flag</span>
                        <span class="comment">\ according to the sign of that calculation</span>

 <span class="mne">JSR</span> <a class="popup destination">Absolute16Bit</a>      <span class="comment">\ Set the sign of (A T) to that of the N flag argument,</span>
                        <span class="comment">\ so (A T) now has the correct sign of the x-axis delta</span>

 <span class="mne">STA</span> <a class="popup variable">xEdgeDeltaHi</a>       <span class="comment">\ Set xEdgeDelta(Hi Lo) = (A T)</span>
 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeDeltaLo</a>       <span class="comment">\ So xEdgeDelta(Hi Lo) contains the signed x-axis delta</span>

                        <span class="comment">\ By this point we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The scaled signed x-axis delta across the polygon</span>
                        <span class="comment">\     edge in xEdgeDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The scaled signed y-axis delta across the polygon</span>
                        <span class="comment">\     edge in (0 yEdgeDeltaLo), which also happens to be</span>
                        <span class="comment">\     positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The scale factor in scaleFactor</span>

                        <span class="comment">\ We now trace the polygon edge from the starting point</span>
                        <span class="comment">\ in point #Y to the end point in point #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To kick this process off, we set the coordinates in</span>
                        <span class="comment">\ xEdgeEnd and yEdgeEnd to those of point #Y, as these</span>
                        <span class="comment">\ variables are used to store the "end of the previous</span>
                        <span class="comment">\ part of the edge" and are therefore used as the "start</span>
                        <span class="comment">\ of the next part of the edge" in the tracing process</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">Y</span>  <span class="comment">\ Set xEdgeEnd(Hi Lo) to the x-coordinate of point #Y,</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ from the x-coordinate tables we populated in parts 3</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">Y</span>  <span class="comment">\ and 4</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\ Set yEdgeEnd(Hi Lo) to the y-coordinate of point #Y,</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndHi</a>         <span class="comment">\ taken from the pitch angles of the points in the</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>  <span class="comment">\ drawing tables</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndLo</a>

 <span class="mne">LDA</span> <a class="popup variable">scaleFactor</a>        <span class="comment">\ If scaleFactor is zero then we didn't need to do any</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol26</a>             <span class="comment">\ scaling on the deltas, so jump to gpol26 to skip the</span>
                        <span class="comment">\ following and process the polygon edge in one step</span>

                        <span class="comment">\ If we get here then we have scaled the deltas down by</span>
                        <span class="comment">\ a factor of scaleFactor</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Because of the way we fed a set bit into scaleFactor</span>
                        <span class="comment">\ for each shift, the scale factor is scaleFactor+1, so</span>
                        <span class="comment">\ this is the same as splitting the polygon edge into</span>
                        <span class="comment">\ scaleFactor+1 parts, each of which is a step along the</span>
                        <span class="comment">\ the edge of the size given in the scaled-down deltas</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now process each of these small steps in a loop</span>
                        <span class="comment">\ that we perform scaleFactor times in the first part</span>
                        <span class="comment">\ and one more time at gpol26</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For each step we move the start point to the end point</span>
                        <span class="comment">\ from the previous step, and we move the end point</span>
                        <span class="comment">\ along the edge by the delta</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We set up the "end point from the previous step" to</span>
                        <span class="comment">\ point #Y above, so this process starts from point #Y</span>
                        <span class="comment">\ and steps toward point #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that we set up the start and end points so the</span>
                        <span class="comment">\ edge is either horizontal or slopes downwards when</span>
                        <span class="comment">\ moving from the start to the end, as that's what the</span>
                        <span class="comment">\ TracePolygonEdge routine expects</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We know that point #Y is higher than point #X as we</span>
                        <span class="comment">\ set that up in part 5, so we trace along the line from</span>
                        <span class="comment">\ the start at point #Y to the end at point #X</span>

<span class="label">.gpol25</span><a id="gpol25" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ Set the following, in sequence:</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\</span>
 <span class="mne">SEC</span>                    <span class="comment">\   yEdgeStart(Hi Lo) = yEdgeEnd(Hi Lo)</span>
 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\   yEdgeEnd(Hi Lo) -= yEdgeDelta(Hi Lo)</span>
 <span class="mne">LDA</span> <a class="popup variable">yEdgeEndHi</a>         <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ So we step along the y-axis by one more delta</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndHi</a>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ Set the following, in sequence:</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\</span>
 <span class="mne">SEC</span>                    <span class="comment">\   xEdgeStart(Hi Lo) = xEdgeEnd(Hi Lo)</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeDeltaLo</a>       <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\   xEdgeEnd(Hi Lo) -= xEdgeDelta(Hi Lo)</span>
 <span class="mne">LDA</span> <a class="popup variable">xEdgeEndHi</a>         <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ So we step along the x-axis by one more delta</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeDeltaHi</a>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">JSR</span> <a class="popup destination">TracePolygonEdge</a>   <span class="comment">\ Trace the small step of polygon edge that we just made</span>
                        <span class="comment">\ along the edge, populating the xPolygonRight or</span>
                        <span class="comment">\ xPolygonLeft table with the x-coordinate of the edge</span>
                        <span class="comment">\ for each y-coordinate</span>

 <span class="mne">DEC</span> <a class="popup variable">scaleFactor</a>        <span class="comment">\ Decrement the scale factor in scaleFactor</span>

 <span class="mne">BNE</span> <a class="popup destination">gpol25</a>             <span class="comment">\ Loop back to repeat the tracing process scaleFactor</span>
                        <span class="comment">\ times</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As there are actually scaleFactor+1 steps, we now fall</span>
                        <span class="comment">\ into the following to do one more step</span>

<span class="label">.gpol26</span><a id="gpol26" class="anchor"></a>

                        <span class="comment">\ If we get here then we are either tracing the entire</span>
                        <span class="comment">\ edge in one step, or we are performing the last step</span>
                        <span class="comment">\ in a set of scaled steps</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we are tracing the entire edge in one step, then we</span>
                        <span class="comment">\ already set up the coordinates of the "end point from</span>
                        <span class="comment">\ the previous step" in xEdgeEnd and yEdgeEnd to that of</span>
                        <span class="comment">\ point #Y, so this process starts from point #Y and</span>
                        <span class="comment">\ traces the edge to point #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we are performing the last step in a set of scaled</span>
                        <span class="comment">\ steps, then xEdgeEnd and yEdgeEnd are set to the end</span>
                        <span class="comment">\ of the last step to be traced, so this process traces</span>
                        <span class="comment">\ the last step towards point #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In either case, we start by setting the starting point</span>
                        <span class="comment">\ for this tracing process to the values in xEdgeEnd and</span>
                        <span class="comment">\ yEdgeEnd</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that we set up the start and end points so the</span>
                        <span class="comment">\ edge is either horizontal or slopes downwards when</span>
                        <span class="comment">\ moving from the start to the end, as that's what the</span>
                        <span class="comment">\ TracePolygonEdge routine expects</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We know that point #Y is higher than point #X as we</span>
                        <span class="comment">\ set that up in part 5, so we trace along the line from</span>
                        <span class="comment">\ the start at point #Y to the end at point #X</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ Set yEdgeStart(Hi Lo) = yEdgeEnd(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">yEdgeEndHi</a>         <span class="comment">\ So this is either the y-coordinate of point #Y or the</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ end of the last step in a multi-step trace</span>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ Set xEdgeStart(Hi Lo) = xEdgeEnd(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">xEdgeEndHi</a>         <span class="comment">\ So this is either the x-coordinate of point #Y or the</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ end of the last step in a multi-step trace</span>

 <span class="mne">LDX</span> <a class="popup variable">pointX</a>             <span class="comment">\ Set X to the number of point #X, which we stored at</span>
                        <span class="comment">\ the start of this part</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\ Set yEdgeEnd(Hi Lo) to the y-coordinate of point #X,</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ from the x-coordinate tables we populated in parts 3</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ and 4</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndHi</a>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Set xEdgeEnd(Hi Lo) to the x-coordinate of point #X</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ from the x-coordinate tables we populated in parts 3</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ and 4</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ Set yEdgeDeltaLo = yEdgeStartLo - yEdgeEndLo</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ This calculates the y-axis delta along the edge, which</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ we know we can do in one byte by this point</span>

 <span class="mne">JSR</span> <a class="popup destination">TracePolygonEdge</a>   <span class="comment">\ Trace the polygon edge, populating the xPolygonRight</span>
                        <span class="comment">\ or xPolygonLeft table with the x-coordinate of the</span>
                        <span class="comment">\ edge for each y-coordinate</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol15</a>             <span class="comment">\ Jump back to part 5 to move on to the next polygon</span>
                        <span class="comment">\ edge</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-6-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 6 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge where the start or end point x-coordinates</span>
             <span class="headerEntry">are two-byte numbers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_6_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tred35</span><a id="tred35" class="anchor"></a>

                        <span class="comment">\ If we get here then at least one of xEdgeStartHi and</span>
                        <span class="comment">\ xEdgeEndHi is non-zero</span>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set xEdgeDelta = xEdgeStart(Hi Lo) - xEdgeEnd(Hi Lo)</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ So xEdgeDelta contains the x-axis delta along the edge</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ we are tracing (we can discard the high byte as we</span>
 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ know it will be zero)</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">BPL</span> <a class="popup destination">tred36</a>             <span class="comment">\ If the result is positive, jump to tred36 to skip the</span>
                        <span class="comment">\ following, as the delta is already the correct sign</span>
                        <span class="comment">\ for the absolute value</span>

                        <span class="comment">\ If we get here then xEdgeDelta is negative and the</span>
                        <span class="comment">\ start point is to the left of the end point</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Negate xEdgeDelta as follows:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\   xEdgeDelta = 0 - xEdgeDelta</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\</span>
                        <span class="comment">\ So xEdgeDelta is positive and contains the absolute</span>
                        <span class="comment">\ value of the x-axis delta</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&E8</span>               <span class="comment">\ Set A to the opcode for the INX instruction, so we</span>
                        <span class="comment">\ trace along the edge by incrementing X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00000000</span>         <span class="comment">\ Set A to use as the high byte in yEdgeDeltaHi for a</span>
                        <span class="comment">\ positive 16-bit number</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&E6</span>               <span class="comment">\ Set Y to the opcode for the INC zp instruction, so we</span>
                        <span class="comment">\ trace along the edge by incrementing Y</span>

 <span class="mne">JMP</span> <a class="popup destination">tred37</a>             <span class="comment">\ Jump to tred37 to keep going</span>

<span class="label">.tred36</span><a id="tred36" class="anchor"></a>

                        <span class="comment">\ If we get here then xEdgeDelta is positive and the</span>
                        <span class="comment">\ start point is to the right of the end point</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&CA</span>               <span class="comment">\ Set A to the opcode for the DEX instruction, so we</span>
                        <span class="comment">\ trace along the edge by decrementing X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ Set A to use as the high byte in yEdgeDeltaHi for a</span>
                        <span class="comment">\ negative 16-bit number</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&C6</span>               <span class="comment">\ Set Y to the opcode for the DEC zp instruction, so we</span>
                        <span class="comment">\ trace along the edge by decrementing Y</span>

<span class="label">.tred37</span><a id="tred37" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">T</a>                  <span class="comment">\ Store the INC/DEC opcode in T so we can retrieve it</span>
                        <span class="comment">\ in parts 7 and 8</span>

 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set the high byte of yEdgeDelta(Hi Lo) to be negative</span>
                        <span class="comment">\ when we are moving along the x-axis from right to left</span>
                        <span class="comment">\ and positive when we are moving along the x-axis from</span>
                        <span class="comment">\ left to right</span>

 <span class="mne">LDY</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set the status flags on the comparison of xEdgeDelta</span>
 <span class="mne">CPY</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ and yEdgeDeltaLo, so we can decide which axis has the</span>
                        <span class="comment">\ longer side along the polygon edge (and therefore</span>
                        <span class="comment">\ which axis we should step along when tracing the edge)</span>

 <span class="mne">LDY</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ Set (A Y) = (xPolygonAddrHi yEdgeStartLo) to use as</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ the storage address in the modification below</span>

 <span class="mne">BCS</span> <a class="popup destination">tred46</a>             <span class="comment">\ If xEdgeDelta >= yEdgeDeltaLo then the x-axis delta is</span>
                        <span class="comment">\ the biggest and the edge has a shallow gradient, so</span>
                        <span class="comment">\ jump to part 8 to trace the edge by stepping along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ Otherwise the edge has a steep gradient, so fall</span>
                        <span class="comment">\ through into part 7 to trace the edge by stepping</span>
                        <span class="comment">\ along the y-axis</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-7-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 7 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge with a steep gradient by stepping along the</span>
             <span class="headerEntry">y-axis (for two-byte x-coordinates)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_7_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ If we get here then xEdgeDelta &lt; yEdgeDelta, so the</span>
                        <span class="comment">\ y-axis delta is the biggest and the polygon edge has a</span>
                        <span class="comment">\ steep gradient</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore step along the y-axis one pixel at a time</span>
                        <span class="comment">\ and cumulatively add the gradient to calculate the</span>
                        <span class="comment">\ x-coordinate at each step</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We get here with the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (A Y) = (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * X = the opcode for DEX or INX</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * T = the opcode for DEC zp or INC zp</span>

 <span class="mne">STA</span> <a class="popup variable">tred41</a><span class="operator">+</span><span class="decimal">2</span>           <span class="comment">\ Modify the instruction at tred41 to use the address in</span>
                        <span class="comment">\ (A Y), starting with the high byte</span>

 <span class="mne">STX</span> <a class="popup variable">tred40</a>             <span class="comment">\ Modify the instruction at tred40 to use the opcode</span>
                        <span class="comment">\ specified in X, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX when xEdgeStart - xEdgeEnd is positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX when xEdgeStart - xEdgeEnd is negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We store the x-coordinate in X, so this ensures that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step left when required with DEX, for when the</span>
                        <span class="comment">\     start point is to the right of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step right when required with INX, for when the</span>
                        <span class="comment">\     start point is to the left of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will run this instruction when we need to step</span>
                        <span class="comment">\ along the x-axis, according to the cumulative value of</span>
                        <span class="comment">\ the slope error</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ If yEdgeStartHi = 0 then the start point is below the</span>
 <span class="mne">BEQ</span> <a class="popup destination">tred38</a>             <span class="comment">\ top edge of the screen, so skip the following</span>
                        <span class="comment">\ instruction</span>

 <span class="mne">INY</span>                    <span class="comment">\ The start point is above the top edge of the screen,</span>
                        <span class="comment">\ so increment the low byte of (A Y) ???</span>

<span class="label">.tred38</span><a id="tred38" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">tred41</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Modify the instruction at tred41 to use the address in</span>
                        <span class="comment">\ (A Y), so it becomes:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   STX into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the low byte incremented by 1 when yEdgeStartHi</span>
                        <span class="comment">\ is non-zero</span>
                        <span class="comment">\</span>
                        <span class="comment">\ xPolygonAddrHi is set to the high byte of either</span>
                        <span class="comment">\ xPolygonLeft or xPolygonRight, and both of these</span>
                        <span class="comment">\ tables start on a page boundary, so this sets the</span>
                        <span class="comment">\ address to offset yEdgeStartLo within the table</span>
                        <span class="comment">\ specified by xPolygonAddrHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will decrement this address for each step along the</span>
                        <span class="comment">\ edge, so we step along the y-axis as we trace the edge</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Modify the instruction at tred45 to use the opcode</span>
 <span class="mne">STA</span> <a class="popup variable">tred45</a>             <span class="comment">\ specified in T, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis and</span>
                        <span class="comment">\ updates the high byte in xEdgeStartHi accordingly</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will run this instruction when we need to step</span>
                        <span class="comment">\ along the x-axis and update the high byte of the</span>
                        <span class="comment">\ address in the process</span>

 <span class="mne">LDY</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Set A = ~(yEdgeDeltaLo / 2)</span>
 <span class="mne">TYA</span>                    <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ We use A to keep track of the slope error ???</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="hex">&FF</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the first addition we do in the</span>
                        <span class="comment">\ following loop will work correctly</span>

 <span class="mne">INY</span>                    <span class="comment">\ Set U = yEdgeDeltaLo + 1</span>
 <span class="mne">STY</span> <a class="popup variable">U</a>                  <span class="comment">\</span>
                        <span class="comment">\ We can use this as a pixel counter when stepping along</span>
                        <span class="comment">\ the polygon edge's y-axis delta one pixel at a time,</span>
                        <span class="comment">\ as there are yEdgeDeltaLo + 1 pixels along the edge</span>
                        <span class="comment">\ (the additional one ensures we include the pixels at</span>
                        <span class="comment">\ both ends)</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

 <span class="mne">JSR</span> <a class="popup destination">ModifyStoringCode</a>  <span class="comment">\ Modify the instruction at tred41 and set drawPolygon</span>
                        <span class="comment">\ and Y according to the values of xEdgeStartHi and</span>
                        <span class="comment">\ yEdgeStartHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The instruction at tred41 is modified as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The drawPolygon flag is set as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawPolygon = 0 when yEdgeStartHi = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">tred41</a>             <span class="comment">\ Jump into the middle of the loop at tred41</span>

<span class="label">.tred39</span><a id="tred39" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Add the x-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">BCC</span> <a class="popup destination">tred41</a>             <span class="comment">\ If the addition didn't overflow then we have not moved</span>
                        <span class="comment">\ into a new x-coordinate with this step along the</span>
                        <span class="comment">\ y-axis, so jump to tred41 so we do not move along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ If we get here then the addition overflowed and the</span>
                        <span class="comment">\ cumulative slope error along the x-axis has added up</span>
                        <span class="comment">\ to a whole pixel, so we now need to step along the</span>
                        <span class="comment">\ x-axis by a pixel</span>

 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Set A = A - yEdgeDeltaLo ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

<span class="label">.tred40</span><a id="tred40" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">CPX</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set the status flags on the comparison of X and</span>
                        <span class="comment">\ yEdgeDeltaHi</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the comparison won't affect the</span>
                        <span class="comment">\ arithmetic in this loop</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred45</a>             <span class="comment">\ If X = yEdgeDeltaHi, jump to tred45 to step along the</span>
                        <span class="comment">\ x-axis by updating the high byte in xEdgeStartHi</span>

<span class="label">.tred41</span><a id="tred41" class="anchor"></a>

                        <span class="comment">\ This is the entry point for the tracing loop and the</span>
                        <span class="comment">\ point where we record the current pixel in the edge</span>
                        <span class="comment">\ that we are tracing</span>

 <span class="mne">STX</span> <a class="popup variable">xPolygonLeft</a>       <span class="comment">\ This instruction is modified above to the following</span>
                        <span class="comment">\ address:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   Store into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the low byte incremented by 1 when yEdgeStartHi</span>
                        <span class="comment">\ is non-zero</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this stores the current x-coordinate as we step</span>
                        <span class="comment">\ along the edge, storing the coordinate in either the</span>
                        <span class="comment">\ xPolygonRight or xPolygonLeft table, and storing the</span>
                        <span class="comment">\ coordinate in the offset given by the y-coordinate</span>
                        <span class="comment">\ of the current position along the edge we are tracing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The ModifyStoringCode routine modifies the instruction</span>
                        <span class="comment">\ further, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>

 <span class="mne">DEC</span> <a class="popup variable">tred41</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the</span>
                        <span class="comment">\ instruction above so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred43</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis,</span>
                        <span class="comment">\ so jump to tred43 to finish off</span>

<span class="label">.tred42</span><a id="tred42" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">U</a>                  <span class="comment">\ Decrement the pixel counter in U</span>

 <span class="mne">BNE</span> <a class="popup destination">tred39</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ Jump to tred16 to return from the subroutine and stop</span>
                        <span class="comment">\ the trace</span>

<span class="label">.tred43</span><a id="tred43" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ Decrement the high byte of the current y-coordinate</span>
                        <span class="comment">\ to keep moving along the y-axis</span>

 <span class="mne">BPL</span> <a class="popup destination">tred44</a>             <span class="comment">\ If yEdgeStartHi is positive then we haven't gone off</span>
                        <span class="comment">\ the left edge of the screen, so jump to tred44 to</span>
                        <span class="comment">\ keep going</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ Jump to tred16 to return from the subroutine and stop</span>
                        <span class="comment">\ the trace</span>

<span class="label">.tred44</span><a id="tred44" class="anchor"></a>

 <span class="mne">BNE</span> <a class="popup destination">tred42</a>             <span class="comment">\ If yEdgeStartHi is non-zero, jump to tred42 to keep</span>
                        <span class="comment">\ working along the edge with the same y-coordinate ???</span>

 <span class="mne">DEC</span> <a class="popup variable">tred41</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the</span>
                        <span class="comment">\ instruction above so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">JSR</span> <a class="popup destination">ModifyStoringCode</a>  <span class="comment">\ Modify the instruction at tred41 and set drawPolygon</span>
                        <span class="comment">\ and Y according to the values of xEdgeStartHi and</span>
                        <span class="comment">\ yEdgeStartHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The instruction at tred41 is modified as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The drawPolygon flag is set as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawPolygon = 0 when yEdgeStartHi = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">tred42</a>             <span class="comment">\ Jump to tred42 to keep working along the edge</span>

<span class="label">.tred45</span><a id="tred45" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis and</span>
                        <span class="comment">\ updates the high byte in xEdgeStartHi accordingly</span>

 <span class="mne">JSR</span> <a class="popup destination">ModifyStoringCode</a>  <span class="comment">\ Modify the instruction at tred41 and set drawPolygon</span>
                        <span class="comment">\ and Y according to the values of xEdgeStartHi and</span>
                        <span class="comment">\ yEdgeStartHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The instruction at tred41 is modified as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The drawPolygon flag is set as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawPolygon = 0 when yEdgeStartHi = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">tred41</a>             <span class="comment">\ Jump to tred41 to restart the loop</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tracepolygonedge-part-8-of-8" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 8 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge with a shallow gradient by stepping along the</span>
             <span class="headerEntry">x-axis (for two-byte x-coordinates)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/tracepolygonedge_part_8_of_8.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ If we get here then xEdgeDelta >= yEdgeDelta, so the</span>
                        <span class="comment">\ x-axis delta is the biggest and the polygon edge has a</span>
                        <span class="comment">\ shallow gradient</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore step along the x-axis one pixel at a time</span>
                        <span class="comment">\ and cumulatively add the gradient to calculate the</span>
                        <span class="comment">\ y-coordinate at each step</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We get here with the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (A Y) = (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * X = the opcode for DEX or INX</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * T = the opcode for DEC zp or INC zp</span>

<span class="label">.tred46</span><a id="tred46" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tred50</a><span class="operator">+</span><span class="decimal">2</span>           <span class="comment">\ Modify the instruction at tred50 to use the address in</span>
                        <span class="comment">\ (A Y), starting with the high byte</span>

 <span class="mne">STX</span> <a class="popup variable">tred48</a>             <span class="comment">\ Modify the instruction at tred48 to use the opcode</span>
                        <span class="comment">\ specified in X, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX when xEdgeStart - xEdgeEnd is positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX when xEdgeStart - xEdgeEnd is negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We store the x-coordinate in X, so this ensures that:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step left when required with DEX, for when the</span>
                        <span class="comment">\     start point is to the right of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We step right when required with INX, for when the</span>
                        <span class="comment">\     start point is to the left of the end point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will run this instruction for each step along the</span>
                        <span class="comment">\ edge, so we step along the x-axis as we trace the edge</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ If yEdgeStartHi = 0 then the start point is below the</span>
 <span class="mne">BEQ</span> <a class="popup destination">tred47</a>             <span class="comment">\ top edge of the screen, so skip the following</span>
                        <span class="comment">\ instruction</span>

 <span class="mne">INY</span>                    <span class="comment">\ The start point is above the top edge of the screen,</span>
                        <span class="comment">\ so increment the low byte of (A Y) ???</span>

<span class="label">.tred47</span><a id="tred47" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">tred50</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Modify the instruction at tred50 to use the address in</span>
                        <span class="comment">\ (A Y), so it becomes:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   STX into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the low byte incremented by 1 when yEdgeStartHi</span>
                        <span class="comment">\ is non-zero</span>
                        <span class="comment">\</span>
                        <span class="comment">\ xPolygonAddrHi is set to the high byte of either</span>
                        <span class="comment">\ xPolygonLeft or xPolygonRight, and both of these</span>
                        <span class="comment">\ tables start on a page boundary, so this sets the</span>
                        <span class="comment">\ address to offset yEdgeStartLo within the table</span>
                        <span class="comment">\ specified by xPolygonAddrHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will decrement this address when we need to step</span>
                        <span class="comment">\ along the y-axis, according to the cumulative value of</span>
                        <span class="comment">\ the slope error</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Modify the instruction at tred53 to use the opcode</span>
 <span class="mne">STA</span> <a class="popup variable">tred53</a>             <span class="comment">\ specified in T, so we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis and</span>
                        <span class="comment">\ updates the high byte in xEdgeStartHi accordingly</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We will run this instruction when we need to step</span>
                        <span class="comment">\ along the x-axis and update the high byte of the</span>
                        <span class="comment">\ address in the process</span>

 <span class="mne">LDY</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set A = ~(xEdgeDelta / 2)</span>
 <span class="mne">TYA</span>                    <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ We use A to keep track of the slope error ???</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="hex">&FF</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the first addition we do in the</span>
                        <span class="comment">\ following loop will work correctly</span>

 <span class="mne">INY</span>                    <span class="comment">\ Set U = xEdgeDelta + 1</span>
 <span class="mne">STY</span> <a class="popup variable">U</a>                  <span class="comment">\</span>
                        <span class="comment">\ We can use this as a pixel counter when stepping along</span>
                        <span class="comment">\ the polygon edge's x-axis delta one pixel at a time,</span>
                        <span class="comment">\ as there are xEdgeDelta + 1 pixels along the edge</span>
                        <span class="comment">\ (the additional one ensures we include the pixels at</span>
                        <span class="comment">\ both ends)</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

 <span class="mne">JSR</span> <a class="popup destination">ModifyStoringCode</a>  <span class="comment">\ Modify the instruction at tred50 and set drawPolygon</span>
                        <span class="comment">\ and Y according to the values of xEdgeStartHi and</span>
                        <span class="comment">\ yEdgeStartHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The instruction at tred50 is modified as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The drawPolygon flag is set as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawPolygon = 0 when yEdgeStartHi = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">tred50</a>             <span class="comment">\ Jump into the middle of the loop at tred50</span>

<span class="label">.tred48</span><a id="tred48" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">CPX</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set the status flags on the comparison of X and</span>
                        <span class="comment">\ yEdgeDeltaHi</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the comparison won't affect the</span>
                        <span class="comment">\ arithmetic in this loop</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred53</a>             <span class="comment">\ If X = yEdgeDeltaHi, jump to tred53 to step along the</span>
                        <span class="comment">\ x-axis by updating the high byte in xEdgeStartHi</span>

<span class="label">.tred49</span><a id="tred49" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Add the y-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ x-axis</span>

 <span class="mne">BCC</span> <a class="popup destination">tred50</a>             <span class="comment">\ If the addition didn't overflow then we have not moved</span>
                        <span class="comment">\ into a new y-coordinate with this step along the</span>
                        <span class="comment">\ x-axis, so jump to tred50 so we do not move along the</span>
                        <span class="comment">\ y-axis</span>

                        <span class="comment">\ If we get here then the addition overflowed and the</span>
                        <span class="comment">\ cumulative slope error along the y-axis has added up</span>
                        <span class="comment">\ to a whole pixel, so we now need to step along the</span>
                        <span class="comment">\ y-axis by a pixel</span>

 <span class="mne">SBC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set A = A - xEdgeDelta ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

 <span class="mne">DEC</span> <a class="popup variable">tred50</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the</span>
                        <span class="comment">\ instruction below so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred51</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis,</span>
                        <span class="comment">\ so jump to tred51 to finish off</span>

<span class="label">.tred50</span><a id="tred50" class="anchor"></a>

                        <span class="comment">\ This is the entry point for the tracing loop and the</span>
                        <span class="comment">\ point where we record the current pixel in the edge</span>
                        <span class="comment">\ that we are tracing</span>

 <span class="mne">STX</span> <a class="popup variable">xPolygonLeft</a>       <span class="comment">\ This instruction is modified above to the following</span>
                        <span class="comment">\ address:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   Store into address (xPolygonAddrHi yEdgeStartLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the low byte incremented by 1 when yEdgeStartHi</span>
                        <span class="comment">\ is non-zero</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this stores the current x-coordinate as we step</span>
                        <span class="comment">\ along the edge, storing the coordinate in either the</span>
                        <span class="comment">\ xPolygonRight or xPolygonLeft table, and storing the</span>
                        <span class="comment">\ coordinate in the offset given by the y-coordinate</span>
                        <span class="comment">\ of the current position along the edge we are tracing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The ModifyStoringCode routine modifies the instruction</span>
                        <span class="comment">\ further, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>

 <span class="mne">DEC</span> <a class="popup variable">U</a>                  <span class="comment">\ Decrement the pixel counter in U</span>

 <span class="mne">BNE</span> <a class="popup destination">tred48</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ x-axis</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ Jump to tred16 to return from the subroutine and stop</span>
                        <span class="comment">\ the trace</span>

<span class="label">.tred51</span><a id="tred51" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ Decrement the high byte of the current y-coordinate</span>
                        <span class="comment">\ to keep moving along the y-axis</span>

 <span class="mne">BPL</span> <a class="popup destination">tred52</a>             <span class="comment">\ If yEdgeStartHi is positive then we haven't gone off</span>
                        <span class="comment">\ the left edge of the screen, so jump to tred52 to</span>
                        <span class="comment">\ keep going</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ Jump to tred16 to return from the subroutine and stop</span>
                        <span class="comment">\ the trace</span>

<span class="label">.tred52</span><a id="tred52" class="anchor"></a>

 <span class="mne">BNE</span> <a class="popup destination">tred50</a>             <span class="comment">\ If yEdgeStartHi is non-zero, jump to tred50 to keep</span>
                        <span class="comment">\ working along the edge with the same y-coordinate ???</span>

 <span class="mne">DEC</span> <a class="popup variable">tred50</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the</span>
                        <span class="comment">\ instruction above so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">JSR</span> <a class="popup destination">ModifyStoringCode</a>  <span class="comment">\ Modify the instruction at tred41 and set drawPolygon</span>
                        <span class="comment">\ and Y according to the values of xEdgeStartHi and</span>
                        <span class="comment">\ yEdgeStartHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The instruction at tred41 is modified as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The drawPolygon flag is set as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawPolygon = 0 when yEdgeStartHi = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">tred50</a>             <span class="comment">\ Jump to tred50 to keep working along the edge</span>

<span class="label">.tred53</span><a id="tred53" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INC xEdgeStartHi when xEdgeStart - xEdgeEnd is</span>
                        <span class="comment">\     negative</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis and</span>
                        <span class="comment">\ updates the high byte in xEdgeStartHi accordingly</span>

 <span class="mne">JSR</span> <a class="popup destination">ModifyStoringCode</a>  <span class="comment">\ Modify the instruction at tred41 and set drawPolygon</span>
                        <span class="comment">\ and Y according to the values of xEdgeStartHi and</span>
                        <span class="comment">\ yEdgeStartHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The instruction at tred41 is modified as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * BIT when yEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STY when yEdgeStartHi = 0 and xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * STX when yEdgeStartHi = 0 and xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The drawPolygon flag is set as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawPolygon = 0 when yEdgeStartHi = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">tred49</a>             <span class="comment">\ Jump to tred49 to restart the loop</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-corruptsecretcode" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CorruptSecretCode</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Corrupt the generation process for the landscape's secret code by</span>
             <span class="headerEntry">fetching one more seed number than necessary</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/corruptsecretcode.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkcrackerseed.html">CheckCrackerSeed</a> calls <a href="#corruptsecretcode">CorruptSecretCode</a></span>
</div>
</div></div>
<span class="label">.CorruptSecretCode</span><a id="corruptsecretcode" class="anchor"></a>

 <span class="mne">BCC</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ We only jump here with the C flag clear, so this</span>
                        <span class="comment">\ generates the next number from the landscape's</span>
                        <span class="comment">\ sequence of seed numbers, thus corrupting the</span>
                        <span class="comment">\ generation of the landscape's secret code</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We then return to the caller using a tail call, so the</span>
                        <span class="comment">\ player doesn't know anything has gone wrong</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-modifystoringcode" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ModifyStoringCode</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Modify the code in TracePolygonEdge that stores the coordinates of</span>
             <span class="headerEntry">the polygon edge that is being traced</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/modifystoringcode.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/tracepolygonedge_part_7_of_8.html">TracePolygonEdge (Part 7 of 8)</a> calls <a href="#modifystoringcode">ModifyStoringCode</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/tracepolygonedge_part_8_of_8.html">TracePolygonEdge (Part 8 of 8)</a> calls <a href="#modifystoringcode">ModifyStoringCode</a></span>
</div>
<hr class="light">
 This routine modifies the code in part 6 of TracePolygonEdge that stores the
 x-coordinates of the polygon edge and sets the values of drawPolygon and Y as
 we trace the edge:

                                yEdgeStartHi = 0             yEdgeStartHi &lt;&gt; 0

   xEdgeStartHi &lt; 0       STY, drawPolygon = 0, Y = 0              BIT

   xEdgeStartHi = 0       STX, drawPolygon = 0                     BIT

   xEdgeStartHi &gt; 0       STY, drawPolygon = 0, Y = 255            BIT

 Note that the value of Y doesn't appear to be used anywhere.

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">A is preserved</span>

</div></div>
<span class="label">.ModifyStoringCode</span><a id="modifystoringcode" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store A on the stack so we can preserve it</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\ If yEdgeStartHi = 0 then jump to stor1</span>
 <span class="mne">BEQ</span> <a class="popup destination">stor1</a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yEdgeStartHi &lt;> 0</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&2C</span>               <span class="comment">\ Set A to the opcode for the BIT addr instruction, so</span>
                        <span class="comment">\ the TracePolygonEdge routine does not store anything</span>
                        <span class="comment">\ in the xPolygonLeft or xPolygonRight table (as the BIT</span>
                        <span class="comment">\ instruction has no effect beyond setting the status</span>
                        <span class="comment">\ flags)</span>

 <span class="mne">BNE</span> <a class="popup destination">stor5</a>              <span class="comment">\ Jump to stor5 to modify the instructions at tred41 and</span>
                        <span class="comment">\ tred50 (this BNE is effectively a JMP as A is never</span>
                        <span class="comment">\ zero)</span>

<span class="label">.stor1</span><a id="stor1" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and A = 0</span>

 <span class="mne">STA</span> <a class="popup variable">drawPolygon</a>        <span class="comment">\ Set drawPolygon = 0 so the polygon gets drawn</span>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ If xEdgeStartHi &lt;> 0 then jump to stor2</span>
 <span class="mne">BNE</span> <a class="popup destination">stor2</a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yEdgeStartHi = 0</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&8E</span>               <span class="comment">\ Set A to the opcode for the STX addr instruction, so</span>
                        <span class="comment">\ the TracePolygonEdge routine stores the value of X</span>
                        <span class="comment">\ into the xPolygonLeft or xPolygonRight table</span>

 <span class="mne">BNE</span> <a class="popup destination">stor5</a>              <span class="comment">\ Jump to stor5 to modify the instructions at tred41 and</span>
                        <span class="comment">\ tred50 (this BNE is effectively a JMP as A is never</span>
                        <span class="comment">\ zero)</span>

<span class="label">.stor2</span><a id="stor2" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xEdgeStartHi &lt;> 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yEdgeStartHi = 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the flags are set according to the value of</span>
                        <span class="comment">\ xEdgeStartHi</span>

 <span class="mne">BPL</span> <a class="popup destination">stor3</a>              <span class="comment">\ If xEdgeStartHi is positive, jump to stor3</span>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xEdgeStartHi &lt; 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yEdgeStartHi = 0</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0</span>

 <span class="mne">JMP</span> <a class="popup destination">stor4</a>              <span class="comment">\ Jump to stor4 to modify the code to use STY</span>

<span class="label">.stor3</span><a id="stor3" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xEdgeStartHi > 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yEdgeStartHi = 0</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ Set Y = 255</span>

<span class="label">.stor4</span><a id="stor4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&8C</span>               <span class="comment">\ Set A to the opcode for the STY addr instruction, so</span>
                        <span class="comment">\ the TracePolygonEdge routine stores the value of Y</span>
                        <span class="comment">\ into the xPolygonLeft or xPolygonRight table</span>

<span class="label">.stor5</span><a id="stor5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tred41</a>             <span class="comment">\ Modify the instruction at tred41 to use the opcode</span>
                        <span class="comment">\ specified in A</span>

 <span class="mne">STA</span> <a class="popup variable">tred50</a>             <span class="comment">\ Modify the instruction at tred50 to use the opcode</span>
                        <span class="comment">\ specified in A</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Restore the value of A that we stored on the stack</span>
                        <span class="comment">\ above</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getnextseednumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetNextSeedNumber</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set A to a seed number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getnextseednumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/addenemiestotiles.html">AddEnemiesToTiles</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/corruptsecretcode.html">CorruptSecretCode</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/generatelandscape.html">GenerateLandscape</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getenemycount.html">GetEnemyCount</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getnextseed0to22.html">GetNextSeed0To22</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getnextseed0to30.html">GetNextSeed0To30</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getnextseedasbcd.html">GetNextSeedAsBCD</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/moveontonextenemy.html">MoveOnToNextEnemy</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/placeobjectontile.html">PlaceObjectOnTile</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processsound.html">ProcessSound</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processtiledata.html">ProcessTileData</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnsecretcode3d.html">SpawnSecretCode3D</a> calls <a href="#getnextseednumber">GetNextSeedNumber</a></span>
</div>
<hr class="light">
 Seed numbers in The Sentinel are produced using a five-byte (40-bit) linear
 feedback shift register (LFSR) with EOR feedback.

 Specifically, to generate a new seed number, we shift the LFSR left by eight
 places, and on each shift we insert the EOR of bits 19 and 32 into bit 0 of
 the register. After eight shifts, the top byte is our next seed number.

</div></div>
<span class="label">.GetNextSeedNumber</span><a id="getnextseednumber" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">yStoreNextSeed</a>     <span class="comment">\ Store Y in yStoreNextSeed so it can be preserved</span>
                        <span class="comment">\ across calls to the routine</span>

                        <span class="comment">\ We generate a new seed number by shifting the</span>
                        <span class="comment">\ five-byte linear feedback shift register in</span>
                        <span class="comment">\ seedNumberLFSR(4 3 2 1 0) by eight places, inserting</span>
                        <span class="comment">\ EOR feedback as we do so</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set a shift counter in Y</span>

<span class="label">.rand1</span><a id="rand1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ Apply EOR feedback to the linear feedback shift</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ register by taking the middle byte seedNumberLFSR+2,</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ shifting it right by three places, EOR'ing it with</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ seedNumberLFSR+4 in the output end of the shift</span>
 <span class="mne">EOR</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">4</span>   <span class="comment">\ register and rotating bit 0 of the result into the C</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ flag</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the same as taking bit 3 of seedNumberLFSR+2</span>
                        <span class="comment">\ and EOR'ing it with bit 0 of seedNumberLFSR+4 into the</span>
                        <span class="comment">\ C flag</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now use the C flag as the next input bit into the</span>
                        <span class="comment">\ shift register</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this is the same as EOR'ing bits 19 and 32 of our</span>
                        <span class="comment">\ 40-bit register and shifting the result into bit 0 of</span>
                        <span class="comment">\ the register</span>

 <span class="mne">ROL</span> <a class="popup variable">seedNumberLFSR</a>     <span class="comment">\ Shift seedNumberLFSR(4 3 2 1 0) to the left by one</span>
 <span class="mne">ROL</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ place, inserting the C flag into bit 0 of the input</span>
 <span class="mne">ROL</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ end of the shift register in seedNumberLFSR</span>
 <span class="mne">ROL</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">3</span>
 <span class="mne">ROL</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">4</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the shift counter</span>

 <span class="mne">BNE</span> <a class="popup destination">rand1</a>              <span class="comment">\ Loop back until we have shifted eight times</span>

 <span class="mne">LDY</span> <a class="popup variable">yStoreNextSeed</a>     <span class="comment">\ Restore the value of Y from yStoreNextSeed that we</span>
                        <span class="comment">\ stored at the start of the routine, so that it's</span>
                        <span class="comment">\ preserved</span>

 <span class="mne">LDA</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">4</span>   <span class="comment">\ Set A to the output end of the shift register in</span>
                        <span class="comment">\ seedNumberLFSR+4 to give us our next seed number</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ystorenextseed" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">yStoreNextSeed</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Temporary storage for Y so it can be preserved through calls to</span>
             <span class="headerEntry">GetNextSeedNumber</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/ystorenextseed.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getnextseednumber.html">GetNextSeedNumber</a> uses <a href="#ystorenextseed">yStoreNextSeed</a></span>
</div>
</div></div>
<span class="label">.yStoreNextSeed</span><a id="ystorenextseed" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-printnumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PrintNumber</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print a number as a single digit, printing zero as a capital "O"</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/printnumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/print2digitbcd.html">Print2DigitBCD</a> calls <a href="#printnumber">PrintNumber</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number to be printed (0 to 9)</span>

</div></div>
<span class="label">.PrintNumber</span><a id="printnumber" class="anchor"></a>

 <span class="mne">CLC</span>                    <span class="comment">\ Convert the number in A into an ASCII digit by adding</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ ASCII "0"</span>

                        <span class="comment">\ Fall into PrintDigit to print the digit in A</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-printdigit" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PrintDigit</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print a numerical digit, printing zero as a capital "O"</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/printdigit.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/printinputbuffer.html">PrintInputBuffer</a> calls <a href="#printdigit">PrintDigit</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The numerical digit to be printed as an ASCII code</span>

</div></div>
<span class="label">.PrintDigit</span><a id="printdigit" class="anchor"></a>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ If the character in A is not a zero, jump to zero1 to</span>
 <span class="mne">BNE</span> <a class="popup destination">zero1</a>              <span class="comment">\ skip the following</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="character">'O'</span>               <span class="comment">\ The character in A is a zero, so set A to ASCII "O" so</span>
                        <span class="comment">\ we print zero as capital "O" instead</span>

<span class="label">.zero1</span><a id="zero1" class="anchor"></a>

 <span class="mne">BIT</span> <a class="popup variable">printTextIn3D</a>      <span class="comment">\ If bit 7 of printTextIn3D is set then we are printing</span>
 <span class="mne">BMI</span> <a class="popup destination">SpawnCharacter3D</a>   <span class="comment">\ 3D text, so jump to SpawnCharacter3D to spawn the</span>
                        <span class="comment">\ character in 3D text blocks</span>

 <span class="mne">JMP</span> <a class="popup destination">PrintCharacter</a>     <span class="comment">\ Otherwise jump to PrintCharacter to print the single-</span>
                        <span class="comment">\ byte VDU command or character in A, returning from the</span>
                        <span class="comment">\ subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawncharacter3d-part-1-of-2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnCharacter3D (Part 1 of 2)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Spawn a character on the landscape in large 3D blocks for drawing</span>
             <span class="headerEntry">on the main title screen or secret code screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawncharacter3d_part_1_of_2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#spawncharacter3d">SpawnCharacter3D</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/printdigit.html">PrintDigit</a> calls <a href="#spawncharacter3d">SpawnCharacter3D</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnsecretcode3d.html">SpawnSecretCode3D</a> calls <a href="#spawncharacter3d">SpawnCharacter3D</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The character to be spawned or the tile coordinates of</span>
                        <span class="argumentEntry">the character on the landscape:</span>

                        <span class="argumentEntry">  * %00xxxxxx = bits 0-5 contain the ASCII code of the</span>
                        <span class="argumentEntry">                character to spawn</span>

                        <span class="argumentEntry">  * %10xxxxxx = bits 0-4 contain the tile x-coordinate</span>
                        <span class="argumentEntry">                of the character on the landscape</span>

                        <span class="argumentEntry">  * %11xxxxxx = bits 0-4 contain the tile z-coordinate</span>
                        <span class="argumentEntry">                of the character on the landscape</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">X is preserved</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">Y is preserved</span>

</div></div>
<span class="label">.SpawnCharacter3D</span><a id="spawncharacter3d" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the character on the stack so we can retrieve it</span>
                        <span class="comment">\ below</span>

 <span class="mne">STA</span> <a class="popup variable">characterDef</a>       <span class="comment">\ Store the character in the first byte of the OSWORD</span>
                        <span class="comment">\ block at characterDef, so we can extract the operating</span>
                        <span class="comment">\ system's character definition (if this is a printable</span>
                        <span class="comment">\ character)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Clear all bits of the character number except for bits</span>
                        <span class="comment">\ 6 and 7</span>

 <span class="mne">BPL</span> <a class="popup destination">spac2</a>              <span class="comment">\ If bit 7 is clear then this is a printable character,</span>
                        <span class="comment">\ so jump to spac2 to spawn the character in 3D text</span>
                        <span class="comment">\ blocks</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Bit 7 is set so this is a tile coordinate, so extract</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ bit 6 of the character number into the C flag</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the character number from the stack and</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00011111</span>         <span class="comment">\ extract bits 0-4 to get the coordinate value</span>

 <span class="mne">BCS</span> <a class="popup destination">spac1</a>              <span class="comment">\ If bit 6 of the original character number is set then</span>
                        <span class="comment">\ this is a tile z-coordinate, so jump to spac1 to set</span>
                        <span class="comment">\ zTileCharacter</span>

 <span class="mne">STA</span> <a class="popup variable">xTileCharacter</a>     <span class="comment">\ Bit 6 of the original character number is clear, so</span>
                        <span class="comment">\ store bits 0-4 in xTileCharacter, so we can spawn the</span>
                        <span class="comment">\ next printable character that's passed to the routine</span>
                        <span class="comment">\ in the right place</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.spac1</span><a id="spac1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">zTileCharacter</a>     <span class="comment">\ Bit 6 of the original character number is set, so</span>
                        <span class="comment">\ store bits 0-4 in zTileCharacter, so we can spawn the</span>
                        <span class="comment">\ next printable character that's passed to the routine</span>
                        <span class="comment">\ in the right place</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.spac2</span><a id="spac2" class="anchor"></a>

                        <span class="comment">\ If we get here then we have a printable character in A</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Store X and Y on the stack to we can preserve them</span>
 <span class="mne">PHA</span>
 <span class="mne">TYA</span>
 <span class="mne">PHA</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">characterDef</a><span class="bracket">)</span>  <span class="comment">\ Call OSWORD with A = 10 to extract the operating</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">characterDef</a><span class="bracket">)</span>  <span class="comment">\ system's character definition into the block at</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ characterDef</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWORD</a>             <span class="comment">\</span>
                        <span class="comment">\ The first byte of the block contains the ASCII code</span>
                        <span class="comment">\ of the character (which we stored above), and the call</span>
                        <span class="comment">\ returns the character definition from the second byte</span>
                        <span class="comment">\ onwards</span>

 <span class="mne">LDA</span> <a class="popup variable">zTileCharacter</a>     <span class="comment">\ Set zTile to the z-coordinate where we want to spawn</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ the character</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ We now loop through the top seven rows of the</span>
                        <span class="comment">\ character definition, so set a row counter in X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We actually loop through the character definition</span>
                        <span class="comment">\ from the bottom to top, ignoring the very bottom row</span>
                        <span class="comment">\ of the definition as this is always blank for the</span>
                        <span class="comment">\ capital letters and digits that we are displaying</span>
                        <span class="comment">\ (the bottom row is only used for descenders, and</span>
                        <span class="comment">\ "THE SENTINEL" and landscape digits don't have them)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Instead we insert a blank pixel row at the top of the</span>
                        <span class="comment">\ definition, on the iteration when X is zero</span>

                        <span class="comment">\ We now have a short interlude to check some of the</span>
                        <span class="comment">\ anti-cracker code, so we can corrupt the secret code</span>
                        <span class="comment">\ being drawn on-screen if this landscape has not been</span>
                        <span class="comment">\ played through properly</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checkcrackerseed" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckCrackerSeed</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Check whether the anti-cracker seed-related data is correctly set</span>
             <span class="headerEntry">up, as part of the anti-cracker code</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checkcrackerseed.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.CheckCrackerSeed</span><a id="checkcrackerseed" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">alteredSeed</a><span class="operator">-</span><span class="decimal">7</span>,<span class="register">X</span>    <span class="comment">\ Set A to the value of alteredSeed, which we set in</span>
                        <span class="comment">\ the AlterCrackerSeed routine</span>

 <span class="mne">CMP</span> <a class="popup variable">CrackerSeed</a><span class="operator">+</span><span class="decimal">1</span><span class="operator">-</span><span class="decimal">7</span>,<span class="register">X</span>  <span class="comment">\ If A >= the contents of CrackerSeed+1 then the code</span>
 <span class="mne">BCS</span> <a class="popup destination">csee1</a>              <span class="comment">\ in AlterCrackerSeed was correctly run (which only</span>
                        <span class="comment">\ happens if the gameplay routines are run, i.e. when</span>
                        <span class="comment">\ the landscape has been played), so jump to csee1 to</span>
                        <span class="comment">\ skip the following</span>

                        <span class="comment">\ If we get here then the AlterCrackerSeed routine has</span>
                        <span class="comment">\ not been correctly run, which means the landscape was</span>
                        <span class="comment">\ not played properly, so we now corrupt the secret code</span>
                        <span class="comment">\ that's being drawn on-screen (if that's why we are</span>
                        <span class="comment">\ here)</span>

 <span class="mne">JSR</span> <a class="popup destination">CorruptSecretCode</a>  <span class="comment">\ At this point A &lt; the contents of CrackerSeed+1 and</span>
                        <span class="comment">\ the C flag is clear, so CorruptSecretCode will call</span>
                        <span class="comment">\ the GetNextSeedNumber routine, which will in turn</span>
                        <span class="comment">\ corrupt the generation of the landscape's secret code</span>
                        <span class="comment">\ by moving one step too far in the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

<span class="label">.csee1</span><a id="csee1" class="anchor"></a>
                        <span class="comment">\ Fall through into part 2 of SpawnCharacter3D to</span>
                        <span class="comment">\ continue with the character-spawning process</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawncharacter3d-part-2-of-2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnCharacter3D (Part 2 of 2)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Spawn large 3D blocks for the extracted character definition</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawncharacter3d_part_2_of_2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ We now loop through the top seven rows in the</span>
                        <span class="comment">\ character definition, using X as the row counter</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We draw the character from the bottom up on the</span>
                        <span class="comment">\ landscape, so that's drawing the character rows on</span>
                        <span class="comment">\ the landscape from front the back as we work through</span>
                        <span class="comment">\ the character definition from bottom to top</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The row counter in X therefore iterates from 7 down</span>
                        <span class="comment">\ to 0, with row 7 spawning the blocks for the</span>
                        <span class="comment">\ penultimate row in the character definition, and row 0</span>
                        <span class="comment">\ spawning a blank row (as this moves the blank row in</span>
                        <span class="comment">\ the character definition from the bottom to the top,</span>
                        <span class="comment">\ as discussed in part 1)</span>

<span class="label">.spac3</span><a id="spac3" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">characterDef</a>,<span class="register">X</span>     <span class="comment">\ The leftmost column of each character definition is</span>
                        <span class="comment">\ blank, so that characters are spaced out, so this</span>
                        <span class="comment">\ shifts the character definition row to the left to</span>
                        <span class="comment">\ move this blank column to the right side of the</span>
                        <span class="comment">\ character definition, so the character's 3D blocks</span>
                        <span class="comment">\ start at the correct tile coordinate</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileCharacter</a>     <span class="comment">\ Set xTile to the x-coordinate where we want to spawn</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ the character</span>

                        <span class="comment">\ Each row in the character definition consists of eight</span>
                        <span class="comment">\ bits (where each bit will be represented by a block on</span>
                        <span class="comment">\ the landscape)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In order to get tall characters on-screen, rather than</span>
                        <span class="comment">\ the rather square characters in the operating system's</span>
                        <span class="comment">\ font, we actually draw each character so that it's</span>
                        <span class="comment">\ four tiles wide and eight tiles tall, so each tile</span>
                        <span class="comment">\ contains a pair of blocks that represents a pair of</span>
                        <span class="comment">\ bits in the character definition</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set a loop counter in loopCounter to work through the</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ four pairs in the eight-block row</span>

<span class="label">.spac4</span><a id="spac4" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">characterDef</a>,<span class="register">X</span>     <span class="comment">\ Shift the character definition row to the left by two</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ places and extract the top two bits into bits 0 and 1</span>
 <span class="mne">ASL</span> <a class="popup variable">characterDef</a>,<span class="register">X</span>     <span class="comment">\ of A, so this is the leftmost block pair from this row</span>
 <span class="mne">ROL</span> <span class="register">A</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ Clear bits 2 to 7 of A and store the result in Y, so</span>
 <span class="mne">TAY</span>                    <span class="comment">\ Y contains the bit pattern for the two leftmost bits</span>
                        <span class="comment">\ in the character row</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can now use this as an index into the table that</span>
                        <span class="comment">\ maps bit patterns to object numbers in objBlockNumber</span>

 <span class="mne">LDA</span> <a class="popup variable">objBlockNumber</a>,<span class="register">Y</span>   <span class="comment">\ Fetch the object number of the 3D text block object</span>
                        <span class="comment">\ that matches the bit pair that we just extracted</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This actually fetches the object number + 32, though</span>
                        <span class="comment">\ the 32 part is removed when the block is drawn in the</span>
                        <span class="comment">\ DrawTileAndObjects, so this doesn't seem to have any</span>
                        <span class="comment">\ effect</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the object number on the stack, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 32 + 0 for no blocks in the pair</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 32 + 7 for no block (left), block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 32 + 8 for block (left), no block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 32 + 9 for block (left), no block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This maps the pair to one of the three 3D text block</span>
                        <span class="comment">\ objects</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), which we ignore, but this also sets</span>
                        <span class="comment">\ the tile page in tileDataPage and the index in Y, so</span>
                        <span class="comment">\ tileDataPage+Y now points to the tile data entry in</span>
                        <span class="comment">\ the tileData table</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the object number for the 3D text block pair</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ and store it in the tile data for the tile where we</span>
                        <span class="comment">\ want to spawn this part of the character definition</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that the DrawTileAndObjects routine has separate</span>
                        <span class="comment">\ logic when drawing 3D text, so this doesn't follow the</span>
                        <span class="comment">\ normal tile data rules, and instead we just need the</span>
                        <span class="comment">\ object number in the low nibble, which we fetched from</span>
                        <span class="comment">\ the objBlockNumber above</span>

 <span class="mne">INC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Increment the x-coordinate to move on to the next tile</span>
                        <span class="comment">\ to the right, for the next bit pair</span>

 <span class="mne">DEC</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ Decrement the loop counter to move onto the next bit</span>
                        <span class="comment">\ pair in the character definition</span>

 <span class="mne">BNE</span> <a class="popup destination">spac4</a>              <span class="comment">\ Loop back to spawn the next bit pair's objects until</span>
                        <span class="comment">\ we have done all four pairs in the character row</span>

 <span class="mne">INC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Increment the z-coordinate to move backwards to the</span>
                        <span class="comment">\ tile row behind in the landscape</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the character row counter in X</span>

 <span class="mne">BMI</span> <a class="popup destination">spac5</a>              <span class="comment">\ If we just spawned row 0 then X will now be negative,</span>
                        <span class="comment">\ so jump to spac5 to finish off as we have spawned all</span>
                        <span class="comment">\ eight character rows</span>

 <span class="mne">BNE</span> <a class="popup destination">spac3</a>              <span class="comment">\ Otherwise loop back until we have spawned rows 7 to 1</span>

                        <span class="comment">\ If we get here then we just spawned row 1, so now we</span>
                        <span class="comment">\ need to spawn a blank for row 0</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the character definition row that we will use</span>
 <span class="mne">STA</span> <a class="popup variable">characterDef</a>       <span class="comment">\ when X is 0, so we don't spawn any blocks for the top</span>
                        <span class="comment">\ row of the 3D text block character</span>

 <span class="mne">BEQ</span> <a class="popup destination">spac3</a>              <span class="comment">\ Jump to spac3 to spawn row 0 (this BEQ is effectively</span>
                        <span class="comment">\ a JMP as A is always zero)</span>

<span class="label">.spac5</span><a id="spac5" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTileCharacter</a>     <span class="comment">\ We just spawned a character in the landscape, so add 4</span>
 <span class="mne">CLC</span>                    <span class="comment">\ to xTileCharacter so the next character gets spawned</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ to the right of the one we just spawned</span>
 <span class="mne">STA</span> <a class="popup variable">xTileCharacter</a>

 <span class="mne">PLA</span>                    <span class="comment">\ Pull A from the stack to reverse the push that we did</span>
                        <span class="comment">\ at the start of the routine</span>

 <span class="mne">TAY</span>                    <span class="comment">\ Retrieve X and Y from the stack so they are preserved</span>
 <span class="mne">PLA</span>
 <span class="mne">TAX</span>
 <span class="mne">PLA</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-objblocknumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">objBlockNumber</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A lookup table to convert bit pairs into object numbers for</span>
             <span class="headerEntry">spawning 3D text blocks on the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/objblocknumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawncharacter3d_part_2_of_2.html">SpawnCharacter3D (Part 2 of 2)</a> uses <a href="#objblocknumber">objBlockNumber</a></span>
</div>
</div></div>
<span class="label">.objBlockNumber</span><a id="objblocknumber" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">+</span> <span class="decimal">0</span>            <span class="comment">\ %00 = no block (left), no block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ No 3D text blocks are required, so set the object</span>
                        <span class="comment">\ number to 0 to indicate no object</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">+</span> <span class="decimal">7</span>            <span class="comment">\ %01 = no block (left), block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the shape of 3D text block 1, which is object</span>
                        <span class="comment">\ type 7</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">+</span> <span class="decimal">8</span>            <span class="comment">\ %10 = block (left), no block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the shape of 3D text block 2, which is object</span>
                        <span class="comment">\ type 8</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">+</span> <span class="decimal">9</span>            <span class="comment">\ %11 = block (left), no block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the shape of 3D text block 3, which is object</span>
                        <span class="comment">\ type 9</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawtitlescreen" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTitleScreen</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the title screen or the screen showing the secret code</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawtitlescreen.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#drawtitlescreen">DrawTitleScreen</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#drawtitlescreen">DrawTitleScreen</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/secretcodeerror.html">SecretCodeError</a> calls <a href="#drawtitlescreen">DrawTitleScreen</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">Determines the type of screen to draw:</span>

                        <span class="argumentEntry">  * If bit 7 = 0 then draw the title screen</span>

                        <span class="argumentEntry">  * If bit 7 = 1 then draw the secret code screen</span>

</div></div>
<span class="label">.DrawTitleScreen</span><a id="drawtitlescreen" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">screenType</a>         <span class="comment">\ Store the screen type in A in screenType, so we can</span>
                        <span class="comment">\ refer to it below</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">128</span>               <span class="comment">\ Set objectYawAngle+63 = 128</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a><span class="operator">+</span><span class="decimal">63</span>  <span class="comment">\</span>
                        <span class="comment">\ The degree system in the Sentinel looks like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\            0</span>
                        <span class="comment">\      -32   |   +32         Overhead view of object</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /             0 = looking straight ahead</span>
                        <span class="comment">\           \|/              +64 = looking sharp right</span>
                        <span class="comment">\   -64 -----+----- +64      -64 = looking sharp left</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment">\          / | \</span>
                        <span class="comment">\         /  |  \</span>
                        <span class="comment">\      -96   |   +96</span>
                        <span class="comment">\           128</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this makes object #63 face directly out of the</span>
                        <span class="comment">\ screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&E0</span>               <span class="comment">\ For object #63, set the following:</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a><span class="operator">+</span><span class="decimal">63</span>       <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&02</span>               <span class="comment">\   yObject(Hi Lo) = &2E0</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectHi</a><span class="operator">+</span><span class="decimal">63</span>       <span class="comment">\</span>
                        <span class="comment">\ So this sets the altitude of object #63 to just under</span>
                        <span class="comment">\ three full block heights (2.875, to be precise)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use object #63 for drawing the 3D text blocks in</span>
                        <span class="comment">\ the game title in the main title screen, or the code</span>
                        <span class="comment">\ in the secret code screen, so this ensures that the</span>
                        <span class="comment">\ text blocks are drawn at the correct height to get the</span>
                        <span class="comment">\ title effect</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of drawingTitleScreen to indicate that we</span>
 <span class="mne">ROR</span> <a class="popup variable">drawingTitleScreen</a> <span class="comment">\ are drawing a title screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call ProcessTileData with A = 0 to zero the tile data</span>
 <span class="mne">JSR</span> <a class="popup destination">ProcessTileData</a>    <span class="comment">\ for the whole landscape</span>

 <span class="mne">BIT</span> <a class="popup variable">screenType</a>         <span class="comment">\ If bit 7 of the screen type is clear, jump to titl1 to</span>
 <span class="mne">BPL</span> <a class="popup destination">titl1</a>              <span class="comment">\ draw "THE SENTINEL" in large 3D text for the main</span>
                        <span class="comment">\ title screen</span>

                        <span class="comment">\ If we get here then bit 7 of the argument is set, so</span>
                        <span class="comment">\ we now draw the secret code</span>

 <span class="mne">JSR</span> <a class="popup destination">SpawnSecretCode3D</a>  <span class="comment">\ Spawn the secret code in large 3D text blocks</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set X = 3 to pass to DrawTitleView so the background</span>
                        <span class="comment">\ of the secret code screen is black with stars</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so the call to DrawTitleView draws a robot</span>
                        <span class="comment">\ on the right of the screen</span>

 <span class="mne">BEQ</span> <a class="popup destination">titl3</a>              <span class="comment">\ Jump to titl3 to skip the following and draw the robot</span>
                        <span class="comment">\ (this BEQ is effectively a JMP as A is always zero)</span>

<span class="label">.titl1</span><a id="titl1" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now look through all the characters in the title</span>
                        <span class="comment">\ text, drawing each one in turn, so set X as a</span>
                        <span class="comment">\ character index</span>

<span class="label">.titl2</span><a id="titl2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">titleText</a>,<span class="register">X</span>        <span class="comment">\ Set A to the X-th character in the title text</span>

 <span class="mne">JSR</span> <a class="popup destination">SpawnCharacter3D</a>   <span class="comment">\ Spawn the 3D text blocks for drawing the character in</span>
                        <span class="comment">\ A in large 3D text</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the character index</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">15</span>                <span class="comment">\ Loop back until we have drawn all 15 characters in the</span>
 <span class="mne">BCC</span> <a class="popup destination">titl2</a>              <span class="comment">\ title text</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set X = 1 to pass to DrawTitleView so the background</span>
                        <span class="comment">\ of the landscape preview is solid blue</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\ Set A = 5 so the call to DrawTitleView draws the</span>
                        <span class="comment">\ Sentinel on the right of the screen</span>

<span class="label">.titl3</span><a id="titl3" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set Y = 1 to pass to DrawTitleView so it draws the</span>
                        <span class="comment">\ screen with the correct perspective for the title</span>
                        <span class="comment">\ screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTitleView</a>      <span class="comment">\ Draw the title screen with the object and background</span>
                        <span class="comment">\ defined in A and X</span>

 <span class="mne">LSR</span> <a class="popup variable">drawingTitleScreen</a> <span class="comment">\ Clear bit 7 of drawingTitleScreen to indicate we are</span>
                        <span class="comment">\ no longer drawing a title screen</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-screentype" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">screenType</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A variable that determines whether we are drawing the title screen</span>
             <span class="headerEntry">or the secret code screen in the DrawTitleScreen routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/screentype.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> uses <a href="#screentype">screenType</a></span>
</div>
</div></div>
<span class="label">.screenType</span><a id="screentype" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-titletext" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">titleText</span>                                               <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The text to draw on the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/titletext.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> uses <a href="#titletext">titleText</a></span>
</div>
</div></div>
<span class="label">.titleText</span><a id="titletext" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%10000000</span> <span class="operator">+</span> <span class="decimal">4</span>     <span class="comment">\ Move to tile coordinate (4, 21), towards the back of</span>
 <span class="mne">EQUB</span> <span class="binary">%11000000</span> <span class="operator">+</span> <span class="decimal">21</span>    <span class="comment">\ the landscape</span>

 <span class="mne">EQUS</span> <span class="string">"THE"</span>             <span class="comment">\ Draw "THE" in 3D text blocks</span>

 <span class="mne">EQUB</span> <span class="binary">%10000000</span> <span class="operator">+</span> <span class="decimal">0</span>     <span class="comment">\ Move to tile coordinate (0, 7), which is further</span>
 <span class="mne">EQUB</span> <span class="binary">%11000000</span> <span class="operator">+</span> <span class="decimal">7</span>     <span class="comment">\ forward and a bit to the left</span>

 <span class="mne">EQUS</span> <span class="string">"SENTINEL"</span>        <span class="comment">\ Draw "SENTINEL" in 3D text blocks</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-readnumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ReadNumber</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Read a number from the keyboard into the input buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/readnumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#readnumber">ReadNumber</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The maximum number of digits to read</span>

</div></div>
<span class="label">.ReadNumber</span><a id="readnumber" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set T to the maximum number of digits to read</span>

 <span class="mne">JSR</span> <a class="popup destination">EnableKeyboard</a>     <span class="comment">\ Select the keyboard as the input stream and flush the</span>
                        <span class="comment">\ keyboard buffer</span>

                        <span class="comment">\ We start by clearing the input buffer by filling it</span>
                        <span class="comment">\ with spaces</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ The input buffer is eight bytes long, so set a byte</span>
                        <span class="comment">\ counter in Y</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="character">' '</span>               <span class="comment">\ Set A to the space character for use when clearing the</span>
                        <span class="comment">\ input buffer</span>

<span class="label">.rkey1</span><a id="rkey1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a>,<span class="register">Y</span>      <span class="comment">\ Reset the Y-th byte of the input buffer to contain a</span>
                        <span class="comment">\ space character</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">rkey1</a>              <span class="comment">\ Loop back until we have cleared the whole input buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">PrintInputBuffer</a>   <span class="comment">\ Print the contents of the keyboard input buffer, which</span>
                        <span class="comment">\ will erase any existing text on-screen as we just</span>
                        <span class="comment">\ filled the input buffer with spaces</span>

<span class="label">.rkey2</span><a id="rkey2" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now read the specified number of key presses, so</span>
                        <span class="comment">\ set Y as a counter for the number of valid characters</span>
                        <span class="comment">\ in the input buffer, starting from zero (as the buffer</span>
                        <span class="comment">\ is empty at the start)</span>

<span class="label">.rkey3</span><a id="rkey3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ReadCharacter</a>      <span class="comment">\ Read a character from the keyboard into A, so A is set</span>
                        <span class="comment">\ to the ASCII code of the pressed key</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">13</span>                <span class="comment">\ If RETURN was pressed then jump to rkey9 to return</span>
 <span class="mne">BEQ</span> <a class="popup destination">rkey9</a>              <span class="comment">\ from the subroutine, as RETURN terminates the input</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ If the key pressed is less than ACSII "0" then it is a</span>
 <span class="mne">BCC</span> <a class="popup destination">rkey3</a>              <span class="comment">\ control code, so jump back to rkey3 to keep listening</span>
                        <span class="comment">\ for key presses, as control codes are not valid input</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">127</span>               <span class="comment">\ If the key pressed is less than ASCII 127 then it is</span>
 <span class="mne">BCC</span> <a class="popup destination">rkey5</a>              <span class="comment">\ a printable ASCII character, so jump to rkey5 to</span>
                        <span class="comment">\ process it</span>

 <span class="mne">BNE</span> <a class="popup destination">rkey3</a>              <span class="comment">\ If the key pressed is not the DELETE key then jump</span>
                        <span class="comment">\ back to rkey3 to keep listening for key presses, as</span>
                        <span class="comment">\ this is not a valid input</span>

                        <span class="comment">\ If we get here then DELETE has been pressed, so we</span>
                        <span class="comment">\ need to delete the most recently entered character</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Because the input buffer is stored as an ascending</span>
                        <span class="comment">\ stack, this means we need to delete the character at</span>
                        <span class="comment">\ inputBuffer, which is the top of the buffer stack,</span>
                        <span class="comment">\ and shuffle the rest of the stack to the left to</span>
                        <span class="comment">\ close up the gap (so that's shuffling then down in</span>
                        <span class="comment">\ memory)</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement Y to reduce the character count by one, as</span>
                        <span class="comment">\ we are about to delete a character from the buffer</span>

 <span class="mne">BMI</span> <a class="popup destination">rkey2</a>              <span class="comment">\ If we just decremented Y past zero then the buffer is</span>
                        <span class="comment">\ empty, so jump to rkey2 to reset Y to zero and keep</span>
                        <span class="comment">\ reading characters, as there is nothing to delete</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Otherwise we want to delete the character from the top</span>
                        <span class="comment">\ of the buffer stack at inputBuffer and shuffle the</span>
                        <span class="comment">\ rest of the stack along to the left, so set an index</span>
                        <span class="comment">\ in X to work through the buffer from left to right</span>

<span class="label">.rkey4</span><a id="rkey4" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">inputBuffer</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>    <span class="comment">\ Shuffle the character at index X + 1 to the left and</span>
 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a>,<span class="register">X</span>      <span class="comment">\ into index X</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the buffer index to point to the next</span>
                        <span class="comment">\ character in the buffer as we work from left to right</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Loop back until we have shuffled all seven characters</span>
 <span class="mne">BNE</span> <a class="popup destination">rkey4</a>              <span class="comment">\ to the left</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="character">' '</span>               <span class="comment">\ Set the last character in the input buffer to a space</span>
 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a><span class="operator">+</span><span class="decimal">7</span>      <span class="comment">\ as the bottom of the stack at inputBuffer+7 is now</span>
                        <span class="comment">\ empty</span>

 <span class="mne">BNE</span> <a class="popup destination">rkey8</a>              <span class="comment">\ Jump to rkey8 to print the updated contents of the</span>
                        <span class="comment">\ input buffer, so we can see the character being</span>
                        <span class="comment">\ deleted, and loop back to listen for more key presses</span>
                        <span class="comment">\ (this BNE is effectively a JMP as A is never zero)</span>

<span class="label">.rkey5</span><a id="rkey5" class="anchor"></a>

                        <span class="comment">\ If we get here then the key press in A is a printable</span>
                        <span class="comment">\ ASCII character</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="character">':'</span>               <span class="comment">\ If the character in A is ASCII ":" or greater then it</span>
 <span class="mne">BCS</span> <a class="popup destination">rkey3</a>              <span class="comment">\ is not a number, so jump to rkey3 to keep listening</span>
                        <span class="comment">\ for key presses, as we are only interested in numbers</span>

 <span class="mne">CPY</span> <a class="popup variable">T</a>                  <span class="comment">\ If Y &lt;> T then the buffer does not yet contain the</span>
 <span class="mne">BNE</span> <a class="popup destination">rkey6</a>              <span class="comment">\ maximum number of digits allowed, so jump to rkey6 to</span>
                        <span class="comment">\ process the number key press</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Otherwise the buffer is already full, so perform a</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWRCH</a>             <span class="comment">\ VDU 7 command to make a system beep</span>

 <span class="mne">JMP</span> <a class="popup destination">rkey3</a>              <span class="comment">\ Jump back to rkey3 to listen for more key presses</span>

<span class="label">.rkey6</span><a id="rkey6" class="anchor"></a>

                        <span class="comment">\ If we get here then the key press in A is a number key</span>
                        <span class="comment">\ and the input buffer is not full</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to increase the character count by one, as</span>
                        <span class="comment">\ we are about to add a character to the buffer</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the key number in A on the stack, so we can</span>
                        <span class="comment">\ retrieve it after the following loop</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ We now want to insert the new character into the top</span>
                        <span class="comment">\ of the buffer stack at inputBuffer and shuffle the</span>
                        <span class="comment">\ stack along to the right (so that's shuffling then up</span>
                        <span class="comment">\ in memory), so set an index in X to work through the</span>
                        <span class="comment">\ buffer from right to left</span>

<span class="label">.rkey7</span><a id="rkey7" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">inputBuffer</a>,<span class="register">X</span>      <span class="comment">\ Shuffle the character at index X to the right and into</span>
 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>    <span class="comment">\ index X + 1</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the buffer index to point to the next</span>
                        <span class="comment">\ character in the buffer as we work from right to left</span>

 <span class="mne">BPL</span> <a class="popup destination">rkey7</a>              <span class="comment">\ Loop back until we have shuffled all seven characters</span>
                        <span class="comment">\ to the right</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Restore the key number that we stored on the stack</span>
                        <span class="comment">\ above</span>

 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a>        <span class="comment">\ Store the key press at the top of the stack, in</span>
                        <span class="comment">\ inputBuffer</span>

<span class="label">.rkey8</span><a id="rkey8" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">PrintInputBuffer</a>   <span class="comment">\ Print the contents of the keyboard input buffer so we</span>
                        <span class="comment">\ we can see the characters being entered or deleted</span>

 <span class="mne">JMP</span> <a class="popup destination">rkey3</a>              <span class="comment">\ Jump back to rkey3 to listen for more key presses</span>

<span class="label">.rkey9</span><a id="rkey9" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-printinputbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PrintInputBuffer</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print the contents of the keyboard input buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/printinputbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/readnumber.html">ReadNumber</a> calls <a href="#printinputbuffer">PrintInputBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">T</span>                    <span class="argumentEntry">The size of the input buffer</span>

</div></div>
<span class="label">.PrintInputBuffer</span><a id="printinputbuffer" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of textDropShadow so the following text is</span>
 <span class="mne">ROR</span> <a class="popup variable">textDropShadow</a>     <span class="comment">\ printed without a drop shadow</span>

                        <span class="comment">\ We now print the contents of the input buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Key presses are stored in the input buffer using an</span>
                        <span class="comment">\ ascending stack, with new input being pushed into</span>
                        <span class="comment">\ inputBuffer, so to print the contents of the buffer,</span>
                        <span class="comment">\ we need to print it backwards, from the oldest input</span>
                        <span class="comment">\ at index T - 1 down to the most recent input at</span>
                        <span class="comment">\ index 0</span>

 <span class="mne">LDX</span> <a class="popup variable">T</a>                  <span class="comment">\ Set X = T - 1 so we can use X as an index into the</span>
 <span class="mne">DEX</span>                    <span class="comment">\ buffer, starting from the oldest input</span>

<span class="label">.pinb1</span><a id="pinb1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">inputBuffer</a>,<span class="register">X</span>      <span class="comment">\ Set A to the X-th entry in the input buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">PrintDigit</a>         <span class="comment">\ Print the numerical digit in A</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the buffer index</span>

 <span class="mne">BPL</span> <a class="popup destination">pinb1</a>              <span class="comment">\ Loop back until we have printed the whole buffer</span>

                        <span class="comment">\ We now want to backspace by the number of characters</span>
                        <span class="comment">\ we just printed, to leave the cursor at the start of</span>
                        <span class="comment">\ the printed number</span>

 <span class="mne">LDX</span> <a class="popup variable">T</a>                  <span class="comment">\ Set X to the size of the input buffer, which we can</span>
                        <span class="comment">\ use as a character counter in the following loop to</span>
                        <span class="comment">\ ensure we backspace by the correct number of</span>
                        <span class="comment">\ characters to reach the start of printed number</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set A = 8 to perform a series of VDU 8 commands, each</span>
                        <span class="comment">\ of which will backspace the cursor by one character</span>

<span class="label">.pinb2</span><a id="pinb2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">PrintDigit</a>         <span class="comment">\ Print the character in A, which performs a VDU 8 to</span>
                        <span class="comment">\ backspace the cursor by one character</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the character counter</span>

 <span class="mne">BNE</span> <a class="popup destination">pinb2</a>              <span class="comment">\ Loop back until we have backspaced to the start of the</span>
                        <span class="comment">\ buffer contents that we just printed</span>

 <span class="mne">LSR</span> <a class="popup variable">textDropShadow</a>     <span class="comment">\ Clear bit 7 of textDropShadow so text tokens are once</span>
                        <span class="comment">\ again printed with drop shadows</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-absolute16bit"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-absolute16bit">Absolute16Bit</a> (category: Maths (Arithmetic))</div><div class="summary">Calculate the absolute value (modulus) of a 16-bit number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-corruptsecretcode"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-corruptsecretcode">CorruptSecretCode</a> (category: Cracker protection)</div><div class="summary">Corrupt the generation process for the landscape's secret code by fetching one more seed number than necessary</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-crackerseed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-crackerseed">CrackerSeed</a> (category: Cracker protection)</div><div class="summary">Obfuscated storage for the high byte of the landscape number as part of the anti-cracker code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtitleview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">DrawTitleView</a> (category: Title screen)</div><div class="summary">Draw the main title screen, the secret code screen or the landscape preview</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enablekeyboard"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-enablekeyboard">EnableKeyboard</a> (category: Keyboard)</div><div class="summary">Select the keyboard as the input stream and flush the keyboard buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseednumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-getnextseednumber">GetNextSeedNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a seed number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettiledata">GetTileData</a> (category: Landscape)</div><div class="summary">Get the tile data and tile data address for a specific tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-jumptopreview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-jumptopreview">JumpToPreview</a> (category: Cracker protection)</div><div class="summary">An intentionally confusing jump point for controlling the main title loop flow when returning from the GenerateLandscape routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-modifystoringcode"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-modifystoringcode">ModifyStoringCode</a> (category: Drawing polygons)</div><div class="summary">Modify the code in TracePolygonEdge that stores the coordinates of the polygon edge that is being traced</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osword"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#osword">OSWORD</a></div><div class="summary">The address for the OSWORD routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-oswrch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#oswrch">OSWRCH</a></div><div class="summary">The address for the OSWRCH routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printcharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-printcharacter">PrintCharacter</a> (category: Text)</div><div class="summary">Print a single-byte VDU command or character from a text token, optionally printing a drop shadow if the character is alphanumeric</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printdigit"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-printdigit">PrintDigit</a> (category: Text)</div><div class="summary">Print a numerical digit, printing zero as a capital "O"</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printinputbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-printinputbuffer">PrintInputBuffer</a> (category: Text)</div><div class="summary">Print the contents of the keyboard input buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processtiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a> (category: Landscape)</div><div class="summary">Process the tile data for all tiles in the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-readcharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-readcharacter">ReadCharacter</a> (category: Keyboard)</div><div class="summary">Read a character from the currently selected input stream</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-s"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#s">S</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawncharacter3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-1-of-2">SpawnCharacter3D (Part 1 of 2)</a> (category: Title screen)</div><div class="summary">Spawn a character on the landscape in large 3D blocks for drawing on the main title screen or secret code screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnsecretcode3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-spawnsecretcode3d">SpawnSecretCode3D</a> (category: Title screen)</div><div class="summary">Draw the landscape's secret code by spawning a set of large 3D text block objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#t">T</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tracepolygonedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a> (category: Drawing polygons)</div><div class="summary">Trace a polygon edge, populating xPolygonRight or xPolygonLeft with the x-coordinate of the edge for each y-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#u">U</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-v"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#v">V</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-alteredseed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#alteredseed">alteredSeed</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">An altered version of the anti-cracker seed-related data that gets created in AlterCrackerSeed and checked in CheckCreckerSeed as part of the anti-cracker code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferoriginhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bufferoriginhi">bufferOriginHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to add to yaw angles for the current screen buffer to convert them from having the origin in the buffer centre to having the origin on the left edge of the buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferoriginlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bufferoriginlo">bufferOriginLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to add to yaw angles for the current screen buffer to convert them from having the origin in the buffer centre to having the origin on the left edge of the buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-characterdef"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#characterdef">characterDef</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">An OSWORD block for reading a character definition</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-csee1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#csee1">csee1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-checkcrackerseed">CheckCrackerSeed</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotplaylandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotplaylandscape">doNotPlayLandscape</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that controls whether we preview and play the landscape after generating it</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawpolygon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawpolygon">drawPolygon</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A flag to record whether the polygon we are currently processing contains any visible pixels, so it can be used to control whether we actually draw the polygon</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawviewangles">drawViewAngles</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address in drawViewAngles(1 0) of the pitch and yaw angles of the tile and polygon points that we are drawing in the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewpitchhi">drawViewPitchHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewpitchlo">drawViewPitchLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-drawviewyawhi">drawViewYawHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewyawlo">drawViewYawLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtableoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawingtableoffset">drawingTableOffset</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to use within the various drawing data tables for the tile we are analysing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtitlescreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#drawingtitlescreen">drawingTitleScreen</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to indicate whether we are currently drawing a title screen in the DrawTitleScreen routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol1">gpol1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-1-of-6">GetPolygonLines (Part 1 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol10">gpol10</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol11">gpol11</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol12">gpol12</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol13">gpol13</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol14">gpol14</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol15">gpol15</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol16">gpol16</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol17">gpol17</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol18">gpol18</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol19">gpol19</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol2">gpol2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-1-of-6">GetPolygonLines (Part 1 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol20"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol20">gpol20</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol21"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol21">gpol21</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol22">gpol22</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-6-of-6">GetPolygonLines (Part 6 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol23"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol23">gpol23</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-6-of-6">GetPolygonLines (Part 6 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol24"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol24">gpol24</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-6-of-6">GetPolygonLines (Part 6 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol25"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol25">gpol25</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-6-of-6">GetPolygonLines (Part 6 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol26"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol26">gpol26</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-6-of-6">GetPolygonLines (Part 6 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol3">gpol3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-2-of-6">GetPolygonLines (Part 2 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol4">gpol4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-3-of-6">GetPolygonLines (Part 3 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol5">gpol5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-3-of-6">GetPolygonLines (Part 3 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol6">gpol6</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-3-of-6">GetPolygonLines (Part 3 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol7">gpol7</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-4-of-6">GetPolygonLines (Part 4 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol8">gpol8</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-4-of-6">GetPolygonLines (Part 4 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#gpol9">gpol9</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">GetPolygonLines (Part 5 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-horizontaledges"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#horizontaledges">horizontalEdges</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter to keep track of how many polygon edges are horizontal in the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-inputbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#inputbuffer">inputBuffer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The eight-byte keyboard input buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-loopcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#loopcounter">loopCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A general-purpose loop counter</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#maxpitchangle">maxPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The maximum pitch angle that fits into the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-minpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#minpitchangle">minPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The minimum pitch angle that fits into the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objblocknumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-objblocknumber">objBlockNumber</a> (category: Title screen)</div><div class="summary">A lookup table to convert bit pairs into object numbers for spawning 3D text blocks on the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectyawangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objectyawangle">objectYawAngle</a> (category: 3D objects)</div><div class="summary">The yaw angle for each object (i.e. the horizontal direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pinb1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#pinb1">pinb1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-printinputbuffer">PrintInputBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pinb2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#pinb2">pinb2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-printinputbuffer">PrintInputBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pointx"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pointx">pointX</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage for the number of point #X while processing polygon lines</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygonedge">polygonEdge</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number the side of the polygon that we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonedgecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygonedgecount">polygonEdgeCount</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of sides in the polygon we are drawing, which is one less than the number of points in the polygon's point list (as the last point in the list is always a repeat of the first point)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#polygonpoint">polygonPoint</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Up to five coordinates for the points of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygontype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygontype">polygonType</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Bits 6 and 7 determine the type of polygon to draw in the DrawPolygon routine (the calling subroutine is in brackets)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printtextin3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#printtextin3d">printTextIn3D</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether we are printing text normally or in 3D (as in the game's title on the title screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#processaction">processAction</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Defines the following</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rand1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rand1">rand1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-getnextseednumber">GetNextSeedNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey1">rkey1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey2">rkey2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey3">rkey3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey4">rkey4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey5">rkey5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey6">rkey6</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey7">rkey7</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey8">rkey8</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rkey9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#rkey9">rkey9</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-readnumber">ReadNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scalefactor"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#scalefactor">scaleFactor</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The scale factor for the x-axis and y-axis deltas when fitting them into single-byte numbers during the tracing of polygon edges</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screentype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-screentype">screenType</a> (category: Title screen)</div><div class="summary">A variable that determines whether we are drawing the title screen or the secret code screen in the DrawTitleScreen routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap1">shap1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap10">shap10</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap11">shap11</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap12">shap12</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap13">shap13</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap14">shap14</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap15">shap15</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap16">shap16</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap2">shap2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap3">shap3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap4">shap4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap5">shap5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap6">shap6</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap7">shap7</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap8">shap8</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shap9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#shap9">shap9</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoothingaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#smoothingaction">smoothingAction</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The action that's applied to tile data by the SmoothTileData routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#spac1">spac1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-1-of-2">SpawnCharacter3D (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#spac2">spac2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-1-of-2">SpawnCharacter3D (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#spac3">spac3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-2-of-2">SpawnCharacter3D (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#spac4">spac4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-2-of-2">SpawnCharacter3D (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#spac5">spac5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-2-of-2">SpawnCharacter3D (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stor1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stor1">stor1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-modifystoringcode">ModifyStoringCode</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stor2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stor2">stor2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-modifystoringcode">ModifyStoringCode</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stor3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stor3">stor3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-modifystoringcode">ModifyStoringCode</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stor4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stor4">stor4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-modifystoringcode">ModifyStoringCode</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stor5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stor5">stor5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-modifystoringcode">ModifyStoringCode</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri1">stri1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-1-of-4">SmoothTileCorners (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri10">stri10</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri11">stri11</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-3-of-4">SmoothTileCorners (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri12">stri12</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-3-of-4">SmoothTileCorners (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri13">stri13</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-3-of-4">SmoothTileCorners (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri14">stri14</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-3-of-4">SmoothTileCorners (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri15">stri15</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-3-of-4">SmoothTileCorners (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri16">stri16</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-4-of-4">SmoothTileCorners (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri17">stri17</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-4-of-4">SmoothTileCorners (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri18">stri18</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-4-of-4">SmoothTileCorners (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri19">stri19</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-4-of-4">SmoothTileCorners (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri2">stri2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-1-of-4">SmoothTileCorners (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri3">stri3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-1-of-4">SmoothTileCorners (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri4">stri4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri5">stri5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri6">stri6</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri7">stri7</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri8">stri8</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#stri9">stri9</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-2-of-4">SmoothTileCorners (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stripdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-stripdata">stripData</a> (category: Landscape)</div><div class="summary">Storage for tile data when smoothing strips of tiles during the landscape generation process</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-textdropshadow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#textdropshadow">textDropShadow</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether text in text tokens is printed with a drop shadow</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledatapage"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tiledatapage">tileDataPage</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address of the tileData page containing the current tile's data</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titl1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#titl1">titl1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-drawtitlescreen">DrawTitleScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titl2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#titl2">titl2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-drawtitlescreen">DrawTitleScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titl3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#titl3">titl3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-drawtitlescreen">DrawTitleScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titletext"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-titletext">titleText</a> (category: Title screen)</div><div class="summary">The text to draw on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred1">tred1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred10">tred10</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred11">tred11</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred12">tred12</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred13">tred13</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred14">tred14</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred15">tred15</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred16">tred16</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred17">tred17</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-2-of-8">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred18">tred18</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred19">tred19</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred2">tred2</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred20"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred20">tred20</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred21"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred21">tred21</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred22">tred22</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred23"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred23">tred23</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred24"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred24">tred24</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred25"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred25">tred25</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-3-of-8">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred26"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred26">tred26</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-4-of-8">TracePolygonEdge (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred27"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred27">tred27</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-4-of-8">TracePolygonEdge (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred28"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred28">tred28</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-4-of-8">TracePolygonEdge (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred29"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred29">tred29</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-4-of-8">TracePolygonEdge (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred3">tred3</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred30"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred30">tred30</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-4-of-8">TracePolygonEdge (Part 4 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred31"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred31">tred31</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-5-of-8">TracePolygonEdge (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred32"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred32">tred32</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-5-of-8">TracePolygonEdge (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred33"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred33">tred33</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-5-of-8">TracePolygonEdge (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred34"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred34">tred34</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-5-of-8">TracePolygonEdge (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred35"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred35">tred35</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-6-of-8">TracePolygonEdge (Part 6 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred36"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred36">tred36</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-6-of-8">TracePolygonEdge (Part 6 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred37"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred37">tred37</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-6-of-8">TracePolygonEdge (Part 6 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred38"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred38">tred38</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred39"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred39">tred39</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred4">tred4</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred40"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred40">tred40</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred41"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred41">tred41</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred42"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred42">tred42</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred43"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred43">tred43</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred44"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred44">tred44</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred45"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred45">tred45</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-7-of-8">TracePolygonEdge (Part 7 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred46"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred46">tred46</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred47"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred47">tred47</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred48"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred48">tred48</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred49"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred49">tred49</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred5">tred5</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred50"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred50">tred50</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred51"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred51">tred51</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred52"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred52">tred52</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred53"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred53">tred53</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-8-of-8">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred6">tred6</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred7">tred7</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred8">tred8</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#tred9">tred9</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-1-of-8">TracePolygonEdge (Part 1 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-trianglepointadd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-trianglepointadd">trianglePointAdd</a> (category: Drawing polygons)</div><div class="summary">The value to add to the second point number to get the third point number when drawing a tile face as two triangles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-trianglestartpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#trianglestartpoint">triangleStartPoint</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the starting point for the tile shape being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgedelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgedelta">xEdgeDelta</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The scaled and signed x-axis delta between two polygon points when tracing the polygon edges (single byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgedeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgedeltahi">xEdgeDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of the scaled and signed x-axis delta between two polygon points when tracing the polygon edges</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgedeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgedeltalo">xEdgeDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The low byte of the scaled and signed x-axis delta between two polygon points when tracing the polygon edges</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgeendhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgeendhi">xEdgeEndHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of the end point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgeendlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgeendlo">xEdgeEndLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of the end point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestarthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgestarthi">xEdgeStartHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xedgestartlo">xEdgeStartLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xmaxhorizontal"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xmaxhorizontal">xMaxHorizontal</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A variable to keep track of the maximum x-coordinates of any polygon edges that are horizontal in the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xminhorizontal"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xminhorizontal">xMinHorizontal</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A variable to keep track of the minimum x-coordinates of any polygon edges that are horizontal in the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpointdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xpointdeltahi">xPointDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage for the high byte of the x-axis delta between two polygon points</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xpolygonaddrhi">xPolygonAddrHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of the address of the table where we store the x-coordinate of the polygon line being processed, so this is either HI(xPolygonLeft) or HI(xPolygonRight)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-xpolygonleft">xPolygonLeft</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the left edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonpointhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-xpolygonpointhi">xPolygonPointHi</a> (category: Drawing polygons)</div><div class="summary">Pixel x-coordinates for all the points in the polygon that we are currently drawing (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonpointlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-xpolygonpointlo">xPolygonPointLo</a> (category: Drawing polygons)</div><div class="summary">Pixel x-coordinates for all the points in the polygon that we are currently drawing (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonpointscale"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xpolygonpointscale">xPolygonPointScale</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A flag to record whether the pixel x-coordinate of the polygon points being processed fit into one or two bytes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-xpolygonright">xPolygonRight</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the right edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtile">xTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner x-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilecharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtilecharacter">xTileCharacter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The tile x-coordinate of the character being spawned in large 3D blocks on the landscape for the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtiletodraw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtiletodraw">xTileToDraw</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The column number of the tile we are currently drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yedgedeltahi">yEdgeDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yedgedeltalo">yEdgeDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgeendhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yedgeendhi">yEdgeEndHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the end point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgeendlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yedgeendlo">yEdgeEndLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the end point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgestarthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yedgestarthi">yEdgeStartHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the start point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yedgestartlo">yEdgeStartLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjecthi">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjectlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjectlo">yObjectLo</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygonbottom"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ypolygonbottom">yPolygonBottom</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the bottom of the polygon being drawn (where higher y-coordinates are up the screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygontop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ypolygontop">yPolygonTop</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the top of the polygon being drawn (where higher y-coordinates are up the screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ystorenextseed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-ystorenextseed">yStoreNextSeed</a> (category: Maths (Arithmetic))</div><div class="summary">Temporary storage for Y so it can be preserved through calls to GetNextSeedNumber</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ztile">zTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilecharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ztilecharacter">zTileCharacter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The tile z-coordinate of the character being spawned in large 3D blocks on the landscape for the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zero1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_f.html#zero1">zero1</a> in subroutine <a href="/source/all/the_sentinel_f.html#header-printdigit">PrintDigit</a></div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_e.html">The Sentinel E source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_g.html">The Sentinel G source</a></nav>
				</div>
			</article>

<?php
include_once("../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
