<?php
include_once("../../templates/template_functions.php");
page_header("all_source", "the_sentinel_j.html", "The Sentinel J source", "The Sentinel J source", "The The Sentinel J source file in The Sentinel", "the_sentinel-index", "source_all_source", "the_sentinel_j", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_i.html">The Sentinel I source</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div><div><div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getobjectangles" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetObjectAngles</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the angles and distances of the vector from the viewer</span>
             <span class="headerEntry">to a specific object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getobjectangles.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkenemygaze_part_1_of_2.html">CheckEnemyGaze (Part 1 of 2)</a> calls <a href="#getobjectangles">GetObjectAngles</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawobject.html">DrawObject</a> calls <a href="#getobjectangles">GetObjectAngles</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getobjvisibility.html">GetObjVisibility</a> calls <a href="#getobjectangles">GetObjectAngles</a></span>
</div>
<hr class="light">
 This routine calculates the following for an object:

 1. objTypeToAnalyse: Set to the type of the object we are analysing.

 2. xDelta(Hi Lo), yDelta(Hi Lo), zDelta(Hi Lo): Calculate the difference (the
 delta) in all three axes between the viewer and the object we are analysing,
 to give us the 3D vector from the viewer to the object.

 3. angle(Hi Lo): Calculate the angle of the hypotenuse of the triangle formed
 by the x-axis and z-axis, which is the projection of the 3D vector from the
 viewer to the object down onto the ground plane (so imagine a light shining
 down from above, casting the vector's shadow onto the y = 0 plane, and that's
 the hypotenuse).

 4. hypotenuse(Hi Lo): Set to the length of the hypotenuse in the above
 triangle, so that's the length of the 3D vector from the viewer to the object
 when projected down onto the ground plane.

 5. objectViewYaw(Hi Lo): The angle of the hypotenuse is the yaw angle of the
 3D vector from the viewer to the object we are analysing. We subtract the
 viewer's yaw angle and the yaw adjustment, and add half a screen width to get
 the yaw angle delta from the viewer's gaze to the object, relative to the
 viewer's gaze, i.e. the screen). This gives us the yaw angle relative to the
 view. You can think of this as the screen x-coordinate of the object, or how
 far the object appears from the left edge of the screen.

 6. objectGazeYaw(Hi Lo): Set to the object's gaze relative to the viewer's
 gaze.

 7. If this is the landscape preview, rotate the object to face forwards and
 scale it so it looks good.

 8. Set objectAdjacent(Hi Lo) to hypotenuse(Hi Lo) so it can be used as the
 length of the adjacent side in the vertical right-angled triangle with the
 projected vector along the bottom and the vector from the viewer to the
 object as the hypotenuse.

 9. Set objectOpposite(Hi Lo) to the length of the opposite side in the
 vertical right-angled triangle with the projected vector along the bottom and
 the vector from the viewer to the object as the hypotenuse.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The number of the object to be analysed</span>

   <span class="argumentLabel">viewType</span>             <span class="argumentEntry">Landscape preview flag:</span>

                        <span class="argumentEntry">  * Zero = this is the landscape preview, so rotate all</span>
                        <span class="argumentEntry">           the objects in the preview to face the viewer</span>

                        <span class="argumentEntry">  * Non-zero = this is not the landscape preview, so</span>
                        <span class="argumentEntry">               leave the objects alone</span>

   <span class="argumentLabel">viewingObject</span>        <span class="argumentEntry">The viewing object</span>

</div></div>
 <span class="mne">RTS</span>                    <span class="comment">\ This instruction appears to be unused</span>

<span class="label">.GetObjectAngles</span><a id="getobjectangles" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">objectToAnalyse</a>    <span class="comment">\ Set objectToAnalyse to the number of the object being</span>
                        <span class="comment">\ analysed</span>

 <span class="mne">LDA</span> <a class="popup variable">objectTypes</a>,<span class="register">Y</span>      <span class="comment">\ Set objTypeToAnalyse to the type of the object being</span>
 <span class="mne">STA</span> <a class="popup variable">objTypeToAnalyse</a>   <span class="comment">\ analysed</span>

                        <span class="comment">\ We start by calculating the difference (the delta) in</span>
                        <span class="comment">\ all three axes between the viewer and the object we</span>
                        <span class="comment">\ are analysing, to give us the 3D vector from the</span>
                        <span class="comment">\ viewer to the object</span>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the object number of the viewer</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHorizontalDelta</a> <span class="comment">\ Calculate the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xDelta(Hi Lo) =  x-coordinate of object #Y</span>
                        <span class="comment">\                   - x-coordinate of object #X</span>
                        <span class="comment">\                   - xTitleOffset</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xDeltaAbsoluteHi = |xDeltaAbsoluteHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\   zDelta(Hi Lo) =  z-coordinate of object #Y</span>
                        <span class="comment">\                   - z-coordinate of object #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\   zDeltaAbsoluteHi = |zDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this calculates the difference in both horizontal</span>
                        <span class="comment">\ axes between object #X (the viewer) and object #Y (the</span>
                        <span class="comment">\ object being analysed)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that xTitleOffset is zero during gameplay, and is</span>
                        <span class="comment">\ only non-zero when we are drawing large 3D text on the</span>
                        <span class="comment">\ title screen</span>

 <span class="mne">JSR</span> <a class="popup destination">GetVerticalDelta</a>   <span class="comment">\ Calculate the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   yDelta(Hi Lo) =   y-coordinate of object #Y</span>
                        <span class="comment">\                   - y-coordinate of object #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this calculates the difference in altitude between</span>
                        <span class="comment">\ object #X (the viewer) and object #Y (the object being</span>
                        <span class="comment">\ analysed)</span>

                        <span class="comment">\ We now have deltas for all three axes, so we now can</span>
                        <span class="comment">\ calculate the angle of the hypotenuse of the triangle</span>
                        <span class="comment">\ formed by the x-axis and z-axis, which is the</span>
                        <span class="comment">\ projection of the 3D vector from the viewer to the</span>
                        <span class="comment">\ object down onto the ground plane (so imagine a light</span>
                        <span class="comment">\ shining down from above, casting the vector's shadow</span>
                        <span class="comment">\ onto the y = 0 plane - that's the hypotenuse)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHypotenuseAngle</a> <span class="comment">\ Calculate the angle of the hypotenuse in the triangle</span>
                        <span class="comment">\ with the following non-hypotenuse sides:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * zDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and return the angle in angle(Hi Lo), the tangent in</span>
                        <span class="comment">\ angleTangent, the length of the longer side in</span>
                        <span class="comment">\ a(Hi Lo) and the length of the shorter side in</span>
                        <span class="comment">\ b(Hi Lo)</span>

                        <span class="comment">\ The angle of the hypotenuse is the yaw angle of the</span>
                        <span class="comment">\ 3D vector from the viewer to the object we are</span>
                        <span class="comment">\ analysing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also subtract the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * objectYawAngle,X from the high byte so the result</span>
                        <span class="comment">\     is the relative yaw angle from object #X (the</span>
                        <span class="comment">\     viewer's gaze) to the object</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yawAdjustmentLo from the low byte so if we are</span>
                        <span class="comment">\     drawing an object for updating, we include the</span>
                        <span class="comment">\     correct yaw offset to enable the object to be</span>
                        <span class="comment">\     drawn flush with the left edge of the screen</span>
                        <span class="comment">\     buffer (see the DrawUpdatedObject routine)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and add the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (10 0) to add half a screen width (as the screen</span>
                        <span class="comment">\     is 20 yaw angles wide)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the result in objectViewYaw(Hi Lo) is the yaw angle</span>
                        <span class="comment">\ delta from the viewer's gaze to the object, plus</span>
                        <span class="comment">\ adjustments and half a screen, to give us the yaw</span>
                        <span class="comment">\ angle relative to the view</span>
                        <span class="comment">\</span>
                        <span class="comment">\ You can think of this as the screen x-coordinate of</span>
                        <span class="comment">\ the object, or how far the object appears from the</span>
                        <span class="comment">\ left edge of the screen</span>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the object number of the viewer</span>

 <span class="mne">LDA</span> <a class="popup variable">angleLo</a>            <span class="comment">\ Set objectViewYaw(Hi Lo) =</span>
 <span class="mne">SEC</span>                    <span class="comment">\                    angle(Hi Lo) - (0 yawAdjustmentLo)</span>
 <span class="mne">SBC</span> <a class="popup variable">yawAdjustmentLo</a>    <span class="comment">\                                 - (objectYawAngle,X 0)</span>
 <span class="mne">STA</span> <a class="popup variable">objectViewYawLo</a>    <span class="comment">\                                 + (10 0)</span>
 <span class="mne">LDA</span> <a class="popup variable">angleHi</a>
 <span class="mne">SBC</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">10</span>
 <span class="mne">STA</span> <a class="popup variable">objectViewYawHi</a>

 <span class="mne">LDY</span> <a class="popup variable">objectToAnalyse</a>    <span class="comment">\ Set Y to the number of the object being analysed</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set objectGazeYaw(Hi Lo) =</span>
 <span class="mne">SEC</span>                    <span class="comment">\                    (objectYawAngle,Y 0) - angle(Hi Lo)</span>
 <span class="mne">SBC</span> <a class="popup variable">angleLo</a>            <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">objectGazeYawLo</a>    <span class="comment">\ This is the difference in yaw angles between the</span>
 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">Y</span>   <span class="comment">\ hypotenuse (i.e. the viewer's gaze) and the direction</span>
 <span class="mne">SBC</span> <a class="popup variable">angleHi</a>            <span class="comment">\ in which the object is facing (i.e. the object's gaze</span>
 <span class="mne">STA</span> <a class="popup variable">objectGazeYawHi</a>    <span class="comment">\ to wherever it is looking), so that's the object's</span>
                        <span class="comment">\ gaze relative to the viewer's gaze</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHypotenuse</a>      <span class="comment">\ Calculate the length of the hypotenuse in the triangle</span>
                        <span class="comment">\ with side lengths of a(Hi Lo) and b(Hi Lo) and angle</span>
                        <span class="comment">\ angleTangent, which the call to GetHypotenuseAngle set</span>
                        <span class="comment">\ to the values for the projection of the 3D vector from</span>
                        <span class="comment">\ the viewer to the object down onto the ground plane</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The hypotenuse length is returned in hypotenuse(Hi Lo)</span>

 <span class="mne">LDA</span> <a class="popup variable">viewType</a>           <span class="comment">\ If viewType is non-zero then this is not the landscape</span>
 <span class="mne">BNE</span> <a class="popup destination">oang1</a>              <span class="comment">\ preview, so jump to oang1 to skip the following</span>

                        <span class="comment">\ This is the landscape preview, so we rotate the object</span>
                        <span class="comment">\ to face towards the back of the landscape, so the</span>
                        <span class="comment">\ Sentinel and sentries all neatly look out of the</span>
                        <span class="comment">\ screen in the preview</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">128</span>               <span class="comment">\ Set objectGazeYaw(Hi Lo) = (128 0)</span>
 <span class="mne">STA</span> <a class="popup variable">objectGazeYawHi</a>    <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ The degree system in the Sentinel looks like this:</span>
 <span class="mne">STA</span> <a class="popup variable">objectGazeYawLo</a>    <span class="comment">\</span>
                        <span class="comment">\            0</span>
                        <span class="comment">\      -32   |   +32         Overhead view of object</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /             0 = looking straight ahead</span>
                        <span class="comment">\           \|/              +64 = looking sharp right</span>
                        <span class="comment">\   -64 -----+----- +64      -64 = looking sharp left</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment">\          / | \</span>
                        <span class="comment">\         /  |  \</span>
                        <span class="comment">\      -96   |   +96</span>
                        <span class="comment">\           128</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this makes the object face directly out of the</span>
                        <span class="comment">\ screen</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ If we are analysing object #63, then this is either</span>
 <span class="mne">BEQ</span> <a class="popup destination">oang1</a>              <span class="comment">\ a block of 3D text or the Sentinel's tower, and the</span>
                        <span class="comment">\ landscape preview doesn't use 3D text so it must be</span>
                        <span class="comment">\ the Sentinel's tower, so jump to oang1 to skip the</span>
                        <span class="comment">\ following</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that all objects apart from the tower</span>
                        <span class="comment">\ are drawn at double size, so they stand out more</span>
                        <span class="comment">\ clearly in the landscape preview (the tower is the</span>
                        <span class="comment">\ biggest object by far, so doubling its size would</span>
                        <span class="comment">\ make it too large)</span>

 <span class="mne">LSR</span> <a class="popup variable">hypotenuseHi</a>       <span class="comment">\ Halve the hypotenuse length to make the object appear</span>
 <span class="mne">ROR</span> <a class="popup variable">hypotenuseLo</a>       <span class="comment">\ to be half the distance away, so it is drawn at twice</span>
                        <span class="comment">\ the size</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Halve the object's altitude in yDelta(Hi Lo) for the</span>
 <span class="mne">ROR</span> <a class="popup variable">yDeltaHi</a>           <span class="comment">\ same reason</span>
 <span class="mne">ROR</span> <a class="popup variable">yDeltaLo</a>           <span class="comment">\</span>
                        <span class="comment">\ Because this is the landscape view, the viewer is very</span>
                        <span class="comment">\ high above the landscape (as well as a long way in</span>
                        <span class="comment">\ front of the front edge), so we know that</span>
                        <span class="comment">\ yDelta(Hi Lo) will be negative, as it's calculated as</span>
                        <span class="comment">\ the altitude of the object being analysed minus the</span>
                        <span class="comment">\ altitude of the viewer, and the latter is higher than</span>
                        <span class="comment">\ any object on the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can halve the value of yDelta(Hi Lo) by shifting</span>
                        <span class="comment">\ a set bit into the top end of yDeltaHi, so we keep the</span>
                        <span class="comment">\ sign correct</span>

 <span class="mne">LDA</span> <a class="popup variable">yDeltaLo</a>           <span class="comment">\ Set yDelta(Hi Lo) = yDelta(Hi Lo) + 112</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">112</span>               <span class="comment">\ Starting with the low bytes</span>
 <span class="mne">STA</span> <a class="popup variable">yDeltaLo</a>

 <span class="mne">BCC</span> <a class="popup destination">oang1</a>              <span class="comment">\ And then the high byte</span>
 <span class="mne">INC</span> <a class="popup variable">yDeltaHi</a>           <span class="comment">\</span>
                        <span class="comment">\ This moves the Sentinel and sentries up so they stand</span>
                        <span class="comment">\ out more clearly in the landscape preview, as</span>
                        <span class="comment">\ otherwise they would appear to be sinking into the</span>
                        <span class="comment">\ landscape rather than perching on top of it</span>

<span class="label">.oang1</span><a id="oang1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">hypotenuseLo</a>       <span class="comment">\ Set objectAdjacent(Hi Lo) to the length of the</span>
 <span class="mne">STA</span> <a class="popup variable">objectAdjacentLo</a>   <span class="comment">\ hypotenuse, which is the length of the adjacent side</span>
 <span class="mne">LDA</span> <a class="popup variable">hypotenuseHi</a>       <span class="comment">\ in the right-angled triangle with the vector from the</span>
 <span class="mne">STA</span> <a class="popup variable">objectAdjacentHi</a>   <span class="comment">\ viewer to the object as the hypotenuse</span>

 <span class="mne">LDA</span> <a class="popup variable">yDeltaLo</a>           <span class="comment">\ Set objectOpposite(Hi Lo) to the height of the object</span>
 <span class="mne">STA</span> <a class="popup variable">objectOppositeLo</a>   <span class="comment">\ relative to the viewer, which is the length of the</span>
 <span class="mne">LDA</span> <a class="popup variable">yDeltaHi</a>           <span class="comment">\ opposite side in the right-angled triangle with the</span>
 <span class="mne">STA</span> <a class="popup variable">objectOppositeHi</a>   <span class="comment">\ vector from the viewer to the object as the hypotenuse</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getobjpointangles" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetObjPointAngles</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the view-relative pitch and yaw angles of all the points</span>
             <span class="headerEntry">in an object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getobjpointangles.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawobject.html">DrawObject</a> calls <a href="#getobjpointangles">GetObjPointAngles</a></span>
</div>
<hr class="light">
 This routine loops through each point in an object definition and calculates
 the following:

 1. A: Calculate the yaw angle of the point, rotated by the rotation of the
 object itself (i.e. its gaze), so this is the yaw angle of the object point
 within the object, but with the correct rotation for the direction the object
 is facing.

 2. xDelta(Hi Lo), zDelta(Hi Lo): Convert this yaw angle and the polar distance
 into x- and z-coordinates for the point in the y = 0 plane (i.e. on the
 ground) using cos(A) and sin(A) on a triangle with the line along the polar
 distance to the point as the hypotenuse. So these are the x- and z-coordinates
 of the object point within the object itself (i.e. relative to the object's
 origin and rotated to the correct gaze).

 3. angle(Hi Lo): Calculate the angle of the right-angled triangle made up of
 the object point's object-relative x- and z-coordinates, to give us the angle
 of the vector from the object's origin to the to the point within the object.

 4. drawViewYaw(Hi Lo): Rotate the yaw angle of the point within the object
 definition by the object's view-relative yaw angle to get the view-relative
 yaw angle of the point. This is the yaw angle of the vector from the viewer to
 the object point.

 5. drawViewPitch(Hi Lo): Construct the vertical triangle that has the vector
 from the viewer to the point as the hypotenuse, the point altitude as the
 opposite side and the projection onto the ground of the vector as the adjacent
 side, and use this to calculate the pitch angle of the vector from the viewer
 to the object point.

</div></div>
<span class="label">.GetObjPointAngles</span><a id="getobjpointangles" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">objTypeToAnalyse</a>   <span class="comment">\ Set X to the number of the object we are drawing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ Set drawingTableIndex to 64 to use as the index into</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ the drawing tables for the object we are drawing, so</span>
                        <span class="comment">\ we store the results in the following drawing tables:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that these drawing tables live just after the</span>
                        <span class="comment">\ tile drawing tables in memory, and the index is set</span>
                        <span class="comment">\ accordingly</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, the tile view angles is stored with a</span>
                        <span class="comment">\ drawing index of 0 or 32, thus taking up the first 64</span>
                        <span class="comment">\ bytes of each table, while the object point angles</span>
                        <span class="comment">\ are stored from drawing index 64</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Each drawing table is 96 bytes in total, so they fit</span>
                        <span class="comment">\ together nicely</span>

 <span class="mne">LDA</span> <a class="popup variable">objPointRange</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>  <span class="comment">\ Set objectLastPoint to entry X + 1 from the table at</span>
 <span class="mne">STA</span> <a class="popup variable">objectLastPoint</a>    <span class="comment">\ objPointRange, so this now contains the number of the</span>
                        <span class="comment">\ first point for the next object, object #X + 1, which</span>
                        <span class="comment">\ is one greater than the last point number for object</span>
                        <span class="comment">\ #X, as the lists of object points are sequential (so</span>
                        <span class="comment">\ object #0's points are first in the object data</span>
                        <span class="comment">\ tables, then object #1's points, and so on)</span>

 <span class="mne">LDY</span> <a class="popup variable">objPointRange</a>,<span class="register">X</span>    <span class="comment">\ Set Y and pointNumber to entry X from the table at</span>
 <span class="mne">STY</span> <a class="popup variable">pointNumber</a>        <span class="comment">\ objPointRange, so this now contains the number of the</span>
                        <span class="comment">\ first point for object #X</span>

                        <span class="comment">\ We now work through the points in the object, using Y</span>
                        <span class="comment">\ as the point number and working through the points</span>
                        <span class="comment">\ from first to last</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object points are stored as polar coordinates plus a</span>
                        <span class="comment">\ height, to define where they appear within the object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The polar coordinate consists of a polar yaw angle and</span>
                        <span class="comment">\ a polar distance (where these are relative to the gaze</span>
                        <span class="comment">\ and origin of the object in the object's definition),</span>
                        <span class="comment">\ which together define the position of the point on the</span>
                        <span class="comment">\ ground plane (y = 0), as if we were looking at the</span>
                        <span class="comment">\ object from above</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The height defines the y-coordinate of the point</span>
                        <span class="comment">\ relative to the object's origin, so that's the height</span>
                        <span class="comment">\ of the point within the object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ You can think of the polar coordinate as defining the</span>
                        <span class="comment">\ positions of the points on a piece of paper, and the</span>
                        <span class="comment">\ height then extruding those points up and down, away</span>
                        <span class="comment">\ from the paper, to create a 3D model</span>

<span class="label">.obpt1</span><a id="obpt1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">objectGazeYawLo</a>    <span class="comment">\ Set the following</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">objectGazeYawHi</a>    <span class="comment">\   (A T) = objectGazeYaw(Hi Lo) + yaw angle for point Y</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">objPointYaw</a>,<span class="register">Y</span>      <span class="comment">\ So this is the yaw angle of point Y in the object,</span>
                        <span class="comment">\ rotated by the rotation of the object itself (i.e. its</span>
                        <span class="comment">\ gaze), so this is the yaw angle of the object point</span>
                        <span class="comment">\ within the object, but with the correct rotation for</span>
                        <span class="comment">\ the direction the object is facing</span>

 <span class="mne">JSR</span> <a class="popup destination">GetSineAndCosine</a>   <span class="comment">\ Calculate the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   sinA = |sin(A T)|</span>
                        <span class="comment">\</span>
                        <span class="comment">\   cosA = |cos(A T)|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ where (A T) is the yaw angle of the object point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also returns the sign of the result in H, as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of H is the sign of sin(A)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 6 of H is the sign of cos(A)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ where 0 = positive and 1 = negative</span>

 <span class="mne">LDY</span> <a class="popup variable">pointNumber</a>        <span class="comment">\ Set U to the polar distance of the object point</span>
 <span class="mne">LDA</span> <a class="popup variable">objPointDistance</a>,<span class="register">Y</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>

 <span class="mne">LDA</span> <a class="popup variable">cosA</a>               <span class="comment">\ Set (A T) = A * U</span>
 <span class="mne">JSR</span> <a class="popup destination">Multiply8x8</a>        <span class="comment">\           = distance * cos(A T)</span>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set (A T) = distance * cos(A T) / 256</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
                        <span class="comment">\ This discards the fractional part of the result</span>

 <span class="mne">BIT</span> <a class="popup variable">H</a>                  <span class="comment">\ If bit 6 of H is clear then cos(A T) is positive and</span>
 <span class="mne">BVC</span> <a class="popup destination">obpt2</a>              <span class="comment">\ the result already has the correct sign, so jump to</span>
                        <span class="comment">\ obpt2 to skip the following</span>

 <span class="mne">JSR</span> <a class="popup destination">Negate16Bit</a>        <span class="comment">\ Otherwise cos(A T) needs to be negative, so set:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A T) = -(A T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the result now has the correct sign</span>

<span class="label">.obpt2</span><a id="obpt2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set (U T) = (A T)</span>
                        <span class="comment">\           = distance * cos(A T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this is the length of the adjacent side in the</span>
                        <span class="comment">\ triangle with the polar distance as the hypotenuse</span>

 <span class="mne">LDA</span> <a class="popup variable">objectAdjacentLo</a>   <span class="comment">\ Set zDelta(Hi Lo) = objectAdjacent(Hi Lo) + (U T)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">T</a>                  <span class="comment">\ So this adds the adjacent side of the vector from the</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaLo</a>           <span class="comment">\ viewer to the object, to the adjacent side of the</span>
 <span class="mne">LDA</span> <a class="popup variable">objectAdjacentHi</a>   <span class="comment">\ polar coordinate of the object point</span>
 <span class="mne">ADC</span> <a class="popup variable">U</a>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaHi</a>           <span class="comment">\ This gives the distance along the axis of the object</span>
                        <span class="comment">\ point, i.e. the point's coordinate</span>

 <span class="mne">BPL</span> <a class="popup destination">obpt3</a>              <span class="comment">\ If the high byte of the result is positive, jump to</span>
                        <span class="comment">\ obpt3 as the result in A is already correct for the</span>
                        <span class="comment">\ absolute value (i.e. A = zDeltaHi = |zDeltaHi|)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Negate zDelta(Hi Lo) so it contains the absolute value</span>
 <span class="mne">SEC</span>                    <span class="comment">\ of the coordinate</span>
 <span class="mne">SBC</span> <a class="popup variable">zDeltaLo</a>
 <span class="mne">STA</span> <a class="popup variable">zDeltaLo</a>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">SBC</span> <a class="popup variable">zDeltaHi</a>

<span class="label">.obpt3</span><a id="obpt3" class="anchor"></a>

                        <span class="comment">\ As the angle of the triangle is at the viewer end of</span>
                        <span class="comment">\ the hypotenuse, the length of the adjacent side is</span>
                        <span class="comment">\ effectively the length of the side along the z-axis,</span>
                        <span class="comment">\ so we can use the distance as a z-coordinate</span>

 <span class="mne">STA</span> <a class="popup variable">zDeltaAbsoluteHi</a>   <span class="comment">\ Set zDeltaAbsoluteHi = |zDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute z-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (zDeltaAbsoluteHi zDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed z-axis length</span>
                        <span class="comment">\ is still in zDeltaHi</span>

                        <span class="comment">\ We now do a similar calculation for the x-axis, but</span>
                        <span class="comment">\ using sin(A) instead of cos(A) to get the length of</span>
                        <span class="comment">\ the opposite side of the triangle instead of the</span>
                        <span class="comment">\ adjacent</span>

 <span class="mne">LDA</span> <a class="popup variable">objPointDistance</a>,<span class="register">Y</span> <span class="comment">\ Set U to the polar distance of the object point</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>

 <span class="mne">LDA</span> <a class="popup variable">sinA</a>               <span class="comment">\ Set (A T) = A * U</span>
 <span class="mne">JSR</span> <a class="popup destination">Multiply8x8</a>        <span class="comment">\           = distance * sin(A)</span>

 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\ Set (A xDeltaLo) = distance * sin(A) / 256</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>

 <span class="mne">STA</span> <a class="popup variable">xDeltaAbsoluteHi</a>   <span class="comment">\ Set xDeltaAbsoluteHi = 0 so it is correctly set to the</span>
                        <span class="comment">\ high byte of (A xDeltaLo), as A is 0</span>

 <span class="mne">LDA</span> <a class="popup variable">H</a>                  <span class="comment">\ Set xDeltaHi to the sign of sin(A T) from above, so</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaHi</a>           <span class="comment">\ the calculation in GetHypotenuseAngle uses the correct</span>
                        <span class="comment">\ sign for opposite side (only the sign bit from</span>
                        <span class="comment">\ xDeltaHi is used in GetHypotenuseAngle, so this will</span>
                        <span class="comment">\ work as bits 0 to 6 of xDeltaHi will be ignored)</span>

                        <span class="comment">\ So we now have the x- and z-coordinates of the object</span>
                        <span class="comment">\ point within the object itself (i.e. relative to the</span>
                        <span class="comment">\ object's origin and rotated to the correct gaze), so</span>
                        <span class="comment">\ we can calculate the angle in that triangle, to give</span>
                        <span class="comment">\ us the yaw angle of the point relative to the object's</span>
                        <span class="comment">\ origin</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHypotenuseAngle</a> <span class="comment">\ Calculate the angle of the hypotenuse in the triangle</span>
                        <span class="comment">\ with the following non-hypotenuse sides:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * zDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and return the angle in angle(Hi Lo), the tangent in</span>
                        <span class="comment">\ angleTangent, the length of the longer side in</span>
                        <span class="comment">\ a(Hi Lo) and the length of the shorter side in</span>
                        <span class="comment">\ b(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So angle(Hi Lo) is the angle of the right-angled</span>
                        <span class="comment">\ triangle made up of the object point's object-relative</span>
                        <span class="comment">\ x- and z-coordinates, i.e. the yaw angle of the point</span>
                        <span class="comment">\ within the object, or the angle of the vector from the</span>
                        <span class="comment">\ object's origin to the to the point within the object</span>

                        <span class="comment">\ We now calculate the yaw and pitch angles of the point</span>
                        <span class="comment">\ in terms of the 3D world, storing the results in the</span>
                        <span class="comment">\ following tables:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We do this by constructing two right-angled triangles,</span>
                        <span class="comment">\ one flat on the ground (to calculate the yaw angle)</span>
                        <span class="comment">\ and the other standing vertically (to calculate the</span>
                        <span class="comment">\ pitch angle)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Let's start with the triangle on the ground</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The object has a view-relative yaw angle of:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   objectViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ which was set up by the call to the GetObjectAngles</span>
                        <span class="comment">\ routine before we called this routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This contains the yaw angle of the object relative to</span>
                        <span class="comment">\ the view</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We just calculated the object-relative yaw angle of</span>
                        <span class="comment">\ the object point in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   angle(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we add these two yaw angles together to get:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   angle(Hi Lo) + objectViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ then this gives us the view-relative yaw angle of the</span>
                        <span class="comment">\ object point, which is what we are trying to calculate</span>
                        <span class="comment">\ in this routine</span>

 <span class="mne">LDY</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ Set Y to the drawing table index for this object point</span>
                        <span class="comment">\ so we store the results in the last 32 bytes of the</span>
                        <span class="comment">\ tile view drawing tables (i.e. in the object point</span>
                        <span class="comment">\ drawing tables)</span>

 <span class="mne">LDA</span> <a class="popup variable">angleLo</a>            <span class="comment">\ Set drawViewYaw(Hi Lo) for this point to:</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">objectViewYawLo</a>    <span class="comment">\   angle(Hi Lo) + objectViewYaw(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawLo</a>,<span class="register">Y</span>    <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">angleHi</a>            <span class="comment">\ So this is the angle in our first triangle, which is</span>
 <span class="mne">ADC</span> <a class="popup variable">objectViewYawHi</a>    <span class="comment">\ the view-relative yaw angle of the object point, so</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>    <span class="comment">\ store this in the drawing table at drawViewYaw(Hi Lo)</span>

                        <span class="comment">\ We now move on to calculating the view-relative pitch</span>
                        <span class="comment">\ angle of the object point by looking at the second</span>
                        <span class="comment">\ triangle</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In the first triangle, we calculated the length and</span>
                        <span class="comment">\ angle of the hypotenuse along the ground, which</span>
                        <span class="comment">\ represents the projection from above of the vector</span>
                        <span class="comment">\ from the viewer to the object point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We're now interested in the y-axis element, so let's</span>
                        <span class="comment">\ construct a triangle that stands vertically, and whose</span>
                        <span class="comment">\ hypotenuse is the 3D vector from the viewer to the</span>
                        <span class="comment">\ object point</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The hypotenuse that we used to calculate the yaw angle</span>
                        <span class="comment">\ is now along the ground, acting as the bottom side</span>
                        <span class="comment">\ of the new triangle, i.e. the adjacent side where the</span>
                        <span class="comment">\ triangle's angle is the pitch angle</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The opposite side of the triangle is the height of the</span>
                        <span class="comment">\ point above the ground (if we're looking up) or below</span>
                        <span class="comment">\ ground (if we're looking down), which we can calculate</span>
                        <span class="comment">\ using the objPointHeight table, which contains the</span>
                        <span class="comment">\ height of the point within the object, and adding the</span>
                        <span class="comment">\ view-relative y-coordinate of the object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Given these two sides, we can then calculate the pitch</span>
                        <span class="comment">\ angle of our new triangle to give the view-relative</span>
                        <span class="comment">\ pitch angle of the object point, which is what we are</span>
                        <span class="comment">\ trying to calculate in this routine</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHypotenuse</a>      <span class="comment">\ Calculate the length of the hypotenuse in the triangle</span>
                        <span class="comment">\ with side lengths of a(Hi Lo) and b(Hi Lo) and angle</span>
                        <span class="comment">\ angleTangent, which are still set from the call to</span>
                        <span class="comment">\ GetHypotenuseAngle above to the values for the vector</span>
                        <span class="comment">\ from the object's origin to the to the point within</span>
                        <span class="comment">\ the object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this is the adjacent side of our new triangle,</span>
                        <span class="comment">\ along the ground</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The hypotenuse length is returned in hypotenuse(Hi Lo)</span>

 <span class="mne">LDY</span> <a class="popup variable">pointNumber</a>        <span class="comment">\ Set A to the objPointHeight entry for the object point</span>
 <span class="mne">LDA</span> <a class="popup variable">objPointHeight</a>,<span class="register">Y</span>   <span class="comment">\</span>
                        <span class="comment">\ The height is stored in objPointHeight as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 contains the sign bit</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 0 to 6 contain half the magnitude of the</span>
                        <span class="comment">\     height</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the height stored as a scaled, sign-magnitude value</span>
                        <span class="comment">\ that we now need to extract into a signed number</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift the sign bit into the C flag and double the</span>
                        <span class="comment">\ value in bits 0 to 6 to get the magnitude of the</span>
                        <span class="comment">\ height in A, so:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   A = |height|</span>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set (A T) = |height|</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>

 <span class="mne">BCC</span> <a class="popup destination">obpt4</a>              <span class="comment">\ If the sign bit is clear then the height is positive</span>
                        <span class="comment">\ and (A T) already has the correct sign, so jump to</span>
                        <span class="comment">\ obpt4 to skip the following</span>

                        <span class="comment">\ Otherwise the sign bit is set and the height is</span>
                        <span class="comment">\ negative, so we need to negate the absolute value to</span>
                        <span class="comment">\ get the signed height</span>

 <span class="mne">JSR</span> <a class="popup destination">Negate16Bit</a>        <span class="comment">\ Set (A T) = -(A T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the result now has the correct sign</span>

<span class="label">.obpt4</span><a id="obpt4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set (U T) = (A T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So (U T) contains the height of the object point</span>
                        <span class="comment">\ relative to the object's origin, i.e. within the</span>
                        <span class="comment">\ object</span>

                        <span class="comment">\ We already calculated the object's view-relative</span>
                        <span class="comment">\ y-coordinate in objectOpposite(Hi Lo), so now we add</span>
                        <span class="comment">\ the two together to get the height of the object</span>
                        <span class="comment">\ point, relative to the view</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set (A xDeltaLo) = (U T) + objectOpposite(Hi Lo)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">objectOppositeLo</a>   <span class="comment">\ So (A xDeltaLo) now contains the vertical delta, ready</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\ to pass to GetPitchAngleDelta</span>
 <span class="mne">LDA</span> <a class="popup variable">U</a>
 <span class="mne">ADC</span> <a class="popup variable">objectOppositeHi</a>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the object number of the viewer so the call</span>
                        <span class="comment">\ to GetPitchAngleDelta calculates the pitch angle</span>
                        <span class="comment">\ relative to the viewing object's gaze</span>

 <span class="mne">JSR</span> <a class="popup destination">GetPitchAngleDelta</a> <span class="comment">\ Set pitchDelta(Hi Lo) to the pitch angle of the vector</span>
                        <span class="comment">\ along the hypotenuse of our new triangle, given the</span>
                        <span class="comment">\ length of the vertical side in (A xDeltaLo) and the</span>
                        <span class="comment">\ length of the adjacent side in hypotenuse(Hi Lo),</span>
                        <span class="comment">\ relative to the viewing object's gaze</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the view-relative pitch angle of the</span>
                        <span class="comment">\ object point, which is what we are trying to calculate</span>
                        <span class="comment">\ in this routine</span>

 <span class="mne">LDY</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ Set Y to the drawing table index for this object point</span>
                        <span class="comment">\ so we store the results in the last 32 bytes of the</span>
                        <span class="comment">\ tile view drawing tables (i.e. in the object point</span>
                        <span class="comment">\ drawing tables)</span>

 <span class="mne">LDA</span> <a class="popup variable">pitchDeltaHi</a>       <span class="comment">\ Store pitchDelta(Hi Lo) in the drawing table as</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\ drawViewPitch(Hi Lo)</span>
 <span class="mne">LDA</span> <a class="popup variable">pitchDeltaLo</a>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>

 <span class="mne">INC</span> <a class="popup variable">pointNumber</a>        <span class="comment">\ Increment the point number to move on to the next</span>
                        <span class="comment">\ point in the object</span>

 <span class="mne">INC</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ Increment the index into the drawing table so we store</span>
                        <span class="comment">\ the results for the next point in the next byte in the</span>
                        <span class="comment">\ drawing tables</span>

 <span class="mne">LDY</span> <a class="popup variable">pointNumber</a>        <span class="comment">\ If we have reached the first point of the next object</span>
 <span class="mne">CPY</span> <a class="popup variable">objectLastPoint</a>    <span class="comment">\ then we have processed all the points in this object,</span>
 <span class="mne">BEQ</span> <a class="popup destination">obpt5</a>              <span class="comment">\ so jump to obpt5 to return from the subroutine</span>

 <span class="mne">JMP</span> <a class="popup destination">obpt1</a>              <span class="comment">\ Loop back to process the next point in the object</span>

<span class="label">.obpt5</span><a id="obpt5" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawObject</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a 3D object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawobjectstack.html">DrawObjectStack</a> calls <a href="#drawobject">DrawObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#drawobject">DrawObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleobject.html">DrawTitleObject</a> calls <a href="#drawobject">DrawObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#drawobject">DrawObject</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The number of the object to be drawn</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">Y is preserved</span>

</div></div>
<span class="label">.DrawObject</span><a id="drawobject" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetObjectAngles</a>    <span class="comment">\ Calculate the angles and distances of the vector from</span>
                        <span class="comment">\ the viewer to object #Y and put them into the</span>
                        <span class="comment">\ following variables:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set objectViewYaw(Hi Lo) to the yaw angle of the</span>
                        <span class="comment">\     viewer's gaze towards the object, relative to the</span>
                        <span class="comment">\     screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set objectGazeYaw(Hi Lo) to the difference in yaw</span>
                        <span class="comment">\     angles between the viewer's gaze towards the</span>
                        <span class="comment">\     object and the object's gaze to wherever it is</span>
                        <span class="comment">\     looking (so that's the object's gaze relative to</span>
                        <span class="comment">\     the viewer's gaze)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set hypotenuse(Hi Lo) to the length of the 3D</span>
                        <span class="comment">\     vector from the viewer to the object when</span>
                        <span class="comment">\     projected down onto the ground plane</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set objectAdjacent(Hi Lo) to the length of the</span>
                        <span class="comment">\     adjacent side in the vertical right-angled</span>
                        <span class="comment">\     triangle with the projected vector along the</span>
                        <span class="comment">\     bottom and the vector from the viewer to the</span>
                        <span class="comment">\     object as the hypotenuse</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set objectOpposite(Hi Lo) to the length of the</span>
                        <span class="comment">\     opposite side in the vertical right-angled</span>
                        <span class="comment">\     triangle with the projected vector along the</span>
                        <span class="comment">\     bottom and the vector from the viewer to the</span>
                        <span class="comment">\     object as the hypotenuse</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that hypotenuse(Hi Lo) and objectAdjacent(Hi Lo)</span>
                        <span class="comment">\ are the same value, as the hypotenuse of the ground</span>
                        <span class="comment">\ plane triangle is the same as the adjacent side of the</span>
                        <span class="comment">\ vertical triangle</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also sets objectToAnalyse to the number of the</span>
                        <span class="comment">\ object that we are drawing</span>

 <span class="mne">LDA</span> <a class="popup variable">hypotenuseHi</a>       <span class="comment">\ If hypotenuseHi (i.e. objectAdjacentHi) is greater or</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">15</span>                <span class="comment">\ equal to 15 then the object is a fair distance away</span>
 <span class="mne">ROR</span> <a class="popup variable">blendPolygonEdges</a>  <span class="comment">\ from the viewer along the z-axis, so set bit 7 of</span>
                        <span class="comment">\ blendPolygonEdges so we draw the polygon edges in the</span>
                        <span class="comment">\ same colour as the polygon body (i.e. the fill</span>
                        <span class="comment">\ colour), so the edges blend into the body</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We do this for distant objects because distinct edge</span>
                        <span class="comment">\ colours can make those object look messy</span>

 <span class="mne">JSR</span> <a class="popup destination">GetObjPointAngles</a>  <span class="comment">\ Calculate the view-relative pitch and yaw angles of</span>
                        <span class="comment">\ all the points in the object and put them into the</span>
                        <span class="comment">\ drawing tables at:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can use these as screen x- and y-coordinates, using</span>
                        <span class="comment">\ the same screen projection that is used in Revs</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ Clear bit 7 and set bit 6 of polygonType so the call</span>
 <span class="mne">STA</span> <a class="popup variable">polygonType</a>        <span class="comment">\ to DrawPolygon below draws the correct type of polygon</span>
                        <span class="comment">\ for being part of an object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set drawingPhaseCount = 0, so the default is to draw</span>
 <span class="mne">STA</span> <a class="popup variable">drawingPhaseCount</a>  <span class="comment">\ the object in one phase (we may change this later if</span>
                        <span class="comment">\ the object needs to be drawn in two phases)</span>

 <span class="mne">STA</span> <a class="popup variable">drawingPhase</a>       <span class="comment">\ Clear bit 7 of drawingPhase so for objects that need</span>
                        <span class="comment">\ two drawing phases, we start by drawing the first</span>
                        <span class="comment">\ phase (as the current phase is determined by bit 7)</span>

 <span class="mne">LDX</span> <a class="popup variable">objTypeToAnalyse</a>   <span class="comment">\ Set X to the number of the object we are drawing</span>

 <span class="mne">LDA</span> <a class="popup variable">objPolygonPhases</a>,<span class="register">X</span> <span class="comment">\ Set A to the phase data for the object we are drawing,</span>
                        <span class="comment">\ which helps determine the number of drawing phases</span>

 <span class="mne">BEQ</span> <a class="popup destination">drob4</a>              <span class="comment">\ If A = 0 then this object only has one drawing phase,</span>
                        <span class="comment">\ so jump to drob4 to move on to drawing the object</span>
                        <span class="comment">\ (this applies to the tree, the boulder, the Sentinel's</span>
                        <span class="comment">\ tower and the 3D text blocks)</span>

                        <span class="comment">\ If we get here then bit 1 of A must be set, as the</span>
                        <span class="comment">\ only values used in the objPolygonPhases table are</span>
                        <span class="comment">\ %00, %10 and %11</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ If bit 0 of A is set then this object might need two</span>
 <span class="mne">BCS</span> <a class="popup destination">drob1</a>              <span class="comment">\ drawing phases, so jump to drob1 to work out how many</span>
                        <span class="comment">\ phases are required by checking the relative altitude</span>
                        <span class="comment">\ of the object (this applies to the robot, the sentry</span>
                        <span class="comment">\ and the Sentinel)</span>

                        <span class="comment">\ If we get here then bit 0 of A is clear and bit 1 is</span>
                        <span class="comment">\ set, so we need to work out how many phases are</span>
                        <span class="comment">\ required by checking whether or not the object is</span>
                        <span class="comment">\ facing the viewer as given in the object's yaw angle</span>
                        <span class="comment">\ (this applies to the meanie only)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectGazeYawHi</a>    <span class="comment">\ Set A to the object's gaze yaw angle + 192, to turn it</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">192</span>               <span class="comment">\ anticlockwise (left) through 90 degrees for the phase</span>
                        <span class="comment">\ calculation (the addition works because the C flag is</span>
                        <span class="comment">\ clear, as we just passed through a BCS)</span>

 <span class="mne">JMP</span> <a class="popup destination">drob3</a>              <span class="comment">\ Jump to drob3 to set drawingPhaseCount to 0 or 2,</span>
                        <span class="comment">\ depending on the direction in which the meanie is now</span>
                        <span class="comment">\ facing:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 = one phase if the meanie's gaze yaw angle is</span>
                        <span class="comment">\     positive after the rotation, which means it must</span>
                        <span class="comment">\     be facing towards the viewer (so we leave</span>
                        <span class="comment">\     drawingPhaseCount = 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 2 = two phases if the meanie's gaze yaw angle is</span>
                        <span class="comment">\     negative after the rotation, which means it must</span>
                        <span class="comment">\     be facing away from the viewer (so we set the</span>
                        <span class="comment">\     drawingPhaseCount = 2)</span>

<span class="label">.drob1</span><a id="drob1" class="anchor"></a>

                        <span class="comment">\ If we get here then we are drawing a robot, a sentry</span>
                        <span class="comment">\ or the Sentinel, so we need to work out how many</span>
                        <span class="comment">\ drawing phases are required</span>

 <span class="mne">LDA</span> <a class="popup variable">objectOppositeHi</a>   <span class="comment">\ If objectOpposite(Hi Lo) has a non-zero high byte,</span>
 <span class="mne">BNE</span> <a class="popup destination">drob2</a>              <span class="comment">\ then jump to drob2 to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Draw the object in two phases if objectOppositeHi</span>
                        <span class="comment">\     is positive (i.e. the object is reasonably far</span>
                        <span class="comment">\     above the viewer)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Draw the object in one phase if objectOppositeHi</span>
                        <span class="comment">\     is negative (i.e. the object is below the viewer)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectOppositeLo</a>   <span class="comment">\ If objectOpposite(Hi Lo) = 0 then the object is at the</span>
 <span class="mne">BEQ</span> <a class="popup destination">drob4</a>              <span class="comment">\ same height as the viewer, so jump to drob4 to draw</span>
                        <span class="comment">\ the object in one phase (by leaving drawingPhaseCount</span>
                        <span class="comment">\ set to 0)</span>

                        <span class="comment">\ If we get here then objectOppositeHi is zero but</span>
                        <span class="comment">\ objectOppositeLo is non-zero, so the object is only a</span>
                        <span class="comment">\ little bit above the viewer and we draw the object in</span>
                        <span class="comment">\ two phases (so now we set drawingPhaseCount = 2)</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Clear bit 7 of A, so the following EOR instruction</span>
                        <span class="comment">\ will set bit 7, so we pass through the BPL instruction</span>
                        <span class="comment">\ and set drawingPhaseCount = 2 before falling through</span>
                        <span class="comment">\ into drob4 to do the actual drawing</span>

<span class="label">.drob2</span><a id="drob2" class="anchor"></a>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Flip bit 7 of A, which will contain objectOppositeHi</span>
                        <span class="comment">\ if we jumped here from the BNE above</span>

<span class="label">.drob3</span><a id="drob3" class="anchor"></a>

 <span class="mne">BPL</span> <a class="popup destination">drob4</a>              <span class="comment">\ If we jumped here because we are drawing a meanie,</span>
                        <span class="comment">\ then this jumps to drob4 if the updated object's gaze</span>
                        <span class="comment">\ yaw angle is positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we fell through from drob2, then this jumps to</span>
                        <span class="comment">\ drob4 if bit 7 of objectOppositeHi is set, i.e. if</span>
                        <span class="comment">\ objectOpposite(Hi Lo) is negative</span>

                        <span class="comment">\ If we get here then one of these is true:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We are drawing a meanie and it is facing away from</span>
                        <span class="comment">\     the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We are drawing a robot, a sentry or the Sentinel</span>
                        <span class="comment">\     and one of these is true:</span>
                        <span class="comment">\</span>
                        <span class="comment">\     * objectOpposite(Hi Lo) is positive and</span>
                        <span class="comment">\       objectOppositeHi > 0 (so the object is</span>
                        <span class="comment">\       reasonably far above the viewer)</span>
                        <span class="comment">\</span>
                        <span class="comment">\     * objectOppositeHi is zero and objectOppositeLo is</span>
                        <span class="comment">\       non-zero (so the object is a little bit above</span>
                        <span class="comment">\       the viewer)</span>
                        <span class="comment">\</span>
                        <span class="comment">\     In other words we are drawing a robot, a sentry or</span>
                        <span class="comment">\     the Sentinel and the object is above the viewer</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set drawingPhaseCount = 2 so we draw the object in two</span>
 <span class="mne">STA</span> <a class="popup variable">drawingPhaseCount</a>  <span class="comment">\ phases</span>

<span class="label">.drob4</span><a id="drob4" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">objTypeToAnalyse</a>   <span class="comment">\ Set X to the number of the object we are drawing</span>

 <span class="mne">LDA</span> <a class="popup variable">objPolygonRange</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>    <span class="comment">\ Set objectLastPolygon to entry X + 1 from the</span>
 <span class="mne">STA</span> <a class="popup variable">objectLastPolygon</a>      <span class="comment">\ table at objPolygonRange, so this now contains the</span>
                            <span class="comment">\ number of the first polygon for the next object,</span>
                            <span class="comment">\ object #X + 1, which is one greater than the last</span>
                            <span class="comment">\ polygon number for object #X, as the lists of</span>
                            <span class="comment">\ object polygons are sequential (so object #0's</span>
                            <span class="comment">\ polygons are first in the object data tables, then</span>
                            <span class="comment">\ object #1's polygons, and so on)</span>

 <span class="mne">LDY</span> <a class="popup variable">objPolygonRange</a>,<span class="register">X</span>  <span class="comment">\ Set Y to entry X from the table at objPolygonRange, so</span>
                        <span class="comment">\ so this now contains the number of the first polygon</span>
                        <span class="comment">\ for object #X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that in the following loop, we start the</span>
                        <span class="comment">\ drawing process with the first polygon for object #X</span>

<span class="label">.drob5</span><a id="drob5" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">polygonNumber</a>      <span class="comment">\ Set polygonNumber to Y, so we start from the first</span>
                        <span class="comment">\ polygon and work through them in order</span>

 <span class="mne">LDA</span> <a class="popup variable">objPolygonData</a>,<span class="register">Y</span>   <span class="comment">\ Set A to the polygon data byte for the polygon we are</span>
                        <span class="comment">\ drawing</span>

 <span class="mne">LDX</span> <a class="popup variable">drawingPhaseCount</a>  <span class="comment">\ If drawingPhaseCount = 0 then jump to drob6 to skip</span>
 <span class="mne">BEQ</span> <a class="popup destination">drob6</a>              <span class="comment">\ the following, as there is only one drawing phase for</span>
                        <span class="comment">\ this object</span>

 <span class="mne">EOR</span> <a class="popup variable">drawingPhase</a>       <span class="comment">\ If bit 7 of the polygon data byte does not match bit 7</span>
 <span class="mne">BMI</span> <a class="popup destination">drob7</a>              <span class="comment">\ of drawingPhase, then we do not draw this polygon in</span>
                        <span class="comment">\ this phase, so jump to drob7 to skip drawing the</span>
                        <span class="comment">\ polygon and move on to the next one</span>

                        <span class="comment">\ If we get here then bit 7 of the polygon data byte</span>
                        <span class="comment">\ matches the phase we are currently drawing, so we draw</span>
                        <span class="comment">\ the polygon</span>

<span class="label">.drob6</span><a id="drob6" class="anchor"></a>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111100</span>         <span class="comment">\ Extract bits 2 to 5 from the polygon data byte to get</span>
 <span class="mne">STA</span> <a class="popup variable">polygonColours</a>     <span class="comment">\ the polygon's edge and fill colours, and put them into</span>
                        <span class="comment">\ polygonColours</span>

 <span class="mne">LDA</span> <a class="popup variable">objPolygonData</a>,<span class="register">Y</span>   <span class="comment">\ Set A to the polygon data byte for the polygon we are</span>
                        <span class="comment">\ drawing</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ Extract bits 0 to 1 from the polygon data byte to get</span>
 <span class="mne">CLC</span>                    <span class="comment">\ the number of sides in the polygon (where 0 means</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ three sides and 1 means four sides)</span>
 <span class="mne">STA</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\</span>
                        <span class="comment">\ Then add 3 to get the number of sides in the polygon,</span>
                        <span class="comment">\ (three for a triangle or four for a quadrilateral)</span>
                        <span class="comment">\ and store the result in polygonEdgeCount</span>

 <span class="mne">LDA</span> <a class="popup variable">objPolygonAddrLo</a>,<span class="register">Y</span> <span class="comment">\ Set drawViewAngles(1 0) to the address of the list of</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewAngles</a>     <span class="comment">\ object-relative point numbers for this polygon so the</span>
 <span class="mne">LDA</span> <a class="popup variable">objPolygonAddrHi</a>,<span class="register">Y</span> <span class="comment">\ DrawPolygon routine can use the yaw and pitch angles</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewAngles</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ that we calculated for the object points in the</span>
                        <span class="comment">\ GetObjPointAngles routine</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawPolygon</a>        <span class="comment">\ Draw the polygon</span>

 <span class="mne">LDY</span> <a class="popup variable">polygonNumber</a>      <span class="comment">\ Set Y to the polygon number once again, as the call</span>
                        <span class="comment">\ to DrawPolygon will have corrupted it</span>

<span class="label">.drob7</span><a id="drob7" class="anchor"></a>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the polygon number in Y</span>

 <span class="mne">CPY</span> <a class="popup variable">objectLastPolygon</a>  <span class="comment">\ If we have not yet reached the end of the list, loop</span>
 <span class="mne">BCC</span> <a class="popup destination">drob5</a>              <span class="comment">\ back to drob5 to draw the next polygon, until we have</span>
                        <span class="comment">\ processed all the polygons in the object</span>

 <span class="mne">DEC</span> <a class="popup variable">drawingPhaseCount</a>  <span class="comment">\ Decrement the drawing phase counter</span>

 <span class="mne">BMI</span> <a class="popup destination">drob8</a>              <span class="comment">\ If drawingPhaseCount was zero before being decremented</span>
                        <span class="comment">\ then there is only one drawing phase, so jump to drob8</span>
                        <span class="comment">\ to finish up</span>

 <span class="mne">BEQ</span> <a class="popup destination">drob8</a>              <span class="comment">\ If drawingPhaseCount was 1 before being decremented</span>
                        <span class="comment">\ then there are two drawing phases and we have just</span>
                        <span class="comment">\ finished drawing the second phase, so jump to drob8 to</span>
                        <span class="comment">\ finish up</span>

                        <span class="comment">\ If we get here then drawingPhaseCount was 2 before</span>
                        <span class="comment">\ being decremented, so this is a two-phase object and</span>
                        <span class="comment">\ we have only drawn the first phase, so now we draw the</span>
                        <span class="comment">\ second phase</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of drawingPhase so we now draw the second</span>
 <span class="mne">STA</span> <a class="popup variable">drawingPhase</a>       <span class="comment">\ phase</span>

 <span class="mne">BMI</span> <a class="popup destination">drob4</a>              <span class="comment">\ Jump back to drob4 to draw the second phase for the</span>
                        <span class="comment">\ two-phase object</span>

<span class="label">.drob8</span><a id="drob8" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">polygonPoint</a><span class="bracket">)</span>  <span class="comment">\ Set drawViewAngles(1 0) = polygonPoint</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewAngles</a>     <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">polygonPoint</a><span class="bracket">)</span>  <span class="comment">\ This resets drawViewAngles(1 0) so DrawPolygon will</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewAngles</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ return to the default behaviour of drawing using point</span>
                        <span class="comment">\ data for tile faces rather than object polygons</span>

 <span class="mne">LSR</span> <a class="popup variable">blendPolygonEdges</a>  <span class="comment">\ Clear bit 7 of blendPolygonEdges so we return to the</span>
                        <span class="comment">\ default setting of allowing drawing polygon edges to</span>
                        <span class="comment">\ be a different colour to the polygon fill</span>

 <span class="mne">LDY</span> <a class="popup variable">objectToAnalyse</a>    <span class="comment">\ Set Y to the number of the object we just drew, so it</span>
                        <span class="comment">\ is preserved</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gethorizontaldelta" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetHorizontalDelta</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Geometry)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the difference in the x-axis and z-axis between two</span>
             <span class="headerEntry">objects, as both signed and absolute deltas</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gethorizontaldelta.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getobjectangles.html">GetObjectAngles</a> calls <a href="#gethorizontaldelta">GetHorizontalDelta</a></span>
</div>
<hr class="light">
 This routine calculates the following:

   xDelta(Hi Lo) = x-coordinate of object #Y - x-coordinate of object #X
                                                   - xTitleOffset

   xDeltaAbsoluteHi = |xDeltaHi|

   zDelta(Hi Lo) = z-coordinate of object #Y - z-coordinate of object #X

   zDeltaAbsoluteHi = |zDeltaHi|

 So this calculates the difference (the "delta") in both the x-coordinate and
 z-coordinate between the two objects, which are the differences along the
 left-right x-axis and the z-axis the goes into the screen.

 Note that xTitleOffset is zero during gameplay, and is only non-zero when we
 are drawing large 3D text on the title screen.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the first object</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The number of the second object</span>

</div></div>
<span class="label">.GetHorizontalDelta</span><a id="gethorizontaldelta" class="anchor"></a>

                        <span class="comment">\ The x-coordinates for each object are stored as 8-bit</span>
                        <span class="comment">\ signed integers, with the x-coordinate for object #X</span>
                        <span class="comment">\ in xObject+X and for object #Y in xObject+Y</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We want to calculate the deltas in 16-bit accuracy,</span>
                        <span class="comment">\ where the low byte is effectively a fractional part,</span>
                        <span class="comment">\ so we convert these x-coordinates into 16-bit numbers</span>
                        <span class="comment">\ like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * x-coordinate for object #X = (xObject+X 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * x-coordinate for object #Y = (xObject+Y 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and we then do a multi-byte subtraction to get the</span>
                        <span class="comment">\ delta, with the title offset included in the</span>
                        <span class="comment">\ calculation as (xTitleOffset 0)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Calculate the following:</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\</span>
                        <span class="comment">\   xDelta(Hi Lo) = (xObject+Y 0) - (xObject,X 0)</span>
                        <span class="comment">\                                 - (xTitleOffset 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low byte (which we know will be</span>
                        <span class="comment">\ zero)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ And then subtracting the high bytes</span>
 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">Y</span>
 <span class="mne">SBC</span> <a class="popup variable">xObject</a>,<span class="register">X</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <a class="popup variable">xTitleOffset</a>
 <span class="mne">STA</span> <a class="popup variable">xDeltaHi</a>

 <span class="mne">BPL</span> <a class="popup destination">delt1</a>              <span class="comment">\ If the high byte of the result is positive, jump to</span>
                        <span class="comment">\ delt1 as the result in A is already correct for the</span>
                        <span class="comment">\ absolute value (i.e. A = xDeltaHi = |xDeltaHi|)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The high byte is negative, so set:</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xDeltaHi</a>           <span class="comment">\   A = 0 - xDeltaHi</span>
                        <span class="comment">\     = -xDeltaHi</span>
                        <span class="comment">\     = |xDeltaHi|</span>

<span class="label">.delt1</span><a id="delt1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xDeltaAbsoluteHi</a>   <span class="comment">\ Set xDeltaAbsoluteHi = |xDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute x-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (xDeltaAbsoluteHi xDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed x-axis length</span>
                        <span class="comment">\ is still in xDeltaHi</span>

                        <span class="comment">\ We now do the same thing, but with the z-coordinates</span>
                        <span class="comment">\</span>
                        <span class="comment">\ There is no title delta to include for the z-axis</span>
                        <span class="comment">\ calculation</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Calculate the following:</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaLo</a>           <span class="comment">\</span>
                        <span class="comment">\   zDelta(Hi Lo) = (zObject+Y 0) - (zObject,X 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low byte (which we know will be</span>
                        <span class="comment">\ zero)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ And then subtracting the high bytes</span>
 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">Y</span>
 <span class="mne">SBC</span> <a class="popup variable">zObject</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaHi</a>

 <span class="mne">BPL</span> <a class="popup destination">delt2</a>              <span class="comment">\ If the high byte of the result is positive, jump to</span>
                        <span class="comment">\ delt2 as the result in A is already correct for the</span>
                        <span class="comment">\ absolute value (i.e. A = zDeltaHi = |zDeltaHi|)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The high byte is negative, so set:</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">zDeltaHi</a>           <span class="comment">\   A = 0 - zDeltaHi</span>
                        <span class="comment">\     = -zDeltaHi</span>
                        <span class="comment">\     = |zDeltaHi|</span>

<span class="label">.delt2</span><a id="delt2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">zDeltaAbsoluteHi</a>   <span class="comment">\ Set zDeltaAbsoluteHi = |zDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute z-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (zDeltaAbsoluteHi zDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed z-axis length</span>
                        <span class="comment">\ is still in zDeltaHi</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getverticaldelta" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetVerticalDelta</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Geometry)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the difference in the y-axis between two objects as a</span>
             <span class="headerEntry">signed delta</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getverticaldelta.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getobjectangles.html">GetObjectAngles</a> calls <a href="#getverticaldelta">GetVerticalDelta</a></span>
</div>
<hr class="light">
 This routine calculates the following:

   yDelta(Hi Lo) = y-coordinate of object #Y - y-coordinate of object #X

 So yDelta(Hi Lo) contains the difference (the "delta") in the y-coordinate
 between the two objects, which is the difference in altitude.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the first object</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The number of the second object</span>

</div></div>
<span class="label">.GetVerticalDelta</span><a id="getverticaldelta" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">yObjectLo</a>,<span class="register">Y</span>        <span class="comment">\ Set yDelta(Hi Lo) =   yObject(Hi Lo) for object #Y</span>
 <span class="mne">SEC</span>                    <span class="comment">\                     - yObject(Hi Lo) for object #X</span>
 <span class="mne">SBC</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">yDeltaLo</a>           <span class="comment">\ starting with the low bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">Y</span>        <span class="comment">\ And then the high bytes</span>
 <span class="mne">SBC</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">yDeltaHi</a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-readkeyboard" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ReadKeyboard</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Enable the keyboard and read a character from it</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/readkeyboard.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#readkeyboard">ReadKeyboard</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#readkeyboard">ReadKeyboard</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/playgame.html">PlayGame</a> calls <a href="#readkeyboard">ReadKeyboard</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/secretcodeerror.html">SecretCodeError</a> calls <a href="#readkeyboard">ReadKeyboard</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The character read from the keyboard</span>

</div></div>
<span class="label">.ReadKeyboard</span><a id="readkeyboard" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">EnableKeyboard</a>     <span class="comment">\ Select the keyboard as the input stream and flush the</span>
                        <span class="comment">\ keyboard buffer</span>

                        <span class="comment">\ Fall through into ReadCharacter to read a character</span>
                        <span class="comment">\ from the keyboard and return it in A</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-readcharacter" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ReadCharacter</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Read a character from the currently selected input stream</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/readcharacter.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/readnumber.html">ReadNumber</a> calls <a href="#readcharacter">ReadCharacter</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The character read from the input stream, in ASCII</span>

</div></div>
<span class="label">.ReadCharacter</span><a id="readcharacter" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">OSRDCH</a>             <span class="comment">\ Read a character from the currently selected input</span>
                        <span class="comment">\ stream into A</span>

 <span class="mne">BCC</span> <a class="popup destination">read1</a>              <span class="comment">\ If the C flag is clear then the call to OSRDCH read a</span>
                        <span class="comment">\ valid character, so jump to read1 to return from the</span>
                        <span class="comment">\ subroutine</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">27</span>                <span class="comment">\ If the character read is not ESCAPE, jump to read1 to</span>
 <span class="mne">BNE</span> <a class="popup destination">read1</a>              <span class="comment">\ return from the subroutine</span>

                        <span class="comment">\ If we get here then we have an ESCAPE condition, so we</span>
                        <span class="comment">\ need to acknowledge it and try again</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Store Y on the stack to we can preserve it through the</span>
 <span class="mne">PHA</span>                    <span class="comment">\ call to OSBYTE</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">126</span>               <span class="comment">\ Call OSBYTE with A = 126 to acknowledge the ESCAPE</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>             <span class="comment">\ condition</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve Y from the stack</span>
 <span class="mne">TAY</span>

 <span class="mne">JMP</span> <a class="popup destination">ReadCharacter</a>      <span class="comment">\ Loop back to read another character</span>

<span class="label">.read1</span><a id="read1" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-enablekeyboard" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">EnableKeyboard</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Select the keyboard as the input stream and flush the keyboard</span>
             <span class="headerEntry">buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/enablekeyboard.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/readkeyboard.html">ReadKeyboard</a> calls <a href="#enablekeyboard">EnableKeyboard</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/readnumber.html">ReadNumber</a> calls <a href="#enablekeyboard">EnableKeyboard</a></span>
</div>
</div></div>
<span class="label">.EnableKeyboard</span><a id="enablekeyboard" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Call OSBYTE with A = 2 and X = 0 to select the</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ keyboard as the input stream and disable the RS423</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set X = 0 to denote the keyboard buffer</span>

 <span class="mne">JMP</span> <a class="popup destination">FlushBuffer</a>        <span class="comment">\ Call FlushBuffer to flush the keyboard buffer and</span>
                        <span class="comment">\ return from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-setcolourpalette" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SetColourPalette</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set the logical colours for each of the four physical colours in</span>
             <span class="headerEntry">screen mode 5</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/setcolourpalette.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#setcolourpalette">SetColourPalette</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#setcolourpalette">SetColourPalette</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/playgame.html">PlayGame</a> calls <a href="#setcolourpalette">SetColourPalette</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/secretcodeerror.html">SecretCodeError</a> calls <a href="#setcolourpalette">SetColourPalette</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">Defines how the four physical colours in the mode 5</span>
                        <span class="argumentEntry">palette are set:</span>

                        <span class="argumentEntry">  * If bit 7 is clear then bits 0-6 contain the physical</span>
                        <span class="argumentEntry">    colour to set for all four logical colours (so the</span>
                        <span class="argumentEntry">    screen is effectively blanked to this colour)</span>

                        <span class="argumentEntry">  * If bit 7 is set then bits 0-6 contain the offset</span>
                        <span class="argumentEntry">    within the colourPalettes table of the last of the</span>
                        <span class="argumentEntry">    four physical colours to set for logical colours</span>
                        <span class="argumentEntry">    3, 2, 1 and 0 (so we work backwards through the</span>
                        <span class="argumentEntry">    table from the offset in bits 0-6)</span>

</div></div>
<span class="label">.SetColourPalette</span><a id="setcolourpalette" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Store the argument in T</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%01111111</span>         <span class="comment">\ Extract bits 0-6 of the argument into Y</span>
 <span class="mne">TAY</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ We now work through the logical colours from 3 down</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ to 0, setting the physical colour for each one in</span>
                        <span class="comment">\ turn, so set a logical colour counter in U</span>

<span class="label">.pall1</span><a id="pall1" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">T</a>                  <span class="comment">\ Set X to the argument in T</span>

 <span class="mne">BPL</span> <a class="popup destination">pall2</a>              <span class="comment">\ If bit 7 of the argument in T is clear, skip the</span>
                        <span class="comment">\ following instruction, so X contains the physical</span>
                        <span class="comment">\ colour in the routine's argument (i.e. the colour to</span>
                        <span class="comment">\ which we set all four logical colours)</span>

                        <span class="comment">\ If we get here then bit 7 of the argument in T is set,</span>
                        <span class="comment">\ which means bits 0-6 contain the offset within the</span>
                        <span class="comment">\ colourPalettes table of the four physical colours in</span>
                        <span class="comment">\ the palette</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We set Y above to the value of bits 0-6, so we can use</span>
                        <span class="comment">\ this as the index into the colourPalettes table (we</span>
                        <span class="comment">\ will decrement Y below for each of the four colours,</span>
                        <span class="comment">\ so we end up setting all four logical colours to the</span>
                        <span class="comment">\ four values in the table)</span>

 <span class="mne">LDX</span> <a class="popup variable">colourPalettes</a>,<span class="register">Y</span>   <span class="comment">\ Fetch the physical colour from the Y-th entry in</span>
                        <span class="comment">\ colourPalettes, which we now want to allocate to</span>
                        <span class="comment">\ logical colour U</span>

<span class="label">.pall2</span><a id="pall2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">19</span>                <span class="comment">\ Start a VDU 19 command, which sets a logical colour to</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWRCH</a>             <span class="comment">\ a physical colour using the following format:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   VDU 19, logical, physical, 0, 0, 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ which we output as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   VDU 19, U, X, 0, 0, 0</span>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ Write the value in U, which is the logical colour we</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWRCH</a>             <span class="comment">\ want to define</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the value in X</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set X = 4 to use as a byte counter as we output the</span>
                        <span class="comment">\ physical colour and three zeroes</span>

<span class="label">.pall3</span><a id="pall3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">OSWRCH</a>             <span class="comment">\ Write the value in A, which is the physical colour we</span>
                        <span class="comment">\ want to set (in the first iteration of the loop), or</span>
                        <span class="comment">\ one of three trailing zeroes (in later iterations)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so the remaining three iterations of the</span>
                        <span class="comment">\ loop output the trailing zeroes</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BNE</span> <a class="popup destination">pall3</a>              <span class="comment">\ Loop back until we have output the whole VDU command</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the colourPalettes index in Y</span>

 <span class="mne">DEC</span> <a class="popup variable">U</a>                  <span class="comment">\ Decrement the logical colour counter in U</span>

 <span class="mne">BPL</span> <a class="popup destination">pall1</a>              <span class="comment">\ Loop back until we have defined the logical colours</span>
                        <span class="comment">\ for all four physical colours</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-colourpalettes" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">colourPalettes</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The logical colours for two mode 5 palettes</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/colourpalettes.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/setcolourpalette.html">SetColourPalette</a> uses <a href="#colourpalettes">colourPalettes</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a> uses <a href="#colourpalettes">colourPalettes</a></span>
</div>
<hr class="light">
 This table contains the logical colours that are set in the SetColourPalette
 routine when it is called with an argument with bit 7 set. This routine is
 only ever called with an argument of &83 or &87.

 If the argument to SetColourPalette is &83 then the palette is set to the
 correct colours for playing the current landscape. The colours are set in the
 SpawnEnemies routine when the landscape is generated. Colours 0 and 1 are
 always blue and black, but colours 2 and 3 are set to different physical
 colours depending on the number of enemies in the landscape. The different
 palettes are as follows:

   * Enemy count = 1: blue, black, white, green

   * Enemy count = 2: blue, black, yellow, red

   * Enemy count = 3: blue, black, cyan, yellow

   * Enemy count = 4: blue, black, red, cyan

   * Enemy count = 5: blue, black, white, red

   * Enemy count = 6: blue, black, yellow, cyan

   * Enemy count = 7: blue, black, cyan, red

   * Enemy count = 8: blue, black, red, yellow

 Landscape 0000 has one enemy, so the starting landscape is therefore in blue,
 black, white and green.

 If the argument to SetColourPalette is &87, the palette is set as follows:

   * Colour 0 = 4 (blue)

   * Colour 1 = 0 (black)

   * Colour 2 = 1 (red)

   * Colour 3 = 3 (yellow)

 This palette is fixed and is used for the title screens.

</div></div>
<span class="label">.colourPalettes</span><a id="colourpalettes" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">4</span><span class="comma">,</span> <span class="decimal">0</span><span class="comma">,</span> <span class="decimal">6</span><span class="comma">,</span> <span class="decimal">3</span>        <span class="comment">\ Palette with SetColourPalette offset 3</span>

 <span class="mne">EQUB</span> <span class="decimal">4</span><span class="comma">,</span> <span class="decimal">0</span><span class="comma">,</span> <span class="decimal">1</span><span class="comma">,</span> <span class="decimal">3</span>        <span class="comment">\ Palette with SetColourPalette offset 7</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ditherscreenbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DitherScreenBuffer</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Dither the contents of the screen buffer onto the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/ditherscreenbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#ditherscreenbuffer">DitherScreenBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">ditherOuterLoop</span>      <span class="argumentEntry">The number of outer loops to implement for the dithered</span>
                        <span class="argumentEntry">effect, where each inner loop dithers 255 pixels to the</span>
                        <span class="argumentEntry">screen</span>

</div></div>
<span class="label">.DitherScreenBuffer</span><a id="ditherscreenbuffer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ Each inner loop of the dithering process updates 255</span>
 <span class="mne">STA</span> <a class="popup variable">ditherInnerLoop</a>    <span class="comment">\ random pixels on-screen, so set the inner loop counter</span>
                        <span class="comment">\ in ditherInnerLoop accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Set bufferWidthBytes = bufferColumns * 8</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ This converts the number of character columns into</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ pixel bytes, as each character block contains eight</span>
 <span class="mne">STA</span> <a class="popup variable">bufferWidthBytes</a>   <span class="comment">\ bytes</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set A = bufferWidthBytes - 1</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>

                        <span class="comment">\ We now set bitMask to a bit mask that covers all the</span>
                        <span class="comment">\ non-zero bits in the list length in A, so if A is of</span>
                        <span class="comment">\ the form %001xxxxx, for example, then bitMask will</span>
                        <span class="comment">\ contain %00111111, while A being like %000001xx will</span>
                        <span class="comment">\ give a bitMask of %00000111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To do this we count the number of continuous clear</span>
                        <span class="comment">\ bits at the top of A, and then use this as an index</span>
                        <span class="comment">\ into the leadingBitMask table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we count zeroes from bit 7 down until we hit a 1,</span>
                        <span class="comment">\ and put the result into Y</span>

 <span class="mne">BEQ</span> <a class="popup destination">dith2</a>              <span class="comment">\ If A = 0 then jump to dith2 to skip the following</span>
                        <span class="comment">\ process and set bitMaskDither to %00000000, which has</span>
                        <span class="comment">\ the same number of leading zeroes as A</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Set Y = -1 so the following loop counts the number of</span>
                        <span class="comment">\ zeroes correctly</span>

<span class="label">.dith1</span><a id="dith1" class="anchor"></a>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift A to the left, moving the top bit into the C</span>
                        <span class="comment">\ flag</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the zero counter in Y</span>

 <span class="mne">BCC</span> <a class="popup destination">dith1</a>              <span class="comment">\ Loop back to keep shifting and counting zeroes until</span>
                        <span class="comment">\ we shift a 1 out of bit 7, at which point Y contains</span>
                        <span class="comment">\ the length of the run of zeroes in bits 7 to 0 of the</span>
                        <span class="comment">\ buffer width in bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">leadingBitMask</a>,<span class="register">Y</span>   <span class="comment">\ Set A to the Y-th entry from the leadingBitMask table,</span>
                        <span class="comment">\ which will give us a bit mask with a matching number</span>
                        <span class="comment">\ of leading zeroes as A</span>

<span class="label">.dith2</span><a id="dith2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">bitMaskDither</a>      <span class="comment">\ Set bitMaskDither to a bit mask with a matching number</span>
                        <span class="comment">\ of leading zeroes as the buffer width in bytes</span>

<span class="label">.dith3</span><a id="dith3" class="anchor"></a>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so we can fetch a random number</span>
                        <span class="comment">\ without clashing with the dithering process in the</span>
                        <span class="comment">\ handler (which is activated on the game over screen,</span>
                        <span class="comment">\ which also uses this routine)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetRandomNumber</a>    <span class="comment">\ Set A to a random number</span>

 <span class="mne">LDY</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">1</span>  <span class="comment">\ Set ditherRandom to the second byte of the random</span>
 <span class="mne">STY</span> <a class="popup variable">ditherRandom</a>       <span class="comment">\ number generator, so this is also a random number</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + pixelByteToDither</span>
 <span class="mne">ADC</span> <a class="popup variable">pixelByteToDither</a>  <span class="comment">\</span>
                        <span class="comment">\ This sets A to a random value in the range 0 to 255</span>
                        <span class="comment">\ that's unlikely to be the same as pixelByteToDither,</span>
                        <span class="comment">\ which is the pixel byte that we dithered last time we</span>
                        <span class="comment">\ were here</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We don't care that pixelByteToDither isn't initialised</span>
                        <span class="comment">\ outside of the reset routine, as we want this to be</span>
                        <span class="comment">\ random</span>

 <span class="mne">AND</span> <a class="popup variable">bitMaskDither</a>      <span class="comment">\ We set bitMaskDither above to a bit mask that has a</span>
                        <span class="comment">\ matching number of leading zeroes as the number of</span>
                        <span class="comment">\ bytes in the buffer width, so this instruction</span>
                        <span class="comment">\ converts A into a number with the same range of</span>
                        <span class="comment">\ non-zero bits as bufferWidthBytes</span>

 <span class="mne">CMP</span> <a class="popup variable">bufferWidthBytes</a>   <span class="comment">\ If A &lt; bufferWidthBytes then jump to dith4 to skip the</span>
 <span class="mne">BCC</span> <a class="popup destination">dith4</a>              <span class="comment">\ next instruction</span>

 <span class="mne">SBC</span> <a class="popup variable">bufferWidthBytes</a>   <span class="comment">\ Subtract bufferWidthBytes from A to bring it into the</span>
                        <span class="comment">\ range 0 to bufferWidthBytes (which works because we</span>
                        <span class="comment">\ already reduced A to a maximum value of bitMaskDither,</span>
                        <span class="comment">\ so A must be less than bufferWidthBytes * 2)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The subtraction works because we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

<span class="label">.dith4</span><a id="dith4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">pixelByteToDither</a>  <span class="comment">\ Set pixelByteToDither to the result in A, which is a</span>
                        <span class="comment">\ valid pixel byte number within the range of the pixel</span>
                        <span class="comment">\ bytes in the screen buffer row</span>

                        <span class="comment">\ We now set (ditherStore A) to the address of a random</span>
                        <span class="comment">\ row in the screen buffer, as an offset from the first</span>
                        <span class="comment">\ screen row buffer at screenBufferRow0, using bits 0 to</span>
                        <span class="comment">\ 4 of the random number in ditherRandom</span>

 <span class="mne">LDA</span> <a class="popup variable">ditherRandom</a>       <span class="comment">\ Set ditherStore to bits 0 to 4 of our random number,</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00011111</span>         <span class="comment">\ so that's a number in the range 0 to &1F</span>
 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set ditherStore = ditherStore / 2 + ditherStore</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ and round the result down to the nearest even number,</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111110</span>         <span class="comment">\ so that's an even number in the range 0 to &2E</span>
 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set A = ditherStore * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
                        <span class="comment">\ So that's a multiple of 8 in the range 0 to &B8</span>

 <span class="mne">ADC</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ Set ditherStore = ditherStore + A</span>
 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\</span>
                        <span class="comment">\ So that's an even number in the range 0 to &2E</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set (ditherStore A) = (ditherStore 0) / 8</span>
 <span class="mne">LSR</span> <a class="popup variable">ditherStore</a>        <span class="comment">\</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ This gives us the address of a randomly picked screen</span>
 <span class="mne">LSR</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ row in (ditherStore A), as an offset from within</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ screen memory ???</span>
 <span class="mne">LSR</span> <a class="popup variable">ditherStore</a>
 <span class="mne">ROR</span> <span class="register">A</span>

 <span class="mne">ADC</span> <a class="popup variable">pixelByteToDither</a>  <span class="comment">\ Set the following:</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\   fromAddr(1 0) = (ditherStore A) + pixelByteToDither</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ So fromAddr(1 0) now contains the offset address</span>
                        <span class="comment">\ within screen memory of a randomly picked pixel byte</span>
                        <span class="comment">\ within the width of the screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is calculated by adding the address of a randomly</span>
                        <span class="comment">\ picked screen row in (ditherStore A) and a randomly</span>
                        <span class="comment">\ picked pixel byte within the width of the screen</span>
                        <span class="comment">\ buffer in pixelByteToDither</span>

                        <span class="comment">\ The address in fromAddr(1 0) is now the offset within</span>
                        <span class="comment">\ screen memory of the random pixel byte that we can use</span>
                        <span class="comment">\ for dithering one pixel of the screen buffer to the</span>
                        <span class="comment">\ screen (as we will dither just one pixel of this byte</span>
                        <span class="comment">\ on each iteration of the inner loop)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The next step is to convert this offset into both a</span>
                        <span class="comment">\ screen memory address and the corresponding screen</span>
                        <span class="comment">\ buffer address, so we can copy the pixel from the</span>
                        <span class="comment">\ screen buffer to the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We start with the screen memory address</span>

 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a>      <span class="comment">\ Set (A toAddr) = objScreenAddr(1 0) + fromAddr(1 0)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ This gives us the address in screen memory of the</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>             <span class="comment">\ random pixel byte, as objScreenAddr(1 0) contains the</span>
 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ screen address of the object</span>
 <span class="mne">ADC</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">dith5</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.dith5</span><a id="dith5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   toAddr(1 0) = objScreenAddr(1 0) + fromAddr(1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

                        <span class="comment">\ And now we calculate the equivalent address in the</span>
                        <span class="comment">\ screen buffer, which is a column buffer, so we start</span>
                        <span class="comment">\ by adding the offset in fromAddr(1 0) to the address</span>
                        <span class="comment">\ of the first screen buffer row at screenBufferRow0</span>
                        <span class="comment">\ (we can skip adding the low bytes as the low byte of</span>
                        <span class="comment">\ screenBufferRow0 is zero)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It's worth noting that the structure of the screen</span>
                        <span class="comment">\ buffer is similar to the screen, with each row in</span>
                        <span class="comment">\ the screen buffer being spaced out by 320 bytes, just</span>
                        <span class="comment">\ as in screen memory, so this means we can just add</span>
                        <span class="comment">\ screenBufferRow0 and fromAddr(1 0) to get the address</span>
                        <span class="comment">\</span>
                        <span class="comment">\ However, as we use a column buffer to update objects</span>
                        <span class="comment">\ on-screen, we need to wrap around after buffer row 15,</span>
                        <span class="comment">\ so we also need to check for this</span>

 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ Set fromAddr(1 0) = screenBufferRow0 + fromAddr(1 0)</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a><span class="bracket">)</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&53</span>               <span class="comment">\ If the result of the addition is less than &5300, then</span>
 <span class="mne">BCC</span> <a class="popup destination">dith6</a>              <span class="comment">\ we have not reached the end of row 15 in the screen</span>
                        <span class="comment">\ buffer, so jump to dith6 to skip the following</span>

 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ Set fromAddr(1 0) = fromAddr(1 0) - &1360</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ If we get here then we have reached character row 16</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ in the screen buffer, so we need to wrap around</span>
 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&13</span>               <span class="comment">\ The value of &1360 is calculated as follows</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\</span>
                        <span class="comment">\ Character row 15 in the screen buffer is at address</span>
                        <span class="comment">\ &51C0, and adding another 320 to that address gives</span>
                        <span class="comment">\ us &5300, but this is past the end of the screen</span>
                        <span class="comment">\ buffer, so we need to wrap it around</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Character row 16 is actually at address &3FA0, so we</span>
                        <span class="comment">\ need to subtract &5300 - &3FA0 = &1360 from the</span>
                        <span class="comment">\ address to perform the wraparound</span>

<span class="label">.dith6</span><a id="dith6" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">ditherRandom</a>       <span class="comment">\ Set X to bits 6 and 7 of ditherRandom, shifted into</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ bits 0 and 1 to create a random number in the range</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ 0 to 3</span>
 <span class="mne">ROL</span> <span class="register">A</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>
 <span class="mne">TAX</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A to the pixel byte that we want to dither onto</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>       <span class="comment">\ the screen, taking it from the screen buffer at</span>
                        <span class="comment">\ address fromAddr(1 0)</span>

 <span class="mne">AND</span> <a class="popup variable">pixelBitMask</a>,<span class="register">X</span>     <span class="comment">\ Convert X from a number in the range 0 to 3 into a bit</span>
                        <span class="comment">\ mask with that pixel number set (where pixel 0 is on</span>
                        <span class="comment">\ the left and pixel 3 is on the right), and clear all</span>
                        <span class="comment">\ the bits in A apart from the two bits for that pixel</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if X is 2, for example, the resulting mask will be</span>
                        <span class="comment">\ %00100010, in which pixel 2 is set, so only these two</span>
                        <span class="comment">\ bits of the pixel byte will be kept</span>

 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ Store the pixel that we want to dither in ditherStore</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>         <span class="comment">\ Set A to the current screen contents of the pixel byte</span>
                        <span class="comment">\ that we are updating,  taking it from the screen at</span>
                        <span class="comment">\ address toAddr(1 0)</span>

 <span class="mne">AND</span> <a class="popup variable">clearPixelMask</a>,<span class="register">X</span>   <span class="comment">\ Clear the pixel number in A by applying a pixel bit</span>
                        <span class="comment">\ mask from clearPixelMask where the bits for every</span>
                        <span class="comment">\ pixel are set except for pixel X</span>

 <span class="mne">ORA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ Set the colour of pixel X to the colour of the pixel</span>
                        <span class="comment">\ from the screen buffer by OR'ing in the pixel bits</span>
                        <span class="comment">\ that we set above</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>         <span class="comment">\ Store the updated pixel byte in screen memory to draw</span>
                        <span class="comment">\ the pixel from the screen buffer on-screen</span>

 <span class="mne">BIT</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ If bit 7 of doNotDitherObject is set then the dithered</span>
 <span class="mne">BMI</span> <a class="popup destination">dith8</a>              <span class="comment">\ effect has been disabled (while we focus on processing</span>
                        <span class="comment">\ an action key), so jump to dith8 to return from the</span>
                        <span class="comment">\ subroutine without doing any more dithering</span>

 <span class="mne">DEC</span> <a class="popup variable">ditherInnerLoop</a>    <span class="comment">\ Decrement the inner loop counter</span>

 <span class="mne">BNE</span> <a class="popup destination">dith7</a>              <span class="comment">\ If we have not yet finished the inner loop, jump to</span>
                        <span class="comment">\ dith7 to loop back to dither another pixel onto the</span>
                        <span class="comment">\ screen, until we have done all 255 pixels in the</span>
                        <span class="comment">\ inner loop</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">DEC</span> <a class="popup variable">ditherOuterLoop</a>    <span class="comment">\ Decrement the outer loop counter</span>

 <span class="mne">BEQ</span> <a class="popup destination">dith8</a>              <span class="comment">\ If we have finished the outer loop, jump to dith8 to</span>
                        <span class="comment">\ return from the subroutine</span>

<span class="label">.dith7</span><a id="dith7" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">dith3</a>              <span class="comment">\ Loop back to dither another pixel onto the screen</span>

<span class="label">.dith8</span><a id="dith8" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-showgameoverscreen" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ShowGameOverScreen</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Display the game over screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/showgameoverscreen.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#showgameoverscreen">ShowGameOverScreen</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#showgameoverscreen">ShowGameOverScreen</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of 2400-dot plotting cycles to perform when</span>
                        <span class="argumentEntry">decaying the screen from the landscape view to the game</span>
                        <span class="argumentEntry">over screen</span>

                        <span class="argumentEntry">  * 5 = 12,000 dots for when the player runs out of</span>
                        <span class="argumentEntry">        energy when trying to hyperspace</span>

                        <span class="argumentEntry">  * 30 = 72,000 dots for when the player is absorbed by</span>
                        <span class="argumentEntry">         the Sentinel</span>

   <span class="argumentLabel">titleObjectToDraw</span>    <span class="argumentEntry">The type of object that caused the player's demise (be</span>
                        <span class="argumentEntry">it the Sentinel, a sentry, a meanie or the player</span>
                        <span class="argumentEntry">themselves)</span>

</div></div>
<span class="label">.ShowGameOverScreen</span><a id="showgameoverscreen" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the argument in A on the stack, so we can fetch</span>
                        <span class="comment">\ it later</span>

 <span class="mne">JSR</span> <a class="popup destination">FlushSoundBuffers</a>  <span class="comment">\ Flush all four sound channel buffers</span>

 <span class="mne">JSR</span> <a class="popup destination">ClearIconsScanner</a>  <span class="comment">\ Clear the energy icon and scanner row at the top of</span>
                        <span class="comment">\ the screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Set soundEffect = 6 so the sound is processed as the</span>
 <span class="mne">STA</span> <a class="popup variable">soundEffect</a>        <span class="comment">\ game over sound</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">250</span>               <span class="comment">\ Set gameOverSoundPitch = 250 to start the sound effect</span>
 <span class="mne">STA</span> <a class="popup variable">gameOverSoundPitch</a> <span class="comment">\ processing for the game over sound</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the argument A from the stack, so it contains</span>
                        <span class="comment">\ the number of black dots to draw on the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DecayScreenToBlack</a> <span class="comment">\ Decay the screen to black with a mass of A * 2400</span>
                        <span class="comment">\ randomly placed black dots</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set sightsByteCount to zero to reset the sights pixel</span>
 <span class="mne">STY</span> <a class="popup variable">sightsByteCount</a>    <span class="comment">\ byte stash</span>

 <span class="mne">STY</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ Clear bit 7 of sightsAreVisible to indicate that the</span>
                        <span class="comment">\ sights are not visible</span>

 <span class="mne">LDA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ Call SpawnTitleObject to spawn an object of type</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnTitleObject</a>   <span class="comment">\ titleObjectToDraw as object #1, using the</span>
                        <span class="comment">\ configuration specified in Y (i.e. 0), so the object</span>
                        <span class="comment">\ is spawned for use in the game over screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ By the time the game ends, titleObjectToDraw has been</span>
                        <span class="comment">\ set to the type of object that caused the player's</span>
                        <span class="comment">\ demise (be it the Sentinel, a sentry, a meanie or the</span>
                        <span class="comment">\ player themselves), so this call spawns that object</span>
                        <span class="comment">\ as object #1</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set screenBackground = 3 so the next time the screen</span>
 <span class="mne">STA</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ is cleared, it shows a black background with stars</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set currentObject = 1 so the call to DrawUpdatedObject</span>
 <span class="mne">STA</span> <a class="popup variable">currentObject</a>      <span class="comment">\ draws object #1</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set bit 7 of drawLandscape so the interrupt handler</span>
 <span class="mne">STA</span> <a class="popup variable">drawLandscape</a>      <span class="comment">\ draws random black dots on the screen, so we combine</span>
                        <span class="comment">\ dithering of object #1 to the screen while at the same</span>
                        <span class="comment">\ time fading the screen to black, to create the</span>
                        <span class="comment">\ hypnotic effect of the winning entity fading in and</span>
                        <span class="comment">\ out of the screen as the game ends</span>

 <span class="mne">STA</span> <a class="popup variable">ditherObjectSights</a> <span class="comment">\ Set bits 6 and 7 of ditherObjectSights so the call to</span>
                        <span class="comment">\ DrawUpdatedObject removes the sights from the screen</span>
                        <span class="comment">\ and dithers object #1 onto the screen</span>

 <span class="mne">LSR</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ Clear bit 7 of doNotDitherObject to enable objects to</span>
                        <span class="comment">\ be updated on the screen with a dithered effect</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">50</span>                <span class="comment">\ Call the PlayMusic routine with A = 50 to play the</span>
 <span class="mne">JSR</span> <a class="popup destination">PlayMusic</a>          <span class="comment">\ game over music</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawUpdatedObject</a>  <span class="comment">\ Draw the current object (or the landscape where the</span>
                        <span class="comment">\ object used to be) into the screen buffer and dither</span>
                        <span class="comment">\ it onto the screen, pixel by pixel and randomly</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Smother the screen in 30 * 2400 = 72,000 randomly</span>
 <span class="mne">JMP</span> <a class="popup destination">DecayScreenToBlack</a> <span class="comment">\ placed black dots to decay the screen to black,</span>
                        <span class="comment">\ returning from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-decayscreentoblack" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DecayScreenToBlack</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Smother the screen with randomly placed black dots to decay the</span>
             <span class="headerEntry">screen to black</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/decayscreentoblack.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a> calls <a href="#decayscreentoblack">DecayScreenToBlack</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of 2400-dot plotting cycles to perform when</span>
                        <span class="argumentEntry">decaying the screen</span>

</div></div>
<span class="label">.DecayScreenToBlack</span><a id="decayscreentoblack" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">blackDotCounter</a>    <span class="comment">\ Set blackDotCounter to the number of 2400-dot</span>
                        <span class="comment">\ plotting cycles we need to perform</span>

<span class="label">.deca1</span><a id="deca1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Set loopCounter = 30 for the inner loop, so each</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ iteration of the inner loop draws 30 * 80 = 2400 dots</span>

<span class="label">.deca2</span><a id="deca2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">DrawBlackDots</a>      <span class="comment">\ Draw 80 randomly positioned dots on the screen in</span>
                        <span class="comment">\ colour 1 (black) to fade the screen to black in a</span>
                        <span class="comment">\ slowly decaying manner</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">DEC</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ Loop back to plot another 80 dots until we have done</span>
 <span class="mne">BNE</span> <a class="popup destination">deca2</a>              <span class="comment">\ this 30 times (to give a total of 2400 dots)</span>

 <span class="mne">DEC</span> <a class="popup variable">blackDotCounter</a>    <span class="comment">\ Loop back to plot 80 * 30 dots until we have done this</span>
 <span class="mne">BNE</span> <a class="popup destination">deca1</a>              <span class="comment">\ blackDotCounter times (to give a total of</span>
                        <span class="comment">\ 2400 * blackDotCounter dots)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-jumptopreview" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">JumpToPreview</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">An intentionally confusing jump point for controlling the main</span>
             <span class="headerEntry">title loop flow when returning from the GenerateLandscape routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/jumptopreview.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/smoothtilecorners_part_2_of_4.html">SmoothTileCorners (Part 2 of 4)</a> calls <a href="#jumptopreview">JumpToPreview</a></span>
</div>
</div></div>
<span class="label">.JumpToPreview</span><a id="jumptopreview" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="hex">&4C</span>               <span class="comment">\ This byte is never executed, as the stack modification</span>
                        <span class="comment">\ in the SmoothTileData routine sets the return address</span>
                        <span class="comment">\ on the stack to JumpToPreview, and the RTS instruction</span>
                        <span class="comment">\ will therefore jump to JumpToPreview+1 (as that's how</span>
                        <span class="comment">\ the RTS instruction works)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This byte is the opcode for a JMP instruction, so this</span>
                        <span class="comment">\ makes it look like there is a JumpToPreview routine</span>
                        <span class="comment">\ that contains the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   &4C &30 &3F     JMP &3F30</span>
                        <span class="comment">\</span>
                        <span class="comment">\ as the BMI instruction below assembles into &30 &3F</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This would jump to a valid instruction halfway through</span>
                        <span class="comment">\ the ConfigureMachine routine, so this byte, although</span>
                        <span class="comment">\ unused, is presumably a JMP opcode to confuse any</span>
                        <span class="comment">\ crackers who have reached this point in their analysis</span>

 <span class="mne">BMI</span> <a class="popup destination">PreviewLandscape</a>   <span class="comment">\ We only get here if the stack has been modified by the</span>
                        <span class="comment">\ SmoothTileData routine, which makes the RTS at the end</span>
                        <span class="comment">\ end of the GenerateLandscape routine jump here</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The penultimate instruction in GenerateLandscape is a</span>
                        <span class="comment">\ call to the ProcessTileData routine, which happens to</span>
                        <span class="comment">\ set the N flag, so when the RTS instruction jumps here</span>
                        <span class="comment">\ using the modified return address, this BMI branch is</span>
                        <span class="comment">\ taken, so this instruction is effectively a JMP to the</span>
                        <span class="comment">\ PreviewLandscape routine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawntitleobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnTitleObject</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Spawn the title object (robot or the Sentinel) as object #1</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawntitleobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleobject.html">DrawTitleObject</a> calls <a href="#spawntitleobject">SpawnTitleObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a> calls <a href="#spawntitleobject">SpawnTitleObject</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The type of object to spawn</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The configuration to use when spawning the object:</span>

                        <span class="argumentEntry">  * 0 = the object on the game over screen (i.e. the</span>
                        <span class="argumentEntry">        enemy that ended the game)</span>

                        <span class="argumentEntry">  * 1 = the Sentinel on the main title screen or the</span>
                        <span class="argumentEntry">        robot on the secret code screen</span>

                        <span class="argumentEntry">  * 2 = the tower on which the Sentinel or robot stands</span>

</div></div>
<span class="label">.SpawnTitleObject</span><a id="spawntitleobject" class="anchor"></a>

                        <span class="comment">\ We set up the object that we want to draw on the title</span>
                        <span class="comment">\ screen in object #1, and we set up the viewing object</span>
                        <span class="comment">\ for that object in object #2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The values come from the Y-th entry in each of the</span>
                        <span class="comment">\ following configuration tables, so this routine sets</span>
                        <span class="comment">\ up the following, depending on the object that we are</span>
                        <span class="comment">\ spawning:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #1 (the object to draw) is set to a yaw</span>
                        <span class="comment">\     of 128 for the game over screen (so the enemy</span>
                        <span class="comment">\     stares directly out of the screen), or -114 for</span>
                        <span class="comment">\     the object on the tower (so it looks towards the</span>
                        <span class="comment">\     left of the viewer) or -50 for the tower (so it is</span>
                        <span class="comment">\     rotated slightly to the left)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #1 (the object to draw) is set to a yaw</span>
                        <span class="comment">\     of 128 for the game over screen, so the enemy</span>
                        <span class="comment">\     stares directly out of the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #1 (the object to draw) is set to a yaw</span>
                        <span class="comment">\     of -114 for the object on the tower, so the robot</span>
                        <span class="comment">\     or Sentinel looks out of the screen, towards the</span>
                        <span class="comment">\     left of the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #1 (the object to draw) is set to a yaw</span>
                        <span class="comment">\     of -50 for the tower, so it is rotated slightly to</span>
                        <span class="comment">\     the left</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #2 (the viewing object) is set to a pitch</span>
                        <span class="comment">\     of -12 for the game over screen, so the camera</span>
                        <span class="comment">\     points down, thus moving the object down the</span>
                        <span class="comment">\     screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #2 (the viewing object) is set to a pitch</span>
                        <span class="comment">\     of -5 and a yaw of -8 for the title screen, so the</span>
                        <span class="comment">\     camera points down and left, thus moving the tower</span>
                        <span class="comment">\     and object to the right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Object #1 is always at the same x-coordinate as</span>
                        <span class="comment">\     the viewing object</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The tower and game over objects are at the same</span>
                        <span class="comment">\     y-coordinate as the viewer (so they at the same</span>
                        <span class="comment">\     altitude)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The object on the tower is higher than the viewer</span>
                        <span class="comment">\     by one y-coordinate</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The game over object is at a z-coordinate distance</span>
                        <span class="comment">\     of 5 from the viewer, while the object and tower</span>
                        <span class="comment">\     are at a distance of 7</span>

 <span class="mne">STA</span> <a class="popup variable">objectTypes</a><span class="operator">+</span><span class="decimal">1</span>      <span class="comment">\ Set the object type for object #1 to the argument in A</span>

 <span class="mne">LDA</span> <a class="popup variable">zTitleObject</a>,<span class="register">Y</span>     <span class="comment">\ Set the z-coordinate for object #1 to the z-coordinate</span>
 <span class="mne">CLC</span>                    <span class="comment">\ of object #2 plus the Y-th entry from the zTitleObject</span>
 <span class="mne">ADC</span> <a class="popup variable">zObject</a><span class="operator">+</span><span class="decimal">2</span>          <span class="comment">\ table</span>
 <span class="mne">STA</span> <a class="popup variable">zObject</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a><span class="operator">+</span><span class="decimal">2</span>        <span class="comment">\ Set the high byte of the y-coordinate for object #1 to</span>
 <span class="mne">CLC</span>                    <span class="comment">\ the high byte of the y-coordinate of object #2 plus</span>
 <span class="mne">ADC</span> <a class="popup variable">yTitleObject</a>,<span class="register">Y</span>     <span class="comment">\ the Y-th entry from the yTitleObject table</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectHi</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">LDA</span> <a class="popup variable">xObject</a><span class="operator">+</span><span class="decimal">2</span>          <span class="comment">\ Set the x-coordinate for object #1 to the x-coordinate</span>
 <span class="mne">STA</span> <a class="popup variable">xObject</a><span class="operator">+</span><span class="decimal">1</span>          <span class="comment">\ of object #2</span>

 <span class="mne">LDA</span> <a class="popup variable">titleViewerPitch</a>,<span class="register">Y</span> <span class="comment">\ Set the pitch angle of the viewer in object #2 to the</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a><span class="operator">+</span><span class="decimal">2</span> <span class="comment">\ Y-th entry from the titleViewerPitch table</span>

 <span class="mne">LDA</span> <a class="popup variable">titleViewerYaw</a>,<span class="register">Y</span>   <span class="comment">\ Set the yaw angle of the viewer in object #2 to the</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ Y-th entry from the titleViewerYaw table</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the low bytes of the y-coordinates for both</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a><span class="operator">+</span><span class="decimal">2</span>        <span class="comment">\ objects</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">LDA</span> <a class="popup variable">titleObjectYaw</a>,<span class="register">Y</span>   <span class="comment">\ Set the yaw angle of object #1 to the Y-th entry from</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ the titleObjectYaw</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set the viewing object to object #2 so the screen will</span>
 <span class="mne">STX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ be drawn from this perspective</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ztitleobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">zTitleObject</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The z-coordinate of an object on the title screen, as a delta from</span>
             <span class="headerEntry">the z-coordinate of the viewing object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/ztitleobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a> uses <a href="#ztitleobject">zTitleObject</a></span>
</div>
</div></div>
<span class="label">.zTitleObject</span><a id="ztitleobject" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">5</span>                 <span class="comment">\ Object 0 = the game over object</span>

 <span class="mne">EQUB</span> <span class="decimal">7</span>                 <span class="comment">\ Object 1 = the object on the tower</span>

 <span class="mne">EQUB</span> <span class="decimal">7</span>                 <span class="comment">\ Object 2 = the tower</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-previewlandscape" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PreviewLandscape</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw an aerial preview of the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/previewlandscape.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/jumptopreview.html">JumpToPreview</a> calls <a href="#previewlandscape">PreviewLandscape</a></span>
</div>
</div></div>
<span class="label">.PreviewLandscape</span><a id="previewlandscape" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">SpawnEnemies</a>       <span class="comment">\ Calculate the number of enemies for this landscape,</span>
                        <span class="comment">\ add them to the landscape and set the palette</span>
                        <span class="comment">\ accordingly</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set X = 3 to pass to DrawTitleView so the background</span>
                        <span class="comment">\ of the landscape preview is black with stars</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 to pass to DrawTitleView so it draws the</span>
                        <span class="comment">\ screen with the correct perspective for the landscape</span>
                        <span class="comment">\ preview</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ Set A = &80 so the call to DrawTitleView draws the</span>
                        <span class="comment">\ landscape preview</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTitleView</a>      <span class="comment">\ Draw the landscape preview</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Print text token 4: Background colour black, print</span>
 <span class="mne">JSR</span> <a class="popup destination">PrintTextToken</a>     <span class="comment">\ "PRESS ANY KEY" at (192, 64), print "LANDSCAPE" two</span>
                        <span class="comment">\ characters right of (64, 768), move cursor right</span>

 <span class="mne">JSR</span> <a class="popup destination">PrintLandscapeNum</a>  <span class="comment">\ Print the four-digit landscape number (0000 to 9999)</span>

 <span class="mne">JSR</span> <a class="popup destination">SpawnPlayer</a>        <span class="comment">\ Add the player and trees to the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the entered secret entry code in the keyboard input</span>
                        <span class="comment">\ buffer does not match the generated secret code for</span>
                        <span class="comment">\ this landscape then the call will return here so we</span>
                        <span class="comment">\ can display an error</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the codes match then the CheckSecretCode will jump</span>
                        <span class="comment">\ to the PlayGame routine instead to play the game</span>

 <span class="mne">JMP</span> <a class="popup destination">SecretCodeError</a>    <span class="comment">\ The entered secret entry in the keyboard input buffer</span>
                        <span class="comment">\ does not match the generated secret code for this</span>
                        <span class="comment">\ landscape, so jump to SecretCodeError to display the</span>
                        <span class="comment">\ "WRONG SECRET CODE" error, wait for a key press and</span>
                        <span class="comment">\ rejoin the main title loop</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-titleviewerpitch" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">titleViewerPitch</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The pitch angle of the viewer for objects on the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/titleviewerpitch.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a> uses <a href="#titleviewerpitch">titleViewerPitch</a></span>
</div>
</div></div>
<span class="label">.titleViewerPitch</span><a id="titleviewerpitch" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">-12</span>               <span class="comment">\ Object 0 = when viewing the game over object</span>

 <span class="mne">EQUB</span> <span class="decimal">-5</span>                <span class="comment">\ Object 1 = when viewing the object on the tower</span>

 <span class="mne">EQUB</span> <span class="decimal">-5</span>                <span class="comment">\ Object 2 = when viewing the tower</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ytitleobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">yTitleObject</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The y-coordinate of an object on the title screen, as a delta from</span>
             <span class="headerEntry">the y-coordinate of the viewing object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/ytitleobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a> uses <a href="#ytitleobject">yTitleObject</a></span>
</div>
</div></div>
<span class="label">.yTitleObject</span><a id="ytitleobject" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Object 0 = the game over object</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Object 1 = the object on the tower</span>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Object 2 = the tower</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-titleobjectyaw" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">titleObjectYaw</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The yaw angle of an object on the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/titleobjectyaw.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a> uses <a href="#titleobjectyaw">titleObjectYaw</a></span>
</div>
</div></div>
<span class="label">.titleObjectYaw</span><a id="titleobjectyaw" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">128</span>               <span class="comment">\ Object 0 = the game over object</span>

 <span class="mne">EQUB</span> <span class="decimal">-114</span>              <span class="comment">\ Object 1 = the object on the tower</span>

 <span class="mne">EQUB</span> <span class="decimal">-50</span>               <span class="comment">\ Object 2 = the tower</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-titlevieweryaw" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">titleViewerYaw</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The yaw angle of the viewer for objects on the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/titlevieweryaw.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a> uses <a href="#titlevieweryaw">titleViewerYaw</a></span>
</div>
</div></div>
<span class="label">.titleViewerYaw</span><a id="titlevieweryaw" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Object 0 = when viewing the game over object</span>

 <span class="mne">EQUB</span> <span class="decimal">-8</span>                <span class="comment">\ Object 1 = when viewing the object on the tower</span>

 <span class="mne">EQUB</span> <span class="decimal">-8</span>                <span class="comment">\ Object 2 = when viewing the tower</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawtitleobjects" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTitleObjects</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw an object on top of a tower on the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawtitleobjects.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> calls <a href="#drawtitleobjects">DrawTitleObjects</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The type of object to draw on top of a tower on the</span>
                        <span class="argumentEntry">right side of the screen:</span>

                        <span class="argumentEntry">  * 0 to draw a robot for the secret code screen</span>

                        <span class="argumentEntry">  * 5 to draw the Sentinel for the main title screen</span>

</div></div>
<span class="label">.DrawTitleObjects</span><a id="drawtitleobjects" class="anchor"></a>

                        <span class="comment">\ We start by drawing a robot or the Sentinel, according</span>
                        <span class="comment">\ to the object type in A</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set Y = 1 so the call to DrawTitleObject chooses the</span>
                        <span class="comment">\ configuration for the object standing on the tower in</span>
                        <span class="comment">\ the main title screen or secret code screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTitleObject</a>    <span class="comment">\ Draw an object of type A, so that's either a robot or</span>
                        <span class="comment">\ the Sentinel</span>

                        <span class="comment">\ We now draw the tower on which the robot or Sentinel</span>
                        <span class="comment">\ standing</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set Y = 2 so the call to DrawTitleObject chooses the</span>
                        <span class="comment">\ configuration for the tower on which the robot or</span>
                        <span class="comment">\ Sentinel is standing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Set A to 6, the object type for the Sentinel's tower,</span>
                        <span class="comment">\ so DrawTitleObject draws the tower</span>

                        <span class="comment">\ Fall through into DrawTitleObject to draw the tower</span>
                        <span class="comment">\ beneath the robot or the Sentinel</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawtitleobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTitleObject</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw an object on the title screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawtitleobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleobjects.html">DrawTitleObjects</a> calls <a href="#drawtitleobject">DrawTitleObject</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The type of object to draw</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The configuration to use when drawing the object:</span>

                        <span class="argumentEntry">  * 1 = the Sentinel on the main title screen or the</span>
                        <span class="argumentEntry">        robot on the secret code screen</span>

                        <span class="argumentEntry">  * 2 = the tower on which the Sentinel or robot stands</span>

</div></div>
<span class="label">.DrawTitleObject</span><a id="drawtitleobject" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">SpawnTitleObject</a>   <span class="comment">\ Call SpawnTitleObject to spawn an object of type A in</span>
                        <span class="comment">\ object #1, using the configuration specified in Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Call DrawObject with Y = 1 to draw object #1 and</span>
 <span class="mne">JMP</span> <a class="popup destination">DrawObject</a>         <span class="comment">\ return from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-playmusic" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PlayMusic</span>                                               <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Play a piece of music</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/playmusic.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#playmusic">PlayMusic</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/performhyperspace.html">PerformHyperspace</a> calls <a href="#playmusic">PlayMusic</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls <a href="#playmusic">PlayMusic</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a> calls <a href="#playmusic">PlayMusic</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of the music to play (which is expressed as</span>
                        <span class="argumentEntry">a byte offset into the music data at musicData):</span>

                        <span class="argumentEntry">  * 0 = hyperspace</span>

                        <span class="argumentEntry">  * 25 = player has just transferred onto the Sentinel's</span>
                        <span class="argumentEntry">         tower</span>

                        <span class="argumentEntry">  * 40 = U-turn</span>

                        <span class="argumentEntry">  * 50 = game over</span>

                        <span class="argumentEntry">  * 66 = landscape successfully finished</span>

</div></div>
<span class="label">.PlayMusic</span><a id="playmusic" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">musicCounter</a>       <span class="comment">\ Set the musicCounter to the value in A to start the</span>
                        <span class="comment">\ music playing from this point</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set soundEffect = 3 to tell the ProcessSound routine</span>
 <span class="mne">STA</span> <a class="popup variable">soundEffect</a>        <span class="comment">\ that this is music and should therefore be processed</span>
                        <span class="comment">\ using the ProcessMusic routine</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

 <span class="mne">EQUB</span> <span class="hex">&23</span>               <span class="comment">\ This byte appears to be unused</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-configuremachine" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ConfigureMachine</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Setup</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Configure the custom screen mode, set the break handler to clear</span>
             <span class="headerEntry">memory, move code, reset timers and set the interrupt handler</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/configuremachine.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/entry.html">Entry</a> calls <a href="#configuremachine">ConfigureMachine</a></span>
</div>
<hr class="light">
 The custom screen mode is based on screen mode 5, but with only 25 character
 rows rather than 32. This gives the game screen a letterbox appearance.

 The custom mode has a vertical resolution of 25 * 8 = 200 pixels, compared to
 the 256 pixels of standard mode 5. The horizontal resolution is the same at
 160 pixels.

 Screen memory for the custom mode runs from &6000 to &7F3F, with four pixels
 per byte and four colours per pixel.

</div></div>
<span class="directive"> CLEAR &3F00, &4100     </span><span class="comment">\ Memory from &3F00 to &4100 has three separate uses</span>
<span class="directive"> ORG &3F00              </span><span class="comment">\</span>
                        <span class="comment">\ During startup it is used to store the startup</span>
                        <span class="comment">\ routines ConfigureMachine and ClearMemory, which</span>
                        <span class="comment">\ aren't needed again once the game has started</span>
                        <span class="comment">\</span>
                        <span class="comment">\ While the landscape is being generated it is used to</span>
                        <span class="comment">\ store the secret code stash at secretCodeStash</span>
                        <span class="comment">\</span>
                        <span class="comment">\ While the game is running it is used to store the</span>
                        <span class="comment">\ first few rows of the screen buffer, starting from</span>
                        <span class="comment">\ screenBufferRow0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ These lines rewind BeebAsm's assembly back to &3F00</span>
                        <span class="comment">\ and clear the block from that point to the end of the</span>
                        <span class="comment">\ startup code at &4100, so we can assemble the startup</span>
                        <span class="comment">\ routines</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At the end of the ClearMemory routine, the game binary</span>
                        <span class="comment">\ actually contains snippets of the original source</span>
                        <span class="comment">\ code, left over from the BBC Micro assembly process,</span>
                        <span class="comment">\ so we include this workspace noise to ensure that we</span>
                        <span class="comment">\ generate an exact match for the game binary</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of gameInProgress to indicate that a game is</span>
 <span class="mne">ROR</span> <a class="popup variable">gameInProgress</a>     <span class="comment">\ not currently in progress and that we are in the title</span>
                        <span class="comment">\ and preview screens (so the interrupt handler doesn't</span>
                        <span class="comment">\ progress the game)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This code is never actually run in this location</span>
                        <span class="comment">\ (identical code can be found at the start of the</span>
                        <span class="comment">\ ResetVariables routine)</span>

<span class="label">.ConfigureMachine</span><a id="configuremachine" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Call OSBYTE with A = 4, X = 1 and Y = 0 to disable</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ cursor editing</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">1</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">144</span>               <span class="comment">\ Call OSBYTE with A = 144, X = 0 and Y = 0 to switch</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ interlace on</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">22</span>                <span class="comment">\ Switch to screen mode 5 with the following VDU</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWRCH</a>             <span class="comment">\ command:</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWRCH</a>             <span class="comment">\   VDU 22, 5</span>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so we can update the 6845 registers</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Set 6845 register R6 = 25</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">25</span>                <span class="comment">\ This is the "vertical displayed" register, which sets</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ the number of displayed character rows to 25. For</span>
                        <span class="comment">\ comparison, this value is 32 for standard mode 5, but</span>
                        <span class="comment">\ we claw back seven rows to create the game's letterbox</span>
                        <span class="comment">\ screen mode</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set 6845 register R7 = 32</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ This is the "vertical sync position" register, which</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ determines the vertical sync position with respect to</span>
                        <span class="comment">\ the reference, programmed in character row times. For</span>
                        <span class="comment">\ comparison this is 34 for mode 5, but it needs to be</span>
                        <span class="comment">\ adjusted for our custom screen's vertical sync</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ Set 6845 register R10 = %00100000</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00100000</span>         <span class="comment">\ This is the "cursor start" register, and bits 5 and 6</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ define the "cursor display mode", as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %00 = steady, non-blinking cursor</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %01 = do not display a cursor</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %10 = fast blinking cursor (blink at 1/16 of the</span>
                        <span class="comment">\           field rate)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %11 = slow blinking cursor (blink at 1/32 of the</span>
                        <span class="comment">\           field rate)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can therefore turn off the cursor completely by</span>
                        <span class="comment">\ setting cursor display mode %01, with bit 6 of R10</span>
                        <span class="comment">\ clear and bit 5 of R10 set</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">151</span>               <span class="comment">\ Call OSBYTE with A = 151, X = &42 and Y = %11111111 to</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&42</span>               <span class="comment">\ write the value %11111111 to SHEILA+&42</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>             <span class="comment">\ This sets the direction of all eight ports of the 6522</span>
                        <span class="comment">\ System VIA to output by setting the corresponding bits</span>
                        <span class="comment">\ in the Data Direction Register B (SHEILA &42)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">151</span>               <span class="comment">\ Call OSBYTE with A = 151, X = &40 and Y = %00000101 to</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&40</span>               <span class="comment">\ write the value %00000101 to SHEILA+&40</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="binary">%00000101</span>         <span class="comment">\</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>             <span class="comment">\ Writing a value of %vaaa to SHEILA+&40 writes to the</span>
                        <span class="comment">\ System VIA's addressable latch, setting latch address</span>
                        <span class="comment">\ %aaa to value v</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This therefore sets address %101 to 1, which is</span>
                        <span class="comment">\ address B5 in the System VIA</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now we set B4 as well</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">151</span>               <span class="comment">\ Call OSBYTE with A = 151, X = &40 and Y = %00001100 to</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&40</span>               <span class="comment">\ write the value %00001100 to SHEILA+&40</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="binary">%00001100</span>         <span class="comment">\</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>             <span class="comment">\ Writing a value of %vaaa to SHEILA+&40 writes to the</span>
                        <span class="comment">\ System VIA's addressable latch, setting latch address</span>
                        <span class="comment">\ %aaa to value v</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This therefore sets address %100 to 0, which is</span>
                        <span class="comment">\ address B4 in the System VIA</span>
                        <span class="comment">\</span>
                        <span class="comment">\ B4 and B5 in the System VIA control the address of the</span>
                        <span class="comment">\ start of screen memory and the screen size, so this</span>
                        <span class="comment">\ sets screen memory to &6000 and screen size to 8K (see</span>
                        <span class="comment">\ page 429 of the "Advanced User Guide for the BBC</span>
                        <span class="comment">\ Micro" by Bray, Dickens and Holmes for details)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call OSBYTE with A = 0 and X = 255 to fetch the</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ operating system version into X</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ If X = 0 then this is either a BBC Micro running an</span>
 <span class="mne">BEQ</span> <a class="popup destination">setp1</a>              <span class="comment">\ operating system version of 1.00 or earlier, or it's</span>
                        <span class="comment">\ an Electron, so in either case jump to setp1 to skip</span>
                        <span class="comment">\ the following</span>

                        <span class="comment">\ If we get here then this is not an Electron or an</span>
                        <span class="comment">\ early operating system, so it must be a BBC Micro with</span>
                        <span class="comment">\ MOS 1.20 or later, or a BBC Master</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">200</span>               <span class="comment">\ Call OSBYTE with A = 200, X = 2 and Y = 0 to set the</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ normal action for the ESCAPE key and clear memory if</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ the BREAK key is pressed</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>

 <span class="mne">JMP</span> <a class="popup destination">setp3</a>              <span class="comment">\ Jump to setp3 to skip the setup for the Electron</span>

<span class="label">.setp1</span><a id="setp1" class="anchor"></a>

                        <span class="comment">\ If we get here then this is either a BBC Micro running</span>
                        <span class="comment">\ MOS 1.00 or earlier, or it's an Electron</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In MOS 0.10, OSBYTE 200 does not let you set the BREAK</span>
                        <span class="comment">\ key to clear memory, so we need to set this up by hand</span>
                        <span class="comment">\ (otherwise crackers could load the game on MOS 0.10</span>
                        <span class="comment">\ and simply press BREAK to access the loaded game code)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The Electron and MOS 1.00 do not need this code, as</span>
                        <span class="comment">\ OSBYTE 200 is supported in these versions of the</span>
                        <span class="comment">\ operating system, but OSBYTE 0 doesn't distinguish</span>
                        <span class="comment">\ between the Electron and MOS 1.00 and earlier (they</span>
                        <span class="comment">\ all return X = 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ There's no harm in manually clearing memory on those</span>
                        <span class="comment">\ systems, though, so the following code is run on</span>
                        <span class="comment">\ BREAK on MOS 1.00 and earlier and on the Electron</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To set this up, we copy the break handler routine from</span>
                        <span class="comment">\ ClearMemory to address BRKI (this points to the</span>
                        <span class="comment">\ cassette filing system workspace, which is unused</span>
                        <span class="comment">\ now that the game is loaded, so it's a suitable</span>
                        <span class="comment">\ location for our handler)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&1C</span>               <span class="comment">\ Set a counter in X for the size of the ClearMemory</span>
                        <span class="comment">\ routine</span>

<span class="label">.setp2</span><a id="setp2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">ClearMemory</a>,<span class="register">X</span>      <span class="comment">\ Copy the X-th byte of the ClearMemory routine into the</span>
 <span class="mne">STA</span> <a class="popup variable">BRKI</a>,<span class="register">X</span>             <span class="comment">\ X-th byte of BRKI</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">setp2</a>              <span class="comment">\ Loop back until we have copied the whole ClearMemory</span>
                        <span class="comment">\ routine to BRKI</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&4C</span>               <span class="comment">\ Set the Break Intercept code to the following, so that</span>
 <span class="mne">STA</span> <a class="popup variable">BRKIV</a>              <span class="comment">\ BRKI gets called when the BREAK key is pressed:</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">BRKI</a><span class="bracket">)</span>          <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">BRKIV</a><span class="operator">+</span><span class="decimal">1</span>            <span class="comment">\    4C 80 03   JMP BRKI</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">BRKI</a><span class="bracket">)</span>          <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">BRKIV</a><span class="operator">+</span><span class="decimal">2</span>            <span class="comment">\ &4C is the opcode for the JMP instruction, and BRKI is</span>
                        <span class="comment">\ at address &0380 (part of the cassette filing system</span>
                        <span class="comment">\ workspace)</span>

<span class="label">.setp3</span><a id="setp3" class="anchor"></a>

                        <span class="comment">\ Next we copy a block of game code in memory as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &4100-&49FF is copied to &5800-&60FF</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The game binary could easily have been structured to</span>
                        <span class="comment">\ avoid this copy, so presumably it's just done to make</span>
                        <span class="comment">\ the game code harder to crack</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&00</span>               <span class="comment">\ Set (Q P) = &4100</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\ We use this as the source address for the copy</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&41</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&58</span>               <span class="comment">\ Set (S R) = &5800</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\</span>
                        <span class="comment">\ We use this as the destination address for the copy</span>

<span class="label">.setp4</span><a id="setp4" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set up a byte counter in Y</span>

<span class="label">.setp5</span><a id="setp5" class="anchor"></a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Copy the Y-th byte of (Q P) to the Y-th byte of (S R)</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BNE</span> <a class="popup destination">setp5</a>              <span class="comment">\ Loop back until we have copied a whole page of bytes</span>

 <span class="mne">INC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Increment the high byte of (Q P) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">INC</span> <a class="popup variable">S</a>                  <span class="comment">\ Increment the high byte of (S R) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">LDA</span> <a class="popup variable">Q</a>                  <span class="comment">\ Loop back until (Q P) reaches &4A00, at which point we</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&4A</span>               <span class="comment">\ have copied the whole block of memory</span>
 <span class="mne">BCC</span> <a class="popup destination">setp4</a>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so we can update the interrupt</span>
                        <span class="comment">\ vector and VIA</span>

 <span class="mne">LDA</span> <a class="popup variable">IRQ1V</a>              <span class="comment">\ Store the current address from the IRQ1V vector in</span>
 <span class="mne">STA</span> <a class="popup variable">irq1Address</a>        <span class="comment">\ irq1Address, so the IRQ handler can jump to it after</span>
 <span class="mne">LDA</span> <a class="popup variable">IRQ1V</a><span class="operator">+</span><span class="decimal">1</span>            <span class="comment">\ implementing the custom interrupt handler</span>
 <span class="mne">STA</span> <a class="popup variable">irq1Address</a><span class="operator">+</span><span class="decimal">1</span>

                        <span class="comment">\ We now wait for the vertical sync, which we can check</span>
                        <span class="comment">\ by reading bit 1 of the 6522 System VIA status byte</span>
                        <span class="comment">\ (SHEILA &4D), which is set if vertical sync has</span>
                        <span class="comment">\ occurred on the video system</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00000010</span>         <span class="comment">\ Set a bit mask in A that we can use to read bit 1 of</span>
                        <span class="comment">\ the 6522 System VIA status byte</span>

<span class="label">.setp6</span><a id="setp6" class="anchor"></a>

 <span class="mne">BIT</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&4D</span>         <span class="comment">\ Loop around until bit 1 of the 6522 System VIA status</span>
 <span class="mne">BEQ</span> <a class="popup destination">setp6</a>              <span class="comment">\ byte is set, so we wait until the vertical sync</span>

                        <span class="comment">\ We now set timer 1 in the 6522 User VIA to count down</span>
                        <span class="comment">\ regularly, triggering the interrupt handler routine at</span>
                        <span class="comment">\ IRQHandler every time it counts down</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The timer is initially set to count down from 14,592</span>
                        <span class="comment">\ to zero, and then a value of 19,998 is latched into</span>
                        <span class="comment">\ the timer so that it triggers the interrupt every time</span>
                        <span class="comment">\ it counts down from 20,000 to zero (the latching</span>
                        <span class="comment">\ process takes two ticks, which gives us a total count</span>
                        <span class="comment">\ of 20,000)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The timer counts down at 1 MHz. or one million times a</span>
                        <span class="comment">\ second, so this means the interrupt is triggered every</span>
                        <span class="comment">\ 0.02 seconds, or exactly 50 times a second</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This regular interrupt is used to progress the game</span>
                        <span class="comment">\ counters and manage the screen panning effect (see the</span>
                        <span class="comment">\ IRQHandler routine for details)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ Set 6522 User VIA auxiliary control register ACR</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&6B</span>         <span class="comment">\ (SHEILA &6B) bits 7 and 6 to disable PB7 (which is one</span>
                        <span class="comment">\ of the pins on the user port) and set continuous</span>
                        <span class="comment">\ interrupts for timer 1</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set 6522 User VIA interrupt enable register IER</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&6E</span>         <span class="comment">\ (SHEILA &4E) bits 6 and 7 (i.e. enable the Timer1</span>
                        <span class="comment">\ interrupt from the User VIA)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&00</span>               <span class="comment">\ Set 6522 User VIA T1C-L timer 1 low-order counter</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&64</span>         <span class="comment">\ (SHEILA &64) to &00 (so this sets the low-order</span>
                        <span class="comment">\ counter but does not start counting until the</span>
                        <span class="comment">\ high-order counter is set)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&39</span>               <span class="comment">\ Set 6522 User VIA T1C-H timer 1 high-order counter</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&65</span>         <span class="comment">\ (SHEILA &45) to &39 to start the T1 counter</span>
                        <span class="comment">\ counting down from &3900 (14592) at a rate of 1 MHz</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&1E</span>               <span class="comment">\ Set 6522 User VIA T1L-L timer 1 low-order latches</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&66</span>         <span class="comment">\ to &1E (so this sets the low-order counter but does</span>
                        <span class="comment">\ not start counting until the high-order counter is</span>
                        <span class="comment">\ set)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&4E</span>               <span class="comment">\ Set 6522 User VIA T1L-H timer 1 high-order latches</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&67</span>         <span class="comment">\ to &4E (so this sets the timer to &4E1E (19998) but</span>
                        <span class="comment">\ does not start counting until the current timer has</span>
                        <span class="comment">\ run down)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">IRQHandler</a><span class="bracket">)</span>    <span class="comment">\ Set the IRQ1V vector to IRQHandler, so the IRQHandler</span>
 <span class="mne">STA</span> <a class="popup variable">IRQ1V</a><span class="operator">+</span><span class="decimal">1</span>            <span class="comment">\ routine is now the interrupt handler</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">IRQHandler</a><span class="bracket">)</span>
 <span class="mne">STA</span> <a class="popup variable">IRQ1V</a>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">JMP</span> <a class="popup destination">MainTitleLoop</a>      <span class="comment">\ Jump to MainTitleLoop to start the main title loop,</span>
                        <span class="comment">\ where we display the title screen, fetch the landscape</span>
                        <span class="comment">\ number and code, preview the landscape and then jump</span>
                        <span class="comment">\ to the main game loop</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-clearmemory" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ClearMemory</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Setup</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Clear game memory, so that the BREAK key can remove all trace of</span>
             <span class="headerEntry">the game code in early versions of the operating system</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/clearmemory.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/configuremachine.html">ConfigureMachine</a> calls <a href="#clearmemory">ClearMemory</a></span>
</div>
</div></div>
<span class="label">.ClearMemory</span><a id="clearmemory" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&04</span>               <span class="comment">\ Set (Q P) = &0400</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>                  <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&00</span>               <span class="comment">\ We use this as the start address for clearing memory,</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\ which is where the game code starts</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also sets A = 0, which we can use to zero memory</span>

<span class="label">.cmem1</span><a id="cmem1" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Set Y = &FF to use as a byte counter</span>

<span class="label">.cmem2</span><a id="cmem2" class="anchor"></a>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Zero the Y-th byte at (Q P)</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BNE</span> <a class="popup destination">cmem2</a>              <span class="comment">\ Loop back until we have zeroed a whole page of memory</span>

 <span class="mne">INC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Increment the high byte of (Q P) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">LDX</span> <a class="popup variable">Q</a>                  <span class="comment">\ Loop back until (Q P) reaches &7C00, at which point we</span>
 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&7C</span>               <span class="comment">\ have zeroed all the game code (including any code</span>
 <span class="mne">BCC</span> <a class="popup destination">cmem1</a>              <span class="comment">\ still left at the higher memory address where it's</span>
                        <span class="comment">\ first loaded)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&00</span>               <span class="comment">\ Set the Break Intercept code to a BRK instruction to</span>
 <span class="mne">STA</span> <a class="popup variable">BRKIV</a>              <span class="comment">\ reinstate the default break handler</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&65</span><span class="comma">,</span> <span class="hex">&74</span><span class="comma">,</span> <span class="hex">&73</span><span class="comma">,</span> <span class="hex">&36</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&12</span><span class="comma">,</span> <span class="hex">&CA</span>    <span class="comment">\ These bytes are unused until</span>
 <span class="mne">EQUB</span> <span class="hex">&19</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4C</span>    <span class="comment">\ the game is in progress, at</span>
 <span class="mne">EQUB</span> <span class="hex">&44</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&23</span><span class="comma">,</span> <span class="hex">&36</span><span class="comma">,</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&4A</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&52</span>    <span class="comment">\ which point this whole section</span>
 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&43</span><span class="comma">,</span> <span class="hex">&46</span><span class="comma">,</span> <span class="hex">&4C</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&48</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&12</span>    <span class="comment">\ of memory is reused</span>
 <span class="mne">EQUB</span> <span class="hex">&D4</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&12</span><span class="comma">,</span> <span class="hex">&DE</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&2E</span>    <span class="comment">\</span>
 <span class="mne">EQUB</span> <span class="hex">&65</span><span class="comma">,</span> <span class="hex">&74</span><span class="comma">,</span> <span class="hex">&73</span><span class="comma">,</span> <span class="hex">&36</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&72</span><span class="comma">,</span> <span class="hex">&74</span><span class="comma">,</span> <span class="hex">&73</span>    <span class="comment">\ These values are workspace</span>
 <span class="mne">EQUB</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&12</span><span class="comma">,</span> <span class="hex">&E8</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&12</span><span class="comma">,</span> <span class="hex">&F2</span>    <span class="comment">\ noise and have no meaning</span>
 <span class="mne">EQUB</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&12</span><span class="comma">,</span> <span class="hex">&FC</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span>    <span class="comment">\</span>
 <span class="mne">EQUB</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&06</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&10</span><span class="comma">,</span> <span class="hex">&05</span>    <span class="comment">\ They actually contain snippets</span>
 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&1A</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span>    <span class="comment">\ of the original source code</span>
 <span class="mne">EQUB</span> <span class="hex">&24</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&2E</span><span class="comma">,</span> <span class="hex">&2A</span><span class="comma">,</span> <span class="hex">&2E</span>
 <span class="mne">EQUB</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&49</span><span class="comma">,</span> <span class="hex">&4E</span><span class="comma">,</span> <span class="hex">&49</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4C</span><span class="comma">,</span> <span class="hex">&44</span><span class="comma">,</span> <span class="hex">&41</span>
 <span class="mne">EQUB</span> <span class="hex">&23</span><span class="comma">,</span> <span class="hex">&31</span><span class="comma">,</span> <span class="hex">&32</span><span class="comma">,</span> <span class="hex">&38</span><span class="comma">,</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&41</span>
 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&4E</span><span class="comma">,</span> <span class="hex">&59</span><span class="comma">,</span> <span class="hex">&2C</span><span class="comma">,</span> <span class="hex">&58</span>
 <span class="mne">EQUB</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&4D</span>
 <span class="mne">EQUB</span> <span class="hex">&4F</span><span class="comma">,</span> <span class="hex">&52</span><span class="comma">,</span> <span class="hex">&59</span><span class="comma">,</span> <span class="hex">&2C</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&38</span>
 <span class="mne">EQUB</span> <span class="hex">&1F</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4C</span>
 <span class="mne">EQUB</span> <span class="hex">&44</span><span class="comma">,</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&23</span><span class="comma">,</span> <span class="hex">&30</span><span class="comma">,</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&41</span>
 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&4E</span><span class="comma">,</span> <span class="hex">&59</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&43</span>
 <span class="mne">EQUB</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&4E</span><span class="comma">,</span> <span class="hex">&2C</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&42</span><span class="comma">,</span> <span class="hex">&22</span>
 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4C</span><span class="comma">,</span> <span class="hex">&44</span>
 <span class="mne">EQUB</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&23</span><span class="comma">,</span> <span class="hex">&36</span><span class="comma">,</span> <span class="hex">&34</span><span class="comma">,</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&41</span>
 <span class="mne">EQUB</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&52</span><span class="comma">,</span> <span class="hex">&59</span><span class="comma">,</span> <span class="hex">&43</span><span class="comma">,</span> <span class="hex">&4E</span><span class="comma">,</span> <span class="hex">&54</span>
 <span class="mne">EQUB</span> <span class="hex">&2C</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&72</span><span class="comma">,</span> <span class="hex">&74</span><span class="comma">,</span> <span class="hex">&73</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span>
 <span class="mne">EQUB</span> <span class="hex">&4C</span><span class="comma">,</span> <span class="hex">&05</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&56</span><span class="comma">,</span> <span class="hex">&1A</span><span class="comma">,</span> <span class="hex">&2E</span>
 <span class="mne">EQUB</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&4E</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4C</span><span class="comma">,</span> <span class="hex">&44</span><span class="comma">,</span> <span class="hex">&41</span>
 <span class="mne">EQUB</span> <span class="hex">&23</span><span class="comma">,</span> <span class="hex">&34</span><span class="comma">,</span> <span class="hex">&30</span><span class="comma">,</span> <span class="hex">&3A</span><span class="comma">,</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&41</span><span class="comma">,</span> <span class="hex">&20</span>
 <span class="mne">EQUB</span> <span class="hex">&43</span><span class="comma">,</span> <span class="hex">&4F</span><span class="comma">,</span> <span class="hex">&56</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&52</span><span class="comma">,</span> <span class="hex">&0D</span><span class="comma">,</span> <span class="hex">&13</span><span class="comma">,</span> <span class="hex">&60</span>
 <span class="mne">EQUB</span> <span class="hex">&1B</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&4C</span>
 <span class="mne">EQUB</span> <span class="hex">&44</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&45</span><span class="comma">,</span> <span class="hex">&4D</span><span class="comma">,</span> <span class="hex">&3A</span>
 <span class="mne">EQUB</span> <span class="hex">&53</span><span class="comma">,</span> <span class="hex">&54</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&20</span><span class="comma">,</span> <span class="hex">&58</span><span class="comma">,</span> <span class="hex">&54</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-entry" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">Entry</span>                                                   <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Setup</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The main entry point for the game</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/entry.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="directive"> ORG &6D00              </span><span class="comment">\ Set the assembly address to &6D00</span>

<span class="label">.Entry</span><a id="entry" class="anchor"></a>

                        <span class="comment">\ We start by copying the game code in memory as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &1900-&6CFF is copied to &0400-&57FF</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The game binary has a load address of &1900 and an</span>
                        <span class="comment">\ execution address of &6D00 (the address of this</span>
                        <span class="comment">\ routine)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&00</span>               <span class="comment">\ Set (Q P) = &1900</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\ We use this as the source address for the copy</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&19</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&04</span>               <span class="comment">\ Set (S R) = &0400</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\</span>
                        <span class="comment">\ We use this as the destination address for the copy</span>

<span class="label">.entr1</span><a id="entr1" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set up a byte counter in Y</span>

<span class="label">.entr2</span><a id="entr2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Copy the Y-th byte of (Q P) to the Y-th byte of (S R)</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the byte counter</span>

 <span class="mne">BNE</span> <a class="popup destination">entr2</a>              <span class="comment">\ Loop back until we have copied a whole page of bytes</span>

 <span class="mne">INC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Increment the high byte of (Q P) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">INC</span> <a class="popup variable">S</a>                  <span class="comment">\ Increment the high byte of (S R) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">LDA</span> <a class="popup variable">Q</a>                  <span class="comment">\ Loop back until (Q P) reaches &6D00, at which point we</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&6D</span>               <span class="comment">\ have copied all the game code</span>
 <span class="mne">BNE</span> <a class="popup destination">entr1</a>

 <span class="mne">JMP</span> <a class="popup destination">ConfigureMachine</a>   <span class="comment">\ Jump to ConfigureMachine to configure the computer,</span>
                        <span class="comment">\ ready for a new game</span>

<div class="headerBlockWrapper"><div class="headerBlock"> Save Sentinel.bin

</div></div>
                                <span class="comment">\ Game addr to file addr</span>
<span class="directive"> COPYBLOCK &4900, &4A00, &6000  </span><span class="comment">\ 4900-49FF to 6000-60FF</span>
<span class="directive"> COPYBLOCK &5800, &6100, &4100  </span><span class="comment">\ 5800-60FF to 4100-49FF</span>
<span class="directive"> COPYBLOCK &0400, &5800, LOAD%  </span><span class="comment">\ 0400-57FF to 1900-6CFF</span>

<span class="directive"> SAVE "3-assembled-output/TheSentinel.bin", LOAD%, P%</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-brki"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#brki">BRKI</a></div><div class="summary">The CFS workspace, which we can use for the Break Intercept handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-brkiv"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#brkiv">BRKIV</a></div><div class="summary">The Break Intercept code (which is a JMP instruction to the Break Intercept handler)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-cleariconsscanner"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-cleariconsscanner">ClearIconsScanner</a> (category: Scanner/energy row)</div><div class="summary">Clear the energy icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-clearmemory"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-clearmemory">ClearMemory</a> (category: Setup)</div><div class="summary">Clear game memory, so that the BREAK key can remove all trace of the game code in early versions of the operating system</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-configuremachine"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a> (category: Setup)</div><div class="summary">Configure the custom screen mode, set the break handler to clear memory, move code, reset timers and set the interrupt handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-decayscreentoblack"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-decayscreentoblack">DecayScreenToBlack</a> (category: Graphics)</div><div class="summary">Smother the screen with randomly placed black dots to decay the screen to black</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawblackdots"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-drawblackdots">DrawBlackDots</a> (category: Graphics)</div><div class="summary">Draw 80 randomly positioned dots on the screen in colour 1 (black)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a> (category: Drawing objects)</div><div class="summary">Draw a 3D object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawpolygon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawpolygon">DrawPolygon</a> (category: Drawing polygons)</div><div class="summary">Draw a polygon</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtitleobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-drawtitleobject">DrawTitleObject</a> (category: Title screen)</div><div class="summary">Draw an object on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtitleview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">DrawTitleView</a> (category: Title screen)</div><div class="summary">Draw the main title screen, the secret code screen or the landscape preview</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawupdatedobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a> (category: Drawing objects)</div><div class="summary">Draw an updated object on-screen, optionally with a dithered effect, and with or without the surrounding landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enablekeyboard"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-enablekeyboard">EnableKeyboard</a> (category: Keyboard)</div><div class="summary">Select the keyboard as the input stream and flush the keyboard buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-flushbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-flushbuffer">FlushBuffer</a> (category: Keyboard)</div><div class="summary">Flush the specified buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-flushsoundbuffers"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-flushsoundbuffers">FlushSoundBuffers</a> (category: Sound)</div><div class="summary">Flush all four sound channel buffers</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gethorizontaldelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-gethorizontaldelta">GetHorizontalDelta</a> (category: Maths (Geometry))</div><div class="summary">Calculate the difference in the x-axis and z-axis between two objects, as both signed and absolute deltas</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gethypotenuse"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-gethypotenuse">GetHypotenuse</a> (category: Maths (Geometry))</div><div class="summary">Calculate the hypotenuse from an angle and two triangle sides with one lookup and one multiplication (so without a square root)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gethypotenuseangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-gethypotenuseangle">GetHypotenuseAngle</a> (category: Maths (Geometry))</div><div class="summary">Calculate the angle of the hypotenuse in a right-angle triangle given the two non-hypotenuse sides (i.e. two orthogonal axes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getobjpointangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-getobjpointangles">GetObjPointAngles</a> (category: Drawing objects)</div><div class="summary">Calculate the view-relative pitch and yaw angles of all the points in an object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getobjectangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-getobjectangles">GetObjectAngles</a> (category: 3D objects)</div><div class="summary">Calculate the angles and distances of the vector from the viewer to a specific object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getpitchangledelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-getpitchangledelta">GetPitchAngleDelta</a> (category: Maths (Geometry))</div><div class="summary">Calculate the pitch angle of a vector relative to an object's pitch angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getrandomnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-getrandomnumber">GetRandomNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a random number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getsineandcosine"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-getsineandcosine">GetSineAndCosine</a> (category: Maths (Geometry))</div><div class="summary">Calculate the sine and the cosine of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getverticaldelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-getverticaldelta">GetVerticalDelta</a> (category: Maths (Geometry))</div><div class="summary">Calculate the difference in the y-axis between two objects as a signed delta</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-h"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#h">H</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in the maths routines</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irq1v"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#irq1v">IRQ1V</a></div><div class="summary">The IRQ1V vector that we intercept to implement the interrupt handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqhandler"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a> (category: Main game loop)</div><div class="summary">The main interrupt handler, which gets run 50 times a second to update the game state and check for game key presses</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maintitleloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-maintitleloop">MainTitleLoop</a> (category: Main title loop)</div><div class="summary">The main title loop: display the title screen, fetch the landscape number/code, preview the landscape and jump to the main game loop</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-multiply8x8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-multiply8x8">Multiply8x8</a> (category: Maths (Arithmetic))</div><div class="summary">Calculate (A T) = T * U</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-negate16bit"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-negate16bit">Negate16Bit</a> (category: Maths (Arithmetic))</div><div class="summary">Negate a 16-bit number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#osbyte">OSBYTE</a></div><div class="summary">The address for the OSBYTE routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osrdch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#osrdch">OSRDCH</a></div><div class="summary">The address for the OSRDCH routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-oswrch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#oswrch">OSWRCH</a></div><div class="summary">The address for the OSWRCH routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-p"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#p">P</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playmusic"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-playmusic">PlayMusic</a> (category: Sound)</div><div class="summary">Play a piece of music</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-previewlandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-previewlandscape">PreviewLandscape</a> (category: Landscape)</div><div class="summary">Draw an aerial preview of the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printlandscapenum"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-printlandscapenum">PrintLandscapeNum</a> (category: Text)</div><div class="summary">Print the four-digit landscape number (0000 to 9999)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printtexttoken"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-printtexttoken">PrintTextToken</a> (category: Text)</div><div class="summary">Print a recursive text token</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processsound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a> (category: Sound)</div><div class="summary">Process any sound effects that have been configured so they play in the background (this is called regularly throughout gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-q"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#q">Q</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-r"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#r">R</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-readcharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-readcharacter">ReadCharacter</a> (category: Keyboard)</div><div class="summary">Read a character from the currently selected input stream</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-s"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#s">S</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sheila"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#sheila">SHEILA</a></div><div class="summary">Memory-mapped space for accessing internal hardware, such as the video ULA, 6845 CRTC and 6522 VIAs (also known as SHEILA)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-secretcodeerror"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-secretcodeerror">SecretCodeError</a> (category: Main title loop)</div><div class="summary">Display the "WRONG SECRET CODE" error, wait for a key press and rejoin the main title loop</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-spawnenemies">SpawnEnemies</a> (category: Landscape)</div><div class="summary">Calculate the number of enemies for this landscape, add them to the landscape and set the palette accordingly</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnplayer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-spawnplayer">SpawnPlayer</a> (category: Landscape)</div><div class="summary">Add the player object to the landscape, ideally placing it below all the enemies and in the bottom half of the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawntitleobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-spawntitleobject">SpawnTitleObject</a> (category: Title screen)</div><div class="summary">Spawn the title object (robot or the Sentinel) as object #1</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#t">T</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#u">U</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-anglehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#anglehi">angleHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The low byte of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-anglelo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#anglelo">angleLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bitmaskdither"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#bitmaskdither">bitMaskDither</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A bit mask for use in the DitherScreenBuffer routine that has a matching number of leading zeroes as the size of the screen buffer in bytes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-blackdotcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#blackdotcounter">blackDotCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter for black dots that are drawn in the screen decaying routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-blendpolygonedges"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#blendpolygonedges">blendPolygonEdges</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to determine whether polygon edges are drawn in the same colour as the polygon fill, thus blending the edges into the polygon body</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffercolumns"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#buffercolumns">bufferColumns</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of character columns in the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferwidthbytes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#bufferwidthbytes">bufferWidthBytes</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The width of the screen buffer in pixel bytes for implementing the dithered effect in DitherScreenBuffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-clearpixelmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-clearpixelmask">clearPixelMask</a> (category: Graphics)</div><div class="summary">A table for converting a pixel number in the range 0 to 3 into a screen mode 5 bit mask with that pixel's bits clear and others set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-cmem1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#cmem1">cmem1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-clearmemory">ClearMemory</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-cmem2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#cmem2">cmem2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-clearmemory">ClearMemory</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-colourpalettes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-colourpalettes">colourPalettes</a> (category: Graphics)</div><div class="summary">The logical colours for two mode 5 palettes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-cosa"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#cosa">cosA</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The result of the cos(A) calculation in the GetSineAndCosine routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-currentobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#currentobject">currentObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the object we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-deca1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#deca1">deca1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-decayscreentoblack">DecayScreenToBlack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-deca2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#deca2">deca2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-decayscreentoblack">DecayScreenToBlack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-delt1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#delt1">delt1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-gethorizontaldelta">GetHorizontalDelta</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-delt2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#delt2">delt2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-gethorizontaldelta">GetHorizontalDelta</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith1">dith1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith2">dith2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith3">dith3</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith4">dith4</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith5">dith5</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith6">dith6</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith7">dith7</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#dith8">dith8</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherinnerloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ditherinnerloop">ditherInnerLoop</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for the inner loop when dithering objects to the screen in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherobjectsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ditherobjectsights">ditherObjectSights</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Configures how an updated object is drawn onto the screen in the DrawUpdatedObject routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherouterloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-ditherouterloop">ditherOuterLoop</a> (category: Screen buffer)</div><div class="summary">A counter for the inner loop when dithering objects to the screen in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherrandom"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ditherrandom">ditherRandom</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Storage for a random value in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherstore"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ditherstore">ditherStore</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage for use in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotditherobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotditherobject">doNotDitherObject</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the DitherScreenBuffer routine can update an object on the screen using a dithered effect</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#drawlandscape">drawLandscape</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Configures whether to draw the landscape behind the object in the DrawUpdatedObject routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawviewangles">drawViewAngles</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address in drawViewAngles(1 0) of the pitch and yaw angles of the tile and polygon points that we are drawing in the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewpitchhi">drawViewPitchHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewpitchlo">drawViewPitchLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-drawviewyawhi">drawViewYawHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewyawlo">drawViewYawLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingphase"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#drawingphase">drawingPhase</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of the current drawing phase when drawing two-phase objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingphasecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawingphasecount">drawingPhaseCount</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A phase counter for objects that need to be drawn in multiple phases</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtableindex"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawingtableindex">drawingTableIndex</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The index into the drawing tables for the tile being analysed</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob1">drob1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob2">drob2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob3">drob3</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob4">drob4</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob5">drob5</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob6">drob6</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob7">drob7</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drob8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#drob8">drob8</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-entr1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#entr1">entr1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-entry">Entry</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-entr2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#entr2">entr2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-entry">Entry</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fromaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#fromaddr">fromAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">An address, typically used as a source address when copying</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameinprogress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gameinprogress">gameInProgress</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Flags whether or not a game is in progress (i.e. the player is playing a landscape rather than interacting with the title and preview screens)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameoversoundpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gameoversoundpitch">gameOverSoundPitch</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A timer for the game over sound</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypotenusehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#hypotenusehi">hypotenuseHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of the hypotenuse of a triangle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypotenuselo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#hypotenuselo">hypotenuseLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The low byte of the hypotenuse of a triangle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irq1address"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-irq1address">irq1Address</a> (category: Main game loop)</div><div class="summary">Stores the previous value of IRQ1V before we install our custom IRQ handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-leadingbitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-leadingbitmask">leadingBitMask</a> (category: Landscape)</div><div class="summary">A table for converting the number of leading clear bits in a number into a bit mask with the same number of leading zeroes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-loopcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#loopcounter">loopCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A general-purpose loop counter</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musiccounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#musiccounter">musicCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for the music currently being made, which counts up in the ProcessMusic routine while the music is being played</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-oang1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#oang1">oang1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-getobjectangles">GetObjectAngles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpointdistance"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpointdistance">objPointDistance</a> (category: Drawing objects)</div><div class="summary">Polar distances for each of the points in each of the objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpointheight"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpointheight">objPointHeight</a> (category: Drawing objects)</div><div class="summary">The height of each of the points in each of the objects, relative to the object's origin</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpointrange"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpointrange">objPointRange</a> (category: Drawing objects)</div><div class="summary">The first and last point numbers for each object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpointyaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpointyaw">objPointYaw</a> (category: Drawing objects)</div><div class="summary">Polar yaw angles for each of the points in each of the objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpolygonaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-objpolygonaddrhi">objPolygonAddrHi</a> (category: Drawing objects)</div><div class="summary">Addresses for the list of polygons and points for each object (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpolygonaddrlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-objpolygonaddrlo">objPolygonAddrLo</a> (category: Drawing objects)</div><div class="summary">Addresses for the list of polygons and points for each object (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpolygondata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpolygondata">objPolygonData</a> (category: Drawing objects)</div><div class="summary">Various data for object polygons (colour, drawing phase)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpolygonphases"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpolygonphases">objPolygonPhases</a> (category: Drawing objects)</div><div class="summary">The phase configuration for each object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objpolygonrange"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-objpolygonrange">objPolygonRange</a> (category: Drawing objects)</div><div class="summary">The first and last polygon numbers for each object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-objscreenaddr">objScreenAddr</a> (category: Screen buffer)</div><div class="summary">The screen address of the object we are updating</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objtypetoanalyse"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objtypetoanalyse">objTypeToAnalyse</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The type of the object being analysed in the GetObjectAngles routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectadjacenthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectadjacenthi">objectAdjacentHi</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The distance of an object from the viewer, expressed as the length of the adjacent side in a triangle with the vector from the viewer to the object as the hypotenuse (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectadjacentlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectadjacentlo">objectAdjacentLo</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The distance of an object from the viewer, expressed as the length of the adjacent side in a triangle with the vector from the viewer to the object as the hypotenuse (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectgazeyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectgazeyawhi">objectGazeYawHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference in the yaw angle of the viewer's gaze and the yaw angle (i.e. the gaze) of the object being analysed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectgazeyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectgazeyawlo">objectGazeYawLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference in the yaw angle of the viewer's gaze and the yaw angle (i.e. the gaze) of the object being analysed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectlastpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectlastpoint">objectLastPoint</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the last point in the object being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectlastpolygon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectlastpolygon">objectLastPolygon</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the last polygon in the object being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectoppositehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectoppositehi">objectOppositeHi</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The height of an object relative to the viewer, expressed as the length of the opposite side in a triangle with the vector from the viewer to the object as the hypotenuse (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectoppositelo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectoppositelo">objectOppositeLo</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The height of an object relative to the viewer, expressed as the length of the opposite side in a triangle with the vector from the viewer to the object as the hypotenuse (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectpitchangle">objectPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">The pitch angle for each object (i.e. the vertical direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttoanalyse"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objecttoanalyse">objectToAnalyse</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the object to analyse in the GetObjectAngles routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttypes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objecttypes">objectTypes</a> (category: 3D objects)</div><div class="summary">The object types table for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectviewyawhi">objectViewYawHi</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw angle of the object being analysed, relative to the current viewer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectviewyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectviewyawlo">objectViewYawLo</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw angle of the object being analysed, relative to the current viewer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectyawangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objectyawangle">objectYawAngle</a> (category: 3D objects)</div><div class="summary">The yaw angle for each object (i.e. the horizontal direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-obpt1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#obpt1">obpt1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-getobjpointangles">GetObjPointAngles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-obpt2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#obpt2">obpt2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-getobjpointangles">GetObjPointAngles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-obpt3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#obpt3">obpt3</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-getobjpointangles">GetObjPointAngles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-obpt4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#obpt4">obpt4</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-getobjpointangles">GetObjPointAngles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-obpt5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#obpt5">obpt5</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-getobjpointangles">GetObjPointAngles</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pall1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#pall1">pall1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-setcolourpalette">SetColourPalette</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pall2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#pall2">pall2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-setcolourpalette">SetColourPalette</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pall3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#pall3">pall3</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-setcolourpalette">SetColourPalette</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pitchdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pitchdeltahi">pitchDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The delta between two pitch angles (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pitchdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pitchdeltalo">pitchDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The delta between two pitch angles (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelbitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-pixelbitmask">pixelBitMask</a> (category: Graphics)</div><div class="summary">A table for converting a pixel number in the range 0 to 3 into a screen mode 5 bit mask with that pixel's bits set and others clear</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelbytetodither"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#pixelbytetodither">pixelByteToDither</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A random pixel byte in a character row in the screen buffer to use when dithering an object to the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pointnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pointnumber">pointNumber</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter for the point number as we work through the points in an object when calculating the point's angles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygoncolours"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygoncolours">polygonColours</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The colours of the polygon that's being drawn in the DrawPolygon routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonedgecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygonedgecount">polygonEdgeCount</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of sides in the polygon we are drawing, which is one less than the number of points in the polygon's point list (as the last point in the list is always a repeat of the first point)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygonnumber">polygonNumber</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter for the polygon number as we work through the polygons in an object when drawing the object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#polygonpoint">polygonPoint</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Up to five coordinates for the points of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygontype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygontype">polygonType</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Bits 6 and 7 determine the type of polygon to draw in the DrawPolygon routine (the calling subroutine is in brackets)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-randomgenerator"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-randomgenerator">randomGenerator</a> (category: Maths (Arithmetic))</div><div class="summary">A 24-bit random number generator that works independently from the landscape seeds and with a much simpler generation algorithm</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-read1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#read1">read1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-readcharacter">ReadCharacter</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbackground"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#screenbackground">screenBackground</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The type of screen background when clearing the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbufferrow0"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-screenbufferrow0">screenBufferRow0</a> (category: Screen buffer)</div><div class="summary">The screen buffer for character row 0</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setp1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#setp1">setp1</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setp2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#setp2">setp2</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setp3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#setp3">setp3</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setp4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#setp4">setp4</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setp5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#setp5">setp5</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setp6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_j.html#setp6">setp6</a> in subroutine <a href="/source/all/the_sentinel_j.html#header-configuremachine">ConfigureMachine</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsarevisible"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsarevisible">sightsAreVisible</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the sights are being shown</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbytecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsbytecount">sightsByteCount</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of screen bytes in the sights pixel byte stash that contain the contents of the screen behind the sights (so they can be restored to remove the sights)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sina"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#sina">sinA</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The result of the sin(A) calculation in the GetSineAndCosine routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soundeffect"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#soundeffect">soundEffect</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Determines how the current sound is processed by the ProcessSound routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleobjecttodraw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#titleobjecttodraw">titleObjectToDraw</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The object we are drawing in the DrawTitleView routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleobjectyaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-titleobjectyaw">titleObjectYaw</a> (category: Title screen)</div><div class="summary">The yaw angle of an object on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleviewerpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-titleviewerpitch">titleViewerPitch</a> (category: Title screen)</div><div class="summary">The pitch angle of the viewer for objects on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titlevieweryaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-titlevieweryaw">titleViewerYaw</a> (category: Title screen)</div><div class="summary">The yaw angle of the viewer for objects on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-toaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#toaddr">toAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">An address, typically used as a destination address when copying</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewtype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_b.html#header-viewtype">viewType</a> (category: Title screen)</div><div class="summary">Storage for the type of title view we are drawing in DrawTitleView (title screen or landscape preview)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingobject">viewingObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltaabsolutehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltaabsolutehi">xDeltaAbsoluteHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The absolute difference between two x-coordinates (high byte), i.e. |xDeltaHi|</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltahi">xDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two x-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltalo">xDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two x-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-xobject">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtitleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtitleoffset">xTitleOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">An x-coordinate offset for drawing the title screen this is zero during gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ydeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ydeltahi">yDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two y-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ydeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ydeltalo">yDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two y-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjecthi">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjectlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjectlo">yObjectLo</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ytitleobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-ytitleobject">yTitleObject</a> (category: Title screen)</div><div class="summary">The y-coordinate of an object on the title screen, as a delta from the y-coordinate of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yawadjustmentlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yawadjustmentlo">yawAdjustmentLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A yaw adjustment to apply to the landscape drawing process so that when we update objects on-screen, we can yaw the viewer's gaze to the right to move the left edge of the object to the left edge of the screen so the object will fit into the screen buffer as efficiently as possible (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltaabsolutehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zdeltaabsolutehi">zDeltaAbsoluteHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The absolute difference between two z-coordinates (high byte), i.e. |zDeltaHi|</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zdeltahi">zDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two z-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zdeltalo">zDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two z-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-zobject">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztitleobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_j.html#header-ztitleobject">zTitleObject</a> (category: Title screen)</div><div class="summary">The z-coordinate of an object on the title screen, as a delta from the z-coordinate of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_i.html">The Sentinel I source</a></nav>
				</div>
			</article>

<?php
include_once("../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
