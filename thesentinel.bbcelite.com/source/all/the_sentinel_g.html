<?php
include_once("../../templates/template_functions.php");
page_header("all_source", "the_sentinel_g.html", "The Sentinel G source", "The Sentinel G source", "The The Sentinel G source file in The Sentinel", "the_sentinel-index", "source_all_source", "the_sentinel_g", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_f.html">The Sentinel F source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_h.html">The Sentinel H source</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div><div><div class="headerBlockWrapper"><div class="headerBlock"><a id="header-stringtonumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">StringToNumber</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Convert a string of ASCII digits in the input buffer in-place into</span>
             <span class="headerEntry">a multi-byte BCD number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/stringtonumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#stringtonumber">StringToNumber</a></span>
</div>
</div></div>
<span class="label">.StringToNumber</span><a id="stringtonumber" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We want to work through the input buffer, converting</span>
                        <span class="comment">\ each character in turn from an ASCII digit into a</span>
                        <span class="comment">\ number, so set an index in Y to work through the</span>
                        <span class="comment">\ buffer, one ASCII digit at a time</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Each pair of ASCII digits gets converted into a value</span>
                        <span class="comment">\ that will fit into a single BCD byte, which we store</span>
                        <span class="comment">\ in-place, so set an index in X to work through the</span>
                        <span class="comment">\ buffer, so we can store the resulting BCD number one</span>
                        <span class="comment">\ byte at a time (i.e. two ASCII digits at a time)</span>

<span class="label">.snum1</span><a id="snum1" class="anchor"></a>

                        <span class="comment">\ We now fetch two digits from the input buffer and</span>
                        <span class="comment">\ convert them into a single BCD number, remembering</span>
                        <span class="comment">\ that the input buffer is stored as an ascending stack,</span>
                        <span class="comment">\ so the digits on the left of the stack (i.e. those</span>
                        <span class="comment">\ that were typed first) are lower significance than</span>
                        <span class="comment">\ those on the right of the stack (i.e. those that were</span>
                        <span class="comment">\ typed last)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Effectively the stack is little-endian, just like the</span>
                        <span class="comment">\ 6502 processor</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The calls to DigitToNumber will backfill the input</span>
                        <span class="comment">\ buffer with &FF if we are reading from the last four</span>
                        <span class="comment">\ characters of the input buffer, so the final result</span>
                        <span class="comment">\ will have four BCD numbers at the start of inputBuffer</span>
                        <span class="comment">\ (from inputBuffer to inputBuffer+3), and the rest of</span>
                        <span class="comment">\ the buffer will be padded out with four &FF bytes</span>
                        <span class="comment">\ (from inputBuffer+4 to inputBuffer+7)</span>

 <span class="mne">JSR</span> <a class="popup destination">DigitToNumber</a>      <span class="comment">\ Set T to the numerical value of the character at index</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Y in the input buffer, which is the low significance</span>
                        <span class="comment">\ digit of the number we are fetching, and in the range</span>
                        <span class="comment">\ 0 to 9</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to the next character in the input buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">DigitToNumber</a>      <span class="comment">\ Set A to the numerical value of the character at index</span>
                        <span class="comment">\ Y in the input buffer, which is the high significance</span>
                        <span class="comment">\ digit of the number we are fetching, and in the range</span>
                        <span class="comment">\ 0 to 9</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift the high significance digit in A into bits 4-7,</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ so A contains the first digit of the BCD number</span>
 <span class="mne">ASL</span> <span class="register">A</span>
 <span class="mne">ASL</span> <span class="register">A</span>

 <span class="mne">ORA</span> <a class="popup variable">T</a>                  <span class="comment">\ Insert the high significance digit in T into bits 0-3,</span>
                        <span class="comment">\ so A now contains both the first and second digits of</span>
                        <span class="comment">\ the BCD number</span>

 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a>,<span class="register">X</span>      <span class="comment">\ Store the BCD number in-place at index X</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the result index in X to move on to the next</span>
                        <span class="comment">\ BCD number</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the buffer index in Y to move on to the next</span>
                        <span class="comment">\ pair of digits</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Loop back until we have converted the whole string</span>
 <span class="mne">BNE</span> <a class="popup destination">snum1</a>              <span class="comment">\ into a multi-byte BCD number</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-digittonumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DigitToNumber</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Convert a digit from the input buffer into a number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/digittonumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/stringtonumber.html">StringToNumber</a> calls <a href="#digittonumber">DigitToNumber</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The offset into the input buffer of the digit to convert</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The numerical value of the digit (0 to 9), where spaces</span>
                        <span class="argumentEntry">are converted to 0</span>

</div></div>
<span class="label">.DigitToNumber</span><a id="digittonumber" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">inputBuffer</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the ASCII digit from the input buffer that we</span>
                        <span class="comment">\ want to convert</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ If Y &lt; 4 then jump to dnum1 to skip the following</span>
 <span class="mne">BCC</span> <a class="popup destination">dnum1</a>

                        <span class="comment">\ Y is 4 or more, so we set this character in the input</span>
                        <span class="comment">\ buffer to &FF so that as we work through the buffer in</span>
                        <span class="comment">\ the StringToNumber routine, converting pairs of ASCII</span>
                        <span class="comment">\ digits into single-byte BCD numbers, we backfill the</span>
                        <span class="comment">\ buffer with &FF</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Set the Y-th character in the input buffer to &FF,</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ making sure not to corrupt the value of A</span>
 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a>,<span class="register">Y</span>
 <span class="mne">PLA</span>

<span class="label">.dnum1</span><a id="dnum1" class="anchor"></a>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="character">' '</span>               <span class="comment">\ If the character in the input buffer is not a space</span>
 <span class="mne">BNE</span> <a class="popup destination">dnum2</a>              <span class="comment">\ then it must be a digit, so jump to dmum2 to convert</span>
                        <span class="comment">\ it into a number</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ Otherwise the character from the input buffer is a</span>
                        <span class="comment">\ space, so set A to ASCII "0" so we return a value of</span>
                        <span class="comment">\ zero in the following subtraction</span>

<span class="label">.dnum2</span><a id="dnum2" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Convert the ASCII digit into a number by subtracting</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ ASCII "0"</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-print2digitbcd" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">Print2DigitBCD</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print a binary coded decimal (BCD) number using two digits</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/print2digitbcd.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/printlandscapenum.html">PrintLandscapeNum</a> calls <a href="#print2digitbcd">Print2DigitBCD</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnsecretcode3d.html">SpawnSecretCode3D</a> calls <a href="#print2digitbcd">Print2DigitBCD</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number to print (in BCD)</span>

</div></div>
<span class="label">.Print2DigitBCD</span><a id="print2digitbcd" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store A on the stack so we can retrieve it later</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Shift the high nibble of A into bits 0-3, so A</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ contains the first digit of the BCD number</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>

 <span class="mne">JSR</span> <a class="popup destination">PrintNumber</a>        <span class="comment">\ Print the number in A as a single digit</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the original value of A, which contains the</span>
                        <span class="comment">\ BCD number to print</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Extract the low nibble of the BCD number into A</span>

 <span class="mne">JMP</span> <a class="popup destination">PrintNumber</a>        <span class="comment">\ Print the number in A as a single digit and return</span>
                        <span class="comment">\ from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getnextseedasbcd" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetNextSeedAsBCD</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set A to the next number from the landscape's sequence of seed</span>
             <span class="headerEntry">numbers, converted to a binary coded decimal (BCD) number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getnextseedasbcd.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checksecretcode_part_1_of_2.html">CheckSecretCode (Part 1 of 2)</a> calls <a href="#getnextseedasbcd">GetNextSeedAsBCD</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnsecretcode3d.html">SpawnSecretCode3D</a> calls <a href="#getnextseedasbcd">GetNextSeedAsBCD</a></span>
</div>
</div></div>
<span class="label">.GetNextSeedAsBCD</span><a id="getnextseedasbcd" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

                        <span class="comment">\ We now convert this into a binary coded decimal (BCD)</span>
                        <span class="comment">\ number by ensuring that both the low nibble and high</span>
                        <span class="comment">\ nibble are in the range 0 to 9</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Store A on the stack so we can retrieve it below</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Extract the low nibble of A, so it's in the range 0 to</span>
                        <span class="comment">\ 15</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ If A >= 10 then set A = A - 6</span>
 <span class="mne">BCC</span> <a class="popup destination">rbcd1</a>              <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ This reduces the number in A to the range 0 to 9, so</span>
                        <span class="comment">\ it's suitable for the second digit in a BCD number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The subtraction will work because the C flag is set by</span>
                        <span class="comment">\ the time we reach the SBC instruction</span>

<span class="label">.rbcd1</span><a id="rbcd1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">lowNibbleBCD</a>       <span class="comment">\ Store the low nibble of the result in lowNibbleBCD</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the original value of A that we stored on the</span>
                        <span class="comment">\ stack above</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11110000</span>         <span class="comment">\ Extract the high nibble of A, so it's in the range 0</span>
                        <span class="comment">\ to 15</span>

 <span class="mne">CMP</span> <span class="hash">#</span>10<<4             <span class="comment">\ If the high nibble in A >= 10 then subtract 6 from the</span>
 <span class="mne">BCC</span> <a class="popup destination">rbcd2</a>              <span class="comment">\ high nibble</span>
 <span class="mne">SBC</span> <span class="hash">#</span>6<<4              <span class="comment">\</span>
                        <span class="comment">\ This reduces the high nibble of the number in A to the</span>
                        <span class="comment">\ range 0 to 9, so it's suitable for the first digit in</span>
                        <span class="comment">\ a BCD number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The subtraction will work because the C flag is set by</span>
                        <span class="comment">\ the time we reach the SBC instruction</span>

<span class="label">.rbcd2</span><a id="rbcd2" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">lowNibbleBCD</a>       <span class="comment">\ By this point A contains a BCD digit in the high</span>
                        <span class="comment">\ nibble and lowNibbleBCD contains a BCD digit in the</span>
                        <span class="comment">\ low nibble, so we can OR them together to produce a</span>
                        <span class="comment">\ BCD number in A, which we can return as our result</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-lownibblebcd" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">lowNibbleBCD</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Storage for the low nibble when constructing a BCD seed number in</span>
             <span class="headerEntry">the GetNextSeedAsBCD routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/lownibblebcd.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getnextseedasbcd.html">GetNextSeedAsBCD</a> uses <a href="#lownibblebcd">lowNibbleBCD</a></span>
</div>
</div></div>
<span class="label">.lowNibbleBCD</span><a id="lownibblebcd" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawnsecretcode3d" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnSecretCode3D</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the landscape's secret code by spawning a set of large 3D</span>
             <span class="headerEntry">text block objects</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawnsecretcode3d.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#spawnsecretcode3d">SpawnSecretCode3D</a></span>
</div>
</div></div>
<span class="label">.SpawnSecretCode3D</span><a id="spawnsecretcode3d" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span> <span class="operator">+</span> <span class="decimal">0</span>     <span class="comment">\ Set bit 7 of printTextIn3D so we print the landscape's</span>
 <span class="mne">STA</span> <a class="popup variable">printTextIn3D</a>      <span class="comment">\ secret code in 3D text when we call Print2DigitBCD</span>
                        <span class="comment">\ below</span>

 <span class="mne">JSR</span> <a class="popup destination">SpawnCharacter3D</a>   <span class="comment">\ Call SpawnCharacter3D with A = #%10000000 + 0 to set</span>
                        <span class="comment">\ the tile x-coordinate of the large 3D secret code text</span>
                        <span class="comment">\ to zero</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span> <span class="operator">+</span> <span class="decimal">7</span>     <span class="comment">\ Call SpawnCharacter3D with A = #%11000000 + 7 to set</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnCharacter3D</a>   <span class="comment">\ the tile z-coordinate of the large 3D secret code text</span>
                        <span class="comment">\ to 7</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we draw the secret code in large 3D text blocks at</span>
                        <span class="comment">\ tile coordinate (0, 7) on the landscape, so that's</span>
                        <span class="comment">\ starting at the left edge of the landscape and seven</span>
                        <span class="comment">\ tile rows from the front</span>

 <span class="mne">LSR</span> <a class="popup variable">playerIsOnTower</a>    <span class="comment">\ If we got here legally (i.e. without crackers getting</span>
                        <span class="comment">\ involved, then the ProcessActionKeys will have set</span>
                        <span class="comment">\ playerIsOnTower to 6 when the player transferred into</span>
                        <span class="comment">\ the robot on the Sentinel's tower, so this sets the</span>
                        <span class="comment">\ value of playerIsOnTower to 3</span>

 <span class="mne">LDX</span> <a class="popup variable">playerIsOnTower</a>    <span class="comment">\ Set X = 3 to use as a loop in the following code</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If crackers have jumped straight here instead of</span>
                        <span class="comment">\ playing the game properly, then X will not be 3 (it</span>
                        <span class="comment">\ will probably be 64, as playerIsOnTower is initialised</span>
                        <span class="comment">\ to 128 at the start of each level)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The following code picks up where the CheckSecretCode</span>
                        <span class="comment">\ routine ends, for when bit 7 of doNotPlayLandscape is</span>
                        <span class="comment">\ set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In this case, CheckSecretCode only iterates up to the</span>
                        <span class="comment">\ point where the secret code is about to be generated,</span>
                        <span class="comment">\ and then it stops, so we can finish the generation</span>
                        <span class="comment">\ process here</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For this to work, we need to set X = 3 so we can</span>
                        <span class="comment">\ generate the next four BCD numbers in the landscape's</span>
                        <span class="comment">\ sequence of seed numbers, as these will give us the</span>
                        <span class="comment">\ secret code</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If X is 64, then the secret code that is generated</span>
                        <span class="comment">\ will be incorrect</span>

<span class="label">.dsec1</span><a id="dsec1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedAsBCD</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to a binary coded decimal</span>
                        <span class="comment">\ (BCD) number</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ If X >= 4, skip printing the BCD number, so that we</span>
 <span class="mne">BCS</span> <a class="popup destination">dsec2</a>              <span class="comment">\ skip printing the four correct secret code numbers if</span>
                        <span class="comment">\ X starts the loop at 64</span>

 <span class="mne">JSR</span> <a class="popup destination">Print2DigitBCD</a>     <span class="comment">\ Draw the binary coded decimal (BCD) number in A in</span>
                        <span class="comment">\ large 3D text</span>

<span class="label">.dsec2</span><a id="dsec2" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">dsec1</a>              <span class="comment">\ Loop back until we have printed the four BCD numbers</span>
                        <span class="comment">\ in the landscape's secret code</span>

 <span class="mne">STX</span> <a class="popup variable">playerIsOnTower</a>    <span class="comment">\ Set playerIsOnTower = &FF to overwrite the correct</span>
                        <span class="comment">\ value, to make it harder for crackers to work out why</span>
                        <span class="comment">\ their secret codes aren't valid</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">LSR</span> <a class="popup variable">printTextIn3D</a>      <span class="comment">\ Clear bit 7 of printTextIn3D to return to printing</span>
                        <span class="comment">\ normal text</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-printlandscapenum" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PrintLandscapeNum</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print the four-digit landscape number (0000 to 9999)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/printlandscapenum.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#printlandscapenum">PrintLandscapeNum</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#printlandscapenum">PrintLandscapeNum</a></span>
</div>
</div></div>
<span class="label">.PrintLandscapeNum</span><a id="printlandscapenum" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">landscapeNumberHi</a>  <span class="comment">\ Print the high byte of the binary coded decimal (BCD)</span>
 <span class="mne">JSR</span> <a class="popup destination">Print2DigitBCD</a>     <span class="comment">\ landscape number as a two-digit number</span>

 <span class="mne">LDA</span> <a class="popup variable">landscapeNumberLo</a>  <span class="comment">\ Print the low byte of the binary coded decimal (BCD)</span>
 <span class="mne">JMP</span> <a class="popup destination">Print2DigitBCD</a>     <span class="comment">\ landscape number as a two-digit number and return from</span>
                        <span class="comment">\ the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-initialiseseeds" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">InitialiseSeeds</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Initialise the seed number generator so it generates the sequence</span>
             <span class="headerEntry">of seed numbers for a specific landscape number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/initialiseseeds.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#initialiseseeds">InitialiseSeeds</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#initialiseseeds">InitialiseSeeds</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#initialiseseeds">InitialiseSeeds</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">(Y X)</span>                <span class="argumentEntry">A landscape number in BCD (0000 to 9999)</span>

</div></div>
<span class="label">.InitialiseSeeds</span><a id="initialiseseeds" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ Initialise the seed number generator by setting bits</span>
 <span class="mne">STX</span> <a class="popup variable">seedNumberLFSR</a>     <span class="comment">\ 0-15 of the five-byte linear feedback shift register</span>
                        <span class="comment">\ to the landscape number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that the GetNextSeedNumber routine (and</span>
                        <span class="comment">\ related routines) will generate a unique sequence of</span>
                        <span class="comment">\ pseudo-random numbers for this landscape, and which</span>
                        <span class="comment">\ will be the exact same sequence every time we need to</span>
                        <span class="comment">\ generate this landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It also ensures that the third number to be generated</span>
                        <span class="comment">\ by the shift register is the high byte of the</span>
                        <span class="comment">\ landscape number that we put into seedNumberLFSR+1, as</span>
                        <span class="comment">\ at this early stage of the process the EOR feedback</span>
                        <span class="comment">\ does not affect this byte as it passes through the</span>
                        <span class="comment">\ shift register, so after three 8-bit shifts the high</span>
                        <span class="comment">\ byte reaches seedNumberLFSR+4 and is returned as the</span>
                        <span class="comment">\ next seed number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This fact is exploited by the anti-cracker code in the</span>
                        <span class="comment">\ SetCrackerSeed routine</span>

 <span class="mne">STY</span> <a class="popup variable">landscapeNumberHi</a>  <span class="comment">\ Set landscapeNumber(Hi Lo) = (Y X)</span>
 <span class="mne">STX</span> <a class="popup variable">landscapeNumberLo</a>

 <span class="mne">STY</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If the high byte of the landscape number is non-zero,</span>
 <span class="mne">TYA</span>                    <span class="comment">\ then set landscapeZero to this non-zero value (to</span>
 <span class="mne">BNE</span> <a class="popup destination">seed1</a>              <span class="comment">\ indicate that we are not playing landscape 0000) and</span>
                        <span class="comment">\ jump to seed1 to set maxNumberOfEnemies to 8</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set landscapeZero to the low byte of the landscape,</span>
 <span class="mne">STA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ so this sets landscapeZero to zero if we are playing</span>
                        <span class="comment">\ landscape 0000, and it sets it to a non-zero value if</span>
                        <span class="comment">\ we are not</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So landscapeZero is now correctly set to indicate</span>
                        <span class="comment">\ whether or not we are playing landscape 0000</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set A to the high byte of the BCD landscape number</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ plus 1, which is the same as saying:</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\   A = 1 + (landscapeNumber div 10)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Or A is 1 plus the "tens" digit of the landscape</span>
                        <span class="comment">\ number</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">9</span>                 <span class="comment">\ If A &lt; 9 then A is in the range 1 to 8, so jump to</span>
 <span class="mne">BCC</span> <a class="popup destination">seed2</a>              <span class="comment">\ seed2 to set maxNumberOfEnemies to this value</span>

                        <span class="comment">\ Otherwise A is 9 or higher, so we now cap A to 8 as</span>
                        <span class="comment">\ the maximum allowed value for maxNumberOfEnemies</span>

<span class="label">.seed1</span><a id="seed1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set A = 8 to use as the maximum number of enemies</span>

<span class="label">.seed2</span><a id="seed2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">maxNumberOfEnemies</a> <span class="comment">\ Set maxNumberOfEnemies to the value in A, so we get</span>
                        <span class="comment">\ the following cap on the number of enemies:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   min(8, 1 + (landscapeNumber div 10))</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So landscapes 0000 to 0009 have a maximum enemy count</span>
                        <span class="comment">\ of 1, landscapes 0010 to 0019 have a maximum enemy</span>
                        <span class="comment">\ count of 2, and so on up to landscapes 0070 and up,</span>
                        <span class="comment">\ which have a maximum enemy count of 8</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processcharacter" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessCharacter</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Process and print a character from a text token, which can encode</span>
             <span class="headerEntry">another text token or be a one-byte character or VDU command</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processcharacter.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/printtexttoken.html">PrintTextToken</a> calls <a href="#processcharacter">ProcessCharacter</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The text token character to be printed</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The offset of the current character within the text</span>
                        <span class="argumentEntry">token being printed</span>

</div></div>
<span class="label">.ProcessCharacter</span><a id="processcharacter" class="anchor"></a>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">200</span>               <span class="comment">\ If the character in A >= 200 then it represents a text</span>
 <span class="mne">BCS</span> <a class="popup destination">char1</a>              <span class="comment">\ token, so jump to char1 to print the token</span>

 <span class="mne">JMP</span> <a class="popup destination">PrintVduCharacter</a>  <span class="comment">\ Otherwise the character in A is a simple one-byte</span>
                        <span class="comment">\ character or VDU command, so jump to PrintVduCharacter</span>
                        <span class="comment">\ to print it</span>

<span class="label">.char1</span><a id="char1" class="anchor"></a>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">200</span>               <span class="comment">\ Set A = A - 200</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As we store recursive tokens within other tokens by</span>
                        <span class="comment">\ encoding then as 200 + the token number, this extracts</span>
                        <span class="comment">\ the recursive token number into A, so we can print it</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works because we jumped here with a</span>
                        <span class="comment">\ BCS, so we know that the C flag is set</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the token we want to print, to pass to the</span>
                        <span class="comment">\ PrintTextToken routine</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Store Y on the stack so we can retrieve it below</span>
 <span class="mne">PHA</span>

 <span class="mne">JSR</span> <a class="popup destination">PrintTextToken</a>     <span class="comment">\ Print the text token in X</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve Y from the stack, so Y now contains the</span>
 <span class="mne">TAY</span>                    <span class="comment">\ offset of the token we just printed within the parent</span>
                        <span class="comment">\ token that we are still printing</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getenemycount" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetEnemyCount</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the number of enemies for the current landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getenemycount.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a> calls <a href="#getenemycount">GetEnemyCount</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The enemy count for the landscape (in the range 1 to 8,</span>
                        <span class="argumentEntry">with higher values for higher landscape numbers)</span>

</div></div>
<span class="label">.GetEnemyCount</span><a id="getenemycount" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">landscapeNumberHi</a>  <span class="comment">\ Set T = (landscapeNumberHi / 4) + 2</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Because the landscape number is in BCD and in the form</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ 0000 to 9999, this extracts the top digit and adds 2</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">CLC</span>                    <span class="comment">\ So T is in the range 2 to 11, with higher values of T</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ for higher landscape numbers</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>

<span class="label">.enem1</span><a id="enem1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, which we now use to calculate the</span>
                        <span class="comment">\ enemy count for this landscape (so the same number is</span>
                        <span class="comment">\ calculated for the same landscape number each time)</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set Y = 7 to use as the count of clear bits in A when</span>
                        <span class="comment">\ A is zero</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set the C flag from bit 7 of this landscape's seed</span>
                        <span class="comment">\ number and clear bit 0 of A, leaving bits 6 to 0 of</span>
                        <span class="comment">\ the original A in bits 7 to 1</span>

 <span class="mne">PHP</span>                    <span class="comment">\ Store the status flags on the stack, so we can use the</span>
                        <span class="comment">\ C flag below to decide whether to negate the result</span>

                        <span class="comment">\ We now count the number of continuous clear bits at</span>
                        <span class="comment">\ the top of A, ignoring bit 0, so we count zeroes from</span>
                        <span class="comment">\ bit 7 down until we hit a 1, and put the result into Y</span>

 <span class="mne">BEQ</span> <a class="popup destination">enem3</a>              <span class="comment">\ If A = 0 then jump to enem3 with Y = 7, as we have a</span>
                        <span class="comment">\ continuous run of seven clear bits in bits 7 to 1</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Otherwise set Y = -1 so the following loop counts the</span>
                        <span class="comment">\ number of zeroes correctly</span>

<span class="label">.enem2</span><a id="enem2" class="anchor"></a>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the zero counter in Y</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift A to the left, moving the top bit into the C</span>
                        <span class="comment">\ flag</span>

 <span class="mne">BCC</span> <a class="popup destination">enem2</a>              <span class="comment">\ Loop back to keep shifting and counting zeroes until</span>
                        <span class="comment">\ we shift a 1 out of bit 7, at which point Y contains</span>
                        <span class="comment">\ the length of the run of zeroes in bits 6 to 0 of the</span>
                        <span class="comment">\ landscape's original seed number</span>

<span class="label">.enem3</span><a id="enem3" class="anchor"></a>

 <span class="mne">TYA</span>                    <span class="comment">\ At this point Y contains a number in the range 0 to 7,</span>
                        <span class="comment">\ so copy this into A</span>

 <span class="mne">PLP</span>                    <span class="comment">\ If the C flag we stored on the stack above was set,</span>
 <span class="mne">BCC</span> <a class="popup destination">enem4</a>              <span class="comment">\ invert A, so this flips the result into the range -1</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ to -8 if bit 7 of the landscape's original seed number</span>
                        <span class="comment">\ was set</span>

<span class="label">.enem4</span><a id="enem4" class="anchor"></a>

                        <span class="comment">\ At this point A is in the range -8 to 7</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + T</span>
 <span class="mne">ADC</span> <a class="popup variable">T</a>                  <span class="comment">\</span>
                        <span class="comment">\ T is in the range 2 to 11, so A is now in the range</span>
                        <span class="comment">\ -6 to 18</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ If A &lt; 0 or A >= 8 then loop back to enem1 to try</span>
 <span class="mne">BCS</span> <a class="popup destination">enem1</a>              <span class="comment">\ again</span>

                        <span class="comment">\ If we get here then A is now in the range 0 to 7, with</span>
                        <span class="comment">\ higher values for higher landscape numbers</span>

 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set A = A + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This addition works as we know the C flag is clear</span>
                        <span class="comment">\ because we just passed through a BCS</span>

                        <span class="comment">\ So A is now a number in the range 1 to 8, with higher</span>
                        <span class="comment">\ values for higher landscape numbers, which we can use</span>
                        <span class="comment">\ as our enemy count (after capping it to the value of</span>
                        <span class="comment">\ maxNumberOfEnemies after we return from the</span>
                        <span class="comment">\ subroutine)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getnextseed0to22" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetNextSeed0To22</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set A to the next number from the landscape's sequence of seed</span>
             <span class="headerEntry">numbers, converted to the range 0 to 22</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getnextseed0to22.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/generatelandscape.html">GenerateLandscape</a> calls <a href="#getnextseed0to22">GetNextSeed0To22</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntrees.html">SpawnTrees</a> calls <a href="#getnextseed0to22">GetNextSeed0To22</a></span>
</div>
</div></div>
<span class="label">.GetNextSeed0To22</span><a id="getnextseed0to22" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Set T to bits 0-2 of A</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000111</span>         <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ So T is a number in the range 0 to 7</span>
 <span class="mne">PLA</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set A to bits 3-6 of A and clear the C flag</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00011110</span>         <span class="comment">\ So T is a number in the range 0 to 15</span>
 <span class="mne">LSR</span> <span class="register">A</span>

 <span class="mne">ADC</span> <a class="popup variable">T</a>                  <span class="comment">\ Set A = A + T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A is a number in the range 0 to 22</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getplayerenergybcd" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPlayerEnergyBCD</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Fetch the player's energy in binary coded decimal (BCD)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getplayerenergybcd.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#getplayerenergybcd">GetPlayerEnergyBCD</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The player's energy in BCD</span>

</div></div>
<span class="label">.GetPlayerEnergyBCD</span><a id="getplayerenergybcd" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 to use as the player's energy in binary</span>
                        <span class="comment">\ coded decimal (BCD)</span>

 <span class="mne">LDX</span> <a class="popup variable">playerEnergy</a>       <span class="comment">\ Set X to the player's energy level</span>

 <span class="mne">BEQ</span> <a class="popup destination">plen2</a>              <span class="comment">\ If X = 0 then jump to plen2 to return A = 0 as the</span>
                        <span class="comment">\ player's energy in BCD</span>

                        <span class="comment">\ Otherwise we convert X into BCD by simply adding 1 to</span>
                        <span class="comment">\ A and repeating this X times</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This works because we only call this routine when the</span>
                        <span class="comment">\ D flag is set to switch arithmetic to BCD</span>
<span class="label">.plen1</span><a id="plen1" class="anchor"></a>

 <span class="mne">CLC</span>                    <span class="comment">\ Increment the BCD number we are building in A</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the player's energy level in S</span>

 <span class="mne">BNE</span> <a class="popup destination">plen1</a>              <span class="comment">\ Loop back until we have added 1 to A, X times, so A</span>
                        <span class="comment">\ now contains the original value of X but in BCD</span>

<span class="label">.plen2</span><a id="plen2" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-makesound" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">MakeSound</span>                                               <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Make a sound</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/makesound.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drainobjectenergy.html">DrainObjectEnergy</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processmusic.html">ProcessMusic</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processsound.html">ProcessSound</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processvolumekeys.html">ProcessVolumeKeys</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_2_of_8.html">ApplyTactics (Part 2 of 8)</a> calls via <a href="#makesound">MakeSound-6</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_6_of_8.html">ApplyTactics (Part 6 of 8)</a> calls via <a href="#makesound">MakeSound-6</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processsound.html">ProcessSound</a> calls via <a href="#makesound">MakeSound-6</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of the sound to make (0 to 6):</span>

                        <span class="argumentEntry">  * 0 = rotating enemy (two-part)</span>

                        <span class="argumentEntry">  * 1 = rotating meanie (two-part)</span>

                        <span class="argumentEntry">  * 2 = create/absorb object white noise</span>

                        <span class="argumentEntry">  * 3 = music</span>

                        <span class="argumentEntry">  * 4 = scanner</span>

                        <span class="argumentEntry">  * 5 = ping</span>

                        <span class="argumentEntry">  * 6 = game over (two-part)</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">MakeSound-6</span>          <span class="argumentEntry">Make a two-part sound at the pitches defined in X and Y,</span>
                        <span class="argumentEntry">where X is the pitch for sound data block #0 and Y is</span>
                        <span class="argumentEntry">the pitch for sound data block #1</span>

</div></div>
 <span class="mne">STX</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">4</span>        <span class="comment">\ Set the third parameter of sound data block #0 to X,</span>
                        <span class="comment">\ to set the pitch of the first sound</span>

 <span class="mne">STY</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">12</span>       <span class="comment">\ Set the third parameter of sound data block #1 to X,</span>
                        <span class="comment">\ to set the pitch of the second sound</span>

<span class="label">.MakeSound</span><a id="makesound" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the sound number on the stack</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Decrement A, keeping the result positive</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>
 <span class="mne">BCS</span> <a class="popup destination">soun1</a>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

<span class="label">.soun1</span><a id="soun1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">DefineEnvelope</a>     <span class="comment">\ Define envelope data A from the envelopeData table, so</span>
                        <span class="comment">\ sounds #0 and #1 both define envelope data 0, while</span>
                        <span class="comment">\ sounds #2 to #6 define envelope data 1 to 5</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the sound number from the stack and put it</span>
 <span class="mne">TAX</span>                    <span class="comment">\ into X, so we can use it as an index</span>

 <span class="mne">LDA</span> <a class="popup variable">soundNumberData</a>,<span class="register">X</span>  <span class="comment">\ Set A to the corresponding entry from soundNumberData</span>
                        <span class="comment">\ for the sound number in X, which tells us which blocks</span>
                        <span class="comment">\ of sound data to use from the soundData table when</span>
                        <span class="comment">\ making the sound</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ If A &lt;> 1 then jump to soun2 to make the sound using</span>
 <span class="mne">BNE</span> <a class="popup destination">soun2</a>              <span class="comment">\ the sound data in soundData block number A</span>

                        <span class="comment">\ If A = 1 then this is a two-part sound, with the first</span>
                        <span class="comment">\ part using the sound data in soundData block number A</span>
                        <span class="comment">\ and the second using the sound data in soundData block</span>
                        <span class="comment">\ zero</span>

 <span class="mne">JSR</span> <a class="popup destination">soun2</a>              <span class="comment">\ Call soun2 to make the first sound using the sound</span>
                        <span class="comment">\ data in soundData block number A</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 and fall through into soun2 to make the</span>
                        <span class="comment">\ second sound using the sound data in soundData block</span>
                        <span class="comment">\ zero</span>

<span class="label">.soun2</span><a id="soun2" class="anchor"></a>

                        <span class="comment">\ At this point we have the number of a soundData block</span>
                        <span class="comment">\ in A, in the range 0 to 4, so now we make the sound</span>
                        <span class="comment">\ using that sound data</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set (Y X) = soundData + A * 8</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ starting with the low byte (we set the high byte in</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">soundData</a><span class="bracket">)</span>     <span class="comment">\ MakeSoundEnvelope)</span>
 <span class="mne">TAX</span>                    <span class="comment">\</span>
                        <span class="comment">\ Each sound data block in soundData contains 8 bytes</span>
                        <span class="comment">\ of data, so this sets (Y X) to the address within</span>
                        <span class="comment">\ the soundData table of the data block specified in A</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set A = 7 for the OSWORD command to make a sound</span>

 <span class="mne">BNE</span> <a class="popup destination">MakeSoundEnvelope</a>  <span class="comment">\ Jump to MakeSoundEnvelope to set up Y and apply the</span>
                        <span class="comment">\ OSWORD command to the (Y X) block, which makes the</span>
                        <span class="comment">\ relevant sound (this BNE is effectively a JMP as A is</span>
                        <span class="comment">\ never zero)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-defineenvelope" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DefineEnvelope</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Define a sound envelope</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/defineenvelope.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/makesound.html">MakeSound</a> calls <a href="#defineenvelope">DefineEnvelope</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of the sound envelope data block to define in</span>
                        <span class="argumentEntry">the envelopeData table (0 to 5)</span>

</div></div>
<span class="label">.DefineEnvelope</span><a id="defineenvelope" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">aStoreEnvelope</a>     <span class="comment">\ Set (Y X) = envelopeData + (A * 8 - A) * 2</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\           = envelopeData + A * 7 * 2</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\           = envelopeData + A * 14</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">SEC</span>                    <span class="comment">\ starting with the low byte (we set the high byte in</span>
 <span class="mne">SBC</span> <a class="popup variable">aStoreEnvelope</a>     <span class="comment">\ MakeSoundEnvelope)</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">envelopeData</a><span class="bracket">)</span>  <span class="comment">\ Each envelope definition in envelopeData contains 14</span>
 <span class="mne">TAX</span>                    <span class="comment">\ bytes of data, so this sets A to the address within</span>
                        <span class="comment">\ the envelopeData table of the data for the envelope</span>
                        <span class="comment">\ number in A</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set A = 8 for the OSWORD command to define an envelope</span>

                        <span class="comment">\ Fall through into MakeSoundEnvelope to set up Y and</span>
                        <span class="comment">\ apply the OSWORD command to the (Y X) block, which</span>
                        <span class="comment">\ defines the relevant sound envelope</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-makesoundenvelope" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">MakeSoundEnvelope</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Either make a sound or set up an envelope</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/makesoundenvelope.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/makesound.html">MakeSound</a> calls <a href="#makesoundenvelope">MakeSoundEnvelope</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The action:</span>

                        <span class="argumentEntry">  * 7 = make a sound</span>

                        <span class="argumentEntry">  * 8 = define a sound envelope</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The low byte of the address of the OSWORD block</span>

</div></div>
<span class="label">.MakeSoundEnvelope</span><a id="makesoundenvelope" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">soundData</a><span class="bracket">)</span>     <span class="comment">\ Set Y to the high byte of the soundData block address,</span>
                        <span class="comment">\ which is the same as the high byte of the envelopeData</span>
                        <span class="comment">\ block address, so (Y X) now points to the relevant</span>
                        <span class="comment">\ envelope or sound or sound data block</span>

 <span class="mne">JMP</span> <a class="popup destination">OSWORD</a>             <span class="comment">\ Call OSWORD with action A, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * A = 7 to make the sound at (Y X)</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * A = 8 to set up the sound envelope at (Y X)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and return from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-astoreenvelope" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">aStoreEnvelope</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Temporary storage for use in the DefineEnvelope routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/astoreenvelope.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/defineenvelope.html">DefineEnvelope</a> uses <a href="#astoreenvelope">aStoreEnvelope</a></span>
</div>
</div></div>
<span class="label">.aStoreEnvelope</span><a id="astoreenvelope" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-soundnumberdata" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">soundNumberData</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table to map a sound number (0 to 6) to the sound data block(s)</span>
             <span class="headerEntry">that are used to make the sound</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/soundnumberdata.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/makesound.html">MakeSound</a> uses <a href="#soundnumberdata">soundNumberData</a></span>
</div>
</div></div>
<span class="label">.soundNumberData</span><a id="soundnumberdata" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Sound #0 = sound data block #1 then block #0</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Sound #1 = sound data block #1 then block #0</span>

 <span class="mne">EQUB</span> <span class="decimal">4</span>                 <span class="comment">\ Sound #2 = sound data block #4</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span>                 <span class="comment">\ Sound #3 = sound data block #2</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span>                 <span class="comment">\ Sound #4 = sound data block #2</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Sound #5 = sound data block #3</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Sound #6 = sound data block #1 then block #0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processvolumekeys" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessVolumeKeys</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Adjust the volume of the sound envelopes when the volume keys are</span>
             <span class="headerEntry">pressed</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processvolumekeys.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#processvolumekeys">ProcessVolumeKeys</a></span>
</div>
</div></div>
<span class="label">.ProcessVolumeKeys</span><a id="processvolumekeys" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">focusOnKeyAction</a>   <span class="comment">\ If bit 7 of focusOnKeyAction is set then the game is</span>
 <span class="mne">BMI</span> <a class="popup destination">volk6</a>              <span class="comment">\ focusing effort on a key action such as a landscape</span>
                        <span class="comment">\ pan, so jump to volk6 to return from the subroutine</span>
                        <span class="comment">\ without checking for volume-related key presses</span>

 <span class="mne">LDA</span> <a class="popup variable">volumeLevel</a>        <span class="comment">\ Set A to the current volume level</span>

 <span class="mne">LDX</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">3</span>        <span class="comment">\ Set X to the key logger entry for "7", "8", COPY and</span>
                        <span class="comment">\ DELETE (volume down, volume up, pause, unpause)</span>

 <span class="mne">BEQ</span> <a class="popup destination">volk1</a>              <span class="comment">\ If X = 0 then "7" (volume down) has been pressed, so</span>
                        <span class="comment">\ jump to volk1 to process it</span>

                        <span class="comment">\ If we get here then X must be 1, 2 or 3 (for "8",</span>
                        <span class="comment">\ COPY and DELETE)</span>

 <span class="mne">DEX</span>                    <span class="comment">\ If X - 1 &lt;> 0 then the original key logger entry must</span>
 <span class="mne">BNE</span> <a class="popup destination">volk6</a>              <span class="comment">\ be 2 or 3 (COPY or DELETE), so jump to volk6 to</span>
                        <span class="comment">\ return from the subroutine</span>

                        <span class="comment">\ If we get here then the key logger entry must be 1,</span>
                        <span class="comment">\ so "8" (volume up) has been pressed</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">120</span>               <span class="comment">\ If A >= 120 then the volume level is already at the</span>
 <span class="mne">BCS</span> <a class="popup destination">volk2</a>              <span class="comment">\ maximum level of 120, so jump to volk2 without</span>
                        <span class="comment">\ changing it</span>

 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Otherwise we can turn the volume up, so add 8 to the</span>
                        <span class="comment">\ volume level in A (the addition works because we know</span>
                        <span class="comment">\ we just passed through a BCS, so we know the C flag is</span>
                        <span class="comment">\ clear)</span>

 <span class="mne">BNE</span> <a class="popup destination">volk2</a>              <span class="comment">\ Jump to volk1 to update the volume level</span>

<span class="label">.volk1</span><a id="volk1" class="anchor"></a>

                        <span class="comment">\ If we get here then "7" (volume down) has been pressed</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ If A = 0 then the volume level is already at the</span>
 <span class="mne">BEQ</span> <a class="popup destination">volk2</a>              <span class="comment">\ minimum level of 0, so jump to volk2 without changing</span>
                        <span class="comment">\ it</span>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Otherwise we can turn the volume down, so subtract 8</span>
                        <span class="comment">\ from the volume level in A (the subtraction works</span>
                        <span class="comment">\ because we know that A > 0, so the CMP above will have</span>
                        <span class="comment">\ set the C)</span>

<span class="label">.volk2</span><a id="volk2" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ If soundCounter >= 2 then a sound is currently being</span>
 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ made (such as the confirmation ping we make when</span>
 <span class="mne">BCS</span> <a class="popup destination">ProcessVolumeKeys</a>  <span class="comment">\ changing the volume level) and it hasn't finished yet,</span>
                        <span class="comment">\ so loop back to the start of the routine to keep</span>
                        <span class="comment">\ checking for key presses and without changing the</span>
                        <span class="comment">\ volume, as we only want to change the volume when we</span>
                        <span class="comment">\ can make a pinging sound so the player can hear the</span>
                        <span class="comment">\ effect of the volume change</span>

 <span class="mne">STA</span> <a class="popup variable">volumeLevel</a>        <span class="comment">\ Update the volume level in volumeLevel to the new</span>
                        <span class="comment">\ value</span>

 <span class="mne">TAY</span>                    <span class="comment">\ Set Y to 0 (if the volume has been turned right down)</span>
 <span class="mne">BEQ</span> <a class="popup destination">volk3</a>              <span class="comment">\ or to 8 (if the volume level is non-zero)</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span>

<span class="label">.volk3</span><a id="volk3" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">envelopeData</a><span class="operator">+</span><span class="decimal">42</span><span class="operator">+</span><span class="decimal">13</span> <span class="comment">\ Set parameter #13 of envelope 3 to Y, to set the ALD</span>
                        <span class="comment">\ for the sound (the amplitude target level at the end</span>
                        <span class="comment">\ of the decay phase)</span>

 <span class="mne">STY</span> <a class="popup variable">envelopeData</a><span class="operator">+</span><span class="decimal">28</span><span class="operator">+</span><span class="decimal">13</span> <span class="comment">\ Set parameter #13 of envelope 2 to Y, to set the ALD</span>
                        <span class="comment">\ for the sound (the amplitude target level at the end</span>
                        <span class="comment">\ of the decay phase)</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">11</span>                <span class="comment">\ We now work through the envelopeVolumes table, which</span>
                        <span class="comment">\ contains offsets into the envelopeData table of the</span>
                        <span class="comment">\ bytes that control the volume of each envelope</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We update each of the bytes to reflect the new volume</span>
                        <span class="comment">\ level, so set a counter in Y to work through all 12</span>
                        <span class="comment">\ bytes of envelope data</span>

<span class="label">.volk4</span><a id="volk4" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">envelopeVolumes</a>,<span class="register">Y</span>  <span class="comment">\ Fetch the Y-th entry of the envelopeVolumes table into</span>
                        <span class="comment">\ X, so it contains the offset within the envelopeData</span>
                        <span class="comment">\ table that we need to update</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">79</span>                <span class="comment">\ If this is not the entry at the beginning of the table</span>
 <span class="mne">BNE</span> <a class="popup destination">volk5</a>              <span class="comment">\ (which will be the last to be processed), jump to</span>
                        <span class="comment">\ volk5 to set the envelope byte to the new volume level</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ If this is the entry at the beginning of the table,</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ negate the volume level in A, as this entry is for the</span>
                        <span class="comment">\ AD parameter (the change of amplitude per step during</span>
                        <span class="comment">\ the decay phase), and we want this aspect to drop more</span>
                        <span class="comment">\ quickly at higher volume levels</span>

<span class="label">.volk5</span><a id="volk5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">envelopeData</a>,<span class="register">X</span>     <span class="comment">\ Set the X-th byte of the envelope data to the volume</span>
                        <span class="comment">\ level in A</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the envelope byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">volk4</a>              <span class="comment">\ Loop back until we have updated all 12 bytes with the</span>
                        <span class="comment">\ new volume level</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">12</span>                <span class="comment">\ Set soundCounter = 12 to count down while the ping</span>
 <span class="mne">STA</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ sound is made</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\ Make sound #5 (ping) so the player can hear the new</span>
 <span class="mne">JSR</span> <a class="popup destination">MakeSound</a>          <span class="comment">\ volume level</span>

 <span class="mne">JMP</span> <a class="popup destination">ProcessVolumeKeys</a>  <span class="comment">\ Loop back to the start of the routine to keep checking</span>
                        <span class="comment">\ for key presses</span>

<span class="label">.volk6</span><a id="volk6" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-volumelevel" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">volumeLevel</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The volume level, which can be changed by pressing "7" and "8"</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/volumelevel.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processvolumekeys.html">ProcessVolumeKeys</a> uses <a href="#volumelevel">volumeLevel</a></span>
</div>
</div></div>
<span class="label">.volumeLevel</span><a id="volumelevel" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">88</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-envelopevolumes" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">envelopeVolumes</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table of offsets into the envelope data for bytes that control</span>
             <span class="headerEntry">the volume of each envelope, so we can change their volume levels</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/envelopevolumes.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processvolumekeys.html">ProcessVolumeKeys</a> uses <a href="#envelopevolumes">envelopeVolumes</a></span>
</div>
</div></div>
<span class="label">.envelopeVolumes</span><a id="envelopevolumes" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">5</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">9</span>        <span class="comment">\ Offset for parameter #9 of envelope 5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ AD (change of amplitude per step during decay phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">0</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">12</span>       <span class="comment">\ Offset for parameter #12 of envelope 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALA (target amplitude level at end of attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">0</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">13</span>       <span class="comment">\ Offset for parameter #13 of envelope 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALD (target amplitude level at end of decay phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">12</span>       <span class="comment">\ Offset for parameter #12 of envelope 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALA (target amplitude level at end of attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">13</span>       <span class="comment">\ Offset for parameter #13 of envelope 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALD (target amplitude level at end of decay phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">8</span>        <span class="comment">\ Offset for parameter #8 of envelope 2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ AA (change of amplitude per step during attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">12</span>       <span class="comment">\ Offset for parameter #12 of envelope 2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALA (target amplitude level at end of attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">12</span>       <span class="comment">\ Offset for parameter #12 of envelope 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALA (target amplitude level at end of attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">4</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">8</span>        <span class="comment">\ Offset for parameter #8 of envelope 5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ AA (change of amplitude per step during attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">4</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">12</span>       <span class="comment">\ Offset for parameter #12 of envelope 4</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALA (target amplitude level at end of attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">5</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">8</span>        <span class="comment">\ Offset for parameter #8 of envelope 5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ AA (change of amplitude per step during attack phase)</span>

 <span class="mne">EQUB</span> <span class="decimal">5</span> <span class="operator">*</span> <span class="decimal">14</span> <span class="operator">+</span> <span class="decimal">12</span>       <span class="comment">\ Offset for parameter #12 of envelope 5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ ALA (target amplitude level at end of attack phase)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processpausekeys" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessPauseKeys</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pause or unpause the game when COPY or DELETE are pressed</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processpausekeys.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#processpausekeys">ProcessPauseKeys</a></span>
</div>
</div></div>
<span class="label">.ProcessPauseKeys</span><a id="processpausekeys" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">3</span>        <span class="comment">\ Set A to the key logger entry for "7", "8", COPY and</span>
                        <span class="comment">\ DELETE (volume down, volume up, pause, unpause)</span>

 <span class="mne">BMI</span> <a class="popup destination">paws2</a>              <span class="comment">\ If there is no key press in the key logger entry, jump</span>
                        <span class="comment">\ to paws2 to return from the subroutine</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ If A &lt;> 2 then COPY is not being pressed, so jump to</span>
 <span class="mne">BNE</span> <a class="popup destination">paws2</a>              <span class="comment">\ paws2 to check for DELETE</span>

                        <span class="comment">\ If we get here then COPY is being pressed, so we need</span>
                        <span class="comment">\ to pause the game</span>

 <span class="mne">ROR</span> <a class="popup variable">gamePaused</a>         <span class="comment">\ Set bit 7 of gamePaused to indicate that the game is</span>
                        <span class="comment">\ paused (this works because the CMP above returned an</span>
                        <span class="comment">\ equality, so the C flag is set and ready to be rotated</span>
                        <span class="comment">\ into bit 7 of gamePaused)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Update the scanner so it's filled with green, to show</span>
 <span class="mne">JSR</span> <a class="popup destination">UpdateScannerNow</a>   <span class="comment">\ that the game is paused (calling UpdateScannerNow</span>
                        <span class="comment">\ ensures the scanner is updated irrespective of whether</span>
                        <span class="comment">\ the scanner is currently enabled in-game)</span>

 <span class="mne">JSR</span> <a class="popup destination">FlushSoundBuffers</a>  <span class="comment">\ Flush all four sound channel buffers</span>

<span class="label">.paws1</span><a id="paws1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">keyLogger</a><span class="operator">+</span><span class="decimal">3</span>        <span class="comment">\ Set A to the key logger entry for "7", "8", COPY and</span>
                        <span class="comment">\ DELETE (volume down, volume up, pause, unpause)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ If A &lt;> 3 then DELETE is not being pressed, so jump</span>
 <span class="mne">BNE</span> <a class="popup destination">paws1</a>              <span class="comment">\ paws1 to check for key presses (or wait until no key</span>
                        <span class="comment">\ is being pressed)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Update the scanner so it's filled with black, so the</span>
 <span class="mne">JSR</span> <a class="popup destination">UpdateScannerNow</a>   <span class="comment">\ game can resume with a blank scanner (calling</span>
                        <span class="comment">\ UpdateScannerNow ensures the scanner is updated</span>
                        <span class="comment">\ irrespective of whether the scanner is currently</span>
                        <span class="comment">\ enabled in-game)</span>

 <span class="mne">LSR</span> <a class="popup variable">gamePaused</a>         <span class="comment">\ Clear bit 7 of gamePaused to indicate that the game is</span>
                        <span class="comment">\ unpaused</span>

<span class="label">.paws2</span><a id="paws2" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processmusic" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessMusic</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Play the configured music in the background</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processmusic.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processsound.html">ProcessSound</a> calls <a href="#processmusic">ProcessMusic</a></span>
</div>
</div></div>
<span class="label">.ProcessMusic</span><a id="processmusic" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">musicCounter</a>       <span class="comment">\ Set X to the music counter, which points to the</span>
                        <span class="comment">\ current place in the music data</span>

 <span class="mne">BMI</span> <a class="popup destination">musi4</a>              <span class="comment">\ If bit 7 of musicCounter is set then there is no music</span>
                        <span class="comment">\ playing, so jump to musi4 to return from the</span>
                        <span class="comment">\ subroutine</span>

 <span class="mne">INC</span> <a class="popup variable">musicCounter</a>       <span class="comment">\ Otherwise there is some music being played, so</span>
                        <span class="comment">\ increment the music counter to move through the music</span>
                        <span class="comment">\ data</span>

 <span class="mne">LDA</span> <a class="popup variable">musicData</a>,<span class="register">X</span>        <span class="comment">\ Set A to the next byte of music data</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ If A = &FF then we just reached the end of this piece</span>
 <span class="mne">BEQ</span> <a class="popup destination">musi3</a>              <span class="comment">\ of music, so jump to musi3 to stop playing music</span>

                        <span class="comment">\ If we get here then we need to process the byte of</span>
                        <span class="comment">\ music data in A</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">200</span>               <span class="comment">\ If A &lt; 200 then jump to musi1 to make the sound</span>
 <span class="mne">BCC</span> <a class="popup destination">musi1</a>

                        <span class="comment">\ If we get here then A contains the sound counter to</span>
                        <span class="comment">\ set for all following notes, with the form 200 + x</span>
                        <span class="comment">\ setting the counter to 4 * x</span>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">200</span>               <span class="comment">\ Set noteCounter = (A - 200) * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ This subtraction works because we just passed through</span>
 <span class="mne">STA</span> <a class="popup variable">noteCounter</a>        <span class="comment">\ a BCC, so we know the C flag is set</span>

 <span class="mne">JMP</span> <a class="popup destination">ProcessMusic</a>       <span class="comment">\ Loop back to the start of the routine to process the</span>
                        <span class="comment">\ next byte of music data</span>

<span class="label">.musi1</span><a id="musi1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">20</span>       <span class="comment">\ Set the third parameter of sound data block #2 to A,</span>
                        <span class="comment">\ to set the pitch</span>

 <span class="mne">LDA</span> <a class="popup variable">noteCounter</a>        <span class="comment">\ Set soundCounter to the note duration so the note</span>
 <span class="mne">STA</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ plays for the correct amount of time</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the ProcessSound routine will do</span>
                        <span class="comment">\ nothing until this counter has run down, so we can</span>
                        <span class="comment">\ play three-note chords by setting the delay to zero</span>
                        <span class="comment">\ for the first two notes in the chord, so that there is</span>
                        <span class="comment">\ no delay between them, and then setting the delay for</span>
                        <span class="comment">\ the last note to the duration of the chord, so the</span>
                        <span class="comment">\ three chord notes play together for that period</span>
                        <span class="comment">\</span>
                        <span class="comment">\ All we need to do is ensure that the three notes can</span>
                        <span class="comment">\ play together, which is what we do next</span>

 <span class="mne">LDA</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">16</span>       <span class="comment">\ Set A to the first parameter of sound data block #2,</span>
                        <span class="comment">\ which contains the channel</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is in the form &1x for sound channel x, and it</span>
                        <span class="comment">\ starts out at &12 for channel 2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Channels 1 to 3 are for tones, so we work our way</span>
                        <span class="comment">\ through channels &11 to &13, playing each note on the</span>
                        <span class="comment">\ next channel number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This plays the music with the last three notes being</span>
                        <span class="comment">\ sustained, which lets us play three-note chords as</span>
                        <span class="comment">\ described above, giving the game music its distinctive</span>
                        <span class="comment">\ chord style</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Add 1 to move A onto the number of the next channel</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&14</span>               <span class="comment">\ If A &lt; &14 then we are still in the range &11 to &13,</span>
 <span class="mne">BCC</span> <a class="popup destination">musi2</a>              <span class="comment">\ so jump to musi2 to use this channel</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&11</span>               <span class="comment">\ Otherwise warp around to channel &11</span>

<span class="label">.musi2</span><a id="musi2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">16</span>       <span class="comment">\ Set the first parameter of sound data block #2 to A,</span>
                        <span class="comment">\ which sets the channel</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set the second parameter of sound data block #2 to 4,</span>
 <span class="mne">STA</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">18</span>       <span class="comment">\ which sets the amplitude</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Make sound #3 (music), which plays the next note of</span>
 <span class="mne">JMP</span> <a class="popup destination">MakeSound</a>          <span class="comment">\ music, returning from the subroutine using a tail call</span>

<span class="label">.musi3</span><a id="musi3" class="anchor"></a>

                        <span class="comment">\ If we get here then we just reached the end of the</span>
                        <span class="comment">\ piece of music and A = &FF</span>

 <span class="mne">STA</span> <a class="popup variable">musicCounter</a>       <span class="comment">\ Set bit 7 of the music counter to flag that we are no</span>
                        <span class="comment">\ longer playing any music</span>

<span class="label">.musi4</span><a id="musi4" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-flushsoundbuffers" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">FlushSoundBuffers</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Flush all four sound channel buffers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/flushsoundbuffers.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#flushsoundbuffers">FlushSoundBuffers</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processpausekeys.html">ProcessPauseKeys</a> calls <a href="#flushsoundbuffers">FlushSoundBuffers</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a> calls <a href="#flushsoundbuffers">FlushSoundBuffers</a></span>
</div>
</div></div>
<span class="label">.FlushSoundBuffers</span><a id="flushsoundbuffers" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ To flush all four sound channel buffers we need to</span>
                        <span class="comment">\ pass the values 4, 5, 6 and 7 to the FlushBuffer</span>
                        <span class="comment">\ routine, so set X to loop through those values</span>

<span class="label">.fbuf1</span><a id="fbuf1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">FlushBuffer</a>        <span class="comment">\ Call FlushBuffer to flush the buffer specified in X</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Loop back until we have flushed the buffers for all</span>
 <span class="mne">BCS</span> <a class="popup destination">fbuf1</a>              <span class="comment">\ four sound channels</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-flushsoundbuffer0" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">FlushSoundBuffer0</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Flush the sound channel 0 buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/flushsoundbuffer0.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#flushsoundbuffer0">FlushSoundBuffer0</a></span>
</div>
</div></div>
<span class="label">.FlushSoundBuffer0</span><a id="flushsoundbuffer0" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set X = 4 to denote the sound channel 0 buffer</span>

                        <span class="comment">\ Fall through into FlushBuffer to flush the sound</span>
                        <span class="comment">\ channel 0 buffer</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-flushbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">FlushBuffer</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Flush the specified buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/flushbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/enablekeyboard.html">EnableKeyboard</a> calls <a href="#flushbuffer">FlushBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/flushsoundbuffers.html">FlushSoundBuffers</a> calls <a href="#flushbuffer">FlushBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getplayerdrain.html">GetPlayerDrain</a> calls <a href="#flushbuffer">FlushBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the buffer to flush:</span>

                        <span class="argumentEntry">  * 4 = sound channel 0 buffer</span>

                        <span class="argumentEntry">  * 5 = sound channel 1 buffer</span>

                        <span class="argumentEntry">  * 6 = sound channel 2 buffer</span>

                        <span class="argumentEntry">  * 7 = sound channel 3 buffer</span>

</div></div>
<span class="label">.FlushBuffer</span><a id="flushbuffer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">21</span>                <span class="comment">\ Call OSBYTE with A = 21 to flush buffer X, returning</span>
 <span class="mne">JMP</span> <a class="popup destination">OSBYTE</a>             <span class="comment">\ from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processsound" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessSound</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Process any sound effects that have been configured so they play</span>
             <span class="headerEntry">in the background (this is called regularly throughout gameplay)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processsound.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/decayscreentoblack.html">DecayScreenToBlack</a> calls <a href="#processsound">ProcessSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> calls <a href="#processsound">ProcessSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_2_of_3.html">DrawLandscapeView (Part 2 of 3)</a> calls <a href="#processsound">ProcessSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#processsound">ProcessSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getrowvisibility_part_1_of_2.html">GetRowVisibility (Part 1 of 2)</a> calls <a href="#processsound">ProcessSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#processsound">ProcessSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#processsound">ProcessSound</a></span>
</div>
</div></div>
<span class="label">.ProcessSound</span><a id="processsound" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ If soundCounter is non-zero then a sound is already</span>
 <span class="mne">BNE</span> <a class="popup destination">psou1</a>              <span class="comment">\ being made, so jump to psou1 to return from the</span>
                        <span class="comment">\ subroutine</span>

 <span class="mne">LDA</span> <a class="popup variable">soundEffect</a>        <span class="comment">\ Set A to the type of sound effect we need to apply,</span>
                        <span class="comment">\ which is specified in the soundEffect variable when</span>
                        <span class="comment">\ the sound is made</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ If A = 4 then this is the scanner sound, so jump to</span>
 <span class="mne">BEQ</span> <a class="popup destination">psou3</a>              <span class="comment">\ psou3 to process the scanner sound</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ If A = 3 then this is music, so jump to ProcessMusic</span>
 <span class="mne">BEQ</span> <a class="popup destination">psou2</a>              <span class="comment">\ via psou2 to process the music being played</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ If A &lt;> 6 then there is no sound effect to apply, so</span>
 <span class="mne">BNE</span> <a class="popup destination">psou1</a>              <span class="comment">\ jump to psou1 to return from the subroutine</span>

                        <span class="comment">\ If we get here then soundEffect = 6, so this is the</span>
                        <span class="comment">\ game over sound</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set X = 7 to pass to MakeSound-6 as the pitch of the</span>
                        <span class="comment">\ first part of the game over sound</span>

 <span class="mne">LDY</span> <a class="popup variable">gameOverSoundPitch</a> <span class="comment">\ Set Y to the pitch for the second part of the game</span>
                        <span class="comment">\ over sound, which starts in the ShowGameOverScreen</span>
                        <span class="comment">\ routine at 250 and counts down towards 80</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">80</span>                <span class="comment">\ If Y &lt; 80 then the game over sound has finished, so</span>
 <span class="mne">BCC</span> <a class="popup destination">psou1</a>              <span class="comment">\ jump to psou1 to return from the subroutine without</span>
                        <span class="comment">\ making a sound</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Make sound #6 (game over) with the pitches in X and Y</span>
 <span class="mne">JSR</span> <a class="popup destination">MakeSound-6</a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, which by this point in the game is</span>
                        <span class="comment">\ effectively a random number</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Convert the random number in A into a random number in</span>
 <span class="mne">CLC</span>                    <span class="comment">\ the range 1 to 4</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

 <span class="mne">STA</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ Set soundCounter to a random number between 1 and 4 to</span>
                        <span class="comment">\ control the length of the noise we just made</span>

 <span class="mne">DEC</span> <a class="popup variable">gameOverSoundPitch</a> <span class="comment">\ Decrement the pitch of the game over sound so the</span>
                        <span class="comment">\ overall effect is of a slowly decaying sound effect</span>

<span class="label">.psou1</span><a id="psou1" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.psou2</span><a id="psou2" class="anchor"></a>

                        <span class="comment">\ If we get here then soundEffect = 3, so the sound</span>
                        <span class="comment">\ effect is music</span>

 <span class="mne">JMP</span> <a class="popup destination">ProcessMusic</a>       <span class="comment">\ Jump to ProcessMusic to play the music</span>

<span class="label">.psou3</span><a id="psou3" class="anchor"></a>

                        <span class="comment">\ If we get here then soundEffect = 4, so this is the</span>
                        <span class="comment">\ scanner sound</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">50</span>                <span class="comment">\ Set soundCounter = 50 to count down while the next</span>
 <span class="mne">STA</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ sound is made</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">34</span>                <span class="comment">\ Set the third parameter of sound data block #2 to 34,</span>
 <span class="mne">STA</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">20</span>       <span class="comment">\ to set the pitch</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set the second parameter of sound data block #2 to 3,</span>
 <span class="mne">STA</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">18</span>       <span class="comment">\ to set the amplitude</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Make sound #4 (scanner)</span>
 <span class="mne">JSR</span> <a class="popup destination">MakeSound</a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

 <span class="mne">EQUB</span> <span class="hex">&B9</span>               <span class="comment">\ This byte appears to be unused</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-playgame" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PlayGame</span>                                                <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main game loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Start playing the generated landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/playgame.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checksecretcode_part_2_of_2.html">CheckSecretCode (Part 2 of 2)</a> calls <a href="#playgame">PlayGame</a></span>
</div>
</div></div>
<span class="label">.PlayGame</span><a id="playgame" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&83</span>               <span class="comment">\ Set the palette to the first set of colours from the</span>
 <span class="mne">JSR</span> <a class="popup destination">SetColourPalette</a>   <span class="comment">\ colourPalettes table, which the SpawnEnemies routine</span>
                        <span class="comment">\ set to the correct palette for playing the game (so</span>
                        <span class="comment">\ for landscape 0000 that would be blue, black, white</span>
                        <span class="comment">\ and green, for example)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this displays the landscape preview screen that we</span>
                        <span class="comment">\ drew in PreviewLandscape with an all-blue palette</span>
                        <span class="comment">\ before jumping here</span>

 <span class="mne">JSR</span> <a class="popup destination">ReadKeyboard</a>       <span class="comment">\ Enable the keyboard, flush the keyboard buffer and</span>
                        <span class="comment">\ read a character from it (so this waits for a key</span>
                        <span class="comment">\ press before starting the game, following the "PRESS</span>
                        <span class="comment">\ ANY KEY" message on the landscape preview screen)</span>

 <span class="mne">LSR</span> <a class="popup variable">gameInProgress</a>     <span class="comment">\ Clear bit 7 of gameInProgress to indicate that a game</span>
                        <span class="comment">\ now in progress and we are no longer in the title and</span>
                        <span class="comment">\ preview screens (so the interrupt handler can now</span>
                        <span class="comment">\ update the game)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-maingameloop" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">MainGameLoop</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main game loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The main game loop for playing a landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/maingameloop.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilealtitudes.html">GetTileAltitudes</a> calls via <a href="#game10">game10</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">game10</span>               <span class="argumentEntry">Jump to MainTitleLoop to restart the game</span>

</div></div>
<span class="label">.MainGameLoop</span><a id="maingameloop" class="anchor"></a>

                        <span class="comment">\ If we get here then we have either started a brand new</span>
                        <span class="comment">\ game or we jumped here from game11 below when one of</span>
                        <span class="comment">\ the following occurred:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The Sentinel has won</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has moved to a new tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has pressed the quit game key</span>

 <span class="mne">JSR</span> <a class="popup destination">FlushSoundBuffers</a>  <span class="comment">\ Flush all four sound channel buffers</span>

 <span class="mne">LDA</span> <a class="popup variable">quitGame</a>           <span class="comment">\ If bit 7 of quitGame is clear then the player has not</span>
 <span class="mne">BPL</span> <a class="popup destination">game1</a>              <span class="comment">\ pressed function key f1 to quit the game, so jump to</span>
                        <span class="comment">\ game 1 to keep playing the game</span>

 <span class="mne">JMP</span> <a class="popup destination">MainTitleLoop</a>      <span class="comment">\ The player has pressed function key f1 to quit the</span>
                        <span class="comment">\ game, so jump to MainTitleLoop to restart the game</span>

<span class="label">.game1</span><a id="game1" class="anchor"></a>

                        <span class="comment">\ If we get here then we have either started a brand new</span>
                        <span class="comment">\ landscape or we jumped to MainGameLoop from game11</span>
                        <span class="comment">\ below when one of the following occurred:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The Sentinel has won</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has moved to a new tile</span>

 <span class="mne">LDA</span> <a class="popup variable">sentinelHasWon</a>     <span class="comment">\ If bit 7 of sentinelHasWon is set then the player has</span>
 <span class="mne">BMI</span> <a class="popup destination">game6</a>              <span class="comment">\ run out of energy either by trying to hyperspace or by</span>
                        <span class="comment">\ being absorbed, so jump to game6 to restart the</span>
                        <span class="comment">\ landscape</span>

                        <span class="comment">\ If we get here then we have either started a brand new</span>
                        <span class="comment">\ landscape or we jumped to MainGameLoop from game11</span>
                        <span class="comment">\ below when the player moved to a new tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In both cases we need to generate a brand new</span>
                        <span class="comment">\ landscape view</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set all four logical colours to physical colour 4</span>
 <span class="mne">JSR</span> <a class="popup destination">SetColourPalette</a>   <span class="comment">\ (blue), so this blanks the entire screen to blue</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set screenOrBuffer = 0 to configure the drawing</span>
 <span class="mne">STA</span> <a class="popup variable">screenOrBuffer</a>     <span class="comment">\ routines to draw directly onto the screen (as opposed</span>
                        <span class="comment">\ to drawing into the screen buffer)</span>

 <span class="mne">STA</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ Zero lastPanKeyPressed so that when we draw the whole</span>
                        <span class="comment">\ landscape view onto the screen below, we draw it in</span>
                        <span class="comment">\ character columns, working from left to right, in the</span>
                        <span class="comment">\ same order as we would for a pan to the right (which</span>
                        <span class="comment">\ is what a zero value of lastPanKeyPressed usually</span>
                        <span class="comment">\ represents)</span>

 <span class="mne">STA</span> <a class="popup variable">sightsByteCount</a>    <span class="comment">\ Set sightsByteCount to zero to reset the sights pixel</span>
                        <span class="comment">\ byte stash</span>

 <span class="mne">STA</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ Clear bit 7 of sightsAreVisible to indicate that the</span>
                        <span class="comment">\ sights are not visible</span>

 <span class="mne">JSR</span> <a class="popup destination">SetScannerAndPause</a> <span class="comment">\ Set scannerUpdate to zero to prevent scanner updates</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This routine also performs a delay of 40 empty loops</span>
                        <span class="comment">\ of 256 iterations each (i.e. 10,240 loops)</span>

 <span class="mne">LDA</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set viewingObject to the object number of the player,</span>
 <span class="mne">STA</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ so the landscape view gets drawn from the perspective</span>
                        <span class="comment">\ of the player</span>

 <span class="mne">BIT</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ If bit 7 of hyperspaceEndsGame is clear then the game</span>
 <span class="mne">BPL</span> <a class="popup destination">game2</a>              <span class="comment">\ has not ended because of a hyperspace, so jump to</span>
                        <span class="comment">\ game2 to draw the landscape</span>

                        <span class="comment">\ If we get here then the game has ended because the</span>
                        <span class="comment">\ player performed a hyperspace</span>

 <span class="mne">BVS</span> <a class="popup destination">game7</a>              <span class="comment">\ If bit 6 of hyperspaceEndsGame is set then the game</span>
                        <span class="comment">\ has ended because the player has hyperspaced from the</span>
                        <span class="comment">\ Sentinel's tower, thus winning the game, so jump to</span>
                        <span class="comment">\ game7 to process winning the landscape</span>

                        <span class="comment">\ If we get here then bit 6 of hyperspaceEndsGame is</span>
                        <span class="comment">\ clear and the player has run out of energy by trying</span>
                        <span class="comment">\ to hyperspace without being able to create a robot</span>
                        <span class="comment">\ into which they can hyperspace</span>

 <span class="mne">JSR</span> <a class="popup destination">ClearScreen</a>        <span class="comment">\ Clear the screen</span>

 <span class="mne">JMP</span> <a class="popup destination">game4</a>              <span class="comment">\ Jump to game4 to skip drawing the landscape view, as</span>
                        <span class="comment">\ the game has ended</span>

<span class="label">.game2</span><a id="game2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">uTurnStatus</a>        <span class="comment">\ If bit 7 of uTurnStatus is set then we just performed</span>
 <span class="mne">BMI</span> <a class="popup destination">game3</a>              <span class="comment">\ a U-turn in the ProcessActionKeys routine, so jump to</span>
                        <span class="comment">\ game3 to skip the following instruction, as we don't</span>
                        <span class="comment">\ need to recalculate tile visibility if we are turning</span>
                        <span class="comment">\ around (as the player hasn't moved)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileVisibility</a>  <span class="comment">\ For each tile in the landscape, calculate whether the</span>
                        <span class="comment">\ player can see that tile, to speed up the process of</span>
                        <span class="comment">\ drawing the landscape</span>

<span class="label">.game3</span><a id="game3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ClearScreen</a>        <span class="comment">\ Clear the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeView</a>  <span class="comment">\ Draw the landscape view</span>

 <span class="mne">JSR</span> <a class="popup destination">UpdateIconsScanner</a> <span class="comment">\ Update the icons in the top-left corner of the screen</span>
                        <span class="comment">\ to show the player's current energy level and redraw</span>
                        <span class="comment">\ the scanner box</span>

<span class="label">.game4</span><a id="game4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">25</span>                <span class="comment">\ Set screenOrBuffer = 25 to configure the drawing</span>
 <span class="mne">STA</span> <a class="popup variable">screenOrBuffer</a>     <span class="comment">\ routines to draw into the screen buffer (as opposed</span>
                        <span class="comment">\ to drawing directly onto the screen)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Call ConfigureBuffer with A = 2 to set up the screen</span>
 <span class="mne">JSR</span> <a class="popup destination">ConfigureBuffer</a>    <span class="comment">\ buffer for use as a column buffer</span>

<span class="label">.game5</span><a id="game5" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">LDA</span> <a class="popup variable">musicCounter</a>       <span class="comment">\ Loop back to keep calling ProcessSound until bit 7 of</span>
 <span class="mne">BPL</span> <a class="popup destination">game5</a>              <span class="comment">\ musicCounter is clear, so if any music is being</span>
                        <span class="comment">\ played, we wait until it has finished</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&83</span>               <span class="comment">\ Set the palette to the first set of colours from the</span>
 <span class="mne">JSR</span> <a class="popup destination">SetColourPalette</a>   <span class="comment">\ colourPalettes table, which the SpawnEnemies routine</span>
                        <span class="comment">\ set to the correct palette for playing the game (so</span>
                        <span class="comment">\ for landscape 0000 that would be blue, black, white</span>
                        <span class="comment">\ and green, for example)</span>

 <span class="mne">LDA</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ Set A to the hyperspace status flag</span>

 <span class="mne">BPL</span> <a class="popup destination">game11</a>             <span class="comment">\ If bit 7 of hyperspaceEndsGame is clear then the game</span>
                        <span class="comment">\ has not ended because of a hyperspace, so jump to</span>
                        <span class="comment">\ game11 to keep going</span>

                        <span class="comment">\ If we get here then the game has ended because of a</span>
                        <span class="comment">\ hyperspace, and it must be because the player ran out</span>
                        <span class="comment">\ of energy, as otherwise we would have taken the branch</span>
                        <span class="comment">\ to game7 above</span>

 <span class="mne">STA</span> <a class="popup variable">sentinelHasWon</a>     <span class="comment">\ Set bit 7 of sentinelHasWon to indicate that the</span>
                        <span class="comment">\ player has run out of energy and the Sentinel has won</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Set soundEffect = 6 so the sound is processed as the</span>
 <span class="mne">STA</span> <a class="popup variable">soundEffect</a>        <span class="comment">\ game over sound</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">5</span>                 <span class="comment">\ The Sentinel has won, so display the game over screen</span>
 <span class="mne">JSR</span> <a class="popup destination">ShowGameOverScreen</a> <span class="comment">\ with A = 5, so we decay the screen to black with a</span>
                        <span class="comment">\ mass of 5 * 2400 = 12,000 randomly placed black dots</span>

<span class="label">.game6</span><a id="game6" class="anchor"></a>

                        <span class="comment">\ If we get here then we restart the landscape by</span>
                        <span class="comment">\ resetting all the game variables, initialising the</span>
                        <span class="comment">\ the seed number generator and jumping into the main</span>
                        <span class="comment">\ title loop to preview the landscape and play the game</span>

 <span class="mne">JSR</span> <a class="popup destination">ResetVariables</a>     <span class="comment">\ Reset all the game's main variables</span>

 <span class="mne">LDY</span> <a class="popup variable">landscapeNumberHi</a>  <span class="comment">\ Set (Y X) = landscapeNumber(Hi Lo)</span>
 <span class="mne">LDX</span> <a class="popup variable">landscapeNumberLo</a>

 <span class="mne">JSR</span> <a class="popup destination">InitialiseSeeds</a>    <span class="comment">\ Initialise the seed number generator to generate the</span>
                        <span class="comment">\ sequence of seed numbers for the landscape number in</span>
                        <span class="comment">\ (Y X) and set maxNumberOfEnemies and the landscapeZero</span>
                        <span class="comment">\ flag accordingly</span>

 <span class="mne">JMP</span> <a class="popup destination">main4</a>              <span class="comment">\ Jump to main4 in the main title loop to restart the</span>
                        <span class="comment">\ landscape without having to enter the landscape's</span>
                        <span class="comment">\ secret code again</span>

<span class="label">.game7</span><a id="game7" class="anchor"></a>

                        <span class="comment">\ If we get here then we have successfully completed</span>
                        <span class="comment">\ the landscape, so we display the secret code for the</span>
                        <span class="comment">\ next landscape and go back to the title screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set all four logical colours to physical colour 4</span>
 <span class="mne">JSR</span> <a class="popup destination">SetColourPalette</a>   <span class="comment">\ (blue), so this blanks the entire screen to blue</span>

                        <span class="comment">\ In order to display the secret code for the next</span>
                        <span class="comment">\ landscape we need to generate it, so we now reset the</span>
                        <span class="comment">\ landscape seed generator, the tile visibility table</span>
                        <span class="comment">\ and the object flags, to get ready for the generation</span>
                        <span class="comment">\ process in the FinishLandscape routine</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ We now zero bits 8 to 40 of the five-byte linear</span>
                        <span class="comment">\ feedback shift landscape register, so set a byte</span>
                        <span class="comment">\ counter in X to count four bytes</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so we can zero the four bytes</span>

 <span class="mne">STA</span> <a class="popup variable">soundEffect</a>        <span class="comment">\ Set soundEffect = 0 to disable sound effect processing</span>
                        <span class="comment">\ in the ProcessSound routine</span>

<span class="label">.game8</span><a id="game8" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span> <span class="comment">\ Zero byte X+1 of seedNumberLFSR(4 3 2 1 0)</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">game8</a>              <span class="comment">\ Loop back until we have reset all four bytes</span>

 <span class="mne">JSR</span> <a class="popup destination">ResetTilesObjects</a>  <span class="comment">\ Reset the tile visibility table and deallocate all</span>
                        <span class="comment">\ object numbers</span>

 <span class="mne">JSR</span> <a class="popup destination">FinishLandscape</a>    <span class="comment">\ Add the player's energy to the landscape number to get</span>
                        <span class="comment">\ the number of the next landscape and display that</span>
                        <span class="comment">\ landscape's secret code as a title screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&87</span>               <span class="comment">\ Set the palette to the second set of colours from the</span>
 <span class="mne">JSR</span> <a class="popup destination">SetColourPalette</a>   <span class="comment">\ colourPalettes table, which contains the fixed palette</span>
                        <span class="comment">\ for the title screens (blue, black, red, yellow)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ Set soundCounter = 10 to count down while the next</span>
 <span class="mne">STA</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ sound is made</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">66</span>                <span class="comment">\ Call the PlayMusic routine with A = 66 to play the</span>
 <span class="mne">JSR</span> <a class="popup destination">PlayMusic</a>          <span class="comment">\ music for when the player finishes a landscape</span>

<span class="label">.game9</span><a id="game9" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">LDA</span> <a class="popup variable">musicCounter</a>       <span class="comment">\ Loop back to keep calling ProcessSound until bit 7 of</span>
 <span class="mne">BPL</span> <a class="popup destination">game9</a>              <span class="comment">\ musicCounter is clear, so if any music is being</span>
                        <span class="comment">\ played, we wait until it has finished</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Print text token 6: Print "PRESS ANY KEY" at (64, 100)</span>
 <span class="mne">JSR</span> <a class="popup destination">PrintTextToken</a>

 <span class="mne">JSR</span> <a class="popup destination">ReadKeyboard</a>       <span class="comment">\ Enable the keyboard, flush the keyboard buffer and</span>
                        <span class="comment">\ read a character from it (so this waits for a key</span>
                        <span class="comment">\ press)</span>

<span class="label">.game10</span><a id="game10" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">MainTitleLoop</a>      <span class="comment">\ Jump to MainTitleLoop to restart the game from the</span>
                        <span class="comment">\ title screen</span>

<span class="label">.game11</span><a id="game11" class="anchor"></a>

                        <span class="comment">\ If we get here then the game is still in progress, so</span>
                        <span class="comment">\ we progress the gameplay</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessGameplay</a>    <span class="comment">\ Run the gameplay loop that processes all game key</span>
                        <span class="comment">\ presses, returning here when the player moves, quits,</span>
                        <span class="comment">\ loses or pans</span>

 <span class="mne">BCC</span> <a class="popup destination">game12</a>             <span class="comment">\ The ProcessGameplay routine will return with the C</span>
                        <span class="comment">\ flag clear if we just finished a landscape pan and the</span>
                        <span class="comment">\ player is still holding down a pan key, in which case</span>
                        <span class="comment">\ jump to game12 to process the pan</span>

 <span class="mne">JMP</span> <a class="popup destination">MainGameLoop</a>       <span class="comment">\ Otherwise the ProcessGameplay routine returned because</span>
                        <span class="comment">\ one of the following is true:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The Sentinel has won</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has moved to a new tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The player has pressed the quit game key</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so jump to MainGameLoop to process these actions</span>

<span class="label">.game12</span><a id="game12" class="anchor"></a>

                        <span class="comment">\ If we get here then the player is holding down a pan</span>
                        <span class="comment">\ key and wants to pan the screen, so we need to process</span>
                        <span class="comment">\ the pan</span>

 <span class="mne">LDA</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ Update lastPanKeyPressed with the details of the pan</span>
 <span class="mne">STA</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ key being pressed, so we can check later on whether it</span>
                        <span class="comment">\ is still being held down</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set numberOfScrolls = 0 to reset the scroll counter</span>
 <span class="mne">STA</span> <a class="popup variable">numberOfScrolls</a>    <span class="comment">\ so the interrupt handler will not scroll the screen</span>
                        <span class="comment">\ while we set up the new pan</span>

 <span class="mne">STA</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ Clear bit 7 of doNotDitherObject to enable objects to</span>
                        <span class="comment">\ be updated on the screen with a dithered effect</span>

 <span class="mne">BIT</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ If bit 7 of sightsAreVisible is set then the sights</span>
 <span class="mne">BMI</span> <a class="popup destination">game13</a>             <span class="comment">\ are being shown, so jump to game13 to skip the</span>
                        <span class="comment">\ following two instructions</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that when we pan the screen as a result</span>
                        <span class="comment">\ of the sights moving off the edge of the screen, the</span>
                        <span class="comment">\ panning process completes and doesn't get aborted if</span>
                        <span class="comment">\ the player releases the pan key</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The sights are not visible so we are panning the</span>
 <span class="mne">ROR</span> <a class="popup variable">keepCheckingPanKey</a> <span class="comment">\ screen because the player has pressed a pan key, so</span>
                        <span class="comment">\ set bit 7 of keepCheckingPanKey so DrawLandscapeView</span>
                        <span class="comment">\ will abort the drawing process if the player releases</span>
                        <span class="comment">\ the pan key before the drawing process has finished</span>

<span class="label">.game13</span><a id="game13" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">PanLandscapeView</a>   <span class="comment">\ Pan the landscape and update the landscape view</span>

 <span class="mne">LSR</span> <a class="popup variable">keepCheckingPanKey</a> <span class="comment">\ Clear bit 7 of keepCheckingPanKey so DrawLandscapeView</span>
                        <span class="comment">\ will keep drawing the landscape irrespective of the</span>
                        <span class="comment">\ pan keys being held down (so this takes the routine</span>
                        <span class="comment">\ back to its default behaviour)</span>

 <span class="mne">JSR</span> <a class="popup destination">UpdateIconsScanner</a> <span class="comment">\ Update the icons in the top-left corner of the screen</span>
                        <span class="comment">\ to show the player's current energy level and redraw</span>
                        <span class="comment">\ the scanner box</span>

 <span class="mne">LDA</span> <a class="popup variable">numberOfScrolls</a>    <span class="comment">\ Set scrollCounter to the number of scrolls required,</span>
 <span class="mne">STA</span> <a class="popup variable">scrollCounter</a>      <span class="comment">\ so the interrupt handler will scroll the screen by</span>
                        <span class="comment">\ this many steps in the background</span>

<span class="label">.game14</span><a id="game14" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">scrollCounter</a>      <span class="comment">\ Loop around until scrollCounter is zero, so this waits</span>
 <span class="mne">BNE</span> <a class="popup destination">game14</a>             <span class="comment">\ until the interrupt handler has finished scrolling the</span>
                        <span class="comment">\ landscape view, thus implementing the pan on-screen</span>

 <span class="mne">BEQ</span> <a class="popup destination">game11</a>             <span class="comment">\ Jump to game11 to continue progressing the gameplay</span>
                        <span class="comment">\ (this BEQ is effectively a JMP as we just passed</span>
                        <span class="comment">\ through a BNE)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-cleariconsscanner" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ClearIconsScanner</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Clear the energy icon and scanner row at the top of the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/cleariconsscanner.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/clearscreen.html">ClearScreen</a> calls <a href="#cleariconsscanner">ClearIconsScanner</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a> calls <a href="#cleariconsscanner">ClearIconsScanner</a></span>
</div>
</div></div>
<span class="label">.ClearIconsScanner</span><a id="cleariconsscanner" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set xIconCounter = 0 so we start drawing from the left</span>
 <span class="mne">STA</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ edge of the screen</span>

<span class="label">.enec1</span><a id="enec1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Draw a blank icon into the top part of the screen (via</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right, incrementing xIconCounter as we do</span>

 <span class="mne">LDA</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ Loop back to keep drawing blank icons until we have</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">40</span>                <span class="comment">\ cleared column 39, at which point we have cleared the</span>
 <span class="mne">BCC</span> <a class="popup destination">enec1</a>              <span class="comment">\ entire row</span>

 <span class="mne">JMP</span> <a class="popup destination">ShowIconBuffer</a>     <span class="comment">\ Display the contents of the icon screen buffer by</span>
                        <span class="comment">\ copying it into screen memory, which will clear the</span>
                        <span class="comment">\ row on-screen, and return from the subroutine using a</span>
                        <span class="comment">\ tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-printtexttoken" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PrintTextToken</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print a recursive text token</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/printtexttoken.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#printtexttoken">PrintTextToken</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#printtexttoken">PrintTextToken</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#printtexttoken">PrintTextToken</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#printtexttoken">PrintTextToken</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processcharacter.html">ProcessCharacter</a> calls <a href="#printtexttoken">PrintTextToken</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/secretcodeerror.html">SecretCodeError</a> calls <a href="#printtexttoken">PrintTextToken</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the text token to print (0 to 17)</span>

</div></div>
<span class="label">.PrintTextToken</span><a id="printtexttoken" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">tokenOffset</a>,<span class="register">X</span>      <span class="comment">\ Set Y to the offset for text token X, which we can use</span>
                        <span class="comment">\ as a character index to print each character in turn</span>

<span class="label">.text1</span><a id="text1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">tokenBase</a>,<span class="register">Y</span>        <span class="comment">\ Set A to the Y-th character of the text token</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ If A = &FF then we have reached the end of the token,</span>
 <span class="mne">BEQ</span> <a class="popup destination">text2</a>              <span class="comment">\ so jump to text2 to return from the subroutine</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessCharacter</a>   <span class="comment">\ Process the Y-th character of the text token in A, so</span>
                        <span class="comment">\ if A is a token number in the format 200 + token, we</span>
                        <span class="comment">\ print the text token, otherwise we print A as a simple</span>
                        <span class="comment">\ one-byte character</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the character index in Y to point to the</span>
                        <span class="comment">\ next character of the text token</span>

 <span class="mne">JMP</span> <a class="popup destination">text1</a>              <span class="comment">\ Loop back to print the next character</span>

<span class="label">.text2</span><a id="text2" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-clearpixelmask" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">clearPixelMask</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table for converting a pixel number in the range 0 to 3 into a</span>
             <span class="headerEntry">screen mode 5 bit mask with that pixel's bits clear and others set</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/clearpixelmask.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> uses <a href="#clearpixelmask">clearPixelMask</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawsights.html">DrawSights</a> uses <a href="#clearpixelmask">clearPixelMask</a></span>
</div>
</div></div>
<span class="label">.clearPixelMask</span><a id="clearpixelmask" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%01110111</span>         <span class="comment">\ Pixel bit mask with all pixels set except pixel 0</span>

 <span class="mne">EQUB</span> <span class="binary">%10111011</span>         <span class="comment">\ Pixel bit mask with all pixels set except pixel 1</span>

 <span class="mne">EQUB</span> <span class="binary">%11011101</span>         <span class="comment">\ Pixel bit mask with all pixels set except pixel 2</span>

 <span class="mne">EQUB</span> <span class="binary">%11101110</span>         <span class="comment">\ Pixel bit mask with all pixels set except pixel 3</span>

 <span class="mne">EQUB</span> <span class="binary">%10001000</span>         <span class="comment">\ These bytes appear to be unused</span>
 <span class="mne">EQUB</span> <span class="binary">%01000100</span>
 <span class="mne">EQUB</span> <span class="binary">%00100010</span>
 <span class="mne">EQUB</span> <span class="binary">%00010001</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updateiconsscanner" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UpdateIconsScanner</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the icons in the top-left corner of the screen to show the</span>
             <span class="headerEntry">player's current energy level and redraw the scanner box</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/updateiconsscanner.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drainobjectenergy.html">DrainObjectEnergy</a> calls <a href="#updateiconsscanner">UpdateIconsScanner</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#updateiconsscanner">UpdateIconsScanner</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#updateiconsscanner">UpdateIconsScanner</a></span>
</div>
</div></div>
<span class="label">.UpdateIconsScanner</span><a id="updateiconsscanner" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 to pass to DrawIcon</span>

 <span class="mne">STA</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ Set xIconCounter = 0 so we start drawing from the left</span>
                        <span class="comment">\ edge of the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ Draw a blank icon into the top part of the screen (via</span>
                        <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right, incrementing xIconCounter as we do</span>

 <span class="mne">LDA</span> <a class="popup variable">playerEnergy</a>       <span class="comment">\ Set a loop counter to count down through the player's</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ energy, so we can reduce it by the maximum possible</span>
                        <span class="comment">\ amount each time to work out the minimum number of</span>
                        <span class="comment">\ icons that represent that energy level</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, loopCounter contains the amount of</span>
                        <span class="comment">\ energy that we have yet to draw</span>

<span class="label">.ener1</span><a id="ener1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ If loopCounter &lt; 15 then we can't represent it with a</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">15</span>                <span class="comment">\ high-energy robot (as that represents 15 energy</span>
 <span class="mne">BCC</span> <a class="popup destination">ener2</a>              <span class="comment">\ units), so jump to ener2 to skip to the next level</span>
                        <span class="comment">\ down</span>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">15</span>                <span class="comment">\ Subtract 15 from the loop counter as we are about to</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ draw a high-energy robot that represents 15 energy</span>
                        <span class="comment">\ units (this subtraction works because we just passed</span>
                        <span class="comment">\ through a BCC, so the C flag must be set)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Draw a high-energy robot into the top part of the</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ screen (via the icon screen buffer at iconBuffer) and</span>
                        <span class="comment">\ move along to the right, incrementing xIconCounter as</span>
                        <span class="comment">\ we do</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Draw a blank icon into the top part of the screen (via</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right, incrementing xIconCounter as we do</span>

 <span class="mne">JMP</span> <a class="popup destination">ener1</a>              <span class="comment">\ Loop back to ener1 to draw another high-energy robot,</span>
                        <span class="comment">\ if required</span>

<span class="label">.ener2</span><a id="ener2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ If loopCounter &lt; 3 then we can't represent it with a</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ blue robot (as that represents three energy units),</span>
 <span class="mne">BCC</span> <a class="popup destination">ener3</a>              <span class="comment">\ so jump to ener3 to skip to the next level down</span>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Subtract 3 from the loop counter as we are about to</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ draw a high-energy robot that represents three energy</span>
                        <span class="comment">\ units (this subtraction works because we just passed</span>
                        <span class="comment">\ through a BCC, so the C flag must be set)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Draw a blue robot into the top part of the screen (via</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right, incrementing xIconCounter as we do</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Draw a blank icon into the top part of the screen (via</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right, incrementing xIconCounter as we do</span>

 <span class="mne">JMP</span> <a class="popup destination">ener2</a>              <span class="comment">\ Loop back to ener2 to draw another blue robot, if</span>
                        <span class="comment">\ required</span>

<span class="label">.ener3</span><a id="ener3" class="anchor"></a>

                        <span class="comment">\ If we get here then the value of loopCounter in A must</span>
                        <span class="comment">\ be 0, 1 or 2, as otherwise we would still be drawing</span>
                        <span class="comment">\ robots</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ If A &lt; 1 then A must be zero, so jump to ener4 to move</span>
 <span class="mne">BCC</span> <a class="popup destination">ener4</a>              <span class="comment">\ on to the scanner as we have no more energy units to</span>
                        <span class="comment">\ draw</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ If we get here then A is 1 or 2, so double it to get</span>
                        <span class="comment">\ the correct icon numbers for the left part of the</span>
                        <span class="comment">\ two-part tree or boulder icons:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 1, double it to 2 for the left tree icon</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 2, double it to 4 for the left boulder</span>
                        <span class="comment">\     icon</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ Draw the correct left icon into the top part of the</span>
                        <span class="comment">\ screen (via the icon screen buffer at iconBuffer) and</span>
                        <span class="comment">\ move along to the right, incrementing xIconCounter as</span>
                        <span class="comment">\ we do</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Increment A to get the correct icon number for the</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ right part of the tree or boulder</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ Draw the correct right icon into the top part of the</span>
                        <span class="comment">\ screen (via the icon screen buffer at iconBuffer) and</span>
                        <span class="comment">\ move along to the right, incrementing xIconCounter as</span>
                        <span class="comment">\ we do</span>

                        <span class="comment">\ We have updated the energy icons, so now we blank the</span>
                        <span class="comment">\ rest of the top line of the screen before drawing the</span>
                        <span class="comment">\ outline of the scanner</span>

<span class="label">.ener4</span><a id="ener4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Draw a blank icon into the top part of the screen (via</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right, incrementing xIconCounter as we do</span>

 <span class="mne">LDA</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ Loop back to keep drawing blank icons until we reach</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">29</span>                <span class="comment">\ column 29, which is where we want to draw the scanner</span>
 <span class="mne">BCC</span> <a class="popup destination">ener4</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Draw the left edge of the scanner box into the top</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ part of the screen (via the icon screen buffer at</span>
                        <span class="comment">\ iconBuffer) and move along to the right, incrementing</span>
                        <span class="comment">\ xIconCounter as we do</span>

<span class="label">.ener5</span><a id="ener5" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Draw the middle part of the scanner box into the top</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ part of the screen (via the icon screen buffer at</span>
                        <span class="comment">\ iconBuffer) and move along to the right, incrementing</span>
                        <span class="comment">\ xIconCounter as we do</span>

 <span class="mne">LDA</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ Loop back to keep drawing the middle part of the</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">38</span>                <span class="comment">\ scanner box until we reach column 38</span>
 <span class="mne">BCC</span> <a class="popup destination">ener5</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">9</span>                 <span class="comment">\ Draw the right edge of the scanner box into the top</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ part of the screen (via the icon screen buffer at</span>
                        <span class="comment">\ iconBuffer) and move along to the right, incrementing</span>
                        <span class="comment">\ xIconCounter as we do</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Draw a blank icon into the top part of the screen (via</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawIcon</a>           <span class="comment">\ the icon screen buffer at iconBuffer) and move along</span>
                        <span class="comment">\ to the right</span>

 <span class="mne">JMP</span> <a class="popup destination">ShowIconBuffer</a>     <span class="comment">\ Display the contents of the icon screen buffer by</span>
                        <span class="comment">\ copying it into screen memory, returning from the</span>
                        <span class="comment">\ subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawicon" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawIcon</span>                                                <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Scanner/energy row</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a single icon in the top-left corner of the screen (via the</span>
             <span class="headerEntry">icon screen buffer at iconBuffer) and move along to the right</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawicon.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/cleariconsscanner.html">ClearIconsScanner</a> calls <a href="#drawicon">DrawIcon</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updateiconsscanner.html">UpdateIconsScanner</a> calls <a href="#drawicon">DrawIcon</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The type of icon to draw:</span>

                        <span class="argumentEntry">  * 0 = Blank</span>

                        <span class="argumentEntry">  * 1 = Robot</span>

                        <span class="argumentEntry">  * 2 = Tree (left)</span>

                        <span class="argumentEntry">  * 3 = Tree (right)</span>

                        <span class="argumentEntry">  * 4 = Boulder (left)</span>

                        <span class="argumentEntry">  * 5 = Boulder (right)</span>

                        <span class="argumentEntry">  * 6 = High-energy robot</span>

                        <span class="argumentEntry">  * 7 = Scanner box (left)</span>

                        <span class="argumentEntry">  * 8 = Scanner box (middle)</span>

                        <span class="argumentEntry">  * 9 = Scanner box (right)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">A is preserved</span>

</div></div>
<span class="label">.DrawIcon</span><a id="drawicon" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the icon type on the stack so we can preserve it</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set X = (A * 8) + 7</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Each icon definition in iconData contains eight bytes,</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ so we can use this as an index into iconData, where it</span>
 <span class="mne">TAX</span>                    <span class="comment">\ points to the last of the eight bytes for icon A (as</span>
                        <span class="comment">\ we added 7 to A * 8 with the ORA instruction)</span>

                        <span class="comment">\ We now calculate the address of the icon in the screen</span>
                        <span class="comment">\ buffer at iconBuffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The icon needs to be drawn in column xIconCounter,</span>
                        <span class="comment">\ where each column is eight pixels wide, and because</span>
                        <span class="comment">\ the screen is split into 8x8-pixel character blocks of</span>
                        <span class="comment">\ eight bytes in each, the icon is in screen memory at</span>
                        <span class="comment">\ this address, which we store in (Q P):</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (Q P) = iconBuffer + xIconCounter * 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is calculated by doing half the sum first, and</span>
                        <span class="comment">\ then doubling the result, like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (iconBuffer / 2) + (xIconCounter * 4)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The calculation is done this way to cater for values</span>
                        <span class="comment">\ of xIconCounter between 32 and 39, as multiplying 32</span>
                        <span class="comment">\ by 8 won't fit into one byte, but multiplying by 4</span>
                        <span class="comment">\ will fit (and doubling just requires a simple shift)</span>

 <span class="mne">LDA</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ Set P = xIconCounter * 4 + LO(iconBuffer / 2)</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ so those are the low bytes</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">iconBuffer</a><span class="bracket">)</span>/2
 <span class="mne">STA</span> <a class="popup variable">P</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">iconBuffer</a><span class="bracket">)</span>/2  <span class="comment">\ Set A = 0 + HI(iconBuffer / 2)</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
                        <span class="comment">\ and those are the high bytes, with the result of the</span>
                        <span class="comment">\ half sum in (A P)</span>

 <span class="mne">ASL</span> <a class="popup variable">P</a>                  <span class="comment">\ Set (Q P) = (A P) * 2</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\           = iconBuffer + xIconCounter * 8</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>                  <span class="comment">\</span>
                        <span class="comment">\ So we now have the address within the icon screen</span>
                        <span class="comment">\ buffer for the icon we want to draw</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ We now copy eight bytes of icon data into the icon</span>
                        <span class="comment">\ screen buffer at iconBuffer</span>

<span class="label">.deni1</span><a id="deni1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">iconData</a>,<span class="register">X</span>         <span class="comment">\ Copy the X-th byte of icon data to the Y-th byte of</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ (Q P)</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the source byte counter</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the destination byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">deni1</a>              <span class="comment">\ Loop back until we have copied all eight bytes</span>

 <span class="mne">INC</span> <a class="popup variable">xIconCounter</a>       <span class="comment">\ Increment the icon counter to move along to the right</span>
                        <span class="comment">\ by one column, as we just drew an icon</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Restore the icon type into A that we stored on the</span>
                        <span class="comment">\ stack above</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-irqhandler" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">IRQHandler</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main game loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The main interrupt handler, which gets run 50 times a second to</span>
             <span class="headerEntry">update the game state and check for game key presses</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/irqhandler.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/configuremachine.html">ConfigureMachine</a> calls <a href="#irqhandler">IRQHandler</a></span>
</div>
<hr class="light">
 This routine is called exactly 50 times a second, and it does the following:

   * Count down the sound timer

   * If a game is not in progress (i.e. we are in the title screen rather than
     playing a landscape), return from the handler

   * If the Sentinel has won and bit 7 of drawLandscape is set, then call
     DrawBlackDots to draw 80 random black dots for the game over screen, and
     return from the handler

   * If the game is paused, scan for the pause and volume keys and return from
     the handler

   * If a game is in progress and the Sentinel has not won and the game is not
     paused, then:

     * If scrollCounter is non-zero then call ScrollPlayerView (which
       decrements scrollCounter) and ShowIconBuffer

     * If the Sentinel has been activated, call UpdateEnemyTimers and
       UpdateScanner

     * If bit 7 of focusOnKeyAction is clear then the game is not currently
       focusing effort on implementing a key action such as a landscape pan, so
       scan for and process all the game keys

</div></div>
<span class="label">.irqh1</span><a id="irqh1" class="anchor"></a>

 <span class="mne">JMP</span> <span class="bracket">(</span><a class="popup variable">irq1Address</a><span class="bracket">)</span>      <span class="comment">\ Jump to the original address from IRQ1V to pass</span>
                        <span class="comment">\ control to the next interrupt handler</span>

<span class="label">.IRQHandler</span><a id="irqhandler" class="anchor"></a>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so the following process isn't</span>
                        <span class="comment">\ interrupted by another interrupt</span>

 <span class="mne">LDA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&6D</span>         <span class="comment">\ Set A to the 6522 User VIA interrupt flag register IFR</span>
                        <span class="comment">\ (SHEILA &6D)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ If bit 6 of the IFR is clear then this interrupt has</span>
 <span class="mne">BEQ</span> <a class="popup destination">irqh1</a>              <span class="comment">\ not been triggered by the 6522 User VIA timer 1</span>
                        <span class="comment">\ reaching zero, so jump to irqh1 to pass the interrupt</span>
                        <span class="comment">\ on to the next interrupt handler</span>

                        <span class="comment">\ If we get here then bit 6 of the IFR is set, so this</span>
                        <span class="comment">\ interrupt has been triggered by the 6522 User VIA</span>
                        <span class="comment">\ timer 1 reaching zero</span>

 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&6D</span>         <span class="comment">\ The AND instruction above leaves A containing bit 6</span>
                        <span class="comment">\ set and all other bits clear, so we can write this to</span>
                        <span class="comment">\ the IFR at SHEILA &6D to clear the timer 1 interrupt</span>

 <span class="mne">LDA</span> <span class="hex">&FC</span>                <span class="comment">\ Set A to the interrupt accumulator save register,</span>
                        <span class="comment">\ which restores A to the value it had on entering the</span>
                        <span class="comment">\ interrupt</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Store A, X and Y on the stack so we can preserve them</span>
 <span class="mne">TXA</span>                    <span class="comment">\ across calls to the interrupt handler</span>
 <span class="mne">PHA</span>
 <span class="mne">TYA</span>
 <span class="mne">PHA</span>

 <span class="mne">CLD</span>                    <span class="comment">\ Clear the D flag to switch arithmetic to normal, in</span>
                        <span class="comment">\ case the interrupt was triggered during any BCD</span>
                        <span class="comment">\ calculations</span>

 <span class="mne">DEC</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ Decrement the sound counter so we can detect when the</span>
 <span class="mne">BPL</span> <a class="popup destination">irqh2</a>              <span class="comment">\ current sound effect has finished, making sure it</span>
 <span class="mne">INC</span> <a class="popup variable">soundCounter</a>       <span class="comment">\ doesn't go below zero</span>

<span class="label">.irqh2</span><a id="irqh2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">gameInProgress</a>     <span class="comment">\ If bit 7 of gameInProgress is set then a game is not</span>
 <span class="mne">BMI</span> <a class="popup destination">irqh8</a>              <span class="comment">\ currently in progress and we are in the title and</span>
                        <span class="comment">\ preview screens, so jump to irqh8 to skip the</span>
                        <span class="comment">\ following and return from the interrupt handler</span>
                        <span class="comment">\ without updating the game state</span>

 <span class="mne">LDA</span> <a class="popup variable">sentinelHasWon</a>     <span class="comment">\ If bit 7 of sentinelHasWon is set then the Sentinel</span>
 <span class="mne">BMI</span> <a class="popup destination">irqh7</a>              <span class="comment">\ has won the game, so jump to irqh7 to draw black dots</span>
                        <span class="comment">\ on the game over screen (when it is showing)</span>

 <span class="mne">LDA</span> <a class="popup variable">gamePaused</a>         <span class="comment">\ If bit 7 of gamePaused is set then the game is paused,</span>
 <span class="mne">BMI</span> <a class="popup destination">irqh5</a>              <span class="comment">\ so jump to irqh5 to scan for the unpause and volume</span>
                        <span class="comment">\ keys and return from the interrupt handler</span>

 <span class="mne">LDA</span> <a class="popup variable">scrollCounter</a>      <span class="comment">\ If scrollCounter = 0 then we do not need to scroll the</span>
 <span class="mne">BEQ</span> <a class="popup destination">irqh3</a>              <span class="comment">\ player's landscape view, so jump to irqh3 to skip the</span>
                        <span class="comment">\ scrolling process</span>

                        <span class="comment">\ If we get here then we still have scrollCounter steps</span>
                        <span class="comment">\ to complete in the current scrolling process, so we</span>
                        <span class="comment">\ now do one scrolling step (ScrollPlayerView decrements</span>
                        <span class="comment">\ the counter in scrollCounter)</span>

 <span class="mne">JSR</span> <a class="popup destination">ScrollPlayerView</a>   <span class="comment">\ Scroll the screen and copy data from the view screen</span>
                        <span class="comment">\ buffer into screen memory to implement the player's</span>
                        <span class="comment">\ scrolling landscape view</span>

 <span class="mne">JSR</span> <a class="popup destination">ShowIconBuffer</a>     <span class="comment">\ Display the contents of the icon screen buffer by</span>
                        <span class="comment">\ copying it into screen memory, as the scrolling</span>
                        <span class="comment">\ process will have scrolled this part of the screen, so</span>
                        <span class="comment">\ we need to redraw it to prevent the energy icons and</span>
                        <span class="comment">\ scanner from moving</span>

<span class="label">.irqh3</span><a id="irqh3" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">activateSentinel</a>   <span class="comment">\ If bit 7 of activateSentinel is set then the Sentinel</span>
 <span class="mne">BMI</span> <a class="popup destination">irqh4</a>              <span class="comment">\ has not yet been activated at the start of the game,</span>
                        <span class="comment">\ so jump to irqh4 to skip the following</span>

 <span class="mne">JSR</span> <a class="popup destination">UpdateEnemyTimers</a>  <span class="comment">\ Update the timers that control the enemy tactics</span>

 <span class="mne">JSR</span> <a class="popup destination">UpdateScanner</a>      <span class="comment">\ Update the scanner, if required</span>

<span class="label">.irqh4</span><a id="irqh4" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">focusOnKeyAction</a>   <span class="comment">\ If bit 7 of focusOnKeyAction is set then the game is</span>
 <span class="mne">BMI</span> <a class="popup destination">irqh8</a>              <span class="comment">\ currently focusing effort on implementing a key action</span>
                        <span class="comment">\ such as a landscape pan, so jump to irqh8 to skip the</span>
                        <span class="comment">\ following keyboard scan</span>

 <span class="mne">JSR</span> <a class="popup destination">CheckForKeyPresses</a> <span class="comment">\ Check for various game key presses and update the key</span>
                        <span class="comment">\ logger and relevant variables</span>

 <span class="mne">JMP</span> <a class="popup destination">irqh8</a>              <span class="comment">\ Jump to irqh8 to return from the interrupt handler</span>

<span class="label">.irqh5</span><a id="irqh5" class="anchor"></a>

                        <span class="comment">\ If we get here then the game is paused, so we scan for</span>
                        <span class="comment">\ key presses and discard them all except for the</span>
                        <span class="comment">\ unpause and volume keys</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">13</span>                <span class="comment">\ Scan the keyboard for all game keys in the gameKeys</span>
 <span class="mne">JSR</span> <a class="popup destination">ScanForGameKeys</a>    <span class="comment">\ table except for the last one ("U" for U-turn)</span>

                        <span class="comment">\ We now reset the first three entries in the key</span>
                        <span class="comment">\ logger (i.e. entries 0 to 2), leaving the last entry</span>
                        <span class="comment">\ populated (i.e. entry 3, which records the volume,</span>
                        <span class="comment">\ pause and unpause key presses)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set a loop counter in X for resetting three entries</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set A = %10000000 to reset the three entries, as the</span>
                        <span class="comment">\ set bit 7 indicates an empty entry in the logger</span>

<span class="label">.irqh6</span><a id="irqh6" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">keyLogger</a>,<span class="register">X</span>        <span class="comment">\ Reset the X-th entry in the key logger</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">irqh6</a>              <span class="comment">\ Loop back until we have reset all four entries</span>

 <span class="mne">JMP</span> <a class="popup destination">irqh8</a>              <span class="comment">\ Jump to irqh8 to return from the interrupt handler</span>

<span class="label">.irqh7</span><a id="irqh7" class="anchor"></a>

                        <span class="comment">\ If we get here then the Sentinel has won the game, so</span>
                        <span class="comment">\ we draw black dots on the game over screen (when it is</span>
                        <span class="comment">\ showing)</span>

 <span class="mne">LDA</span> <a class="popup variable">drawLandscape</a>      <span class="comment">\ If bit 7 of drawLandscape is clear, skip the following</span>
 <span class="mne">BPL</span> <a class="popup destination">irqh8</a>              <span class="comment">\ to return from the interrupt handler</span>

                        <span class="comment">\ If bit 7 of drawLandscape is set then we are showing</span>
                        <span class="comment">\ the game over screen, which combines dithering of an</span>
                        <span class="comment">\ object to the screen while at the same time fading the</span>
                        <span class="comment">\ screen to black, to create the hypnotic effect of the</span>
                        <span class="comment">\ winning entity fading in and out of the screen as the</span>
                        <span class="comment">\ game ends</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawBlackDots</a>      <span class="comment">\ Draw 80 randomly positioned dots on the screen in</span>
                        <span class="comment">\ colour 1 (black) to fade the screen to black in a</span>
                        <span class="comment">\ slowly decaying manner</span>

<span class="label">.irqh8</span><a id="irqh8" class="anchor"></a>

 <span class="mne">PLA</span>                    <span class="comment">\ Restore A, X and Y from the stack</span>
 <span class="mne">TAY</span>
 <span class="mne">PLA</span>
 <span class="mne">TAX</span>
 <span class="mne">PLA</span>

 <span class="mne">RTI</span>                    <span class="comment">\ Return from the interrupt handler</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scrollplayerview" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ScrollPlayerView</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Scroll the screen and copy data from the screen buffer into screen</span>
             <span class="headerEntry">memory to implement the player's scrolling landscape view</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/scrollplayerview.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/irqhandler.html">IRQHandler</a> calls <a href="#scrollplayerview">ScrollPlayerView</a></span>
</div>
</div></div>
<span class="label">.ScrollPlayerView</span><a id="scrollplayerview" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ Set Y to the direction of the last pan key that was</span>
                        <span class="comment">\ pressed (which may not still be held down)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this contains the direction of any scrolling that</span>
                        <span class="comment">\ we still need to apply, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 = pan right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 1 = pan left</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 2 = pan up</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 3 = pan down</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use this as an index into various tables, to look</span>
                        <span class="comment">\ up the correct values for the direction in which we</span>
                        <span class="comment">\ want to scroll</span>

                        <span class="comment">\ We now scroll the screen in the correct direction to</span>
                        <span class="comment">\ pan the player's scrolling landscape view</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that we scroll the screen in the opposite</span>
                        <span class="comment">\ direction to the pan direction, so if we are panning</span>
                        <span class="comment">\ right we move the screen to the left, for example</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The screen address of the player's scrolling landscape</span>
                        <span class="comment">\ view is stored in viewScreenAddr(1 0), so this is the</span>
                        <span class="comment">\ address of the screen just below the energy icon and</span>
                        <span class="comment">\ scanner row</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore start the scrolling process by updating</span>
                        <span class="comment">\ the screen address in viewScreenAddr(1 0) to point to</span>
                        <span class="comment">\ the new address after scrolling</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Scrolling is done in individual steps, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When scrolling horizontally, we scroll by one</span>
                        <span class="comment">\     column that's one character block wide (i.e. one</span>
                        <span class="comment">\     byte, two pixels wide)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When scrolling vertically, we scroll by one row</span>
                        <span class="comment">\     that's one character block tall (i.e. eight bytes,</span>
                        <span class="comment">\     eight pixels tall)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The amount of change that we need to apply to</span>
                        <span class="comment">\ viewScreenAddr(1 0) for each of the four directions is</span>
                        <span class="comment">\ given in the tables scrollScreenHi and scrollScreenLo,</span>
                        <span class="comment">\ as 16-bit signed values, so we just need to look up</span>
                        <span class="comment">\ the correct value and apply it to viewScreenAddr(1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For example, we advance viewScreenAddr(1 0) by eight</span>
                        <span class="comment">\ bytes when panning right, as we need to scroll the</span>
                        <span class="comment">\ screen to the left, so the start of the screen in</span>
                        <span class="comment">\ memory moves on by eight bytes (one character block)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This would scroll the screen to the left by two pixels</span>
                        <span class="comment">\ as each character block is two pixels wide</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Similarly, we reduce viewScreenAddr(1 0) by 320 bytes</span>
                        <span class="comment">\ when panning up, as we need to scroll the screen down,</span>
                        <span class="comment">\ so the start of the screen in memory moves on by eight</span>
                        <span class="comment">\ bytes (one character row of 40 character blocks with</span>
                        <span class="comment">\ eight bytes per character block)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This would scroll the screen to down by eight pixels</span>
                        <span class="comment">\ as each character row is eight pixels wide</span>

 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a>     <span class="comment">\ Apply the change in scrollScreen(Hi Lo) for the</span>
 <span class="mne">CLC</span>                    <span class="comment">\ current pan direction in Y to the screen address of</span>
 <span class="mne">ADC</span> <a class="popup variable">scrollScreenLo</a>,<span class="register">Y</span>   <span class="comment">\ the player's scrolling landscape, which is stored in</span>
 <span class="mne">STA</span> <a class="popup variable">viewScreenAddr</a>     <span class="comment">\ viewScreenAddr(1 0)</span>
 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">scrollScreenHi</a>,<span class="register">Y</span>   <span class="comment">\ We start by calculating this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A viewScreenAddr) = viewScreenAddr(1 0)</span>
                        <span class="comment">\                  + (scrollScreenHi+Y scrollScreenLo+Y)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">scro1</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the high byte is in range, jump to scro1 to check</span>
                        <span class="comment">\ the high byte against the start of screen memory</span>

 <span class="mne">JMP</span> <a class="popup destination">scro2</a>              <span class="comment">\ Jump to scro2 to skip the next check, as we know it</span>
                        <span class="comment">\ doesn't apply</span>

<span class="label">.scro1</span><a id="scro1" class="anchor"></a>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ If the high byte in A &lt; &60 then the new address is</span>
 <span class="mne">BCS</span> <a class="popup destination">scro2</a>              <span class="comment">\ before the start of screen memory, so add &20 to the</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ high byte so the address wraps around within the range</span>
                        <span class="comment">\ of screen memory between &6000 and &8000</span>

<span class="label">.scro2</span><a id="scro2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   viewScreenAddr(1 0) = viewScreenAddr(1 0)</span>
                        <span class="comment">\                  + (scrollScreenHi+Y scrollScreenLo+Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

                        <span class="comment">\ We now reprogram the 6845 CRTC chip to scroll the</span>
                        <span class="comment">\ screen in hardware (so-called "hardware scrolling")</span>
                        <span class="comment">\ by setting 6845 registers R12 and R13 to the new</span>
                        <span class="comment">\ address for the start of screen memory</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The registers actually require the address to be set</span>
                        <span class="comment">\ in terms of character rows, so we need to set R12 and</span>
                        <span class="comment">\ R12 to the address divided by 8 (see below)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetIconRowAddress</a>  <span class="comment">\ Set iconRowAddr(1 0) to the address in screen memory</span>
                        <span class="comment">\ of the icon and scanner row at the top of the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This calculates the address from viewScreenAddr(1 0),</span>
                        <span class="comment">\ so the value returned will be the new start of screen</span>
                        <span class="comment">\ memory, after the scroll is completed</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It also sets A to the high byte of the address of</span>
                        <span class="comment">\ screen memory in iconRowAddr(1 0)</span>

 <span class="mne">STA</span> <a class="popup variable">screenAddrHi</a>       <span class="comment">\ Set (screenAddrHi A) = iconRowAddr(1 0) / 8</span>
 <span class="mne">LDA</span> <a class="popup variable">iconRowAddr</a>        <span class="comment">\</span>
 <span class="mne">LSR</span> <a class="popup variable">screenAddrHi</a>       <span class="comment">\ So (screenAddrHi A) contains the new address of screen</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ memory, divided by 8, which is suitable for passing to</span>
 <span class="mne">LSR</span> <a class="popup variable">screenAddrHi</a>       <span class="comment">\ the 6845 CRTC to change the address of screen memory</span>
 <span class="mne">ROR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <a class="popup variable">screenAddrHi</a>
 <span class="mne">ROR</span> <span class="register">A</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">13</span>                <span class="comment">\ Set 6845 register R13 = A, for the low byte</span>
 <span class="mne">STX</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ We do this by writing the register number (13) to</span>
                        <span class="comment">\ SHEILA &00, and then the value (A) to SHEILA &01</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">12</span>                <span class="comment">\ Set 6845 register R12 = &0F, for the high byte</span>
 <span class="mne">STX</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&00</span>         <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">screenAddrHi</a>       <span class="comment">\ We do this by writing the register number (12) to</span>
 <span class="mne">STA</span> <a class="popup variable">SHEILA</a><span class="operator">+</span><span class="hex">&01</span>         <span class="comment">\ SHEILA &00, and then the value (screenAddrHi) to</span>
                        <span class="comment">\ SHEILA &01</span>

                        <span class="comment">\ This sets 6845 registers (R12 R13) = (screenAddrHi A)</span>
                        <span class="comment">\ to point to the start of screen memory in terms of</span>
                        <span class="comment">\ character rows. There are 8 pixel lines in each</span>
                        <span class="comment">\ character row, so to get the actual address of the</span>
                        <span class="comment">\ start of screen memory, we multiply by 8:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (screenAddrHi A) * 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ which is iconRowAddr(1 0), as set above</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this whole thing sets the start of screen memory to</span>
                        <span class="comment">\ the address of iconRowAddr(1 0), which scrolls the</span>
                        <span class="comment">\ screen by the required amount</span>

 <span class="mne">DEC</span> <a class="popup variable">scrollCounter</a>      <span class="comment">\ Decrement the scroll counter, as we have just scrolled</span>
                        <span class="comment">\ the screen by one more step</span>

                        <span class="comment">\ We now set viewScreenAddr(1 0) to the new address of</span>
                        <span class="comment">\ the start of the player's landscape view, so that's</span>
                        <span class="comment">\ the address of the top-left corner of the view, just</span>
                        <span class="comment">\ below the energy icon and scanner bar at the top of</span>
                        <span class="comment">\ the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now need to set toAddr(1 0) to the address in</span>
                        <span class="comment">\ screen memory that we need to update now that the</span>
                        <span class="comment">\ screen has been scrolled</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Scrolling the screen leads to the following update</span>
                        <span class="comment">\ requirements:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When scrolling the screen to the left, we need to</span>
                        <span class="comment">\     update the column on the right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When scrolling the screen to the right, we need to</span>
                        <span class="comment">\     update the column on the left</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When scrolling the screen down, we need to update</span>
                        <span class="comment">\     the row along the top</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When scrolling the screen up, we need to update</span>
                        <span class="comment">\     the row along the bottom</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We want to set toAddr(1 0) to the address of the area</span>
                        <span class="comment">\ in screen memory that we need to update, and the</span>
                        <span class="comment">\ offset within screen memory of this area for each of</span>
                        <span class="comment">\ the four directions is given in the tables at</span>
                        <span class="comment">\ updateOffsetHi and updateOffsetLo, as 16-bit signed</span>
                        <span class="comment">\ values, so we just need to look up the correct offset</span>
                        <span class="comment">\ and apply it to viewScreenAddr(1 0) to get the address</span>
                        <span class="comment">\ of the area of screen memory we need to update</span>

 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a>     <span class="comment">\ Set toAddr(1 0) to the screen address of the player's</span>
 <span class="mne">CLC</span>                    <span class="comment">\ scrolling landscape, plus the offset for the current</span>
 <span class="mne">ADC</span> <a class="popup variable">updateOffsetLo</a>,<span class="register">Y</span>   <span class="comment">\ pan direction from updateOffset(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>             <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ We start by calculating this:</span>
 <span class="mne">ADC</span> <a class="popup variable">updateOffsetHi</a>,<span class="register">Y</span>   <span class="comment">\</span>
                        <span class="comment">\   (A toAddr) = viewScreenAddr(1 0)</span>
                        <span class="comment">\                  + (updateOffsetHi+Y updateOffsetLo+Y)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">scro3</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.scro3</span><a id="scro3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   toAddr(1 0) = viewScreenAddr(1 0)</span>
                        <span class="comment">\                  + (updateOffsetHi+Y updateOffsetLo+Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

                        <span class="comment">\ By this point we have done the following to implement</span>
                        <span class="comment">\ the required screen scrolling:</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * Updated viewScreenAddr(1 0) to the new address of</span>
                        <span class="comment">\    the player's scrolling landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * Updated the 6845 to scroll the screen by changing</span>
                        <span class="comment">\    the address of screen memory</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * Decremented the counter in scrollCounter</span>
                        <span class="comment">\</span>
                        <span class="comment">\  * Set toAddr(1 0) to the address of the area in</span>
                        <span class="comment">\    screen memory that we now need to update</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can now fall through into ShowScreenBuffer to copy</span>
                        <span class="comment">\ the contents of the screen buffer into the area we</span>
                        <span class="comment">\ need to update, so that the scroll reveals the correct</span>
                        <span class="comment">\ part of the view</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-showscreenbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ShowScreenBuffer</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the player's scrolling landscape view by copying the</span>
             <span class="headerEntry">relevant parts of the screen buffer into screen memory</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/showscreenbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#showscreenbuffer">ShowScreenBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The direction of scrolling that we just applied:</span>

                        <span class="argumentEntry">  * 0 = pan right</span>

                        <span class="argumentEntry">  * 1 = pan left</span>

                        <span class="argumentEntry">  * 2 = pan up</span>

                        <span class="argumentEntry">  * 3 = pan down</span>

   <span class="argumentLabel">toAddr(1 0)</span>          <span class="argumentEntry">The address of the area in screen memory that we need to</span>
                        <span class="argumentEntry">update with the contents of the screen buffer</span>

</div></div>
<span class="label">.ShowScreenBuffer</span><a id="showscreenbuffer" class="anchor"></a>

                        <span class="comment">\ We start by setting both screenBufferAddr(1 0) and</span>
                        <span class="comment">\ fromAddr(1 0) to the address in the screen buffer of</span>
                        <span class="comment">\ the content that we need to copy into the screen area</span>
                        <span class="comment">\ following the hardware scroll</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We do this by taking the current value of the address</span>
                        <span class="comment">\ in screenBufferAddr(1 0) and applying the change in</span>
                        <span class="comment">\ scrollScreen(Hi Lo) for the current pan direction in</span>
                        <span class="comment">\ Y, just as we did when we updated the screen address</span>
                        <span class="comment">\ in viewScreenAddr(1 0) in the ScrollPlayerView routine</span>

 <span class="mne">LDA</span> <a class="popup variable">screenBufferAddr</a>   <span class="comment">\ Add scrollScreen(Hi Lo) for this pan direction to the</span>
 <span class="mne">CLC</span>                    <span class="comment">\ address in screenBufferAddr(1 0), starting with the</span>
 <span class="mne">ADC</span> <a class="popup variable">scrollScreenLo</a>,<span class="register">Y</span>   <span class="comment">\ low bytes</span>
 <span class="mne">STA</span> <a class="popup variable">screenBufferAddr</a>

 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ Store the low byte of the result in fromAddr(1 0)</span>

 <span class="mne">LDA</span> <a class="popup variable">screenBufferAddr</a><span class="operator">+</span><span class="decimal">1</span> <span class="comment">\ And then add the high bytes</span>
 <span class="mne">ADC</span> <a class="popup variable">scrollScreenHi</a>,<span class="register">Y</span>
 <span class="mne">STA</span> <a class="popup variable">screenBufferAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ Store the high byte of the result in fromAddr(1 0), so</span>
                        <span class="comment">\ fromAddr(1 0) = screenBufferAddr(1 0) and we copy the</span>
                        <span class="comment">\ new screen content from the correct address in the</span>
                        <span class="comment">\ screen buffer</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ If Y >= 2 then we are panning up or down, and we are</span>
 <span class="mne">BCS</span> <a class="popup destination">ShowBufferRow</a>      <span class="comment">\ scrolling down or up, so jump to ShowBufferRow to</span>
                        <span class="comment">\ update the player's scrolling landscape view by</span>
                        <span class="comment">\ copying an eight-pixel high character row from the</span>
                        <span class="comment">\ screen buffer into screen memory</span>

                        <span class="comment">\ Otherwise we are panning left or right, and we are</span>
                        <span class="comment">\ scrolling right or left, so fall through into</span>
                        <span class="comment">\ ShowBufferColumn to update the player's scrolling</span>
                        <span class="comment">\ landscape view by copying a two-pixel wide column from</span>
                        <span class="comment">\ the screen buffer into screen memory</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-showbuffercolumn" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ShowBufferColumn</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the player's scrolling landscape view by copying a 2-pixel</span>
             <span class="headerEntry">wide column from the screen buffer into screen memory</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/showbuffercolumn.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">fromAddr(1 0)</span>        <span class="argumentEntry">The source address from which we copy the character</span>
                        <span class="argumentEntry">column</span>

   <span class="argumentLabel">toAddr(1 0)</span>          <span class="argumentEntry">The destination address to which we copy the character</span>
                        <span class="argumentEntry">column</span>

</div></div>
<span class="label">.ShowBufferColumn</span><a id="showbuffercolumn" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">24</span>                <span class="comment">\ The custom screen mode 5 used by the game contains 25</span>
                        <span class="comment">\ character rows, each of which is eight pixels high, so</span>
                        <span class="comment">\ set a row counter in X to count the character rows in</span>
                        <span class="comment">\ the screen buffer, which is one row less than the</span>
                        <span class="comment">\ screen height, as the top row is the energy icon and</span>
                        <span class="comment">\ scanner row</span>

<span class="label">.dcol1</span><a id="dcol1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ShowBufferBlock</a>    <span class="comment">\ Copy an eight-byte 8x2-pixel character block from the</span>
                        <span class="comment">\ screen buffer at fromAddr(1 0) into screen memory at</span>
                        <span class="comment">\ toAddr(1 0)</span>

 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ Set (A fromAddr) = fromAddr(1 0) + &140</span>
 <span class="mne">CLC</span>                    <span class="comment">\                  = fromAddr(1 0) + 320</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&40</span>               <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ Each character row in screen mode 5 takes up 320 bytes</span>
 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ (40 character blocks of eight bytes each), so this</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&01</span>               <span class="comment">\ sets fromAddr(1 0) to the address of the next row down</span>
                        <span class="comment">\ in the screen buffer</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&53</span>               <span class="comment">\ If the result of the addition is less than &5300, then</span>
 <span class="mne">BNE</span> <a class="popup destination">dcol2</a>              <span class="comment">\ we have not reached the end of row 15 in the screen</span>
                        <span class="comment">\ buffer, so jump to dcol2 to skip the following</span>

                        <span class="comment">\ At this point the screen buffer wraps around so the</span>
                        <span class="comment">\ buffer entries continue at a lower address</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically the last buffer before &5300 is</span>
                        <span class="comment">\ screenBufferRow15, at address:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   &51C0 to &51FF for character row 15</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and we now wrap around as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   &3FA0 to &3FDF for character row 16</span>
                        <span class="comment">\</span>
                        <span class="comment">\ to take us to the buffer at screenBufferRow16</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The address of screenBufferRow16 is &A0 more than the</span>
                        <span class="comment">\ start of the screen buffer at screenBufferRow0, and</span>
                        <span class="comment">\ the address of the latter is in screenBufferAddr(1 0),</span>
                        <span class="comment">\ so we can calculate the new address like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A fromAddr) = screenBufferAddr(1 0) + &A0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this wraps the address around so we can keep</span>
                        <span class="comment">\ drawing content into the screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ See screenBufferRow0 for more information on the</span>
                        <span class="comment">\ structure of the screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">screenBufferAddr</a>   <span class="comment">\ Calculate the following:</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&A0</span>               <span class="comment">\   (A fromAddr) = screenBufferAddr(1 0) + &A0</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">screenBufferAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&00</span>

<span class="label">.dcol2</span><a id="dcol2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   fromAddr(1 0) = fromAddr(1 0) + 320</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

 <span class="mne">LDA</span> <a class="popup variable">toAddr</a>             <span class="comment">\ Set (A toAddr) = toAddr(1 0) + &140</span>
 <span class="mne">CLC</span>                    <span class="comment">\                = toAddr(1 0) + 320</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&40</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&01</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">dcol3</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.dcol3</span><a id="dcol3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   toAddr(1 0) = toAddr(1 0) + 320</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the counter in X to move on to the next</span>
                        <span class="comment">\ character row down</span>

 <span class="mne">BNE</span> <a class="popup destination">dcol1</a>              <span class="comment">\ Loop back until we have copied all 24 character blocks</span>
                        <span class="comment">\ in the column from fromAddr(1 0) to toAddr(1 0)</span>

 <span class="mne">JMP</span> <a class="popup destination">drow3</a>              <span class="comment">\ Jump to drow3 to return from the subroutine, as drow3</span>
                        <span class="comment">\ contains an RTS</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-showbufferrow" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ShowBufferRow</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the player's scrolling landscape view by copying an 8-pixel</span>
             <span class="headerEntry">high character row from the screen buffer into screen memory</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/showbufferrow.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showiconbuffer.html">ShowIconBuffer</a> calls <a href="#showbufferrow">ShowBufferRow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showscreenbuffer.html">ShowScreenBuffer</a> calls <a href="#showbufferrow">ShowBufferRow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showbuffercolumn.html">ShowBufferColumn</a> calls via <a href="#drow3">drow3</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">fromAddr(1 0)</span>        <span class="argumentEntry">The source address from which we copy the character row</span>

   <span class="argumentLabel">toAddr(1 0)</span>          <span class="argumentEntry">The destination address to which we copy the character</span>
                        <span class="argumentEntry">row</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">drow3</span>                <span class="argumentEntry">Contains an RTS</span>

</div></div>
<span class="label">.ShowBufferRow</span><a id="showbufferrow" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">40</span>                <span class="comment">\ Each character row in screen mode 5 contains 40</span>
                        <span class="comment">\ character blocks of eight bytes, so set a block</span>
                        <span class="comment">\ counter in X to count the character blocks</span>

<span class="label">.drow1</span><a id="drow1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ShowBufferBlock</a>    <span class="comment">\ Copy an eight-byte 8x2-pixel character block from the</span>
                        <span class="comment">\ screen buffer at fromAddr(1 0) into screen memory at</span>
                        <span class="comment">\ toAddr(1 0)</span>

 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ Set fromAddr(1 0) = fromAddr(1 0) + 8</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ So this moves the from address to the next character</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ block in the character row</span>
 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">LDA</span> <a class="popup variable">toAddr</a>             <span class="comment">\ Set (A toAddr) = toAddr(1 0) + 8</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">8</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">drow2</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.drow2</span><a id="drow2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   toAddr(1 0) = toAddr(1 0) + 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the counter in X to move on to the next</span>
                        <span class="comment">\ character block in the row</span>

 <span class="mne">BNE</span> <a class="popup destination">drow1</a>              <span class="comment">\ Loop back until we have copied all 40 character blocks</span>
                        <span class="comment">\ in the character row from fromAddr(1 0) to toAddr(1 0)</span>

<span class="label">.drow3</span><a id="drow3" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-showbufferblock" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ShowBufferBlock</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the player's scrolling landscape view by copying an 8-byte</span>
             <span class="headerEntry">character block from the screen buffer into screen memory</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/showbufferblock.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showbuffercolumn.html">ShowBufferColumn</a> calls <a href="#showbufferblock">ShowBufferBlock</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showbufferrow.html">ShowBufferRow</a> calls <a href="#showbufferblock">ShowBufferBlock</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">fromAddr(1 0)</span>        <span class="argumentEntry">The source address from which we copy the eight-byte</span>
                        <span class="argumentEntry">character block</span>

   <span class="argumentLabel">toAddr(1 0)</span>          <span class="argumentEntry">The destination address to which we copy the eight-byte</span>
                        <span class="argumentEntry">character block</span>

</div></div>
<span class="label">.ShowBufferBlock</span><a id="showbufferblock" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Copy byte #0 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #1 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #2 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #3 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #4 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #5 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #6 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Copy byte #7 of fromAddr(1 0) to toAddr(1 0)</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updateoffsetlo" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">updateOffsetLo</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The offset within screen memory for the player's landscape view</span>
             <span class="headerEntry">of the area to update following a scroll (low byte)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/updateoffsetlo.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scrollplayerview.html">ScrollPlayerView</a> uses <a href="#updateoffsetlo">updateOffsetLo</a></span>
</div>
</div></div>
<span class="label">.updateOffsetLo</span><a id="updateoffsetlo" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">320</span> <span class="operator">-</span> <span class="decimal">8</span><span class="bracket">)</span>       <span class="comment">\ Direction 0 = 320 - 8 (pan right, scroll left)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>             <span class="comment">\ Direction 1 = 0 (pan left, scroll right)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>             <span class="comment">\ Direction 2 = 0 (pan up, scroll down)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">320</span> <span class="operator">*</span> <span class="decimal">23</span><span class="bracket">)</span>      <span class="comment">\ Direction 3 = 320 * 23 (pan down, scroll up)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updateoffsethi" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">updateOffsetHi</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The offset within screen memory for the player's landscape view</span>
             <span class="headerEntry">of the area to update following a scroll (high byte)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/updateoffsethi.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scrollplayerview.html">ScrollPlayerView</a> uses <a href="#updateoffsethi">updateOffsetHi</a></span>
</div>
</div></div>
<span class="label">.updateOffsetHi</span><a id="updateoffsethi" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">320</span> <span class="operator">-</span> <span class="decimal">8</span><span class="bracket">)</span>       <span class="comment">\ Direction 0 = 320 - 8 (pan right, scroll left)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>             <span class="comment">\ Direction 1 = 0 (pan left, scroll right)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>             <span class="comment">\ Direction 2 = 0 (pan up, scroll down)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">320</span> <span class="operator">*</span> <span class="decimal">23</span><span class="bracket">)</span>      <span class="comment">\ Direction 3 = 320 * 23 (pan down, scroll up)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scrollscreenlo" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">scrollScreenLo</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The amount to change the start of screen memory in order to scroll</span>
             <span class="headerEntry">the player's landscape view through each direction (low byte)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/scrollscreenlo.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scrollplayerview.html">ScrollPlayerView</a> uses <a href="#scrollscreenlo">scrollScreenLo</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showscreenbuffer.html">ShowScreenBuffer</a> uses <a href="#scrollscreenlo">scrollScreenLo</a></span>
</div>
</div></div>
<span class="label">.scrollScreenLo</span><a id="scrollscreenlo" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span>+8<span class="bracket">)</span>            <span class="comment">\ Direction 0 = +8 (pan right, scroll left)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">-8</span><span class="bracket">)</span>            <span class="comment">\ Direction 1 = -8 (pan left, scroll right)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">-320</span><span class="bracket">)</span>          <span class="comment">\ Direction 2 = -320 (pan up, scroll down)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span>+320<span class="bracket">)</span>          <span class="comment">\ Direction 3 = +320 (pan down, scroll up)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-scrollscreenhi" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">scrollScreenHi</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The amount to change the start of screen memory in order to scroll</span>
             <span class="headerEntry">the player's landscape view through each direction (high byte)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/scrollscreenhi.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scrollplayerview.html">ScrollPlayerView</a> uses <a href="#scrollscreenhi">scrollScreenHi</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showscreenbuffer.html">ShowScreenBuffer</a> uses <a href="#scrollscreenhi">scrollScreenHi</a></span>
</div>
</div></div>
<span class="label">.scrollScreenHi</span><a id="scrollscreenhi" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span>+8<span class="bracket">)</span>            <span class="comment">\ Direction 0 = +8 (pan right, scroll left)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">-8</span><span class="bracket">)</span>            <span class="comment">\ Direction 1 = -8 (pan left, scroll right)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">-320</span><span class="bracket">)</span>          <span class="comment">\ Direction 2 = -320 (pan up, scroll down)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span>+320<span class="bracket">)</span>          <span class="comment">\ Direction 3 = +320 (pan down, scroll up)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-screenbufferhi" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">screenBufferHi</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The value to add to scrollScreenHi for each direction to get the</span>
             <span class="headerEntry">high byte of the screen buffer address of the content to scroll in</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/screenbufferhi.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/setbufferaddress.html">SetBufferAddress</a> uses <a href="#screenbufferhi">screenBufferHi</a></span>
</div>
<hr class="light">
 This table contains the address within the screen buffer from which the
 interrupt handler should start pulling screen content to scroll onto the
 screen, depending on the direction of the scroll. The content that should be
 pulled onto the screen at the start of the scrolling process is as follows:

   * When panning right: The left column of the column-shaped screen buffer
     appears first as the new content scrolls in from the right

   * When panning left: The right column of the column-shaped screen buffer
     appears first as the new content scrolls in from the right

   * When panning up: The bottom row of the row-shaped screen buffer appears
     first as the new content scrolls in from above

   * When panning down: The top row of the row-shaped screen buffer appears
     first as the new content scrolls in from below

 This table contains the address of the new content for each panning direction,
 but with a slight complication. The first step in scrolling content onto the
 screen is to add the scrolling direction in scrollScreen(Hi Lo), so to make
 sure the first scroll moves the correct content onto the screen, the values
 in this table already have the corresponding value of scrollScreen(Hi Lo)
 subtracted from them, so when this is added at the start of the scroll, the
 address correctly points to the address of the new content in the screen
 buffer.

 The screen buffer starts at address screenBufferRow0, each character column
 takes up eight bytes of buffer space, and each character row takes up 320
 bytes of buffer space.

</div></div>
<span class="label">.screenBufferHi</span><a id="screenbufferhi" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">0</span> <span class="operator">*</span> <span class="decimal">8</span> <span class="operator">-</span> <span class="decimal">8</span><span class="bracket">)</span>      <span class="comment">\ Direction 0</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan right, scroll left</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 0 * 8 = the left column (column 0)</span>
                                            <span class="comment">\         of the 16-column screen</span>
                                            <span class="comment">\         buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ -8 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\    = - +8</span>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">15</span> <span class="operator">*</span> <span class="decimal">8</span> <span class="operator">+</span> <span class="decimal">8</span><span class="bracket">)</span>     <span class="comment">\ Direction 1</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan left, scroll right</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 15 * 8 = the right column (column</span>
                                            <span class="comment">\          15) of the 16-column</span>
                                            <span class="comment">\          screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 8 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\   = - -8</span>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">7</span> <span class="operator">*</span> <span class="decimal">320</span> <span class="operator">+</span> <span class="decimal">320</span><span class="bracket">)</span>  <span class="comment">\ Direction 2</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan up, scroll down</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 8 * 320 = the bottom row (row 7)</span>
                                            <span class="comment">\           of the 8-row screen</span>
                                            <span class="comment">\           buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 320 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\     = - -320</span>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">0</span> <span class="operator">*</span> <span class="decimal">320</span> <span class="operator">-</span> <span class="decimal">320</span><span class="bracket">)</span>  <span class="comment">\ Direction 3</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan down, scroll up</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 8 * 320 = the top row (row 0) of</span>
                                            <span class="comment">\           the 8-row screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ -320 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\      = - +320</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-screenbufferlo" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">screenBufferLo</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The value to add to scrollScreenLo for each direction to get the</span>
             <span class="headerEntry">low byte of the screen buffer address of the content to scroll in</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/screenbufferlo.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/setbufferaddress.html">SetBufferAddress</a> uses <a href="#screenbufferlo">screenBufferLo</a></span>
</div>
<hr class="light">
 See screenBufferHi for an explanation of this table.

</div></div>
<span class="label">.screenBufferLo</span><a id="screenbufferlo" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">0</span> <span class="operator">*</span> <span class="decimal">8</span> <span class="operator">-</span> <span class="decimal">8</span><span class="bracket">)</span>      <span class="comment">\ Direction 0</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan right, scroll left</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 0 * 8 = the left column (column 0)</span>
                                            <span class="comment">\         of the 16-column screen</span>
                                            <span class="comment">\ buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ -8 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\    = - +8</span>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">15</span> <span class="operator">*</span> <span class="decimal">8</span> <span class="operator">+</span> <span class="decimal">8</span><span class="bracket">)</span>     <span class="comment">\ Direction 1</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan left, scroll right</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 15 * 8 = the right column (column</span>
                                            <span class="comment">\          15) of the 16-column</span>
                                            <span class="comment">\          screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 8 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\   = - -8</span>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">7</span> <span class="operator">*</span> <span class="decimal">320</span> <span class="operator">+</span> <span class="decimal">320</span><span class="bracket">)</span>  <span class="comment">\ Direction 2</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan up, scroll down</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 8 * 320 = the bottom row (row 7)</span>
                                            <span class="comment">\           of the 8-row screen</span>
                                            <span class="comment">\           buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 320 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\     = - -320</span>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a> <span class="operator">+</span> <span class="decimal">0</span> <span class="operator">*</span> <span class="decimal">320</span> <span class="operator">-</span> <span class="decimal">320</span><span class="bracket">)</span>  <span class="comment">\ Direction 3</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ Pan down, scroll up</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ screenBufferRow0 = base address of</span>
                                            <span class="comment">\                    screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ 8 * 320 = the top row (row 0) of</span>
                                            <span class="comment">\           the 8-row screen buffer</span>
                                            <span class="comment">\</span>
                                            <span class="comment">\ -320 = - scrollScreen(Hi Lo)</span>
                                            <span class="comment">\      = - +320</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-panangletoupdate" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">panAngleToUpdate</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pitch and yaw angles for panning the landscape view, so the output</span>
             <span class="headerEntry">of DrawLandscapeView will be the bit we add when updating the view</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/panangletoupdate.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> uses <a href="#panangletoupdate">panAngleToUpdate</a></span>
</div>
<hr class="light">
 This table contains the angles through which we need to pitch or yaw the
 landscape view when we need to scroll the landscape view during a pan.

 The DrawLandscapeView routine always renders the full view, and its output is
 clipped to the size of the screen or screen buffer. This clipping is done on
 the screen x- and y-coordinates, and the clipping is done from the right or
 bottom edges of the screen.

 This means that when we pan the screen, we effectively redraw the whole view,
 which is 20 yaw angles wide and 12 pitch angles tall, and then use the newly
 drawn portion from the top-left corner of that redrawn view for the new part
 that we scroll into the screen to complete the pan.

 When panning left, we can simply subtract 8 from the player's current yaw
 angle to rotate the player's view to the left. This moves the player's gaze to
 the left, so when we draw the new landscape view into the screen buffer, the
 portion on the left of the view is the new part that the player is now seeing,
 so clipping the left portion of the view into the screen buffer will give us
 the content that we need to scroll in from the left to perform the pan.

 Things are different when panning right. If we simply add 8 to the player's
 current yaw angle, then the new part of the landscape view will be on the far
 right of the newly drawn view, so it will be clipped when drawing into the
 screen buffer. So instead we add 20 to the player's yaw angle to rotate the
 view to the right by an entire screen's width, so when the view is drawn and
 clipped, the new portion will be on the left of the newly drawn view, just as
 it was when panning left. As long as we make sure to set the player's yaw
 angle correctly after we have finished drawing - by subtracting 12 from the
 player's yaw angle, leaving them with a net rotation of 8 to the right - then
 this approach ensures that the new portion of the screen is drawn into the
 screen buffer correctly.

 The same approach is applied when panning vertically. If we pan up, then we
 simply add 4 to the player's yaw angle so they look up higher. This moves the
 player's gaze up, so when we draw the new landscape view into the screen
 buffer, the portion at the top of the view is the new part that the player is
 now seeing, so clipping the top portion of the view into the screen buffer
 will give us the content that we need to scroll in from the top to perform the
 pan.

 However, if we are panning down then we need to jump down a whole screen's
 height, so we subtract 12 from the player's pitch angle, as this is the height
 of the screen. We then draw the new view, which puts the new portion of the
 view into the screen buffer. We then fix the player's pitch angle by adding 8,
 so the net result is a pitch rotation of -4, as required.

</div></div>
<span class="label">.panAngleToUpdate</span><a id="panangletoupdate" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">20</span>                <span class="comment">\ Direction 0 (pan right, scroll left)</span>
 <span class="mne">EQUB</span> <span class="decimal">-8</span>                <span class="comment">\ Direction 1 (pan left, scroll right)</span>
 <span class="mne">EQUB</span> <span class="decimal">4</span>                 <span class="comment">\ Direction 2 (pan up, scroll down)</span>
 <span class="mne">EQUB</span> <span class="decimal">-12</span>               <span class="comment">\ Direction 3 (pan down, scroll up)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-startscrollingview" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">StartScrollingView</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Start a scroll process in the background by setting the number of</span>
             <span class="headerEntry">scroll steps and the address to start copying new content from</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/startscrollingview.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> calls <a href="#startscrollingview">StartScrollingView</a></span>
</div>
</div></div>
<span class="label">.StartScrollingView</span><a id="startscrollingview" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">numberOfScrolls</a>    <span class="comment">\ Store the number of scroll steps required in the</span>
                        <span class="comment">\ variable</span>
                        <span class="comment">\</span>
                        <span class="comment">\ When this variable is non-zero, the interrupt handler</span>
                        <span class="comment">\ will scroll the screen by this many steps in the</span>
                        <span class="comment">\ background</span>

                        <span class="comment">\ Fall through into SetBufferAddress to set the address</span>
                        <span class="comment">\ from which the interrupt handler should start fetching</span>
                        <span class="comment">\ new content to scroll onto the screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-setbufferaddress" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SetBufferAddress</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set screenBufferAddr(1 0) to the address from which the interrupt</span>
             <span class="headerEntry">handler should fetch new content to scroll onto the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/setbufferaddress.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#setbufferaddress">SetBufferAddress</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The direction of scrolling that we are applying:</span>

                        <span class="argumentEntry">  * 0 = pan right</span>

                        <span class="argumentEntry">  * 1 = pan left</span>

                        <span class="argumentEntry">  * 2 = pan up</span>

                        <span class="argumentEntry">  * 3 = pan down</span>

</div></div>
<span class="label">.SetBufferAddress</span><a id="setbufferaddress" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">screenBufferLo</a>,<span class="register">Y</span>   <span class="comment">\ Set screenBufferAddr(1 0) to the Y-th entry from the</span>
 <span class="mne">STA</span> <a class="popup variable">screenBufferAddr</a>   <span class="comment">\ screenBufferHi and screenBufferLo lookup tables</span>
 <span class="mne">LDA</span> <a class="popup variable">screenBufferHi</a>,<span class="register">Y</span>   <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">screenBufferAddr</a><span class="operator">+</span><span class="decimal">1</span> <span class="comment">\ This sets screenBufferAddr(1 0) to the address from</span>
                        <span class="comment">\ which the interrupt handler should start pulling</span>
                        <span class="comment">\ screen content to scroll onto the screen, so:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When panning right: The left column of the</span>
                        <span class="comment">\     column-shaped screen buffer appears first as the</span>
                        <span class="comment">\     new content scrolls in from the right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When panning left: The right column of the</span>
                        <span class="comment">\     column-shaped screen buffer appears first as the</span>
                        <span class="comment">\     new content scrolls in from the right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When panning up: The bottom row of the row-shaped</span>
                        <span class="comment">\     screen buffer appears first as the new content</span>
                        <span class="comment">\     scrolls in from above</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When panning down: The top row of the row-shaped</span>
                        <span class="comment">\     screen buffer appears first as the new content</span>
                        <span class="comment">\     scrolls in from below</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this sets screenBufferAddr(1 0) to the address</span>
                        <span class="comment">\ where the interrupt handler should start fetching new</span>
                        <span class="comment">\ content to scroll onto the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ See the documentation for screenBufferHi for a</span>
                        <span class="comment">\ deeper look into the exact values that are set</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-userowbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UseRowBuffer</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Configure the row buffer for use</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/userowbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> calls <a href="#userowbuffer">UseRowBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/setcolumnbuffermax.html">SetColumnBufferMax</a> calls via <a href="#rbuf1">rbuf1</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">rbuf1</span>                <span class="argumentEntry">Set the minimum and maximum pitch angled for the buffer</span>
                        <span class="argumentEntry">type specified in Y (0 = row buffer, 1 = column buffer)</span>

</div></div>
<span class="label">.UseRowBuffer</span><a id="userowbuffer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call ConfigureBuffer with A = 0 to set up the screen</span>
 <span class="mne">JSR</span> <a class="popup destination">ConfigureBuffer</a>    <span class="comment">\ buffer for use as a row buffer</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 so we set the maximum and minimum pitch</span>
                        <span class="comment">\ angles for the row buffer in the following</span>

<span class="label">.rbuf1</span><a id="rbuf1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">bufferMaxPitch</a>,<span class="register">Y</span>   <span class="comment">\ Set maxPitchAngle to the maximum pitch angle allowed</span>
 <span class="mne">STA</span> <a class="popup variable">maxPitchAngle</a>      <span class="comment">\ in the buffer specified in Y</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferMinPitch</a>,<span class="register">Y</span>   <span class="comment">\ Set minPitchAngle to the minimum pitch angle allowed</span>
 <span class="mne">STA</span> <a class="popup variable">minPitchAngle</a>      <span class="comment">\ in the buffer specified in Y</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-buffermaxpitch" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">bufferMaxPitch</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Maximum allowed pitch angles for points in the screen buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/buffermaxpitch.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/userowbuffer.html">UseRowBuffer</a> uses <a href="#buffermaxpitch">bufferMaxPitch</a></span>
</div>
</div></div>
<span class="label">.bufferMaxPitch</span><a id="buffermaxpitch" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">240</span>               <span class="comment">\ Row buffer contains pitch angles from 176 to 240</span>

 <span class="mne">EQUB</span> <span class="decimal">240</span>               <span class="comment">\ Column buffer contains pitch angles from 48 to 240</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-bufferminpitch" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">bufferMinPitch</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Minimum allowed pitch angles for points in the screen buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/bufferminpitch.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/userowbuffer.html">UseRowBuffer</a> uses <a href="#bufferminpitch">bufferMinPitch</a></span>
</div>
</div></div>
<span class="label">.bufferMinPitch</span><a id="bufferminpitch" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">176</span>               <span class="comment">\ Row buffer contains pitch angles from 176 to 240</span>

 <span class="mne">EQUB</span> <span class="decimal">48</span>                <span class="comment">\ Column buffer contains pitch angles from 48 to 240</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-usecolumnbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UseColumnBuffer</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Configure the column buffer for use</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/usecolumnbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> calls <a href="#usecolumnbuffer">UseColumnBuffer</a></span>
</div>
</div></div>
<span class="label">.UseColumnBuffer</span><a id="usecolumnbuffer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Call ConfigureBuffer with A = 2 to set up the screen</span>
 <span class="mne">JSR</span> <a class="popup destination">ConfigureBuffer</a>    <span class="comment">\ buffer for use as a column buffer</span>

                        <span class="comment">\ Fall through into SetColumnBufferMax to set the</span>
                        <span class="comment">\ maximum and minimum pitch angles for the column buffer</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-setcolumnbuffermax" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SetColumnBufferMax</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set the maximum and minimum pitch angles for the column buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/setcolumnbuffermax.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> calls <a href="#setcolumnbuffermax">SetColumnBufferMax</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/resettilesobjects.html">ResetTilesObjects</a> calls <a href="#setcolumnbuffermax">SetColumnBufferMax</a></span>
</div>
</div></div>
<span class="label">.SetColumnBufferMax</span><a id="setcolumnbuffermax" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set Y = 1 so we set the maximum and minimum pitch</span>
                        <span class="comment">\ angles for the column buffer when we jump to rbuf1</span>

 <span class="mne">BNE</span> <a class="popup destination">rbuf1</a>              <span class="comment">\ Jump to rbuf1 to set the maximum and minimum pitch</span>
                        <span class="comment">\ angles for the column buffer and return from the</span>
                        <span class="comment">\ subroutine using a tail call (this BNE is effectively</span>
                        <span class="comment">\ a JMP as Y is never zero)</span>


</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-checkforkeypresses"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-checkforkeypresses">CheckForKeyPresses</a> (category: Keyboard)</div><div class="summary">Check for various game key presses and update the key logger and relevant variables (during the interrupt handler)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-clearscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-clearscreen">ClearScreen</a> (category: Graphics)</div><div class="summary">Clear the screen to a specified background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-configurebuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-configurebuffer">ConfigureBuffer</a> (category: Screen buffer)</div><div class="summary">Set up the variables required to configure the screen buffer to a specific buffer type</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-defineenvelope"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-defineenvelope">DefineEnvelope</a> (category: Sound)</div><div class="summary">Define a sound envelope</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-digittonumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-digittonumber">DigitToNumber</a> (category: Text)</div><div class="summary">Convert a digit from the input buffer into a number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawblackdots"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-drawblackdots">DrawBlackDots</a> (category: Graphics)</div><div class="summary">Draw 80 randomly positioned dots on the screen in colour 1 (black)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawicon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-drawicon">DrawIcon</a> (category: Scanner/energy row)</div><div class="summary">Draw a single icon in the top-left corner of the screen (via the icon screen buffer at iconBuffer) and move along to the right</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscapeview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-1-of-3">DrawLandscapeView (Part 1 of 3)</a> (category: Drawing the landscape)</div><div class="summary">Set up a number of variables for drawing the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-finishlandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-finishlandscape">FinishLandscape</a> (category: Main game loop)</div><div class="summary">Add the player's energy to the landscape number to get the number of the next landscape and display that landscape's secret code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-flushbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-flushbuffer">FlushBuffer</a> (category: Keyboard)</div><div class="summary">Flush the specified buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-flushsoundbuffers"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-flushsoundbuffers">FlushSoundBuffers</a> (category: Sound)</div><div class="summary">Flush all four sound channel buffers</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-geticonrowaddress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-geticonrowaddress">GetIconRowAddress</a> (category: Scanner/energy row)</div><div class="summary">Calculate the address in screen memory of the icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseedasbcd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-getnextseedasbcd">GetNextSeedAsBCD</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to the next number from the landscape's sequence of seed numbers, converted to a binary coded decimal (BCD) number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseednumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-getnextseednumber">GetNextSeedNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a seed number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettilevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-gettilevisibility">GetTileVisibility</a> (category: Drawing the landscape)</div><div class="summary">For each tile in the landscape, calculate whether the player can see that tile, to speed up the process of drawing the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-initialiseseeds"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-initialiseseeds">InitialiseSeeds</a> (category: Landscape)</div><div class="summary">Initialise the seed number generator so it generates the sequence of seed numbers for a specific landscape number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maingameloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a> (category: Main game loop)</div><div class="summary">The main game loop for playing a landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maintitleloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-maintitleloop">MainTitleLoop</a> (category: Main title loop)</div><div class="summary">The main title loop: display the title screen, fetch the landscape number/code, preview the landscape and jump to the main game loop</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-makesound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">MakeSound</a> (category: Sound)</div><div class="summary">Make a sound</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-makesound-6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_g.html#makesound">MakeSound-6</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">MakeSound</a> (category: Sound)</div><div class="summary">Make a two-part sound at the pitches defined in X and Y, where X is the pitch for sound data block #0 and Y is the pitch for sound data block #1</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-makesoundenvelope"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-makesoundenvelope">MakeSoundEnvelope</a> (category: Sound)</div><div class="summary">Either make a sound or set up an envelope</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#osbyte">OSBYTE</a></div><div class="summary">The address for the OSBYTE routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osword"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#osword">OSWORD</a></div><div class="summary">The address for the OSWORD routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-p"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#p">P</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-panlandscapeview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-panlandscapeview">PanLandscapeView</a> (category: Drawing the landscape)</div><div class="summary">Pan the landscape and update the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playmusic"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-playmusic">PlayMusic</a> (category: Sound)</div><div class="summary">Play a piece of music</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-print2digitbcd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-print2digitbcd">Print2DigitBCD</a> (category: Text)</div><div class="summary">Print a binary coded decimal (BCD) number using two digits</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-printnumber">PrintNumber</a> (category: Text)</div><div class="summary">Print a number as a single digit, printing zero as a capital "O"</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printtexttoken"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-printtexttoken">PrintTextToken</a> (category: Text)</div><div class="summary">Print a recursive text token</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printvducharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-printvducharacter">PrintVduCharacter</a> (category: Text)</div><div class="summary">Print a one-byte character from a text token or a multi-byte VDU 25 command</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processcharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processcharacter">ProcessCharacter</a> (category: Text)</div><div class="summary">Process and print a character from a text token, which can encode another text token or be a one-byte character or VDU command</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processgameplay"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-processgameplay">ProcessGameplay</a> (category: Gameplay)</div><div class="summary">A gameplay loop that processes all game key presses, returning to the main game loop when the player moves, quits, loses or pans</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processmusic"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processmusic">ProcessMusic</a> (category: Sound)</div><div class="summary">Play the configured music in the background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processsound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a> (category: Sound)</div><div class="summary">Process any sound effects that have been configured so they play in the background (this is called regularly throughout gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processvolumekeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a> (category: Sound)</div><div class="summary">Adjust the volume of the sound envelopes when the volume keys are pressed</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-q"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#q">Q</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-readkeyboard"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-readkeyboard">ReadKeyboard</a> (category: Keyboard)</div><div class="summary">Enable the keyboard and read a character from it</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-resettilesobjects"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-resettilesobjects">ResetTilesObjects</a> (category: Main title Loop)</div><div class="summary">Reset the tile visibility table and deallocate all object numbers</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-resetvariables"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-resetvariables">ResetVariables</a> (category: Main title Loop)</div><div class="summary">Reset all the game's main variables</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sheila"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Configuration variable <a href="/source/all/workspaces.html#sheila">SHEILA</a></div><div class="summary">Memory-mapped space for accessing internal hardware, such as the video ULA, 6845 CRTC and 6522 VIAs (also known as SHEILA)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scanforgamekeys"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-scanforgamekeys">ScanForGameKeys</a> (category: Keyboard)</div><div class="summary">Scan for game key presses and update the key logger</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scrollplayerview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-scrollplayerview">ScrollPlayerView</a> (category: Graphics)</div><div class="summary">Scroll the screen and copy data from the screen buffer into screen memory to implement the player's scrolling landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setcolourpalette"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-setcolourpalette">SetColourPalette</a> (category: Graphics)</div><div class="summary">Set the logical colours for each of the four physical colours in screen mode 5</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setscannerandpause"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-setscannerandpause">SetScannerAndPause</a> (category: Main game loop)</div><div class="summary">Set the scanner update status and delay for 40 empty loops of 256 iterations each (i.e. 10,240 loops)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-showbufferblock"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-showbufferblock">ShowBufferBlock</a> (category: Screen buffer)</div><div class="summary">Update the player's scrolling landscape view by copying an 8-byte character block from the screen buffer into screen memory</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-showbufferrow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-showbufferrow">ShowBufferRow</a> (category: Screen buffer)</div><div class="summary">Update the player's scrolling landscape view by copying an 8-pixel high character row from the screen buffer into screen memory</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-showgameoverscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-showgameoverscreen">ShowGameOverScreen</a> (category: Title screen)</div><div class="summary">Display the game over screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-showiconbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-showiconbuffer">ShowIconBuffer</a> (category: Screen buffer)</div><div class="summary">Display the redrawn icon and scanner row by copying the contents of the icon screen buffer into screen memory</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawncharacter3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-1-of-2">SpawnCharacter3D (Part 1 of 2)</a> (category: Title screen)</div><div class="summary">Spawn a character on the landscape in large 3D blocks for drawing on the main title screen or secret code screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#t">T</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateenemytimers"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-updateenemytimers">UpdateEnemyTimers</a> (category: Gameplay)</div><div class="summary">Update the timers that control the enemy tactics</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateiconsscanner"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a> (category: Scanner/energy row)</div><div class="summary">Update the icons in the top-left corner of the screen to show the player's current energy level and redraw the scanner box</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updatescanner"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-updatescanner">UpdateScanner</a> (category: Scanner/energy row)</div><div class="summary">Update the scanner, if required</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updatescannernow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-updatescannernow">UpdateScannerNow</a> (category: Scanner/energy row)</div><div class="summary">Update the scanner to a new state</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-astoreenvelope"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-astoreenvelope">aStoreEnvelope</a> (category: Sound)</div><div class="summary">Temporary storage for use in the DefineEnvelope routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-activatesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#activatesentinel">activateSentinel</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record when the Sentinel is activated at the start of the game (by the player pressing a key that expends or absorbs energy</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffermaxpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-buffermaxpitch">bufferMaxPitch</a> (category: Screen buffer)</div><div class="summary">Maximum allowed pitch angles for points in the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-bufferminpitch">bufferMinPitch</a> (category: Screen buffer)</div><div class="summary">Minimum allowed pitch angles for points in the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-char1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#char1">char1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processcharacter">ProcessCharacter</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dcol1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dcol1">dcol1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-showbuffercolumn">ShowBufferColumn</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dcol2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dcol2">dcol2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-showbuffercolumn">ShowBufferColumn</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dcol3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dcol3">dcol3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-showbuffercolumn">ShowBufferColumn</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-deni1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#deni1">deni1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-drawicon">DrawIcon</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dnum1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dnum1">dnum1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-digittonumber">DigitToNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dnum2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dnum2">dnum2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-digittonumber">DigitToNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotditherobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotditherobject">doNotDitherObject</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the DitherScreenBuffer routine can update an object on the screen using a dithered effect</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#drawlandscape">drawLandscape</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Configures whether to draw the landscape behind the object in the DrawUpdatedObject routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drow1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#drow1">drow1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-showbufferrow">ShowBufferRow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drow2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#drow2">drow2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-showbufferrow">ShowBufferRow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drow3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_g.html#drow3">drow3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-showbufferrow">ShowBufferRow</a> (category: Screen buffer)</div><div class="summary">Contains an RTS</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dsec1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dsec1">dsec1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-spawnsecretcode3d">SpawnSecretCode3D</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dsec2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#dsec2">dsec2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-spawnsecretcode3d">SpawnSecretCode3D</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enec1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#enec1">enec1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-cleariconsscanner">ClearIconsScanner</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enem1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#enem1">enem1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getenemycount">GetEnemyCount</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enem2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#enem2">enem2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getenemycount">GetEnemyCount</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enem3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#enem3">enem3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getenemycount">GetEnemyCount</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enem4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#enem4">enem4</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getenemycount">GetEnemyCount</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ener1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#ener1">ener1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ener2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#ener2">ener2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ener3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#ener3">ener3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ener4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#ener4">ener4</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ener5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#ener5">ener5</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-updateiconsscanner">UpdateIconsScanner</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-envelopedata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-envelopedata">envelopeData</a> (category: Sound)</div><div class="summary">Data for the six sound envelopes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-envelopevolumes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-envelopevolumes">envelopeVolumes</a> (category: Sound)</div><div class="summary">A table of offsets into the envelope data for bytes that control the volume of each envelope, so we can change their volume levels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fbuf1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#fbuf1">fbuf1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-flushsoundbuffers">FlushSoundBuffers</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-focusonkeyaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#focusonkeyaction">focusOnKeyAction</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that determines whether the game should focus effort on implementing a key action, such as a pan of the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fromaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#fromaddr">fromAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">An address, typically used as a source address when copying</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game1">game1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game11">game11</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game12">game12</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game13">game13</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game14">game14</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game2">game2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game3">game3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game4">game4</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game5">game5</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game6">game6</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game7">game7</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game8">game8</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#game9">game9</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameinprogress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gameinprogress">gameInProgress</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Flags whether or not a game is in progress (i.e. the player is playing a landscape rather than interacting with the title and preview screens)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameoversoundpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gameoversoundpitch">gameOverSoundPitch</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A timer for the game over sound</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gamepaused"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#gamepaused">gamePaused</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether the game is paused</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hyperspaceendsgame"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#hyperspaceendsgame">hyperspaceEndsGame</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Records whether the player performing a hyperspace has just ended the game</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-iconbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-iconbuffer">iconBuffer</a> (category: Graphics)</div><div class="summary">The icon screen buffer, which is used to buffer the energy icon and scanner row before writing to screen memory</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-icondata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-icondata">iconData</a> (category: Graphics)</div><div class="summary">Screen mode 5 bitmap data for the ten icons that make up the energy icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-iconrowaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#iconrowaddr">iconRowAddr</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The screen address of the icon and scanner row along the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-inputbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#inputbuffer">inputBuffer</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The eight-byte keyboard input buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irq1address"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-irq1address">irq1Address</a> (category: Main game loop)</div><div class="summary">Stores the previous value of IRQ1V before we install our custom IRQ handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh1">irqh1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh2">irqh2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh3">irqh3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh4">irqh4</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh5">irqh5</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh6">irqh6</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh7">irqh7</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-irqh8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#irqh8">irqh8</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-irqhandler">IRQHandler</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keepcheckingpankey"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#keepcheckingpankey">keepCheckingPanKey</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the DrawLandscapeView routine aborts drawing if the pan key is released before it has finished</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keylogger"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#keylogger">keyLogger</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The four-byte key logger for logging game key presses</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapenumberhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#landscapenumberhi">landscapeNumberHi</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The high byte of the four-digit binary coded decimal landscape number (0000 to 9999)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapenumberlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#landscapenumberlo">landscapeNumberLo</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The low byte of the four-digit binary coded decimal landscape number (0000 to 9999)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapezero"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#landscapezero">landscapeZero</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that is set depending on whether we are playing landscape 0000</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lastpankeypressed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#lastpankeypressed">lastPanKeyPressed</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The direction of the last pan key that was pressed (which may not still be held down)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-loopcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#loopcounter">loopCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A general-purpose loop counter</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lownibblebcd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-lownibblebcd">lowNibbleBCD</a> (category: Maths (Arithmetic))</div><div class="summary">Storage for the low nibble when constructing a BCD seed number in the GetNextSeedAsBCD routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-main4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_a.html#main4">main4</a> in subroutine <a href="/source/all/the_sentinel_a.html#header-maintitleloop">MainTitleLoop</a> (category: Main title loop)</div><div class="summary">The entry point for restarting a landscape after dying, so the player doesn't have to enter the landscape's secret code again</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxnumberofenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#maxnumberofenemies">maxNumberOfEnemies</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The maximum number of enemies that can appear on the current landscape, which is calculated as follows</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#maxpitchangle">maxPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The maximum pitch angle that fits into the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-minpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#minpitchangle">minPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The minimum pitch angle that fits into the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musi1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#musi1">musi1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processmusic">ProcessMusic</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musi2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#musi2">musi2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processmusic">ProcessMusic</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musi3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#musi3">musi3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processmusic">ProcessMusic</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musi4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#musi4">musi4</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processmusic">ProcessMusic</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musiccounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#musiccounter">musicCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for the music currently being made, which counts up in the ProcessMusic routine while the music is being played</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-musicdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-musicdata">musicData</a> (category: Sound)</div><div class="summary">Data for the game's music</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-notecounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#notecounter">noteCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The sound counter for an individual note while playing chords in the music player</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-numberofscrolls"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#numberofscrolls">numberOfScrolls</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The total number of scrolls that we need to perform for the current panning operation</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pankeybeingpressed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pankeybeingpressed">panKeyBeingPressed</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The direction in which the player is currently panning</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-paws1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#paws1">paws1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processpausekeys">ProcessPauseKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-paws2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#paws2">paws2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processpausekeys">ProcessPauseKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playerenergy">playerEnergy</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The player's energy level (in the range 0 to 63)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerisontower"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playerisontower">playerIsOnTower</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether the player is on top of the the Sentinel's tower</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#playerobject">playerObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the player object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-plen1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#plen1">plen1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getplayerenergybcd">GetPlayerEnergyBCD</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-plen2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#plen2">plen2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getplayerenergybcd">GetPlayerEnergyBCD</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printtextin3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#printtextin3d">printTextIn3D</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether we are printing text normally or in 3D (as in the game's title on the title screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-psou1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#psou1">psou1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-psou2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#psou2">psou2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-psou3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#psou3">psou3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-quitgame"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#quitgame">quitGame</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether the player has pressed function key f1 to quit the game</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rbcd1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#rbcd1">rbcd1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getnextseedasbcd">GetNextSeedAsBCD</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rbcd2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#rbcd2">rbcd2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-getnextseedasbcd">GetNextSeedAsBCD</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rbuf1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_g.html#rbuf1">rbuf1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-userowbuffer">UseRowBuffer</a> (category: Screen buffer)</div><div class="summary">Set the minimum and maximum pitch angled for the buffer type specified in Y (0 = row buffer, 1 = column buffer)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenaddrhi">screenAddrHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of the screen memory address in the ScrollPlayerView routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbufferaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-screenbufferaddr">screenBufferAddr</a> (category: Screen buffer)</div><div class="summary">Storage for the address for the current drawing operation in the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbufferhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-screenbufferhi">screenBufferHi</a> (category: Screen buffer)</div><div class="summary">The value to add to scrollScreenHi for each direction to get the high byte of the screen buffer address of the content to scroll in</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbufferlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-screenbufferlo">screenBufferLo</a> (category: Screen buffer)</div><div class="summary">The value to add to scrollScreenLo for each direction to get the low byte of the screen buffer address of the content to scroll in</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbufferrow0"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-screenbufferrow0">screenBufferRow0</a> (category: Screen buffer)</div><div class="summary">The screen buffer for character row 0</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenorbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenorbuffer">screenOrBuffer</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Controls whether the graphics routines draw directly onto the screen, or into the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scro1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#scro1">scro1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-scrollplayerview">ScrollPlayerView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scro2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#scro2">scro2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-scrollplayerview">ScrollPlayerView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scro3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#scro3">scro3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-scrollplayerview">ScrollPlayerView</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scrollcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#scrollcounter">scrollCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for the number of columns or rows we still need to scroll in the player's scrolling landscape view when the player pans</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scrollscreenhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-scrollscreenhi">scrollScreenHi</a> (category: Screen buffer)</div><div class="summary">The amount to change the start of screen memory in order to scroll the player's landscape view through each direction (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-scrollscreenlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-scrollscreenlo">scrollScreenLo</a> (category: Screen buffer)</div><div class="summary">The amount to change the start of screen memory in order to scroll the player's landscape view through each direction (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seed1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#seed1">seed1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-initialiseseeds">InitialiseSeeds</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seed2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#seed2">seed2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-initialiseseeds">InitialiseSeeds</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sentinelhaswon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sentinelhaswon">sentinelHasWon</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record when the player runs out of energy (i.e. the energy level goes negative), at which point the Sentinel wins</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsarevisible"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsarevisible">sightsAreVisible</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the sights are being shown</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbytecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsbytecount">sightsByteCount</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of screen bytes in the sights pixel byte stash that contain the contents of the screen behind the sights (so they can be restored to remove the sights)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-snum1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#snum1">snum1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-stringtonumber">StringToNumber</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soun1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#soun1">soun1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">MakeSound</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soun2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#soun2">soun2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">MakeSound</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soundcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#soundcounter">soundCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for the sound currently being made, which counts down in the IRQHandler routine at a rate of 50 times a second</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sounddata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-sounddata">soundData</a> (category: Sound)</div><div class="summary">OSWORD blocks for making the various game sounds</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soundeffect"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#soundeffect">soundEffect</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Determines how the current sound is processed by the ProcessSound routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soundnumberdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-soundnumberdata">soundNumberData</a> (category: Sound)</div><div class="summary">A table to map a sound number (0 to 6) to the sound data block(s) that are used to make the sound</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-text1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#text1">text1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-printtexttoken">PrintTextToken</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-text2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#text2">text2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-printtexttoken">PrintTextToken</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-toaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#toaddr">toAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">An address, typically used as a destination address when copying</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tokenbase"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_i.html#tokenbase">tokenBase</a> in variable <a href="/source/all/the_sentinel_i.html#header-tokenoffset">tokenOffset</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tokenoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-tokenoffset">tokenOffset</a> (category: Text)</div><div class="summary">Address offsets for the text tokens (each offset in the table is the offset of the token from tokenBase)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-uturnstatus"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#uturnstatus">uTurnStatus</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether we are performing or have just performed a U-turn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateoffsethi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-updateoffsethi">updateOffsetHi</a> (category: Screen buffer)</div><div class="summary">The offset within screen memory for the player's landscape view of the area to update following a scroll (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateoffsetlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-updateoffsetlo">updateOffsetLo</a> (category: Screen buffer)</div><div class="summary">The offset within screen memory for the player's landscape view of the area to update following a scroll (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#viewscreenaddr">viewScreenAddr</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The screen address of the player's scrolling landscape view, which is just below the icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingobject">viewingObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volk1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#volk1">volk1</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volk2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#volk2">volk2</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volk3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#volk3">volk3</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volk4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#volk4">volk4</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volk5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#volk5">volk5</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volk6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_g.html#volk6">volk6</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-processvolumekeys">ProcessVolumeKeys</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-volumelevel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_g.html#header-volumelevel">volumeLevel</a> (category: Sound)</div><div class="summary">The volume level, which can be changed by pressing "7" and "8"</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xiconcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xiconcounter">xIconCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for drawing the icons in the top-left of the screen that show the player's energy level, as we work from left to right along the x-axis</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_f.html">The Sentinel F source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_h.html">The Sentinel H source</a></nav>
				</div>
			</article>

<?php
include_once("../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
