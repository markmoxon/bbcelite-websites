<?php
include_once("../../templates/template_functions.php");
page_header("all_source", "the_sentinel_e.html", "The Sentinel E source", "The Sentinel E source", "The The Sentinel E source file in The Sentinel", "the_sentinel-index", "source_all_source", "the_sentinel_e", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_d.html">The Sentinel D source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_f.html">The Sentinel F source</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div><div><div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettilealtitudes" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileAltitudes</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate tile corner altitudes and maximum tile corner altitudes</span>
             <span class="headerEntry">for each tile in the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettilealtitudes.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilevisibility.html">GetTileVisibility</a> calls <a href="#gettilealtitudes">GetTileAltitudes</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checksecretstash.html">CheckSecretStash</a> calls via <a href="#talt2">talt2</a></span></span>
</div>
<hr class="light">
 This routine calculates tile altitudes for use when drawing the landscape.

 The altitude of each tile corner and the shape of the anchored tile (if any)
 are stored as follows:

   * &6000 to &601F for row zTile = 0
   * &6100 to &611F for row zTile = 1
     ...
   * &7E00 to &7E1F for row zTile = 30
   * &7F00 to &7F1F for row zTile = 31

 The altitude of the highest tile corner for each tile is stored as follows:

   * &6020 to &603E for tile row anchored by zTile = 0
   * &6120 to &613E for tile row anchored by zTile = 1
     ...
   * &7D20 to &7E3E for tile row anchored by zTile = 29
   * &7E20 to &7E3E for tile row anchored by zTile = 30

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">(Q</span>  <span class="argumentEntry">P)               (Q P) is set to &6000</span>

   <span class="argumentLabel">(S</span>  <span class="argumentEntry">R)               (Q P) is set to &6020</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">talt2</span>                <span class="argumentEntry">Jump to MainTitleLoop via game10</span>

</div></div>
<span class="label">.GetTileAltitudes</span><a id="gettilealtitudes" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set the low byte of (Q P) = &7F00</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>

 <span class="mne">STA</span> <a class="popup variable">considerObjects</a>    <span class="comment">\ Clear bit 7 of considerObjects so GetTileAltitude will</span>
                        <span class="comment">\ only extract the altitude and flatness of the tiles</span>
                        <span class="comment">\ when we call it below, ignoring any objects on the</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&7F</span>               <span class="comment">\ Set the high byte of (Q P) = &7F00</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>                  <span class="comment">\</span>
                        <span class="comment">\ This is the address where we will store the altitude</span>
                        <span class="comment">\ data for the back row of tile corners in the landscape</span>

                        <span class="comment">\ We now iterate through the tile corners with a nested</span>
                        <span class="comment">\ loop, with zTile going from 31 to 0 (so that's from</span>
                        <span class="comment">\ back to front)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For each zTile, xTile also goes from 31 to 0, so</span>
                        <span class="comment">\ that's from right to left</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we work through the landscape, starting with the</span>
                        <span class="comment">\ row of tile corners at the back (which we work through</span>
                        <span class="comment">\ from right to left), and then doing the next row</span>
                        <span class="comment">\ forward, looping until we reach the front row</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set zTile = 31 so we start iterating from the back row</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ (so zTile iterates from 31 to 0 in the outer loop)</span>

<span class="label">.talt1</span><a id="talt1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set xTile = 31 so we start iterating from the right</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ end of the current row (so xTile iterates from 31 to 0</span>
                        <span class="comment">\ in the inner loop)</span>

 <span class="mne">BNE</span> <a class="popup destination">talt3</a>              <span class="comment">\ Jump to talt3 to join the loop below (this BNE is</span>
                        <span class="comment">\ effectively a JMP as A is never zero)</span>

<span class="label">.talt2</span><a id="talt2" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">game10</a>             <span class="comment">\ Jump to MainTitleLoop to restart the game (this has</span>
                        <span class="comment">\ nothing to do with the GetTileAltitudes routine, but</span>
                        <span class="comment">\ is all part of the anti-cracker code)</span>

<span class="label">.talt3</span><a id="talt3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileAltitude</a>    <span class="comment">\ Call GetTileAltitude with bit 7 of considerObjects</span>
                        <span class="comment">\ clear to extract the following tile data:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * A = the high byte of the tile's altitude (which</span>
                        <span class="comment">\         is also the altitude of the tile corner)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * C flag = the tile's shape, clear if the tile is</span>
                        <span class="comment">\              flat or set if the tile is not flat</span>

 <span class="mne">LDY</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set Y to the tile corner x-coordinate, to use as an</span>
                        <span class="comment">\ index so we store the tile corner data like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Column xTile = 31 is stored in (Q P) + &1F</span>
                        <span class="comment">\   * Column xTile = 30 is stored in (Q P) + &1E</span>
                        <span class="comment">\   ...</span>
                        <span class="comment">\   * Column xTile = 1 is stored in (Q P) + &01</span>
                        <span class="comment">\   * Column xTile = 0 is stored in (Q P) + &00</span>
                        <span class="comment">\</span>
                        <span class="comment">\ (Q P) starts at &7F00 for zTile = 31, so the back row</span>
                        <span class="comment">\ of the landscape is stored in &7F00 to &7F1F</span>
                        <span class="comment">\</span>
                        <span class="comment">\ (Q P) is decremented for each tile row (see below), so</span>
                        <span class="comment">\ the next row forward is stored in &7E00 to &7E1F, for</span>
                        <span class="comment">\ example</span>

 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ Rotate the C flag into bit 0 of A, so we have the</span>
                        <span class="comment">\ following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 0 = clear if the tile is flat or set if the</span>
                        <span class="comment">\             tile is not flat</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 1-4 = the tile corner's altitude</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Store the tile corner data in A in the Y-th entry in</span>
                        <span class="comment">\ the variable at (Q P), so this populates the extracted</span>
                        <span class="comment">\ data for the tile corner at (xTile, zTile)</span>

 <span class="mne">DEC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Decrement the tile corner x-coordinate in the inner</span>
                        <span class="comment">\ loop</span>

 <span class="mne">BPL</span> <a class="popup destination">talt3</a>              <span class="comment">\ Loop back until we have processed all the tile corners</span>
                        <span class="comment">\ in the tile row at z-coordinate zTile, working from</span>
                        <span class="comment">\ right to left</span>

 <span class="mne">DEC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Decrement the high byte of (Q P), so we store the</span>
                        <span class="comment">\ tile corner data like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Row zTile = 31 is stored in &7F00 to &7F1F</span>
                        <span class="comment">\   * Row zTile = 30 is stored in &7E00 to &7E1F</span>
                        <span class="comment">\   ...</span>
                        <span class="comment">\   * Row zTile = 1 is stored in &6100 to &611F</span>
                        <span class="comment">\   * Row zTile = 0 is stored in &6000 to &601F</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement the tile corner z-coordinate in the outer</span>
                        <span class="comment">\ loop</span>

 <span class="mne">BPL</span> <a class="popup destination">talt1</a>              <span class="comment">\ Loop back until we have processed all the tile rows in</span>
                        <span class="comment">\ the landscape, working from the back row of the</span>
                        <span class="comment">\ landscape all the way to the front row</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This leaves (Q P) set to &6000</span>

                        <span class="comment">\ We now iterate through each tile to calculate the</span>
                        <span class="comment">\ altitude of the highest tile corner, so we can store</span>
                        <span class="comment">\ it after the altitude data that we just extracted</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ Set the low byte of (S R) = &20</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\</span>
                        <span class="comment">\ At this point the low byte of (Q P) is still zero, so</span>
                        <span class="comment">\ the following loop will start with the following</span>
                        <span class="comment">\ values:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (Q P) = &7E00</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (S R) = &7E20</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words (Q P) points to the altitude data that</span>
                        <span class="comment">\ we just extracted, and (S R) points to the next set of</span>
                        <span class="comment">\ bytes just after the end of the altitude data</span>

                        <span class="comment">\ We now work our way through the tiles, using X as the</span>
                        <span class="comment">\ row number iterating from the rear, and Y as the</span>
                        <span class="comment">\ column number iterating from right to left along each</span>
                        <span class="comment">\ row in turn</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Set X = 30 to use as the row number, so we start</span>
                        <span class="comment">\ iterating from the rear, skipping the row right at the</span>
                        <span class="comment">\ back as the tile corners in that row do not anchor any</span>
                        <span class="comment">\ tiles (so X iterates from 30 to 0 in the outer loop)</span>

<span class="label">.talt4</span><a id="talt4" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = &60 + X</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ So this is the high byte of the address of the</span>
                        <span class="comment">\ extracted altitude for row X, starting from &7E and</span>
                        <span class="comment">\ working down to &60 as we iterate over each row</span>

 <span class="mne">STA</span> <a class="popup variable">Q</a>                  <span class="comment">\ Set the high byte of (Q P) to A, so (Q P) points to</span>
                        <span class="comment">\ the extracted altitude data for row X</span>

 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\ Set the high byte of (S R) to A, so (S R) points to</span>
                        <span class="comment">\ the address just after the extracted altitude data</span>
                        <span class="comment">\ for row X</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Set Y = 30 to use as the column number, so we start</span>
                        <span class="comment">\ iterating from the right, skipping the rightmost</span>
                        <span class="comment">\ column as the tile corners in that column do not</span>
                        <span class="comment">\ anchor any tiles (so Y iterates from 30 to 0 in the</span>
                        <span class="comment">\ inner loop)</span>

<span class="label">.talt5</span><a id="talt5" class="anchor"></a>

                        <span class="comment">\ We now calculate the altitude of the highest corner</span>
                        <span class="comment">\ for the tile that we are analysing, i.e. the tile</span>
                        <span class="comment">\ that's anchored by the tile corner at tile coordinates</span>
                        <span class="comment">\ (X, Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We do this by working through all four corners in the</span>
                        <span class="comment">\ tile, starting with the anchor point, and then</span>
                        <span class="comment">\ checking the corner to the right, then the corner</span>
                        <span class="comment">\ behind, and then the corner to the left</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Fetch the extracted altitude data for the anchor of</span>
                        <span class="comment">\ the tile that we are analysing</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Shift bit 0 into the C flag, so it contains the shape,</span>
                        <span class="comment">\ and set A as the altitude</span>

 <span class="mne">BCC</span> <a class="popup destination">talt9</a>              <span class="comment">\ If the tile is flat then the C flag will be clear, so</span>
                        <span class="comment">\ jump to talt9 to set (S R) to the altitude of the tile</span>
                        <span class="comment">\ anchor, as the tile is flat and this altitude will do</span>
                        <span class="comment">\ for the highest point on the tile</span>

 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ Otherwise the tile is not flat, so rotate the C flag</span>
                        <span class="comment">\ back into the extracted altitude data in A</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to the tile corner to the right of the one</span>
                        <span class="comment">\ we are analysing</span>

 <span class="mne">CMP</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ If this corner's altitude is less than the tile</span>
 <span class="mne">BCC</span> <a class="popup destination">talt6</a>              <span class="comment">\ anchor's altitude, jump to talt6 to skip the following</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the new corner's height, so that A contains</span>
                        <span class="comment">\ the highest altitude of the tile's front two corners</span>

<span class="label">.talt6</span><a id="talt6" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Increment the high byte of (Q P), so it now points to</span>
                        <span class="comment">\ the extracted altitude data for the row of tile</span>
                        <span class="comment">\ corners behind the one we are currently analysing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Y is still incremented from the anchor point, so this</span>
                        <span class="comment">\ points us to the corner behind the one we just</span>
                        <span class="comment">\ analysed</span>

 <span class="mne">CMP</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ If this corner's altitude is less than the highest</span>
 <span class="mne">BCC</span> <a class="popup destination">talt7</a>              <span class="comment">\ altitude, jump to talt7 to skip the following</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the new corner's height, so that A contains</span>
                        <span class="comment">\ the highest altitude of the tile's front two corners</span>
                        <span class="comment">\ and the one at the rear-right of the tile</span>

<span class="label">.talt7</span><a id="talt7" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement Y to the tile corner to the left of the one</span>
                        <span class="comment">\ we just analysed</span>

 <span class="mne">CMP</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ If this corner's altitude is less than the highest</span>
 <span class="mne">BCC</span> <a class="popup destination">talt8</a>              <span class="comment">\ altitude, jump to talt8 to skip the following</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the new corner's height, so that A contains</span>
                        <span class="comment">\ the highest altitude of the tile's front two corners</span>
                        <span class="comment">\ and the two rear corners</span>

<span class="label">.talt8</span><a id="talt8" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Decrement the high byte of (Q P) so it once again</span>
                        <span class="comment">\ points to the extracted altitude data for the anchor</span>
                        <span class="comment">\ point of the tile we are analysing</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Shift the highest altitude in A to remove the tile</span>
                        <span class="comment">\ shape from bit 0 and set A to the actual altitude from</span>
                        <span class="comment">\ bits 2 to 4</span>

<span class="label">.talt9</span><a id="talt9" class="anchor"></a>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set the entry in (S R) for this tile to the value in A</span>
                        <span class="comment">\ so it contains the highest altitude of the tile</span>
                        <span class="comment">\ anchored by the relevant tile corner</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the column counter in Y to move left by one</span>
                        <span class="comment">\ tile</span>

 <span class="mne">BPL</span> <a class="popup destination">talt5</a>              <span class="comment">\ Loop back until we have processed the whole row from</span>
                        <span class="comment">\ right to left</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the row counter in X to move forward by one</span>
                        <span class="comment">\ row</span>

 <span class="mne">BPL</span> <a class="popup destination">talt4</a>              <span class="comment">\ Loop back to process the next row until we have</span>
                        <span class="comment">\ processed all tiles in all rows in the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This leaves (S R) set to &6020</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawlandscapeview-part-1-of-3" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawLandscapeView (Part 1 of 3)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set up a number of variables for drawing the landscape view</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawlandscapeview_part_1_of_3.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitleview.html">DrawTitleView</a> calls <a href="#drawlandscapeview">DrawLandscapeView</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#drawlandscapeview">DrawLandscapeView</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#drawlandscapeview">DrawLandscapeView</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> calls <a href="#drawlandscapeview">DrawLandscapeView</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">viewingObject</span>        <span class="argumentEntry">The number of the object that is viewing the landscape</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">The status of the drawing operation:</span>

                        <span class="argumentEntry">  * Clear = the whole landscape has been drawn</span>

                        <span class="argumentEntry">  * Set = the whole landscape has not been drawn as the</span>
                        <span class="argumentEntry">          panning key is no longer being held down</span>

</div></div>
<span class="label">.DrawLandscapeView</span><a id="drawlandscapeview" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the number of the object that is viewing the</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">polygonPoint</a><span class="bracket">)</span>  <span class="comment">\ Set drawViewAngles(1 0) = polygonPoint</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewAngles</a>     <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">polygonPoint</a><span class="bracket">)</span>  <span class="comment">\ This sets drawViewAngles(1 0) so DrawPolygon will</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewAngles</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ implement the default behaviour of drawing using point</span>
                        <span class="comment">\ data for tile faces rather than object polygons</span>

 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Set A to the yaw angle of the viewer's object</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set viewingArcRightYaw = yaw angle + 32</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">viewingArcRightYaw</a> <span class="comment">\ This gives us the yaw angle of the right edge of the</span>
                        <span class="comment">\ viewing arc, where the arc is 90 degrees wide (as a</span>
                        <span class="comment">\ full circle is represented by 256)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set T = (yaw angle + 32) mod 64 - 32</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ This gives us the yaw angle of the centre of the</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ viewing arc (i.e. the direction of gaze), reduced</span>
                        <span class="comment">\ into the range of a single 90-degree quadrant</span>

 <span class="mne">LDA</span> <a class="popup variable">viewingArcRightYaw</a> <span class="comment">\ Set bits 0-1 of Y to bits 6-7 of viewingArcRightYaw</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ This gives us a value in the range 0 to 3, giving</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ the number of the quadrant that contains the right</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ edge of the viewing arc, numbered clockwise and</span>
 <span class="mne">TAY</span>                    <span class="comment">\ starting from 12 o'clock to 3pm</span>

 <span class="mne">LDA</span> <a class="popup variable">quadrantOffsets</a>,<span class="register">Y</span>  <span class="comment">\ Set quadrantOffset to 0, 1, 33 or 32 depending on the</span>
 <span class="mne">STA</span> <a class="popup variable">quadrantOffset</a>     <span class="comment">\ quadrant containing the right edge of the viewing arc</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used by the DrawTileAndObjects routine ???</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set viewingQuadrantx4 = Y * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ So viewingQuadrantx4 contains the quadrant number</span>
 <span class="mne">STA</span> <a class="popup variable">viewingQuadrantx4</a>  <span class="comment">\ containing the right edge of the viewing arc,</span>
                        <span class="comment">\ multiplied by 4</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used by the DrawSlopingTile routine to work</span>
                        <span class="comment">\ out the number of faces in a sloping tile</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set viewingQuadrantOpp = Y - 2</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ So it viewingQuadrantOpp contains the number of the</span>
 <span class="mne">STA</span> <a class="popup variable">viewingQuadrantOpp</a> <span class="comment">\ quadrant opposite the quadrant containing the right</span>
                        <span class="comment">\ edge of the viewing arc</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used by the DrawTileAndObjects routine ???</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set screenLeftYawHi = T - 10</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ So screenLeftYawHi contains the yaw angle of the gaze</span>
 <span class="mne">STA</span> <a class="popup variable">screenLeftYawHi</a>    <span class="comment">\ in the centre of the viewing arc, less 14.0625 degrees</span>
                        <span class="comment">\ (i.e. 360 * 10 / 256)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The screen is 20 yaw angle units across, so this sets</span>
                        <span class="comment">\ screenLeftYawHi to the high byte of the yaw angle of</span>
                        <span class="comment">\ the left edge of the screen, reduced into the range of</span>
                        <span class="comment">\ a single 90-degree quadrant (so it's relative to the</span>
                        <span class="comment">\ 90-degree viewing arc)</span>

                        <span class="comment">\ We now set (xTileViewer, zTileViewer) to the tile</span>
                        <span class="comment">\ coordinate of the viewer (object #X), but with the</span>
                        <span class="comment">\ axes rotated to match the orientation of the viewer,</span>
                        <span class="comment">\ so the x- and z-coordinate axes are from the</span>
                        <span class="comment">\ perspective of the viewer rather than of the 3D world</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As a reminder, the degree system in the Sentinel looks</span>
                        <span class="comment">\ like this, with the z-axis pointing into the screen</span>
                        <span class="comment">\ and the x-axis pointing right:</span>
                        <span class="comment">\</span>
                        <span class="comment">\            0</span>
                        <span class="comment">\      -32   |   +32         Overhead view of player</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /             0 = looking straight ahead</span>
                        <span class="comment">\           \|/              +64 = looking sharp right</span>
                        <span class="comment">\   -64 -----+----- +64      -64 = looking sharp left</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment diff">\          / | \             ^           x-axis left --></span>
                        <span class="comment">\         /  |  \            |             to right</span>
                        <span class="comment">\      -96   |   +96         z-axis</span>
                        <span class="comment">\           128              into screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To make this easier to describe, let's label it like a</span>
                        <span class="comment">\ clock:</span>
                        <span class="comment">\</span>
                        <span class="comment">\            12</span>
                        <span class="comment">\    10.30   |    1.30</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /</span>
                        <span class="comment">\           \|/</span>
                        <span class="comment">\     9 -----+----- 3</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment">\          / | \</span>
                        <span class="comment">\         /  |  \</span>
                        <span class="comment">\     7.30   |   4.30</span>
                        <span class="comment">\            6</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now work out which quadrant contains the viewing</span>
                        <span class="comment">\ arc and set (xTileViewer, zTileViewer) to the tile</span>
                        <span class="comment">\ coordinates of the viewer, but using the axes from the</span>
                        <span class="comment">\ viewer's frame of reference/point of view</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that in the following, we subtract from 30 rather</span>
                        <span class="comment">\ than 31 because we are working with tiles rather than</span>
                        <span class="comment">\ tile corners ???</span>

 <span class="mne">BIT</span> <a class="popup variable">viewingArcRightYaw</a> <span class="comment">\ If bit 7 of the quadrant containing the right edge of</span>
 <span class="mne">BMI</span> <a class="popup destination">dlan2</a>              <span class="comment">\ the viewing arc is set, jump to dlan2</span>

 <span class="mne">BVS</span> <a class="popup destination">dlan1</a>              <span class="comment">\ If bit 6 of the quadrant containing the right edge of</span>
                        <span class="comment">\ the viewing arc is set, jump to dlan1</span>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is clear</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is clear</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 12 o'clock to 3 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the viewing direction in the middle of the arc is</span>
                        <span class="comment">\ between 10.30 and 1.30, or broadly in the direction of</span>
                        <span class="comment">\ 12 o'clock</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the standard orientation of the landscape,</span>
                        <span class="comment">\ so we can simply set the viewer coordinates to those</span>
                        <span class="comment">\ of object #X</span>

 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ Set (xTileViewer, zTileViewer) = (x, z)</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\ where object #X is on tile (x, z)</span>
 <span class="mne">STA</span> <a class="popup variable">zTileViewer</a>

 <span class="mne">JMP</span> <a class="popup destination">dlan4</a>              <span class="comment">\ Jump to dlan4 to keep going</span>

<span class="label">.dlan1</span><a id="dlan1" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is clear</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 3 o'clock to 6 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the viewing direction in the middle of the arc is</span>
                        <span class="comment">\ between 1.30 and 4.30, or broadly in the direction of</span>
                        <span class="comment">\ 3 o'clock</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If you imagine the standard 3D world, with the z-axis</span>
                        <span class="comment">\ going into the screen and the x-axis going from left</span>
                        <span class="comment">\ to right, then turning right means that from our new</span>
                        <span class="comment">\ perspective:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The axis we now see running from left to right is</span>
                        <span class="comment">\     the 3D world z-axis, but in the opposite direction</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The axis we now see going away from us is the 3D</span>
                        <span class="comment">\     world x-axis</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Therefore, from the perspective of the viewer:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-axis is the 3D world z-axis in the opposite</span>
                        <span class="comment">\     direction, which is 30 - z</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The z-axis is the 3D world x-axis, which is x</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So that's what we set now</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set (xTileViewer, zTileViewer) = (30 - z, x)</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\ where object #X is on tile (x, z)</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewer</a>
 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">zTileViewer</a>

 <span class="mne">JMP</span> <a class="popup destination">dlan4</a>              <span class="comment">\ Jump to dlan4 to keep going</span>

<span class="label">.dlan2</span><a id="dlan2" class="anchor"></a>

                        <span class="comment">\ If we get here then bit 7 of the quadrant containing</span>
                        <span class="comment">\ the right edge of the viewing arc is set</span>

 <span class="mne">BVS</span> <a class="popup destination">dlan3</a>              <span class="comment">\ If bit 6 of the quadrant containing the right edge of</span>
                        <span class="comment">\ the viewing arc is set, jump to dlan3</span>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is set</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is clear</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 6 o'clock to 9 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the viewing direction in the middle of the arc is</span>
                        <span class="comment">\ between 4.30 and 7.30, or broadly in the direction of</span>
                        <span class="comment">\ 6 o'clock</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If you imagine the standard 3D world, with the z-axis</span>
                        <span class="comment">\ going into the screen and the x-axis going from left</span>
                        <span class="comment">\ to right, then turning around to face out of the</span>
                        <span class="comment">\ screen means that from our new perspective:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The axis we now see running from left to right is</span>
                        <span class="comment">\     the 3D world x-axis, but in the opposite direction</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The axis we now see going away from us is the 3D</span>
                        <span class="comment">\     world z-axis, but in the opposite direction</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Therefore, from the perspective of the viewer:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-axis is the 3D world x-axis in the opposite</span>
                        <span class="comment">\     direction, which is 30 - x</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The z-axis is the 3D world z-axis in the opposite</span>
                        <span class="comment">\     direction, which is 30 - z</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So that's what we set now</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set (xTileViewer, zTileViewer) = (30 - x, 30 - z)</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ where object #X is on tile (x, z)</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewer</a>
 <span class="mne">CLC</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>
 <span class="mne">SBC</span> <a class="popup variable">zObject</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">zTileViewer</a>

 <span class="mne">JMP</span> <a class="popup destination">dlan4</a>              <span class="comment">\ Jump to dlan4 to keep going</span>

<span class="label">.dlan3</span><a id="dlan3" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is set</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 9 o'clock to 12 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the viewing direction in the middle of the arc is</span>
                        <span class="comment">\ between 7.30 and 10.30, or broadly in the direction of</span>
                        <span class="comment">\ 9 o'clock</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If you imagine the standard 3D world, with the z-axis</span>
                        <span class="comment">\ going into the screen and the x-axis going from left</span>
                        <span class="comment">\ to right, then turning left means that from our new</span>
                        <span class="comment">\ perspective:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The axis we now see running from left to right is</span>
                        <span class="comment">\     the 3D world z-axis</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The axis we now see going away from us is the 3D</span>
                        <span class="comment">\     world x-axis, but in the opposite direction</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Therefore, from the perspective of the viewer:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-axis is the 3D world z-axis, which is z</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The z-axis is the 3D world x-axis in the opposite</span>
                        <span class="comment">\     direction, which is 30 - x</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So that's what we set now</span>

 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\ Set (xTileViewer, zTileViewer) = (z, 30 - x)</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\</span>
 <span class="mne">CLC</span>                    <span class="comment">\ where object #X is on tile (x, z)</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>
 <span class="mne">SBC</span> <a class="popup variable">xObject</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">zTileViewer</a>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawlandscapeview-part-2-of-3" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawLandscapeView (Part 2 of 3)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Work through the landscape, drawing one row of tiles/objects at a</span>
             <span class="headerEntry">time, from the back row to the front row</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawlandscapeview_part_2_of_3.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.dlan4</span><a id="dlan4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ We now iterate through all the tile rows, from back to</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ front towards the viewer, so set a row counter in</span>
                        <span class="comment">\ zTile to iterate from 31 to 0</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileLeftPrevious</a>  <span class="comment">\ Set xTileViewLeft = xTileLeftPrevious, so we start</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ checking for the view edges, starting from the left</span>
                        <span class="comment">\ edge from the previous calculation (or from tile zero</span>
                        <span class="comment">\ if this is the first time)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This makes the search for edges more efficient as the</span>
                        <span class="comment">\ edges in neighbouring rows will be close together</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set drawingTableOffset = 0 so the call to first call</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ GetTileViewEdges (for tile row 31) will populate the</span>
                        <span class="comment">\ tables at tileViewData+0, tileViewYaw+0 and</span>
                        <span class="comment">\ tileViewPitch+0 with the angles of the tile being</span>
                        <span class="comment">\ analysed</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewEdges</a>   <span class="comment">\ For the row of tile corners at the very back of the</span>
                        <span class="comment">\ landscape from the point of view of the viewer, work</span>
                        <span class="comment">\ out the edges of the visible portion of the row in</span>
                        <span class="comment">\ the current player view, as left to right tile</span>
                        <span class="comment">\ numbers in xTileViewLeft and xTileViewRight</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We don't draw this row as it doesn't have any tiles</span>
                        <span class="comment">\ anchored by the corners, but we generate the data so</span>
                        <span class="comment">\ we can use it when drawing the tile rows below</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ Store the column number for the left edge of the</span>
 <span class="mne">STA</span> <a class="popup variable">xTileLeftPrevious</a>  <span class="comment">\ visible portion of the row in xTileLeftPrevious, so</span>
                        <span class="comment">\ we can refer to it above when we move on to the next</span>
                        <span class="comment">\ row in front</span>

                        <span class="comment">\ We now loop through each row of tile corners that has</span>
                        <span class="comment">\ a row of tiles anchored, drawing each row in turn,</span>
                        <span class="comment">\ from the back of the view to the front</span>

<span class="label">.dlan5</span><a id="dlan5" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Flip drawingTableOffset between 0 and 32, so each call</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ to GetTileViewEdges and GetTileViewAngles alternates</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ between storing the tile view data in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and storing it in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (drawViewYawHi+32 drawViewYawLo+32)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (drawViewPitchHi+32 drawViewPitchLo+32)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData+32</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This lets us store tile view data for both the current</span>
                        <span class="comment">\ row that we are drawing and the previously drawn row</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ Set xTileViewLeftEdge to the tile number of the left</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ edge of the visible portion of the row we are</span>
                        <span class="comment">\ analysing (i.e. zTile) so that we can generate results</span>
                        <span class="comment">\ for other rows without losing this information</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewRight</a>     <span class="comment">\ Set xTileViewRightEdge to the tile number of the right</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ edge of the visible portion of the row we are</span>
                        <span class="comment">\ analysing (i.e. zTile) so that we can generate results</span>
                        <span class="comment">\ for other rows without losing this information</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement zTile to the z-coordinate of the next tile</span>
                        <span class="comment">\ row forward, towards the viewer, so we can draw this</span>
                        <span class="comment">\ new row</span>

 <span class="mne">BMI</span> <a class="popup destination">dlan6</a>              <span class="comment">\ If we have already drawn all the rows from 31 to 0,</span>
                        <span class="comment">\ jump to dlan6 to return from the subroutine with the</span>
                        <span class="comment">\ C flag clear</span>

 <span class="mne">LDY</span> <a class="popup variable">zTile</a>              <span class="comment">\ If the new tile row is not the tile row that contains</span>
 <span class="mne">CPY</span> <a class="popup variable">zTileViewer</a>        <span class="comment">\ the viewer, jump to dlan7 to draw it</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan7</a>

 <span class="mne">JMP</span> <a class="popup destination">dlan18</a>             <span class="comment">\ The new tile row contains the viewer, so jump to</span>
                        <span class="comment">\ dlan18 to draw this row as a special case</span>

<span class="label">.dlan6</span><a id="dlan6" class="anchor"></a>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have drawn the</span>
                        <span class="comment">\ whole landscape</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.dlan7</span><a id="dlan7" class="anchor"></a>

                        <span class="comment">\ We now check whether the new row, which we are about</span>
                        <span class="comment">\ to draw, has the same visible portion as the</span>
                        <span class="comment">\ previously drawn row, or if whether the new row's</span>
                        <span class="comment">\ visible portion extends beyond the previous visible</span>
                        <span class="comment">\ row or doesn't extend as far</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the visible portions don't match, then we either</span>
                        <span class="comment">\ need to extend the tile data for the current row to</span>
                        <span class="comment">\ match, or we need to go back and extend the tile data</span>
                        <span class="comment">\ on the previous row to match the current row</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is so we can draw the tiles properly, as tiles</span>
                        <span class="comment">\ are made up of tiles from both the current and</span>
                        <span class="comment">\ previous rows of tile corners, so the calculate tile</span>
                        <span class="comment">\ view data needs to match between the two rows</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewEdges</a>   <span class="comment">\ For the new tile row, work out the edges of the</span>
                        <span class="comment">\ visible portion of the row in the current player view,</span>
                        <span class="comment">\ as left to right tile numbers in xTileViewLeft and</span>
                        <span class="comment">\ xTileViewRight</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ If xTileViewLeft = xTileViewLeftEdge then the left</span>
 <span class="mne">CPY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ edge of the visible row in this new row is at the same</span>
 <span class="mne">BEQ</span> <a class="popup destination">dlan11</a>             <span class="comment">\ place as in the previous row, so jump to dlan11 to</span>
                        <span class="comment">\ do the same check on the right edge</span>

 <span class="mne">BCC</span> <a class="popup destination">dlan9</a>              <span class="comment">\ If xTileViewLeft &lt; xTileViewLeftEdge then the left</span>
                        <span class="comment">\ edge of the visible row in this new row is less than</span>
                        <span class="comment">\ (i.e. to the left of) the edge in the previous row, so</span>
                        <span class="comment">\ jump to dlan9 to go back to the previous row to fetch</span>
                        <span class="comment">\ the tile data needed to make the datasets match</span>

                        <span class="comment">\ Otherwise xTileViewLeft > xTileViewLeftEdge and the</span>
                        <span class="comment">\ left edge of the visible row in this new row is</span>
                        <span class="comment">\ greater (i.e. to the right of) the edge in the</span>
                        <span class="comment">\ previous row, so we need to fetch more data on the</span>
                        <span class="comment">\ left end of the current row to make the datasets match</span>

<span class="label">.dlan8</span><a id="dlan8" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement Y to move left along the row by one tile</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">CPY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ Loop back until we have moved left along the tile row</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan8</a>              <span class="comment">\ all the way to the left edge in the previous row</span>

 <span class="mne">BEQ</span> <a class="popup destination">dlan11</a>             <span class="comment">\ Jump to dlan11 to move on to the checks on the right</span>
                        <span class="comment">\ edge (this BEQ is effectively a JMP as we just passed</span>
                        <span class="comment">\ through a BNE)</span>

<span class="label">.dlan9</span><a id="dlan9" class="anchor"></a>

                        <span class="comment">\ If we get here then xTileViewLeft &lt; xTileViewLeftEdge,</span>
                        <span class="comment">\ so we need to go back to the previous row to fetch</span>
                        <span class="comment">\ more tile data for the left end of the row, so we can</span>
                        <span class="comment">\ use it to work out what to draw for the left end of</span>
                        <span class="comment">\ the new row we are trying to draw</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is because the visible part of the new row (the</span>
                        <span class="comment">\ row in front) is extending left beyond the left edge</span>
                        <span class="comment">\ of the visible part of the previous row (the one</span>
                        <span class="comment">\ behind), so we won't have calculated the required</span>
                        <span class="comment">\ tile data for the non-visible part of the previous</span>
                        <span class="comment">\ row</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we do that now by switching back to the previous</span>
                        <span class="comment">\ row and calculating all the tile data for the tiles on</span>
                        <span class="comment">\ the left of the previous row that have visible tiles</span>
                        <span class="comment">\ in front of them in the new row</span>

 <span class="mne">LDA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Flip drawingTableOffset between 0 and 32, so the calls</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ to GetTileViewEdges and GetTileViewAngles store their</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ data into the storage area that we used for the</span>
                        <span class="comment">\ previous row, so we effectively extend the data to the</span>
                        <span class="comment">\ left for the previous row</span>

 <span class="mne">INC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Increment xTile to the tile row number behind the one</span>
                        <span class="comment">\ we are drawing, i.e. the previous row in this process</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ Set Y to the left edge for the previous row</span>

<span class="label">.dlan10</span><a id="dlan10" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement Y to move left along the row by one tile</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">CPY</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ Loop back until we have moved left along the tile row</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan10</a>             <span class="comment">\ all the way to the left edge in the new row in front</span>

 <span class="mne">STY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ Update xTileViewLeftEdge to store the newly moved edge</span>
                        <span class="comment">\ for the previous row</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement zTile once again to move back to the row</span>
                        <span class="comment">\ that we are drawing</span>

 <span class="mne">LDA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Flip drawingTableOffset back again, so the calls</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ to GetTileViewEdges and GetTileViewAngles once again</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ store data in the new row's storage area</span>

<span class="label">.dlan11</span><a id="dlan11" class="anchor"></a>

                        <span class="comment">\ By this point we have checked the left edges of the</span>
                        <span class="comment">\ current and previous rows to fill in gaps in the tile</span>
                        <span class="comment">\ data caused by the new row overlapping the previous</span>
                        <span class="comment">\ row, and we now do the exact same thing for the right</span>
                        <span class="comment">\ edges</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewRight</a>     <span class="comment">\ If xTileViewRight = xTileViewRightEdge then the right</span>
 <span class="mne">CPY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ edge of the visible row in this new row is at the same</span>
 <span class="mne">BEQ</span> <a class="popup destination">dlan15</a>             <span class="comment">\ place as in the previous row, so jump to dlan15 to</span>
                        <span class="comment">\ draw the new row as we have all the tile information</span>
                        <span class="comment">\ we need</span>

 <span class="mne">BCS</span> <a class="popup destination">dlan13</a>             <span class="comment">\ If xTileViewRight > xTileViewRightEdge then the right</span>
                        <span class="comment">\ edge of the visible row in this new row is greater</span>
                        <span class="comment">\ then (i.e. to the right of) the edge in the previous</span>
                        <span class="comment">\ row, so jump to dlan13 to go back to the previous row</span>
                        <span class="comment">\ to fetch the tile data needed to make the datasets</span>
                        <span class="comment">\ match</span>

                        <span class="comment">\ Otherwise xTileViewRight &lt; xTileViewRightEdge and the</span>
                        <span class="comment">\ right edge of the visible row in this new row is less</span>
                        <span class="comment">\ than (i.e. to the left of) the edge in the previous</span>
                        <span class="comment">\ row, so we need to fetch more data on the right end of</span>
                        <span class="comment">\ the current row to make the datasets match</span>

<span class="label">.dlan12</span><a id="dlan12" class="anchor"></a>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to move right along the row by one tile</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">CPY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Loop back until we have moved right along the tile row</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan12</a>             <span class="comment">\ all the way to the right edge in the previous row</span>

 <span class="mne">BEQ</span> <a class="popup destination">dlan15</a>             <span class="comment">\ Jump to dlan15 to draw the new row as we have all the</span>
                        <span class="comment">\ tile information we need (this BEQ is effectively a</span>
                        <span class="comment">\ JMP as we just passed through a BNE)</span>

<span class="label">.dlan13</span><a id="dlan13" class="anchor"></a>

                        <span class="comment">\ If we get here, xTileViewRight > xTileViewRightEdge,</span>
                        <span class="comment">\ so we need to go back to the previous row to fetch</span>
                        <span class="comment">\ more tile data for the right end of the row, so we can</span>
                        <span class="comment">\ use it to work out what to draw for the right end of</span>
                        <span class="comment">\ the new row we are trying to draw</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is because the visible part of the new row (the</span>
                        <span class="comment">\ row in front) is extending right beyond the right edge</span>
                        <span class="comment">\ of the visible part of the previous row (the one</span>
                        <span class="comment">\ behind), so we won't have calculated the required</span>
                        <span class="comment">\ tile data for the non-visible part of the previous</span>
                        <span class="comment">\ row</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we do that now by switching back to the previous</span>
                        <span class="comment">\ row and calculating all the tile data for the tiles on</span>
                        <span class="comment">\ the right of the previous row that have visible tiles</span>
                        <span class="comment">\ in front of them in the new row</span>

 <span class="mne">LDA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Flip drawingTableOffset between 0 and 32, so the calls</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ to GetTileViewEdges and GetTileViewAngles store their</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ data into the storage area that we used for the</span>
                        <span class="comment">\ previous row, so we effectively extend the data to the</span>
                        <span class="comment">\ left for the previous row</span>

 <span class="mne">INC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Increment xTile to the tile row number behind the one</span>
                        <span class="comment">\ we are drawing, i.e. the previous row in this process</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Set Y to the right edge for the previous row</span>

<span class="label">.dlan14</span><a id="dlan14" class="anchor"></a>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to move right along the row by one tile</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">CPY</span> <a class="popup variable">xTileViewRight</a>     <span class="comment">\ Loop back until we have moved right along the tile row</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan14</a>             <span class="comment">\ all the way to the right edge in the new row in front</span>

 <span class="mne">STY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Update xTileViewRightEdge to store the newly moved</span>
                        <span class="comment">\ edge for the previous row</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement zTile once again to move back to the row</span>
                        <span class="comment">\ that we are drawing</span>

 <span class="mne">LDA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Flip drawingTableOffset back again, so the calls</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ to GetTileViewEdges and GetTileViewAngles once again</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ store data in the new row's storage area</span>

<span class="label">.dlan15</span><a id="dlan15" class="anchor"></a>

                        <span class="comment">\ By this point we have ensured that we have all the</span>
                        <span class="comment">\ tile data that we need to draw the new row</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeRow</a>   <span class="comment">\ Draw the tile row at z-coordinate zTile, between tiles</span>
                        <span class="comment">\ xTileViewLeftEdge and xTileViewRightEdge, including</span>
                        <span class="comment">\ any objects on any of the tiles</span>

 <span class="mne">BIT</span> <a class="popup variable">keepCheckingPanKey</a> <span class="comment">\ If bit 7 of keepCheckingPanKey is clear then we should</span>
 <span class="mne">BPL</span> <a class="popup destination">dlan16</a>             <span class="comment">\ keep drawing the landscape irrespective of whether the</span>
                        <span class="comment">\ pan key is still being pressed, so jump to dlan16 to</span>
                        <span class="comment">\ jump back to dlan5 to keep drawing the landscape</span>

                        <span class="comment">\ If we get here then we need to check whether the same</span>
                        <span class="comment">\ pan key is still being held down, and abort the</span>
                        <span class="comment">\ drawing process if it isn't (this happens if the</span>
                        <span class="comment">\ player initiates a pan, thus triggering this drawing</span>
                        <span class="comment">\ process, but releases the key before the drawing has</span>
                        <span class="comment">\ finished, in which case we don't need to finish off</span>
                        <span class="comment">\ drawing the landscape)</span>

 <span class="mne">JSR</span> <a class="popup destination">CheckForSamePanKey</a> <span class="comment">\ Check to see whether the same pan key is being</span>
                        <span class="comment">\ held down compared to the last time we checked</span>

 <span class="mne">BNE</span> <a class="popup destination">dlan17</a>             <span class="comment">\ If the same pan key is not being held down, jump to</span>
                        <span class="comment">\ dlan17 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set to indicate that this is the case</span>

<span class="label">.dlan16</span><a id="dlan16" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">dlan5</a>              <span class="comment">\ Loop back to dlan5 to analyse and draw the next tile</span>
                        <span class="comment">\ row forward, towards the viewer</span>

<span class="label">.dlan17</span><a id="dlan17" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that we are aborting the</span>
                        <span class="comment">\ drawing of the landscape as the panning key is no</span>
                        <span class="comment">\ longer being held down</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawlandscapeview-part-3-of-3" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawLandscapeView (Part 3 of 3)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a tile row in two parts, one on either side of the viewer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawlandscapeview_part_3_of_3.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.dlan18</span><a id="dlan18" class="anchor"></a>

                        <span class="comment">\ If we get here then the tile row we are drawing</span>
                        <span class="comment">\ contains the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The viewer can only see one half of the row, because</span>
                        <span class="comment">\ they are standing on it, so we need to work out which</span>
                        <span class="comment">\ half this is (if they can see any of the row at all)</span>
                        <span class="comment">\ and then draw it</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We don't draw the viewer's tile yet, as we do that</span>
                        <span class="comment">\ later</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ Set Y to the tile number just inside the left edge of</span>
 <span class="mne">INY</span>                    <span class="comment">\ the visible portion of the row</span>

 <span class="mne">CPY</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\ If this isn't the viewer's tile, jump to dlan19 to</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan19</a>             <span class="comment">\ perform the same check on the right side</span>

                        <span class="comment">\ If we get here then the visible part of the viewer's</span>
                        <span class="comment">\ tile row starts on the tile just to the left of their</span>
                        <span class="comment">\ position, so we are looking left and should draw that</span>
                        <span class="comment">\ part of the visible row</span>

 <span class="mne">STY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Set the right edge to the viewer's tile, so we draw</span>
                        <span class="comment">\ from the left edge up to (but not including) the</span>
                        <span class="comment">\ viewer's tile</span>

 <span class="mne">JMP</span> <a class="popup destination">dlan20</a>             <span class="comment">\ Jump to dlan20 to draw the tile row containing the</span>
                        <span class="comment">\ viewer</span>

<span class="label">.dlan19</span><a id="dlan19" class="anchor"></a>

                        <span class="comment">\ If we get here then the left edge is not just to the</span>
                        <span class="comment">\ left of the viewer, so now we check the right edge</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Set Y to the tile number that's two to the left of the</span>
 <span class="mne">DEY</span>                    <span class="comment">\ right edge of the visible portion</span>
 <span class="mne">DEY</span>

 <span class="mne">CPY</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\ If this isn't the viewer's tile, jump to dlan21 to</span>
 <span class="mne">BNE</span> <a class="popup destination">dlan21</a>             <span class="comment">\ skip drawing the tile row altogether, as we can't see</span>
                        <span class="comment">\ it to the left or the right (so instead we move on to</span>
                        <span class="comment">\ drawing the player's tile)</span>

                        <span class="comment">\ If we get here then the visible part of the viewer's</span>
                        <span class="comment">\ tile row starts on the tile just to the right of their</span>
                        <span class="comment">\ position, so we are looking right and should draw that</span>
                        <span class="comment">\ part of the visible row</span>

 <span class="mne">INY</span>                    <span class="comment">\ Set the left edge to the tile just right of the</span>
 <span class="mne">STY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ viewer's tile, so we draw from just right of the</span>
                        <span class="comment">\ viewer's tile to the right edge</span>

<span class="label">.dlan20</span><a id="dlan20" class="anchor"></a>

                        <span class="comment">\ We now draw the tile row containing the viewer, but</span>
                        <span class="comment">\ first we need to ensure we have the data for the tiles</span>
                        <span class="comment">\ at each end</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ Set Y to the left edge of the viewer's tile row</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Set Y to the right edge of the viewer's tile row</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeRow</a>   <span class="comment">\ Draw the tile row at z-coordinate zTile, between tiles</span>
                        <span class="comment">\ xTileViewLeftEdge and xTileViewRightEdge, including</span>
                        <span class="comment">\ any objects on any of the tiles</span>

<span class="label">.dlan21</span><a id="dlan21" class="anchor"></a>

                        <span class="comment">\ We now draw the tile row beneath the viewer, but first</span>
                        <span class="comment">\ we need to ensure we have the data for the tile just</span>
                        <span class="comment">\ in front of it</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set drawingTableOffset = 0 so the following call to</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ GetTileViewAngles (which we call to fetch the data for</span>
                        <span class="comment">\ the tile corner row in front of viewer) will populate</span>
                        <span class="comment">\ the tables at tileViewYaw+0 and tileViewPitch+0</span>

 <span class="mne">INC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Increment the row number so it's the row in front of</span>
                        <span class="comment">\ the viewer</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\ Set Y to the tile column for the viewer's tile, so we</span>
                        <span class="comment">\ can fetch the tile data for the tile directly in front</span>
                        <span class="comment">\ of the viewer</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

                        <span class="comment">\ By this point we have the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The tables at tileViewYaw+0 and tileViewPitch+0</span>
                        <span class="comment">\     contain data for the tile corner row in front of</span>
                        <span class="comment">\     the viewer, i.e. for the front edge of the tile on</span>
                        <span class="comment">\     which the viewer sits</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The tables at tileViewYaw+32 and tileViewPitch+32</span>
                        <span class="comment">\     contain data for the tile corner row containing</span>
                        <span class="comment">\     the viewer, i.e. for the rear edge of the tile on</span>
                        <span class="comment">\     which the viewer sits</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Y is the offset of the viewer's tile within these</span>
                        <span class="comment">\ tables, so, for example:</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * drawViewPitchHi,Y is the corner at the front</span>
                        <span class="comment">\      left of the viewer's tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * drawViewPitchHi+1,Y is the corner at the front</span>
                        <span class="comment">\      right of the viewer's tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * drawViewPitchHi+32,Y is the corner at the rear</span>
                        <span class="comment">\      left of the viewer's tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * drawViewPitchHi+32+1,Y is the corner at the rear</span>
                        <span class="comment">\      right of the viewer's tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now set up the angles for the tile to ensure that</span>
                        <span class="comment">\ it looks correct</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\ If the high byte of the pitch angle of the front-left</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ edge of the viewer's tile is 2 or more, then it is off</span>
 <span class="mne">BCS</span> <a class="popup destination">dlan22</a>             <span class="comment">\ the top of the screen, so jump to dlan22 to skip</span>
                        <span class="comment">\ drawing it and instead return from the subroutine ???</span>

 <span class="mne">STA</span> <a class="popup variable">drawViewPitchHi</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">Y</span>    <span class="comment">\ Set the pitch angle for the tile corner in the</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>      <span class="comment">\ front-right corner of the viewer's tile to be the</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchLo</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">Y</span>    <span class="comment">\ same as the front-left corner, so this ensures</span>
                            <span class="comment">\ that the two front corners of the tile containing</span>
                            <span class="comment">\ the viewer are horizontally level</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set drawingTableOffset = 0 so the following call to</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ DrawFlatTile (for the tile row beneath the viewer)</span>
                        <span class="comment">\ will fetch data from the tables at tileViewData+32,</span>
                        <span class="comment">\ tileViewYaw+32 and tileViewPitch+32</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement the row number so it goes back to the row</span>
                        <span class="comment">\ containing the viewer</span>

                        <span class="comment">\ We now position the corners of the viewer's tile so</span>
                        <span class="comment">\ it spreads to the left and right screen edges and</span>
                        <span class="comment">\ appears to dip down behind the viewer (so it spreads</span>
                        <span class="comment">\ down to the bottom of the screen as well)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&FF</span>                       <span class="comment">\ Set the pitch angle for the two rear tile</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchHi</a><span class="operator">+</span><span class="decimal">32</span>,<span class="register">Y</span>       <span class="comment">\ corners to be as low down as possible (as the</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchHi</a><span class="operator">+</span><span class="decimal">32</span><span class="operator">+</span><span class="decimal">1</span>,<span class="register">Y</span>     <span class="comment">\ high byte of &FF makes the angle negative)</span>

 <span class="mne">STA</span> <a class="popup variable">drawViewYawHi</a><span class="operator">+</span><span class="decimal">32</span>,<span class="register">Y</span> <span class="comment">\ Set the yaw angle for the two left tile corners to be</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>    <span class="comment">\ as far left as possible</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">20</span>                    <span class="comment">\ Set the yaw angle for the two right tile corners</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawHi</a><span class="operator">+</span><span class="decimal">32</span><span class="operator">+</span><span class="decimal">1</span>,<span class="register">Y</span>   <span class="comment">\ to 20, which is a full screen width, so this puts</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawHi</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">Y</span>      <span class="comment">\ them on the right edge of the screen</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\ Set xTileToDraw to the column of the viewer's tile, so</span>
 <span class="mne">STA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ the call to DrawFlatTile draws this tile</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawFlatTile</a>       <span class="comment">\ Draw the flat tile under the viewer</span>

<span class="label">.dlan22</span><a id="dlan22" class="anchor"></a>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have drawn the</span>
                        <span class="comment">\ whole landscape</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-quadrantoffsets" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">quadrantOffsets</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Offsets into the tile view data tables for the four different</span>
             <span class="headerEntry">viewing directions</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/quadrantoffsets.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_1_of_3.html">DrawLandscapeView (Part 1 of 3)</a> uses <a href="#quadrantoffsets">quadrantOffsets</a></span>
</div>
</div></div>
<span class="label">.quadrantOffsets</span><a id="quadrantoffsets" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Looking at 12 o'clock (front left corner)</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Looking at 3 o'clock (front right corner)</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span> <span class="operator">+</span> <span class="decimal">1</span>            <span class="comment">\ Looking at 6 o'clock (rear right corner)</span>

 <span class="mne">EQUB</span> <span class="decimal">32</span>                <span class="comment">\ Looking at 9 o'clock (rear left corner)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileviewedges" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileViewEdges</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">For a given tile row, work out the edges of the visible portion of</span>
             <span class="headerEntry">the row in the current player view, as left to right tile numbers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileviewedges.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_2_of_3.html">DrawLandscapeView (Part 2 of 3)</a> calls <a href="#gettileviewedges">GetTileViewEdges</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">xTileViewLeft</span>        <span class="argumentEntry">The tile column of the tile we are analysing, from the</span>
                        <span class="argumentEntry">perspective of the viewer, to be used as a starting</span>
                        <span class="argumentEntry">point for working out the visible edges of the row</span>

   <span class="argumentLabel">zTile</span>                <span class="argumentEntry">The tile row of the tile we are analysing, from the</span>
                        <span class="argumentEntry">perspective of the viewer</span>

   <span class="argumentLabel">drawingTableOffset</span>   <span class="argumentEntry">Defines where we store the results of the analysis in</span>
                        <span class="argumentEntry">the tileViewData, tileViewYaw and tileViewPitch drawing</span>
                        <span class="argumentEntry">data tables; each table contains two complete sets of</span>
                        <span class="argumentEntry">tile data, with the first table at offset 0 and the</span>
                        <span class="argumentEntry">second table at offset 32, so we store the results</span>
                        <span class="argumentEntry">as follows:</span>

                        <span class="argumentEntry">  * 0 = store the results in the first table</span>
                        <span class="argumentEntry">        e.g. in the 32-byte table at tileViewData</span>

                        <span class="argumentEntry">  * 32 = store the results in the second table</span>
                        <span class="argumentEntry">        e.g. in the 32-byte table at tileViewData+32</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">xTileViewLeft</span>        <span class="argumentEntry">The number of the tile column on this row that appears</span>
                        <span class="argumentEntry">at the left edge of the screen</span>

   <span class="argumentLabel">xTileViewRight</span>       <span class="argumentEntry">The number of the tile column on this row that appears</span>
                        <span class="argumentEntry">at the right edge of the screen</span>

   <span class="argumentLabel">tileViewData</span>         <span class="argumentEntry">Tile data for all the tile corners analysed while</span>
                        <span class="argumentEntry">looking for the edges</span>

   <span class="argumentLabel">drawViewYaw(Hi Lo)</span>   <span class="argumentEntry">The yaw angles for all the tile corners analysed while</span>
                        <span class="argumentEntry">looking for the edges</span>

   <span class="argumentLabel">drawViewPitchHi</span>      <span class="argumentEntry">High byte of the pitch angles for all the tile corners</span>
                        <span class="argumentEntry">analysed while looking for the edges</span>

   <span class="argumentLabel">drawViewPitchLo</span>      <span class="argumentEntry">Low byte of the pitch angles for all the tile corners</span>
                        <span class="argumentEntry">analysed while looking for the edges</span>

   <span class="argumentLabel">tileIsOnScreen</span>       <span class="argumentEntry">Information on whether a tile corner is on-screen for</span>
                        <span class="argumentEntry">all the tile corners analysed while looking for the</span>
                        <span class="argumentEntry">edges</span>

</div></div>
<span class="label">.GetTileViewEdges</span><a id="gettileviewedges" class="anchor"></a>

                        <span class="comment">\ This routine may need clarifying, as the algorithm</span>
                        <span class="comment">\ doesn't seem to make sense - it's possible that I've</span>
                        <span class="comment">\ misinterpreted how GetTileViewAngles sets the bits in</span>
                        <span class="comment">\ tileIsOnScreen, as that uses bufferMinYaw(Hi Lo) for</span>
                        <span class="comment">\ the calculation and those values are not completely</span>
                        <span class="comment">\ understood ??? </span>

 <span class="mne">LDY</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ Set Y to the tile column so we can pass it to the</span>
                        <span class="comment">\ GetTileViewAngles routine</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Calculate the pitch and yaw angles for the tile corner</span>
                        <span class="comment">\ at (Y, zTile), from the perspective of the viewer, and</span>
                        <span class="comment">\ store them in the following tables in the relevant</span>
                        <span class="comment">\ entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>

 <span class="mne">BEQ</span> <a class="popup destination">edge5</a>              <span class="comment">\ If A = %00000000 then the tile is not on-screen and is</span>
                        <span class="comment">\ past the left edge of the screen, so jump to edge5 to</span>
                        <span class="comment">\ move right from this point, looking for a tile that's</span>
                        <span class="comment">\ on-screen</span>

                        <span class="comment">\ If we get here then our chosen starting tile is either</span>
                        <span class="comment">\ on-screen or off the right edge of the screen</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ If A = %10000000 then the tile is on-screen, so jump</span>
 <span class="mne">BEQ</span> <a class="popup destination">edge4</a>              <span class="comment">\ to edge4 to update xTileViewRight to this position and</span>
                        <span class="comment">\ start moving left, so we work through the portion to</span>
                        <span class="comment">\ the left of the starting point</span>

                        <span class="comment">\ If we get here then tileIsOnScreen = %10000001 and the</span>
                        <span class="comment">\ tile is not on-screen and is past the right edge of</span>
                        <span class="comment">\ the screen, so fall through into edge1 to start moving</span>
                        <span class="comment">\ right</span>

<span class="label">.edge1</span><a id="edge1" class="anchor"></a>

                        <span class="comment">\ If we get here then we keep moving right, updating</span>
                        <span class="comment">\ xTileViewLeft as we go</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We keep moving until:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's on-screen or reach the end</span>
                        <span class="comment">\     of the tile row, in which case we jump to edge3 to</span>
                        <span class="comment">\     set xTileViewRight and return from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's off the left of the screen,</span>
                        <span class="comment">\     in which case we fall through into edge2</span>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the current column number in xTileViewLeft</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewLeft</a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileEdgeToRight</a> <span class="comment">\ Move one tile to the right and calculate the pitch and</span>
                        <span class="comment">\ yaw angles for the tile corner from the perspective of</span>
                        <span class="comment">\ the viewer, and store them in the following tables in</span>
                        <span class="comment">\ the relevant entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The C flag is set if we have already reached the end</span>
                        <span class="comment">\ of the row and can't move any further right</span>

 <span class="mne">BCS</span> <a class="popup destination">edge3</a>              <span class="comment">\ If we just moved off the right end of the row then the</span>
                        <span class="comment">\ right end of the row is visible on-screen, so jump to</span>
                        <span class="comment">\ edge3 to set xTileViewRight accordingly and return</span>
                        <span class="comment">\ from the subroutine</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%10000001</span>         <span class="comment">\ If A = %10000001 then the tile is past the right edge</span>
 <span class="mne">BEQ</span> <a class="popup destination">edge1</a>              <span class="comment">\ of the screen, so loop back to move right by one more</span>
                        <span class="comment">\ tile</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ If A = %10000000 then the tile is on-screen, so jump</span>
 <span class="mne">BEQ</span> <a class="popup destination">edge3</a>              <span class="comment">\ to edge3 to set xTileViewRight accordingly and return</span>
                        <span class="comment">\ from the subroutine</span>

                        <span class="comment">\ If we get here then A must be %00000000 and the tile</span>
                        <span class="comment">\ is off the left edge of the screen, so fall through</span>
                        <span class="comment">\ into edge2 to keep moving right</span>

<span class="label">.edge2</span><a id="edge2" class="anchor"></a>

                        <span class="comment">\ If we get here then we keep moving right until:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's on-screen or reach the end</span>
                        <span class="comment">\     of the tile row, in which case we jump to edge3 to</span>
                        <span class="comment">\     set xTileViewRight and return from the subroutine</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileEdgeToRight</a> <span class="comment">\ Move one tile to the right and calculate the pitch and</span>
                        <span class="comment">\ yaw angles for the tile corner from the perspective of</span>
                        <span class="comment">\ the viewer, and store them in the following tables in</span>
                        <span class="comment">\ the relevant entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The C flag is set if we have already reached the end</span>
                        <span class="comment">\ of the row and can't move any further right</span>

 <span class="mne">BCS</span> <a class="popup destination">edge3</a>              <span class="comment">\ If we just moved off the right end of the row then the</span>
                        <span class="comment">\ right end of the row is visible on-screen, so jump to</span>
                        <span class="comment">\ edge3 to set xTileViewRight accordingly and return</span>
                        <span class="comment">\ from the subroutine</span>

 <span class="mne">BEQ</span> <a class="popup destination">edge2</a>              <span class="comment">\ If A = %00000000 then the new tile is not visible, so</span>
                        <span class="comment">\ loop back to edge2 to keep moving right</span>

                        <span class="comment">\ Otherwise the tile is either visible or off the right</span>
                        <span class="comment">\ edge, so fall through into edge3 to set xTileViewRight</span>
                        <span class="comment">\ accordingly and return from the subroutine</span>

<span class="label">.edge3</span><a id="edge3" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the current column number in xTileViewRight</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewRight</a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.edge4</span><a id="edge4" class="anchor"></a>

                        <span class="comment">\ If we get here then we keep moving left, updating</span>
                        <span class="comment">\ xTileViewRight as we go</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We keep moving until:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We reach the start of the tile row, in which case</span>
                        <span class="comment">\     we jump to edge9 to set xTileViewLeft and return</span>
                        <span class="comment">\     from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's on-screen, in which case we</span>
                        <span class="comment">\     jump to edge4 to update xTileViewRight and keep</span>
                        <span class="comment">\     moving left</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's off the right of the screen,</span>
                        <span class="comment">\     in which case jump to edge9 to set xTileViewLeft</span>
                        <span class="comment">\     and return from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's off the left of the screen,</span>
                        <span class="comment">\     in which case jump to edge7 to move left until we</span>
                        <span class="comment">\     find a visible tile or run out of row</span>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the current column number in xTileViewRight</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewRight</a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileEdgeToLeft</a>  <span class="comment">\ Move one tile to the left and calculate the pitch and</span>
                        <span class="comment">\ yaw angles for the tile corner from the perspective of</span>
                        <span class="comment">\ the viewer, and store them in the following tables in</span>
                        <span class="comment">\ the relevant entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The C flag is set if we have already reached the start</span>
                        <span class="comment">\ of the row and can't move any further left</span>

 <span class="mne">BCS</span> <a class="popup destination">edge9</a>              <span class="comment">\ If we just moved off the left end of the row then the</span>
                        <span class="comment">\ left end of the row is visible on-screen, so jump to</span>
                        <span class="comment">\ edge9 to set xTileViewLeft accordingly and return from</span>
                        <span class="comment">\ the subroutine</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ If A = %10000000 then the tile is on-screen, so jump</span>
 <span class="mne">BEQ</span> <a class="popup destination">edge4</a>              <span class="comment">\ to edge4 to update xTileViewRight and keep moving left</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00000000</span>         <span class="comment">\ If A = %10000001 then the tile is off the right edge</span>
 <span class="mne">JMP</span> <a class="popup destination">edge8</a>              <span class="comment">\ of the screen, so jump to edge8 to set xTileViewLeft</span>
                        <span class="comment">\ accordingly and return from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If A = %00000000 then the tile is off the left edge of</span>
                        <span class="comment">\ the screen, so jump to edge8 and on to edge7 to move</span>
                        <span class="comment">\ left until we find a visible tile or run out of row</span>

<span class="label">.edge5</span><a id="edge5" class="anchor"></a>

                        <span class="comment">\ If we get here then we keep moving right until:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's on-screen or reach the end</span>
                        <span class="comment">\     of the tile row, in which case we jump to edge6 to</span>
                        <span class="comment">\     set xTileViewRight and start working left from</span>
                        <span class="comment">\     xTileViewLeft until we find a visible tile or run</span>
                        <span class="comment">\     out of row</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileEdgeToRight</a> <span class="comment">\ Move one tile to the right and calculate the pitch and</span>
                        <span class="comment">\ yaw angles for the tile corner from the perspective of</span>
                        <span class="comment">\ the viewer, and store them in the following tables in</span>
                        <span class="comment">\ the relevant entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The C flag is set if we have already reached the end</span>
                        <span class="comment">\ of the row and can't move any further right</span>

 <span class="mne">BCS</span> <a class="popup destination">edge6</a>              <span class="comment">\ If we just moved off the right end of the row then the</span>
                        <span class="comment">\ right end of the row is visible on-screen, so jump to</span>
                        <span class="comment">\ edge3 to set xTileViewRight accordingly and start</span>
                        <span class="comment">\ moving left from the current left edge value in</span>
                        <span class="comment">\ xTileViewLeft</span>

 <span class="mne">BEQ</span> <a class="popup destination">edge5</a>              <span class="comment">\ If the new tile is not visible and off to the left of</span>
                        <span class="comment">\ the screen then loop back to edge5 to keep moving</span>
                        <span class="comment">\ right</span>

                        <span class="comment">\ If we get here then we have now found a visible tile</span>
                        <span class="comment">\ by moving right, so store that in xTileViewRight and</span>
                        <span class="comment">\ start moving left</span>

<span class="label">.edge6</span><a id="edge6" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the current column number in xTileViewRight</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewRight</a>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewLeft</a>      <span class="comment">\ Set xTile to the value of xTileViewLeft so we can</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ start moving left from this point</span>

<span class="label">.edge7</span><a id="edge7" class="anchor"></a>

                        <span class="comment">\ If we get here then we keep moving left until:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We find a tile that's on-screen or reach the end</span>
                        <span class="comment">\     of the tile row, in which case we set</span>
                        <span class="comment">\     xTileViewLeft and return from the subroutine</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileEdgeToLeft</a>  <span class="comment">\ Move one tile to the left and calculate the pitch and</span>
                        <span class="comment">\ yaw angles for the tile corner from the perspective of</span>
                        <span class="comment">\ the viewer, and store them in the following tables in</span>
                        <span class="comment">\ the relevant entry for this tile corner:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * drawViewPitch(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileViewData</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileIsOnScreen (also returned in A and the Z flag)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The C flag is set if we have already reached the start</span>
                        <span class="comment">\ of the row and can't move any further left</span>

 <span class="mne">BCS</span> <a class="popup destination">edge9</a>              <span class="comment">\ If we just moved off the left end of the row then the</span>
                        <span class="comment">\ left end of the row is visible on-screen, so jump to</span>
                        <span class="comment">\ edge9 to set xTileViewLeft accordingly and return from</span>
                        <span class="comment">\ the subroutine</span>

<span class="label">.edge8</span><a id="edge8" class="anchor"></a>

 <span class="mne">BEQ</span> <a class="popup destination">edge7</a>              <span class="comment">\ If the new tile is not visible then loop back to edge7</span>
                        <span class="comment">\ to keep moving left</span>

<span class="label">.edge9</span><a id="edge9" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the current column number in xTileViewLeft</span>
 <span class="mne">STA</span> <a class="popup variable">xTileViewLeft</a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileedgetoleft" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileEdgeToLeft</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Move one tile to the left along the tile row that we are analysing</span>
             <span class="headerEntry">for view edges and tile angles</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileedgetoleft.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileviewedges.html">GetTileViewEdges</a> calls <a href="#gettileedgetoleft">GetTileEdgeToLeft</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileedgetoright.html">GetTileEdgeToRight</a> calls via <a href="#prev1">prev1</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">prev1</span>                <span class="argumentEntry">Return from the subroutine with the C flag set</span>

</div></div>
<span class="label">.prev1</span><a id="prev1" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that we have reached the</span>
                        <span class="comment">\ end of the tile row</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.GetTileEdgeToLeft</span><a id="gettileedgetoleft" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set Y to the column of the tile corner we are</span>
                        <span class="comment">\ currently analysing when looking for the view edges</span>
                        <span class="comment">\ and calculating the tile's pitch and yaw angles</span>

 <span class="mne">BEQ</span> <a class="popup destination">prev1</a>              <span class="comment">\ If Y = 0 then we are already at the left end of the</span>
                        <span class="comment">\ tile row and can't move any further left, so jump to</span>
                        <span class="comment">\ prev1 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Otherwise decrement Y to move one tile to the left</span>

 <span class="mne">JMP</span> <a class="popup destination">GetTileViewAngles</a>  <span class="comment">\ Jump to GetTileViewAngles to analyse the new corner to</span>
                        <span class="comment">\ look for the view edges and calculate the tile's pitch</span>
                        <span class="comment">\ and yaw angles, and return from the subroutine with</span>
                        <span class="comment">\ the C flag clear</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileedgetoright" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileEdgeToRight</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Move one tile to the right along the tile row that we are</span>
             <span class="headerEntry">analysing for view edges and tile angles</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileedgetoright.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileviewedges.html">GetTileViewEdges</a> calls <a href="#gettileedgetoright">GetTileEdgeToRight</a></span>
</div>
</div></div>
<span class="label">.GetTileEdgeToRight</span><a id="gettileedgetoright" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set Y to the column of the tile corner we are</span>
                        <span class="comment">\ currently analysing when looking for the view edges</span>
                        <span class="comment">\ and calculating the tile's pitch and yaw angles</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to move one tile to the right</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ If Y = 32 then we have gone past the end of the tile</span>
 <span class="mne">BEQ</span> <a class="popup destination">prev1</a>              <span class="comment">\ row and can't move any further tight, so jump to prev1</span>
                        <span class="comment">\ to return from the subroutine with the C flag set</span>

                        <span class="comment">\ Otherwise fall through into GetTileViewAngles to</span>
                        <span class="comment">\ analyse the new corner to look for the view edges and</span>
                        <span class="comment">\ calculate the tile's pitch and yaw angles, and return</span>
                        <span class="comment">\ from the subroutine with the C flag clear</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileviewangles-part-1-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileViewAngles (Part 1 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the pitch and yaw angles for a tile corner, relative to</span>
             <span class="headerEntry">a viewer object (e.g. the player), and whether it is on-screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileviewangles_part_1_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_2_of_3.html">DrawLandscapeView (Part 2 of 3)</a> calls <a href="#gettileviewangles">GetTileViewAngles</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_3_of_3.html">DrawLandscapeView (Part 3 of 3)</a> calls <a href="#gettileviewangles">GetTileViewAngles</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileedgetoleft.html">GetTileEdgeToLeft</a> calls <a href="#gettileviewangles">GetTileViewAngles</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileviewedges.html">GetTileViewEdges</a> calls <a href="#gettileviewangles">GetTileViewAngles</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The tile column of the tile we are analysing, from the</span>
                        <span class="argumentEntry">perspective of the viewer</span>

   <span class="argumentLabel">zTile</span>                <span class="argumentEntry">The tile row of the tile we are analysing, from the</span>
                        <span class="argumentEntry">perspective of the viewer</span>

   <span class="argumentLabel">drawingTableOffset</span>   <span class="argumentEntry">Defines where we store the results of the analysis in</span>
                        <span class="argumentEntry">the tileViewData, tileViewYaw and tileViewPitch drawing</span>
                        <span class="argumentEntry">data tables; each table contains two complete sets of</span>
                        <span class="argumentEntry">tile data, with the first table at offset 0 and the</span>
                        <span class="argumentEntry">second table at offset 32, so we store the results</span>
                        <span class="argumentEntry">as follows:</span>

                        <span class="argumentEntry">  * 0 = store the results in the first table</span>
                        <span class="argumentEntry">        e.g. in the 32-byte table at tileViewData</span>

                        <span class="argumentEntry">  * 32 = store the results in the second table</span>
                        <span class="argumentEntry">        e.g. in the 32-byte table at tileViewData+32</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">tileViewData</span>         <span class="argumentEntry">Tile data for this tile corner, stored in the relevant</span>
                        <span class="argumentEntry">entry for this tile corner</span>

   <span class="argumentLabel">drawViewYaw(Hi Lo)</span>   <span class="argumentEntry">The yaw angle, stored in the relevant entry for this</span>
                        <span class="argumentEntry">tile corner</span>

   <span class="argumentLabel">drawViewPitchHi</span>      <span class="argumentEntry">High byte of the pitch angle, stored in the relevant</span>
                        <span class="argumentEntry">entry for this tile corner</span>

   <span class="argumentLabel">drawViewPitchLo</span>      <span class="argumentEntry">Low byte of the pitch angle, stored in the relevant</span>
                        <span class="argumentEntry">entry for this tile corner</span>

   <span class="argumentLabel">tileIsOnScreen</span>       <span class="argumentEntry">Determines whether the tile corner is on-screen (i.e.</span>
                        <span class="argumentEntry">within the max and min yaw angle limits):</span>

                        <span class="argumentEntry">  * %00000000 = tile is not on-screen and is past the</span>
                        <span class="argumentEntry">                left edge of the screen</span>

                        <span class="argumentEntry">  * %10000000 = tile is on-screen</span>

                        <span class="argumentEntry">  * %10000001 = tile is not on-screen and is past the</span>
                        <span class="argumentEntry">                right edge of the screen</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The value of tileIsOnScreen is also returned in A</span>

   <span class="argumentLabel">Z flag</span>               <span class="argumentEntry">The Z flag is set according to the value of</span>
                        <span class="argumentEntry">tileIsOnScreen, so a BNE or BEQ following the call to</span>
                        <span class="argumentEntry">GetTileViewAngles will act accordingly</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">The C flag is clear to indicate that we have not gone</span>
                        <span class="argumentEntry">past the end of the tile row, which is used when calling</span>
                        <span class="argumentEntry">this routine via GetTileEdgeToLeft or GetTileEdgeToRight</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">Y is preserved</span>

</div></div>
<span class="label">.GetTileViewAngles</span><a id="gettileviewangles" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">xTile</a>              <span class="comment">\ Store the tile column in xTile, so we can analyse the</span>
                        <span class="comment">\ tile at (xTile, zTile)</span>

 <span class="mne">STY</span> <a class="popup variable">yStoreTileView</a>     <span class="comment">\ Store Y in yStoreTileView so it can be preserved</span>
                        <span class="comment">\ across calls to the routine</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set drawingTableIndex = Y + drawingTableOffset</span>
 <span class="mne">ORA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ So drawingTableIndex is the index into the drawing</span>
                        <span class="comment">\ tables for the tile we are analysing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set tileIsOnScreen = 0, so the default is that the</span>
 <span class="mne">STA</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ tile is not on-screen (we change this in part 3 if it</span>
                        <span class="comment">\ is on-screen)</span>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the number of the object that is viewing the</span>
                        <span class="comment">\ landscape</span>

                        <span class="comment">\ We start by calculating the difference (the delta) in</span>
                        <span class="comment">\ the x-axis between the viewer and the tile we are</span>
                        <span class="comment">\ analysing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">128</span>               <span class="comment">\ Set the low byte of xDelta(Hi Lo) to 128</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the high byte of xDelta(Hi Lo) to the</span>
 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ following:</span>
 <span class="mne">SBC</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\</span>
 <span class="mne">SEC</span>                    <span class="comment">\   xTile - xTileViewer - 1 - xTitleOffset</span>
 <span class="mne">SBC</span> <a class="popup variable">xTitleOffset</a>       <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaHi</a>           <span class="comment">\ Note that xTitleOffset is zero during gameplay, and is</span>
                        <span class="comment">\ only non-zero when we are drawing large 3D text on the</span>
                        <span class="comment">\ title screen, so let's ignore it for now to keep</span>
                        <span class="comment">\ things simple</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Setting the low byte to 128 effectively adds 0.5 to</span>
                        <span class="comment">\ the result, so we get this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xDelta(Hi Lo) = xTile - xTileViewer - 0.5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this is the delta along the x-axis between the</span>
                        <span class="comment">\ viewer and the tile that we are analysing</span>

 <span class="mne">BPL</span> <a class="popup destination">tang1</a>              <span class="comment">\ If the result is positive then jump to tang1 to skip</span>
                        <span class="comment">\ the following</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Negate the result to make it positive, so we now have:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\   (A xDeltaLo) = |xTile - xTileViewer - 0.5|</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">SBC</span> <a class="popup variable">xDeltaHi</a>

<span class="label">.tang1</span><a id="tang1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xDeltaAbsoluteHi</a>   <span class="comment">\ Set xDeltaAbsoluteHi = |xDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute z-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (xDeltaAbsoluteHi xDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed x-axis length</span>
                        <span class="comment">\ is still in xDeltaHi</span>

                        <span class="comment">\ We now do the same thing but for the z-axis, so that</span>
                        <span class="comment">\ zDelta contains the difference (the delta) in the</span>
                        <span class="comment">\ z-axis between the viewer and the tile we are</span>
                        <span class="comment">\ analysing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">128</span>               <span class="comment">\ Set the low byte of zDelta(Hi Lo) to 128</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaLo</a>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the high byte of zDelta(Hi Lo) to the</span>
 <span class="mne">LDA</span> <a class="popup variable">zTile</a>              <span class="comment">\ following:</span>
 <span class="mne">SBC</span> <a class="popup variable">zTileViewer</a>        <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaHi</a>           <span class="comment">\   zTile - zTileViewer - 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Setting the low byte to 128 effectively adds 0.5 to</span>
                        <span class="comment">\ the result, so we get this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   zDelta(Hi Lo) = zTile - zTileViewer - 0.5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this is the delta along the z-axis between the</span>
                        <span class="comment">\ viewer and the tile that we are analysing</span>

 <span class="mne">BPL</span> <a class="popup destination">tang2</a>              <span class="comment">\ If the result is positive then jump to tang2 to skip</span>
                        <span class="comment">\ the following</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Negate the result to make it positive, so we now have:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">zDeltaLo</a>           <span class="comment">\   (A zDeltaLo) = |zTile - zTileViewer - 0.5|</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaLo</a>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">SBC</span> <a class="popup variable">zDeltaHi</a>

<span class="label">.tang2</span><a id="tang2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">zDeltaAbsoluteHi</a>   <span class="comment">\ Set zDeltaAbsoluteHi = |zDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute z-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (zDeltaAbsoluteHi zDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed z-axis length</span>
                        <span class="comment">\ is still in zDeltaHi</span>

                        <span class="comment">\ We now have both deltas, so we now can calculate the</span>
                        <span class="comment">\ angle of the hypotenuse of the triangle formed by</span>
                        <span class="comment">\ these axes, which is the projection of the 3D vector</span>
                        <span class="comment">\ from the viewer to the tile down onto the ground plane</span>
                        <span class="comment">\ (so imagine a light shining down from above, casting</span>
                        <span class="comment">\ the vector's shadow onto the y = 0 plane, and that's</span>
                        <span class="comment">\ the hypotenuse)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHypotenuseAngle</a> <span class="comment">\ Calculate the angle of the hypotenuse in the triangle</span>
                        <span class="comment">\ with the following non-hypotenuse sides:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * zDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and return the angle in angle(Hi Lo), the tangent in</span>
                        <span class="comment">\ angleTangent, the length of the longer side in</span>
                        <span class="comment">\ a(Hi Lo) and the length of the shorter side in</span>
                        <span class="comment">\ b(Hi Lo)</span>

                        <span class="comment">\ The angle of the hypotenuse is the yaw angle of the</span>
                        <span class="comment">\ 3D vector from the viewer to the tile corner we are</span>
                        <span class="comment">\ analysing, so store it in the table at</span>
                        <span class="comment">\ drawViewYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also subtract the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * screenLeftYawHi from the high byte so the result</span>
                        <span class="comment">\     is the relative yaw angle from the left edge of</span>
                        <span class="comment">\     the screen, so the result is effectively a screen</span>
                        <span class="comment">\     x-coordinate where zero is the left screen edge</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * yawAdjustmentLo from the low byte so if we are</span>
                        <span class="comment">\     drawing an object for updating, we include the</span>
                        <span class="comment">\     correct yaw offset to enable the object to be</span>
                        <span class="comment">\     drawn flush with the left edge of the screen</span>
                        <span class="comment">\     buffer (see the DrawUpdatedObject routine)</span>

 <span class="mne">LDY</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ Set Y to the drawing table index for this tile</span>

 <span class="mne">LDA</span> <a class="popup variable">angleLo</a>            <span class="comment">\ Set drawViewYaw(Hi Lo) for this tile to:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">yawAdjustmentLo</a>    <span class="comment">\   angle(Hi Lo) - (screenLeftYawHi 0)</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawLo</a>,<span class="register">Y</span>    <span class="comment">\                - (0 yawAdjustmentLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">angleHi</a>            <span class="comment">\ And then the high bytes</span>
 <span class="mne">SBC</span> <a class="popup variable">screenLeftYawHi</a>
 <span class="mne">STA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>

 <span class="mne">JSR</span> <a class="popup destination">GetHypotenuse</a>      <span class="comment">\ Calculate the length of the hypotenuse in the triangle</span>
                        <span class="comment">\ with side lengths of a(Hi Lo) and b(Hi Lo) and angle</span>
                        <span class="comment">\ angleTangent, which are still set from the call to</span>
                        <span class="comment">\ GetHypotenuseAngle above to the values for the 3D</span>
                        <span class="comment">\ vector from the viewer to the tile corner we are</span>
                        <span class="comment">\ analysing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The hypotenuse length is returned in hypotenuse(Hi Lo)</span>
                        <span class="comment">\ so we can use it to calculate the pitch angle of the</span>
                        <span class="comment">\ viewer-to-tile vector in part 3</span>

                        <span class="comment">\ Fall through into part 2 to start the pitch angle</span>
                        <span class="comment">\ calculations</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileviewangles-part-2-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileViewAngles (Part 2 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Fetch the tile data for the tile corner we are analysing</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileviewangles_part_2_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ We have calculated the yaw angle of the vector from</span>
                        <span class="comment">\ the viewer to the tile corner we are analysing, so</span>
                        <span class="comment">\ now for the pitch angle</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We start by fetching the tile data for the tile corner</span>
                        <span class="comment">\ we are analysing, and for that we need to know the</span>
                        <span class="comment">\ tile coordinates in terms of the 3D world, as that's</span>
                        <span class="comment">\ how the tileData table is organised</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The following code sets (X, Y) to the coordinate of</span>
                        <span class="comment">\ the tile corner we are analysing, i.e. (xTile, zTile),</span>
                        <span class="comment">\ but with the axes rotated to match the orientation of</span>
                        <span class="comment">\ the 3D world rather than the viewer (as xTile and</span>
                        <span class="comment">\ zTile contain the coordinates from the perspective of</span>
                        <span class="comment">\ the viewer, not the 3D world)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the reverse of the process described in part 1</span>
                        <span class="comment">\ of the DrawLandscapeView routine, which changes the</span>
                        <span class="comment">\ frame of reference from the 3D world to the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In that routine, we map the following coordinate</span>
                        <span class="comment">\ changes, depending on the direction in which the</span>
                        <span class="comment">\ viewer is facing compared to the 3D world's default</span>
                        <span class="comment">\ axes:</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * If the viewer has not turned:</span>
                        <span class="comment">\      (x, z) maps to (x, z)</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * If the viewer has turned right:</span>
                        <span class="comment">\      (x, z) maps to (30 - z, x)</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * If the viewer has turned around:</span>
                        <span class="comment">\      (x, z) maps to (30 - x, 30 - z)</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * If the viewer has turned left:</span>
                        <span class="comment">\      (x, z) maps to (z, 30 - x)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we apply the same logic here, but in the reverse</span>
                        <span class="comment">\ direction, as we want to move from the viewer's frame</span>
                        <span class="comment">\ of reference into the 3D world's frame of reference</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that the logic in DrawLandscapeView subtracts</span>
                        <span class="comment">\ from 30, while here we subtract from 31, because this</span>
                        <span class="comment">\ logic is working with tile corners, while the logic in</span>
                        <span class="comment">\ DrawLandscapeView is working with tiles</span>

 <span class="mne">BIT</span> <a class="popup variable">viewingArcRightYaw</a> <span class="comment">\ If bit 7 of the quadrant containing the right edge of</span>
 <span class="mne">BMI</span> <a class="popup destination">tang4</a>              <span class="comment">\ the viewing arc is set, jump to tang4</span>

 <span class="mne">BVS</span> <a class="popup destination">tang3</a>              <span class="comment">\ If bit 6 of the quadrant containing the right edge of</span>
                        <span class="comment">\ the viewing arc is set, jump to tang3</span>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is clear</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is clear</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 12 o'clock to 3 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the viewer has not turned, so we can</span>
                        <span class="comment">\ use the tile coordinates unchanged</span>

 <span class="mne">LDX</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set X = xTile</span>

 <span class="mne">LDY</span> <a class="popup variable">zTile</a>              <span class="comment">\ Set Y = zTile</span>

 <span class="mne">JMP</span> <a class="popup destination">tang6</a>              <span class="comment">\ Jump to tang6 to keep going</span>

<span class="label">.tang3</span><a id="tang3" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is clear</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 3 o'clock to 6 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the viewer has turned right, so we can</span>
                        <span class="comment">\ turn left to go back to the 3D world</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Turning left maps (x, z) maps to (z, 31 - x), so</span>
                        <span class="comment">\ that's what we do now</span>

 <span class="mne">LDX</span> <a class="popup variable">zTile</a>              <span class="comment">\ Set X = zTile</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set Y = 31 - xTile</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <a class="popup variable">xTile</a>
 <span class="mne">TAY</span>

 <span class="mne">JMP</span> <a class="popup destination">tang6</a>              <span class="comment">\ Jump to tang6 to keep going</span>

<span class="label">.tang4</span><a id="tang4" class="anchor"></a>

                        <span class="comment">\ If we get here then bit 7 of the quadrant containing</span>
                        <span class="comment">\ the right edge of the viewing arc is set</span>

 <span class="mne">BVS</span> <a class="popup destination">tang5</a>              <span class="comment">\ If bit 6 of the quadrant containing the right edge of</span>
                        <span class="comment">\ the viewing arc is set, jump to tang5</span>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is set</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is clear</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the viewer has turned around, so we</span>
                        <span class="comment">\ turn back around to go back to the 3D world</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Turning around maps (x, z) maps to (31 - x, 31 - z),</span>
                        <span class="comment">\ so that's what we do now</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set X = 31 - xTile</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <a class="popup variable">xTile</a>
 <span class="mne">TAX</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set Y = 31 - zTile</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <a class="popup variable">zTile</a>
 <span class="mne">TAY</span>

 <span class="mne">JMP</span> <a class="popup destination">tang6</a>              <span class="comment">\ Jump to tang6 to keep going</span>

<span class="label">.tang5</span><a id="tang5" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 of the right edge's quadrant is set</span>
                        <span class="comment">\   * Bit 6 of the right edge's quadrant is set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the right edge of the viewing arc is</span>
                        <span class="comment">\ in the 9 o'clock to 12 o'clock quadrant</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that the viewer has turned left, so we can</span>
                        <span class="comment">\ turn right to go back to the 3D world</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Turning right maps (x, z) maps to (31 - z, x), so</span>
                        <span class="comment">\ that's what we do now</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set X = 31 - xTile</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <a class="popup variable">zTile</a>
 <span class="mne">TAX</span>

 <span class="mne">LDY</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set Y = yTile</span>

<span class="label">.tang6</span><a id="tang6" class="anchor"></a>

                        <span class="comment">\ We now have the tile coordinates for the tile that we</span>
                        <span class="comment">\ are analysing, but in 3D world coordinates, so we can</span>
                        <span class="comment">\ now fetch the tile data</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The 3D world coordinates for the tile are in (X, Y),</span>
                        <span class="comment">\ so we can fetch the tile data using code that's very</span>
                        <span class="comment">\ similar to the GetTileData routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In the following comments I will refer to (X, Y) as</span>
                        <span class="comment">\ (xTile, zTile), just as in GetTileData, as that's a</span>
                        <span class="comment">\ bit easier to follow than X and Y</span>

 <span class="mne">STY</span> <a class="popup variable">T</a>                  <span class="comment">\ Store zTile in T, so we can use it in the following</span>
                        <span class="comment">\ calculation</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set Y = (xTile &lt;&lt; 3 and %11100000) + zTile</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\       = (xTile >> 2 and %00000111) &lt;&lt; 5 + zTile</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\       = (xTile div 4) * &20 + zTile</span>
 <span class="mne">ASL</span> <span class="register">A</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11100000</span>
 <span class="mne">ORA</span> <a class="popup variable">T</a>
 <span class="mne">TAY</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = bits 0-1 of xTile</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\       = xTile mod 4</span>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Store A in T so we can use it in part 3 to calculate</span>
                        <span class="comment">\ the address of the tile's visibility bit</span>

                        <span class="comment">\ The low byte of tileDataPage(1 0) gets set to zero in</span>
                        <span class="comment">\ ResetVariables and is never changed</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The low byte of tileData is also zero, as we know that</span>
                        <span class="comment">\ tileData is &0400</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in the following, we are just adding the high bytes</span>
                        <span class="comment">\ to get a result that is on a page boundary</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the following:</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">tileData</a><span class="bracket">)</span>      <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">tileDataPage</a><span class="operator">+</span><span class="decimal">1</span>     <span class="comment">\   tileDataPage(1 0) = tileData + (A 0)</span>
                        <span class="comment">\                     = tileData + (xTile mod 4) * &100</span>

                        <span class="comment">\ So we now have the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   tileDataPage(1 0) = tileData + (xTile mod 4) * &100</span>
                        <span class="comment">\</span>
                        <span class="comment">\   Y = (xTile div 4) * &20 + zTile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The address in tileDataPage(1 0) is the page within</span>
                        <span class="comment">\ tileData for the tile anchored at (xTile, zTile), and</span>
                        <span class="comment">\ is always one of &0400, &0500, &0600 or &0700 because</span>
                        <span class="comment">\ (xTile mod 4) is one of 0, 1, 2 or 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value of Y is the offset within that page of the</span>
                        <span class="comment">\ tile data for the tile anchored at (xTile, zTile)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can therefore fetch the tile data for the specified</span>
                        <span class="comment">\ tile using Y as an index offset from tileDataPage(1 0)</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">LDX</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ Store the tile data in the correct place in the</span>
 <span class="mne">STA</span> <a class="popup variable">tileViewData</a>,<span class="register">X</span>     <span class="comment">\ tileViewData table</span>

                        <span class="comment">\ Fall through into part 3 to finish the pitch angle</span>
                        <span class="comment">\ calculations</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileviewangles-part-3-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileViewAngles (Part 3 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the pitch angle for the tile corner</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileviewangles_part_3_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ By this point, A contains the tile data for the tile</span>
                        <span class="comment">\ we are analysing and Y contains the index offset of</span>
                        <span class="comment">\ the tile data from tileDataPage(1 0)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ If both bits 6 and 7 are set in the tile data then the</span>
 <span class="mne">BCC</span> <a class="popup destination">tang8</a>              <span class="comment">\ tile we are analysing contains an object, in which</span>
                        <span class="comment">\ case keep going, otherwise there is no object on the</span>
                        <span class="comment">\ tile so jump to tang8</span>

<span class="label">.tang7</span><a id="tang7" class="anchor"></a>

                        <span class="comment">\ If we get here then the tile we are analysing contains</span>
                        <span class="comment">\ an object and the tile data is in A</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>         <span class="comment">\ Because the tile has an object on it, the tile data</span>
 <span class="mne">TAY</span>                    <span class="comment">\ contains the number of the top object on the tile in</span>
                        <span class="comment">\ bits 0 to 5, so extract the object number into Y (so</span>
                        <span class="comment">\ the tile effectively contains object #Y)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the object flags for the object on the tile</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ If bit 6 of the object flags for object #Y is set</span>
 <span class="mne">BCS</span> <a class="popup destination">tang7</a>              <span class="comment">\ then object #Y is stacked on top of another object,</span>
                        <span class="comment">\ and that object number is in bits 0 to 5 of the object</span>
                        <span class="comment">\ flags, so jump to tang7 to extract that object number</span>
                        <span class="comment">\ from A and check the flags again (so this works down</span>
                        <span class="comment">\ through the stack of objects until we reach the object</span>
                        <span class="comment">\ at the bottom of the stack)</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">Y</span>        <span class="comment">\ At this point we have reached the object on the tile</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ itself, so set U to the y-coordinate of that object,</span>
                        <span class="comment">\ which will be the tile altitude, and return from the</span>
                        <span class="comment">\ subroutine with the C flag clear to denote a flat</span>
                        <span class="comment">\ tile, as objects are only ever placed on flat tiles</span>

 <span class="mne">JMP</span> <a class="popup destination">tang9</a>              <span class="comment">\ Jump to tang9 to keep going, leaving the tile's entry</span>
                        <span class="comment">\ in the tileViewData table alone (so it still contains</span>
                        <span class="comment">\ the tile data that we stored in part 2)</span>

<span class="label">.tang8</span><a id="tang8" class="anchor"></a>

                        <span class="comment">\ If we get here then the tile we are analysing does not</span>
                        <span class="comment">\ contain an object and the tile data is in A, with Y</span>
                        <span class="comment">\ containing the index offset of the tile data from</span>
                        <span class="comment">\ tileDataPage(1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ From part 2, we have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * T = bits 0-1 of xTile</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Y = (xTile div 4) * &20 + zTile</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ The high nibble of the tile data contains the altitude</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ of the tile's anchor, so shift this into U</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>

                        <span class="comment">\ We now fetch the tile's visibility bit from the</span>
                        <span class="comment">\ tileVisibility table, using the reverse of the logic</span>
                        <span class="comment">\ in the GetTileVisibility routine for calculating the</span>
                        <span class="comment">\ address of the visibility bit</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Shift Y right by one place, so the C flag is set to</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ bit 0 of zTile (the row number), and Y contains the</span>
 <span class="mne">TAY</span>                    <span class="comment">\ following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 4 to 6 contain bits 2 to 4 of xTile (the</span>
                        <span class="comment">\     column number)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 0 to 3 contain bits 1 to 4 of zTile (the</span>
                        <span class="comment">\     row number)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This therefore gives us the offset in the visibility</span>
                        <span class="comment">\ table for the tile's visibility byte, as per the</span>
                        <span class="comment">\ GetTileVisibility routine</span>

 <span class="mne">ROL</span> <a class="popup variable">T</a>                  <span class="comment">\ In part 2 we set T to bits 0-1 of xTile (the column</span>
                        <span class="comment">\ number), so this sets T as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * Bit 0 contains bit 0 of the of the tile row in</span>
                        <span class="comment">\      zTile (via the C flag from above)</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * Bits 1-2 contain bits 0-1 of the column number in</span>
                        <span class="comment">\      xTile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This therefore gives us the bit number within the byte</span>
                        <span class="comment">\ in the visibility table for the tile's visibility, as</span>
                        <span class="comment">\ per the GetTileVisibility routine</span>

 <span class="mne">LDA</span> <a class="popup variable">tileVisibility</a>,<span class="register">Y</span>   <span class="comment">\ Set A to the visibility byte that contains the</span>
                        <span class="comment">\ visibility bit for this tile</span>

 <span class="mne">LDY</span> <a class="popup variable">T</a>                  <span class="comment">\ Fetch the Y-th bit from the visibility byte, which</span>
 <span class="mne">AND</span> <a class="popup variable">visibileBitMask</a>,<span class="register">Y</span>  <span class="comment">\ contains the specific visibility bit for this tile</span>

 <span class="mne">BNE</span> <a class="popup destination">tang9</a>              <span class="comment">\ If the visibility bit is set then A will be non-zero,</span>
                        <span class="comment">\ so skip the following instruction, leaving the entry</span>
                        <span class="comment">\ for this tile to contain the non-zero tile data that</span>
                        <span class="comment">\ we stored in tileViewData,X at the end of part 2</span>

 <span class="mne">STA</span> <a class="popup variable">tileViewData</a>,<span class="register">X</span>     <span class="comment">\ The visibility bit is zero, so zero the entry in the</span>
                        <span class="comment">\ tileViewData table for this tile (which otherwise</span>
                        <span class="comment">\ would contain the tile data that we set in part 2)</span>

<span class="label">.tang9</span><a id="tang9" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the number of the object that is viewing the</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set (A xDeltaLo) = (U 0) - y-coordinate of object #X</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\ We set U above to the altitude of the tile that we are</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\ analysing, so (A xDeltaLo) now contains the vertical</span>
 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ distance between the viewer and the tile we are</span>
 <span class="mne">SBC</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ analysing, ready to pass to GetPitchAngleDelta</span>

 <span class="mne">JSR</span> <a class="popup destination">GetPitchAngleDelta</a> <span class="comment">\ Set pitchDelta(Hi Lo) to the pitch angle of the vector</span>
                        <span class="comment">\ relative to the viewer's pitch angle</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The vector in question has x- and z-axis elements from</span>
                        <span class="comment">\ part 1:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * zDelta(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and we calculated the hypotenuse(Hi Lo) for this in</span>
                        <span class="comment">\ part 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The vector also has y-axis element of (A xDeltaLo),</span>
                        <span class="comment">\ which we just calculated</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this call calculates the relative pitch angle for</span>
                        <span class="comment">\ the vector between the viewer and the tile that we are</span>
                        <span class="comment">\ analysing, so store it in the correct entry in the</span>
                        <span class="comment">\ table at drawViewPitch(Hi Lo)</span>

 <span class="mne">LDY</span> <a class="popup variable">drawingTableIndex</a>  <span class="comment">\ Set Y to the drawing table index for this tile</span>

 <span class="mne">LDA</span> <a class="popup variable">pitchDeltaHi</a>       <span class="comment">\ Store the high byte of the pitch vector in the correct</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\ part of the drawViewPitchHi table</span>

 <span class="mne">LDA</span> <a class="popup variable">pitchDeltaLo</a>       <span class="comment">\ Store the low byte of the pitch vector in the correct</span>
 <span class="mne">STA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>  <span class="comment">\ part of the drawViewPitchLo table</span>

                        <span class="comment">\ Fall through into part 4 to work out how much of the</span>
                        <span class="comment">\ tile is on-screen</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettileviewangles-part-4-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileViewAngles (Part 4 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate how much of the tile is on-screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettileviewangles_part_4_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ By this point we have pitch and yaw angles for the</span>
                        <span class="comment">\ vector between the viewer and the tile that we are</span>
                        <span class="comment">\ analysing, relative to the viewing gaze, so we now</span>
                        <span class="comment">\ need to work out the value of tileIsOnScreen to return</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We set tileIsOnScreen to zero at the start of the</span>
                        <span class="comment">\ routine, to indicate that the tile is not on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now set the following bits if applicable:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set bit 7 when</span>
                        <span class="comment">\              drawViewYaw(Hi Lo) >= bufferMinYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set bit 0 when drawViewYawHi >= bufferMaxYawHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So bit 7 is set when the tile corner is inside the</span>
                        <span class="comment">\ minimum yaw limit, and bit 0 is set when the tile</span>
                        <span class="comment">\ corner is inside (but not on) the maximum yaw limit</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the yaw limit is the screen size, then the two bits</span>
                        <span class="comment">\ determine whether the tile is on-screen</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>    <span class="comment">\ If drawViewYawHi &lt; bufferMinYawHi, jump to tang11 to</span>
 <span class="mne">CMP</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ return with tileIsOnScreen = 0, as the tile is off the</span>
 <span class="mne">BCC</span> <a class="popup destination">tang11</a>             <span class="comment">\ left of the screen edge</span>

 <span class="mne">BNE</span> <a class="popup destination">tang10</a>             <span class="comment">\ If drawViewYawHi > bufferMinYawHi, jump to tang10 with</span>
                        <span class="comment">\ the C flag set to set bit 7 of tileIsOnScreen</span>

                        <span class="comment">\ If we get here then drawViewYawHi = bufferMinYawHi, so</span>
                        <span class="comment">\ we now check the low bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawLo</a>,<span class="register">Y</span>    <span class="comment">\ If drawViewYawLo &lt; bufferMinYawLo, jump to tang11 to</span>
 <span class="mne">CMP</span> <a class="popup variable">bufferMinYawLo</a>     <span class="comment">\ return with tileIsOnScreen = 0</span>
 <span class="mne">BCC</span> <a class="popup destination">tang11</a>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>    <span class="comment">\ If we get here then drawViewYawLo >= bufferMinYawLo,</span>
                        <span class="comment">\ so the C flag is set, and we set A to drawViewYawHi</span>
                        <span class="comment">\ for the comparison below</span>

<span class="label">.tang10</span><a id="tang10" class="anchor"></a>

                        <span class="comment">\ If we get here then the C flag is set, as we have to</span>
                        <span class="comment">\ pass through a BCC to get here</span>

 <span class="mne">ROR</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ Set bit 7 of tileIsOnScreen, so bit 7 is set if the</span>
                        <span class="comment">\ tile is on or to the right of the minimum yaw limit,</span>
                        <span class="comment">\ i.e. to the right of the left edge of the screen</span>

 <span class="mne">CMP</span> <a class="popup variable">bufferMaxYawHi</a>     <span class="comment">\ If drawViewYawHi &lt; bufferMaxYawHi, jump to tang11 to</span>
 <span class="mne">BCC</span> <a class="popup destination">tang11</a>             <span class="comment">\ return from the routine with bit 0 of tileIsOnScreen</span>
                        <span class="comment">\ clear</span>

                        <span class="comment">\ If we get here then drawViewYawHi >= bufferMaxYawHi,</span>
                        <span class="comment">\ so the tile is off-screen to the right</span>

 <span class="mne">INC</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ Set bit 0 of tileIsOnScreen to indicate that the tile</span>
                        <span class="comment">\ is to the right of the maximum yaw limit, i.e. to the</span>
                        <span class="comment">\ right of the right edge of the screen</span>

<span class="label">.tang11</span><a id="tang11" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">yStoreTileView</a>     <span class="comment">\ Restore Y so that it's preserved</span>

 <span class="mne">LDA</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ Set A to the value of tileIsOnScreen, to return from</span>
                        <span class="comment">\ the subroutine</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have not gone</span>
                        <span class="comment">\ past the end of the tile row, which is used when</span>
                        <span class="comment">\ calling this routine via GetTileEdgeToLeft or</span>
                        <span class="comment">\ GetTileEdgeToRight</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawlandscaperow" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawLandscapeRow</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a row of tiles between the left visible edge and the right</span>
             <span class="headerEntry">visible, in two parts towards each side of the viewer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawlandscaperow.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_2_of_3.html">DrawLandscapeView (Part 2 of 3)</a> calls <a href="#drawlandscaperow">DrawLandscapeRow</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_3_of_3.html">DrawLandscapeView (Part 3 of 3)</a> calls <a href="#drawlandscaperow">DrawLandscapeRow</a></span>
</div>
</div></div>
<span class="label">.DrawLandscapeRow</span><a id="drawlandscaperow" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ Set xTileToDraw to the column number of the tile at</span>
 <span class="mne">STA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ the left edge of the visible row we want to draw</span>

<span class="label">.draw1</span><a id="draw1" class="anchor"></a>

 <span class="mne">CMP</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ If we have gone past the right edge, jump to draw4 to</span>
 <span class="mne">BCS</span> <a class="popup destination">draw4</a>              <span class="comment">\ return from the subroutine</span>

 <span class="mne">CMP</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\ If we have gone past the viewer's tile column, jump to</span>
 <span class="mne">BCS</span> <a class="popup destination">draw2</a>              <span class="comment">\ draw2 to draw the second half</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTileAndObjects</a> <span class="comment">\ Draw the tile and any objects stacked on it</span>

 <span class="mne">INC</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Increment the column number to move right along the</span>
                        <span class="comment">\ row</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Set A to the updated column number of the tile we want</span>
                        <span class="comment">\ to draw</span>

 <span class="mne">JMP</span> <a class="popup destination">draw1</a>              <span class="comment">\ Loop back to draw1 the next tile to the right until we</span>
                        <span class="comment">\ reach the viewer's tile column or reach the end of the</span>
                        <span class="comment">\ row</span>

<span class="label">.draw2</span><a id="draw2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTileViewRightEdge</a> <span class="comment">\ Set A to the column number of the tile at the right</span>
                        <span class="comment">\ edge of the visible row we want to draw</span>

<span class="label">.draw3</span><a id="draw3" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Decrement the column counter in A to move left along</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ the row</span>

 <span class="mne">BMI</span> <a class="popup destination">draw4</a>              <span class="comment">\ If we have reached the start of the row, jump to draw4</span>
                        <span class="comment">\ to return from the subroutine</span>

 <span class="mne">STA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Store the updated column number of the tile we want to</span>
                        <span class="comment">\ draw</span>

 <span class="mne">CMP</span> <a class="popup variable">xTileViewLeftEdge</a>  <span class="comment">\ If we have gone past the left edge, jump to draw4 to</span>
 <span class="mne">BCC</span> <a class="popup destination">draw4</a>              <span class="comment">\ return from the subroutine</span>

 <span class="mne">CMP</span> <a class="popup variable">xTileViewer</a>        <span class="comment">\ If we have gone past the viewer's tile column, jump to</span>
 <span class="mne">BCC</span> <a class="popup destination">draw4</a>              <span class="comment">\ draw4 to return from the subroutine</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTileAndObjects</a> <span class="comment">\ Draw the tile and any objects stacked on it</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Set A to the column number of the tile we just drew</span>

 <span class="mne">JMP</span> <a class="popup destination">draw3</a>              <span class="comment">\ Loop back to draw1 the next tile to the left until we</span>
                        <span class="comment">\ reach the viewer's tile column or reach the end of the</span>
                        <span class="comment">\ row</span>

<span class="label">.draw4</span><a id="draw4" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-flipbuffertype" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">FlipBufferType</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Flip the buffer type between buffer type 0 (left row buffer) and</span>
             <span class="headerEntry">buffer type 1 (right row buffer)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/flipbuffertype.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygon.html">DrawPolygon</a> calls <a href="#flipbuffertype">FlipBufferType</a></span>
</div>
</div></div>
<span class="label">.FlipBufferType</span><a id="flipbuffertype" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">screenBufferType</a>   <span class="comment">\ Flip bit 0 of screenBufferType to swap between buffer</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ type 0 (left row buffer) and buffer type 1 (right row</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ buffer)</span>

                        <span class="comment">\ Fall through into ConfigureBuffer to configure the new</span>
                        <span class="comment">\ buffer type</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-configurebuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ConfigureBuffer</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set up the variables required to configure the screen buffer to a</span>
             <span class="headerEntry">specific buffer type</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/configurebuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/clearscreen.html">ClearScreen</a> calls <a href="#configurebuffer">ConfigureBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#configurebuffer">ConfigureBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/usecolumnbuffer.html">UseColumnBuffer</a> calls <a href="#configurebuffer">ConfigureBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/userowbuffer.html">UseRowBuffer</a> calls <a href="#configurebuffer">ConfigureBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The type of buffer to configure:</span>

                        <span class="argumentEntry">  * 0 = left row buffer (for up/down pan)</span>
                        <span class="argumentEntry">        for the first 256 bytes of the 320-byte row</span>

                        <span class="argumentEntry">  * 1 = right row buffer (for up/down pan)</span>
                        <span class="argumentEntry">        for the last 64 bytes of the 320-byte row</span>

                        <span class="argumentEntry">  * 2 = column buffer (for left/right pan)</span>

</div></div>
<span class="label">.ConfigureBuffer</span><a id="configurebuffer" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">screenBufferType</a>   <span class="comment">\ Set screenBufferType to the new buffer type</span>

 <span class="mne">TAY</span>                    <span class="comment">\ Copy the buffer type into Y so we can use it as an</span>
                        <span class="comment">\ index into the various buffer configuration tables</span>

 <span class="mne">LDA</span> <a class="popup variable">buffersMinYaw</a>,<span class="register">Y</span>    <span class="comment">\ Set the high byte of bufferMinYaw(Hi Lo) to the value</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ from the buffersMinYaw table for this screen buffer</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set bufferMaxYawHi = bufferMinYawHi / 2</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMaxYawHi</a>     <span class="comment">\ and with bit 7 flipped ???</span>

 <span class="mne">LDA</span> <a class="popup variable">buffersOrigin</a>,<span class="register">Y</span>    <span class="comment">\ Set the high byte of bufferOrigin(Hi Lo) to the value</span>
 <span class="mne">STA</span> <a class="popup variable">bufferOriginHi</a>     <span class="comment">\ from the buffersOrigin table for this screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">xBuffersWidth</a>,<span class="register">Y</span>    <span class="comment">\ Set xBufferWidth to the value from the xBuffersWidth</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferWidth</a>       <span class="comment">\ table for this screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">xBuffersLeft</a>,<span class="register">Y</span>     <span class="comment">\ Set xBufferLeft to the value from the xBuffersLeft</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferLeft</a>        <span class="comment">\ table for this screen buffer</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set xBufferRight = xBufferLeft + xBufferWidth</span>
 <span class="mne">ADC</span> <a class="popup variable">xBufferWidth</a>       <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferRight</a>       <span class="comment">\ So this sets the right edge of the screen buffer</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the low byte of bufferMinYaw(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMinYawLo</a>

 <span class="mne">STA</span> <a class="popup variable">bufferOriginLo</a>     <span class="comment">\ Zero the low byte of bufferOrigin(Hi Lo)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-buffersorigin" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">buffersOrigin</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The offset to add to yaw angles for each screen buffer to convert</span>
             <span class="headerEntry">from the origin in the buffer centre to the origin on the left</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/buffersorigin.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/configurebuffer.html">ConfigureBuffer</a> uses <a href="#buffersorigin">buffersOrigin</a></span>
</div>
</div></div>
<span class="label">.buffersOrigin</span><a id="buffersorigin" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">10</span>                <span class="comment">\ Left row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span>                 <span class="comment">\ Right row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">12</span>                <span class="comment">\ Column buffer</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-xbuffersleft" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">xBuffersLeft</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The left edge of each screen buffer in pixels ???</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/xbuffersleft.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/configurebuffer.html">ConfigureBuffer</a> uses <a href="#xbuffersleft">xBuffersLeft</a></span>
</div>
</div></div>
<span class="label">.xBuffersLeft</span><a id="xbuffersleft" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">80</span>                <span class="comment">\ Left row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">64</span>                <span class="comment">\ Right row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">96</span>                <span class="comment">\ Column buffer</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-xbufferswidth" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">xBuffersWidth</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The width of each screen buffer in pixels ???</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/xbufferswidth.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/configurebuffer.html">ConfigureBuffer</a> uses <a href="#xbufferswidth">xBuffersWidth</a></span>
</div>
</div></div>
<span class="label">.xBuffersWidth</span><a id="xbufferswidth" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">112</span>               <span class="comment">\ Left row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">112</span>               <span class="comment">\ Right row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">64</span>                <span class="comment">\ Column buffer</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-buffersminyaw" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">buffersMinYaw</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Minimum allowed yaw angles for points in the screen buffer ???</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/buffersminyaw.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/configurebuffer.html">ConfigureBuffer</a> uses <a href="#buffersminyaw">buffersMinYaw</a></span>
</div>
</div></div>
<span class="label">.buffersMinYaw</span><a id="buffersminyaw" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">20</span>                <span class="comment">\ Left row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">20</span>                <span class="comment">\ Right row buffer</span>

 <span class="mne">EQUB</span> <span class="decimal">8</span>                 <span class="comment">\ Column buffer</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-configureobjbuffer" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ConfigureObjBuffer</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set up the variables required to configure the screen buffer for</span>
             <span class="headerEntry">updating an object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/configureobjbuffer.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#configureobjbuffer">ConfigureObjBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls via <a href="#buff1">buff1</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of the character columns to configure</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">buff1</span>                <span class="argumentEntry">Contains an RTS</span>

</div></div>
<span class="label">.ConfigureObjBuffer</span><a id="configureobjbuffer" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set T to the number of character columns we need to</span>
                        <span class="comment">\ configure to contain the object we are drawing</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ This converts the number of character columns into</span>
                        <span class="comment">\ a yaw angle by dividing by 2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The custom screen mode 5 used by the game is 40</span>
                        <span class="comment">\ character columns wide, and the screen is 20 yaw</span>
                        <span class="comment">\ angles wide in terms of the game's coordinate system</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can simply double the character column count in</span>
                        <span class="comment">\ A to convert it into a yaw angle</span>

 <span class="mne">STA</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ Set bufferMinYaw(Hi Lo) = A</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\                         = T / 2</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMinYawLo</a>     <span class="comment">\ So this stores the character column count as a yaw</span>
                        <span class="comment">\ angle in bufferMinYaw(Hi Lo), where the low byte is</span>
                        <span class="comment">\ effectively a fractional part</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This gives us the yaw angle of the left edge of the</span>
                        <span class="comment">\ screen buffer ???</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ Set bufferMaxYawHi = bufferMinYawHi / 2</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ and with bit 7 flipped ???</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMaxYawHi</a>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set xBufferWidth = T * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ This gives us the width of the buffer in pixels</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferWidth</a>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set xBufferRight = 128 + T * 2</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111100</span>         <span class="comment">\</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ rounded down to a multiple of 4 ???</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferRight</a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set xBufferLeft = xBufferRight - xBufferWidth</span>
 <span class="mne">SBC</span> <a class="popup variable">xBufferWidth</a>
 <span class="mne">STA</span> <a class="popup variable">xBufferLeft</a>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set bufferOrigin(Hi Lo) = xBufferLeft / 8</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ starting with the high byte</span>
 <span class="mne">STA</span> <a class="popup variable">bufferOriginHi</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ And then the low byte</span>
 <span class="mne">ROR</span> <span class="register">A</span>
 <span class="mne">STA</span> <a class="popup variable">bufferOriginLo</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Configure the screen buffer as a column buffer</span>
 <span class="mne">STA</span> <a class="popup variable">screenBufferType</a>

<span class="label">.buff1</span><a id="buff1" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawtileandobjects" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTileAndObjects</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a tile and any objects stacked on it</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawtileandobjects.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscaperow.html">DrawLandscapeRow</a> calls <a href="#drawtileandobjects">DrawTileAndObjects</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">xTileToDraw</span>          <span class="argumentEntry">The tile x-coordinate (i.e. the tile column)</span>

   <span class="argumentLabel">zTile</span>                <span class="argumentEntry">The tile z-coordinate (i.e. the tile row)</span>

</div></div>
<span class="label">.tobj1</span><a id="tobj1" class="anchor"></a>

                        <span class="comment">\ If we get here then we need to draw a block in the</span>
                        <span class="comment">\ title screen's 3D text</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use object #63 for this purpose, and we set it to</span>
                        <span class="comment">\ the object number for the 3D text block pair that the</span>
                        <span class="comment">\ SpawnCharacter3D put into bits 0 to 3 of the tile data</span>

 <span class="mne">LDA</span> <a class="popup variable">tileViewData</a>,<span class="register">X</span>     <span class="comment">\ Set the object type for object #63 to the bottom</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ nibble of the tile data, which contains the object</span>
 <span class="mne">STA</span> <a class="popup variable">objectTypes</a><span class="operator">+</span><span class="decimal">63</span>     <span class="comment">\ number for the 3D text block pair for this part of the</span>
                        <span class="comment">\ text:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 for no blocks in the pair</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 7 for no block (left), block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 8 for block (left), no block (right)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 9 for block (left), no block (right)</span>

 <span class="mne">BEQ</span> <a class="popup destination">buff1</a>              <span class="comment">\ If the object type is zero then jump to buff1 to</span>
                        <span class="comment">\ return from the subroutine without drawing anything</span>

                        <span class="comment">\ Otherwise we have set the type of object #63 to the</span>
                        <span class="comment">\ correct 3D text block object, so now we set the tile</span>
                        <span class="comment">\ coordinate and draw the object</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Set the x-coordinate for the block in object #63 to</span>
 <span class="mne">STA</span> <a class="popup variable">xObject</a><span class="operator">+</span><span class="decimal">63</span>         <span class="comment">\ the tile column in xTileToDraw</span>

 <span class="mne">LDA</span> <a class="popup variable">zTile</a>              <span class="comment">\ Set the z-coordinate for the block in object #63 to</span>
 <span class="mne">STA</span> <a class="popup variable">zObject</a><span class="operator">+</span><span class="decimal">63</span>         <span class="comment">\ the tile row in zTile</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set Y = 63 to pass to the DrawObject routine so we</span>
                        <span class="comment">\ draw object #63</span>

 <span class="mne">JMP</span> <a class="popup destination">DrawObject</a>         <span class="comment">\ Jump to DrawObject to draw the 3D text block we've set</span>
                        <span class="comment">\ up in object #63, returning from the subroutine using</span>
                        <span class="comment">\ a tail call</span>

<span class="label">.DrawTileAndObjects</span><a id="drawtileandobjects" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Set X to the index of the tile data that we set up for</span>
 <span class="mne">ORA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ this tile in part 2 of the GetTileViewAngles routine</span>
 <span class="mne">CLC</span>                    <span class="comment">\ ???</span>
 <span class="mne">ADC</span> <a class="popup variable">quadrantOffset</a>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>
 <span class="mne">TAX</span>

 <span class="mne">BIT</span> <a class="popup variable">drawingTitleScreen</a> <span class="comment">\ If bit 7 of drawingTitleScreen is set then we are</span>
 <span class="mne">BMI</span> <a class="popup destination">tobj1</a>              <span class="comment">\ drawing a title screen, so jump up to tobj1 to draw</span>
                        <span class="comment">\ this tile as a block in the title screen's 3D text</span>

 <span class="mne">LDA</span> <a class="popup variable">tileViewData</a>,<span class="register">X</span>     <span class="comment">\ Set A to the tile data for the current view, which we</span>
                        <span class="comment">\ set in the GetTileViewAngles routine to the tile data</span>
                        <span class="comment">\ for this tile, but zeroed if the tile is not visible</span>
                        <span class="comment">\ (which will happen if the tile does not contain an</span>
                        <span class="comment">\ object and is marked as not being visible from the</span>
                        <span class="comment">\ player's point of view in the tileVisibility table)</span>

 <span class="mne">BEQ</span> <a class="popup destination">buff1</a>              <span class="comment">\ If A is zero then we marked this tile as being hidden</span>
                        <span class="comment">\ in part 3 of the GetTileViewAngles routine, so jump to</span>
                        <span class="comment">\ buff1 to return from the subroutine without drawing</span>
                        <span class="comment">\ anything</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ If both bits 6 and 7 are set in the tile data then the</span>
 <span class="mne">BCC</span> <a class="popup destination">tobj2</a>              <span class="comment">\ tile we are analysing contains an object, in which</span>
                        <span class="comment">\ case keep going, otherwise there is no object on the</span>
                        <span class="comment">\ tile so jump to tobj2</span>

                        <span class="comment">\ If we get here then the tile we are drawing contains</span>
                        <span class="comment">\ an object</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the tile data on the stack</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawFlatTile</a>       <span class="comment">\ Draw the flat tile that's beneath the object</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the tile data from the stack</span>

 <span class="mne">JMP</span> <a class="popup destination">DrawObjectStack</a>    <span class="comment">\ Draw the stack of objects on top of the tile, and</span>
                        <span class="comment">\ return from the subroutine using a tail call</span>

<span class="label">.tobj2</span><a id="tobj2" class="anchor"></a>

                        <span class="comment">\ If we get here then the tile we are drawing does not</span>
                        <span class="comment">\ contain an object</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Set A to the tile shape for the tile, which is in the</span>
                        <span class="comment">\ bottom nibble of the tile data</span>

 <span class="mne">BEQ</span> <a class="popup destination">DrawFlatTile</a>       <span class="comment">\ If the tile shape is zero then the tile is flat, so</span>
                        <span class="comment">\ jump to DrawFlatTile to draw the flat tile, returning</span>
                        <span class="comment">\ from the subroutine using a tail call</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">12</span>                <span class="comment">\ If the tile shape is 12 then we know the tile consists</span>
 <span class="mne">BEQ</span> <a class="popup destination">tobj3</a>              <span class="comment">\ of two faces, so jump to tobj3</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ If the tile shape is 4 then we know the tile consists</span>
 <span class="mne">BNE</span> <a class="popup destination">DrawSlopingTile</a>    <span class="comment">\ of two faces, so keep going, otherwise we don't know</span>
                        <span class="comment">\ how many faces it contains, so jump to DrawSlopingTile</span>
                        <span class="comment">\ to work this out</span>

<span class="label">.tobj3</span><a id="tobj3" class="anchor"></a>

                        <span class="comment">\ If we get here then the tile shape is 4 or 12, both of</span>
                        <span class="comment">\ which we know consist of two triangular faces</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the tile shape on the stack</span>

 <span class="mne">LDA</span> <a class="popup variable">viewingQuadrantOpp</a> <span class="comment">\ Set triangleStartPoint to bit 0 of viewingQuadrantOpp</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ to pass to the DrawTwoFaceTile routine ???</span>
 <span class="mne">STA</span> <a class="popup variable">triangleStartPoint</a>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the tile shape from the stack</span>

 <span class="mne">BNE</span> <a class="popup destination">DrawTwoFaceTile</a>    <span class="comment">\ Jump to DrawTwoFaceTile to draw the tile, returning</span>
                        <span class="comment">\ from the subroutine using a tail call (this BNE is</span>
                        <span class="comment">\ effectively a JMP as we know the tile shape is</span>
                        <span class="comment">\ non-zero)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawflattile" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawFlatTile</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a flat tile in the correct colour for the chess board effect</span>
             <span class="headerEntry">that we use to draw the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawflattile.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawlandscapeview_part_3_of_3.html">DrawLandscapeView (Part 3 of 3)</a> calls <a href="#drawflattile">DrawFlatTile</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#drawflattile">DrawFlatTile</a></span>
</div>
</div></div>
<span class="label">.DrawFlatTile</span><a id="drawflattile" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ If bit 0 of xTileToDraw and zTile are the same, then</span>
 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ the tile's x-coordinate and z-coordinate are either</span>
 <span class="mne">EOR</span> <a class="popup variable">zTile</a>              <span class="comment">\ both odd or both even, so jump to DrawOneFaceTile</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ with X set to 0 to draw this tile in colour 3 (white,</span>
 <span class="mne">BEQ</span> <a class="popup destination">DrawOneFaceTile</a>    <span class="comment">\ yellow, cyan or red)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Otherwise the tile's x-coordinate and z-coordinate are</span>
                        <span class="comment">\ different (i.e. one is odd and one is even), so set</span>
                        <span class="comment">\ X to 8 to draw this tile in colour 0 (blue)</span>

                        <span class="comment">\ We now have a very short interlude to set the value of</span>
                        <span class="comment">\ stashOffset as part of the game's anti-cracker code,</span>
                        <span class="comment">\ and we pick up the tile-drawing process again in the</span>
                        <span class="comment">\ DrawOneFaceTile routine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-setsecretstash" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SetSecretStash</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Alter the secret code stash, as part of the anti-cracker code</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/setsecretstash.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.SetSecretStash</span><a id="setsecretstash" class="anchor"></a>

                        <span class="comment">\ This routine sets the value of stashOffset, which is</span>
                        <span class="comment">\ the offset into the secretCodeStash where we store a</span>
                        <span class="comment">\ set of generated values for later checking in the</span>
                        <span class="comment">\ GetRowVisibility routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The offset is set to the middle byte from the</span>
                        <span class="comment">\ landscape seed linear feedback shift register (LFSR),</span>
                        <span class="comment">\ overwriting previous values until we get here for the</span>
                        <span class="comment">\ last time</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As we only reach this routine when drawing flat tiles</span>
                        <span class="comment">\ in colour 0, so stashOffset is set to the middle byte</span>
                        <span class="comment">\ from the landscape seed linear feedback shift register</span>
                        <span class="comment">\ for the last flat colour 0 tile to be drawn</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value itself doesn't matter, it's just another way</span>
                        <span class="comment">\ of throwing crackers off the trail of working out how</span>
                        <span class="comment">\ to generate landscape codes, as it changes the address</span>
                        <span class="comment">\ of the secret code stash for each landscape</span>

 <span class="mne">LDA</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">2</span><span class="operator">-</span><span class="decimal">8</span>,<span class="register">X</span>   <span class="comment">\ At this point, X = 8 from DrawFlatTile, so this</span>
 <span class="mne">STA</span> <a class="popup variable">stashOffset</a><span class="operator">-</span><span class="decimal">8</span>,<span class="register">X</span>        <span class="comment">\ sets the following:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   stashOffset = seedNumberLFSR+2</span>

                        <span class="comment">\ seedNumberLFSR+2 is the middle byte of the LFSR at</span>
                        <span class="comment">\ seedNumberLFSR(4 3 2 1 0), so this sets the secret</span>
                        <span class="comment">\ code stash offset to a unique and consistent value for</span>
                        <span class="comment">\ each landscape</span>

                        <span class="comment">\ Fall through into DrawOneFaceTile to finish drawing</span>
                        <span class="comment">\ the flat tile</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawonefacetile" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawOneFaceTile</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a tile with one quadrilateral (four-sided) face</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawonefacetile.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawflattile.html">DrawFlatTile</a> calls <a href="#drawonefacetile">DrawOneFaceTile</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawslopingtile.html">DrawSlopingTile</a> calls <a href="#drawonefacetile">DrawOneFaceTile</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The reference shape to use when picking the tile's</span>
                        <span class="argumentEntry">colour from the tileShapeColour table</span>

</div></div>
<span class="label">.DrawOneFaceTile</span><a id="drawonefacetile" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">tileShapeColour</a>,<span class="register">X</span>  <span class="comment">\ Set polygonColours to the entry for the reference</span>
 <span class="mne">STA</span> <a class="popup variable">polygonColours</a>     <span class="comment">\ shape from the tileShapeColour or tileShapeColour+16</span>
                        <span class="comment">\ table, so we draw the polygon in the correct colour</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00000000</span>         <span class="comment">\ Clear bits 6 and 7 of polygonType so the following</span>
 <span class="mne">STA</span> <a class="popup variable">polygonType</a>        <span class="comment">\ call to DrawPolygon draws a quadrilateral tile face</span>

 <span class="mne">JMP</span> <a class="popup destination">DrawPolygon</a>        <span class="comment">\ Jump to DrawPolygon to draw the quadrilateral and</span>
                        <span class="comment">\ return from the subroutine using a tail call</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawslopingtile" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawSlopingTile</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a sloping tile that is not shape 4 or 12</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawslopingtile.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#drawslopingtile">DrawSlopingTile</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The shape of the tile to draw (not 0, 4 or 12)</span>

</div></div>
<span class="label">.DrawSlopingTile</span><a id="drawslopingtile" class="anchor"></a>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the tile shape so we can retrieve it later</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set Y = (A - viewingQuadrantx4) mod 16</span>
 <span class="mne">SBC</span> <a class="popup variable">viewingQuadrantx4</a>  <span class="comment">\</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Tiles are grouped into four groups, so this sets the</span>
 <span class="mne">TAY</span>                    <span class="comment">\ correct group for the orientation of the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, this makes the shape numbers relative</span>
                        <span class="comment">\ to the viewer's orientation, so we can set the correct</span>
                        <span class="comment">\ colours for the shape's faces</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, it realigns the following tile shape</span>
                        <span class="comment">\ numbers so that the numbering starts in the quadrant</span>
                        <span class="comment">\ where the player is facing:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   1    0 0            Y = 1-3 when facing 12 o'clock</span>
                        <span class="comment">\        1 1              = 5-7 when facing 9 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 6 o'clock</span>
                        <span class="comment">\   2    1 1              = 13-15 when facing 3 o'clock</span>
                        <span class="comment">\        0 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   3    1 0</span>
                        <span class="comment">\        1 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\</span>
                        <span class="comment">\   5    1 0            Y = 1-3 when facing 3 o'clock</span>
                        <span class="comment">\        1 0              = 5-7 when facing 12 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 9 o'clock</span>
                        <span class="comment">\   6    1 0              = 13-15 when facing 6 o'clock</span>
                        <span class="comment">\        0 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   7    1 1</span>
                        <span class="comment">\        1 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\</span>
                        <span class="comment">\   9    1 1            Y = 1-3 when facing 6 o'clock</span>
                        <span class="comment">\        0 0              = 5-7 when facing 3 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 12 o'clock</span>
                        <span class="comment">\   10   0 1              = 13-15 when facing 9 o'clock</span>
                        <span class="comment">\        0 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   11   0 0</span>
                        <span class="comment">\        1 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\</span>
                        <span class="comment">\   13   0 1            Y = 1-3 when facing 9 o'clock</span>
                        <span class="comment">\        0 1              = 5-7 when facing 6 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 3 o'clock</span>
                        <span class="comment">\   14   0 0              = 13-15 when facing 12 o'clock</span>
                        <span class="comment">\        0 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   15   0 1</span>
                        <span class="comment">\        1 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use this value below when calculating the colours</span>
                        <span class="comment">\ of the two faces in two-face tiles</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ If Y mod 4 = 1 then the tile shape is the first shape</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00000001</span>         <span class="comment">\ in one of the groups above, so it's a single sloping</span>
 <span class="mne">BEQ</span> <a class="popup destination">DrawOneFaceTile</a>    <span class="comment">\ face from one horizontal edge to another, so jump to</span>
                        <span class="comment">\ DrawOneFaceTile to draw this one-face tile</span>

                        <span class="comment">\ If we get here then the tile shape is the second or</span>
                        <span class="comment">\ third shape in one of the groups above, so one corner</span>
                        <span class="comment">\ is a different altitude to the others</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now use the value of Y to pick the correct value</span>
                        <span class="comment">\ for triangleStartPoint and the correct tileShapeColour</span>
                        <span class="comment">\ table offset for the tile colour, so we can pass them</span>
                        <span class="comment">\ to DrawTwoFaceTile to draw the tile</span>

 <span class="mne">LDA</span> <a class="popup variable">triangleStart</a>,<span class="register">Y</span>    <span class="comment">\ Set triangleStartPoint = 1 for Y = 6, 7, 14, 15 ???</span>
 <span class="mne">STA</span> <a class="popup variable">triangleStartPoint</a> <span class="comment">\                          0 for Y = 2, 3, 10, 11</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = 1 for tile shapes 6, 7, 14, 15</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000100</span>         <span class="comment">\         0 for tile shapes 2, 3, 10, 11</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set C flag if viewingQuadrantOpp = 1 and A = 1</span>
 <span class="mne">ADC</span> <a class="popup variable">viewingQuadrantOpp</a> <span class="comment">\            or viewingQuadrantOpp = 2</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\            or viewingQuadrantOpp = 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Clear C flag if viewingQuadrantOpp = 0</span>
                        <span class="comment">\              or viewingQuadrantOpp = 1 and A = 0</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the tile shape to pass to DrawTwoFaceTile</span>

 <span class="mne">BCS</span> <a class="popup destination">DrawTwoFaceTile</a>    <span class="comment">\ Add 16 to the tile shape if the C flag is clear ???</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="decimal">16</span>

                        <span class="comment">\ Fall through into DrawTwoFaceTile to draw the tile</span>
                        <span class="comment">\ with two triangular (three-sided) faces</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawtwofacetile" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTwoFaceTile</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a tile with two triangular (three-sided) faces</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawtwofacetile.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawslopingtile.html">DrawSlopingTile</a> calls <a href="#drawtwofacetile">DrawTwoFaceTile</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#drawtwofacetile">DrawTwoFaceTile</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The shape of the tile to draw, amended to use as an</span>
                        <span class="argumentEntry">offset into the tileShapeColour table ???</span>

                        <span class="argumentEntry">Add 16 if either of these is true, so we use the colours</span>
                        <span class="argumentEntry">from tileShapeColour+16:</span>

                        <span class="argumentEntry">  * viewingQuadrantOpp = 0</span>

                        <span class="argumentEntry">  * viewingQuadrantOpp = 1, shape = 2, 3, 10, 11</span>

   <span class="argumentLabel">triangleStartPoint</span>   <span class="argumentEntry">The starting point to use when drawing the two triangles</span>
                        <span class="argumentEntry">(0 or 1)</span>

                        <span class="argumentEntry">  * For shapes 4 or 12 = bit 0 of viewingQuadrantOpp</span>

                        <span class="argumentEntry">  * Otherwise:</span>

                        <span class="argumentEntry">    * 1 for shapes 6, 7, 14, 15 (viewer-relative)</span>

                        <span class="argumentEntry">    * 0 for all other shapes</span>

</div></div>
<span class="label">.DrawTwoFaceTile</span><a id="drawtwofacetile" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tileShapeOffset</a>    <span class="comment">\ Set tileShapeOffset to the tile shape that's been</span>
                        <span class="comment">\ amended to use as an offset into the tileShapeColour</span>
                        <span class="comment">\ table</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the tile shape so we can use it as an index</span>
                        <span class="comment">\ into the tileShapeColour table</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 and clear bit 6 of polygonType so the call</span>
 <span class="mne">STA</span> <a class="popup variable">polygonType</a>        <span class="comment">\ to DrawPolygon draws the first triangle in the tile</span>
                        <span class="comment">\ face</span>

 <span class="mne">LDA</span> <a class="popup variable">tileShapeColour</a>,<span class="register">X</span>  <span class="comment">\ Set polygonColours to the entry for this shape from</span>
 <span class="mne">STA</span> <a class="popup variable">polygonColours</a>     <span class="comment">\ the tileShapeColour or tileShapeColour+16 table, so ww</span>
                        <span class="comment">\ draw the first polygon in the correct colour</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawPolygon</a>        <span class="comment">\ Draw the first triangular face</span>

 <span class="mne">LDA</span> <a class="popup variable">tileShapeOffset</a>    <span class="comment">\ Set polygonColours to the entry for this shape from</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">16</span>                <span class="comment">\ the other tileShapeColour table (so if the previous</span>
 <span class="mne">TAX</span>                    <span class="comment">\ colour was from tileShapeColour then we pick the next</span>
 <span class="mne">LDA</span> <a class="popup variable">tileShapeColour</a>,<span class="register">X</span>  <span class="comment">\ colour from tileShapeColour+16)</span>
 <span class="mne">STA</span> <a class="popup variable">polygonColours</a>

 <span class="mne">LDA</span> <a class="popup variable">polygonType</a>        <span class="comment">\ Set bit 6 of polygonType so both bits 6 and 7 are set,</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ so the call to DrawPolygon draws the second triangle</span>
 <span class="mne">STA</span> <a class="popup variable">polygonType</a>        <span class="comment">\ in the tile face</span>

                        <span class="comment">\ Fall into DrawPolygon to draw the second triangular</span>
                        <span class="comment">\ face</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawpolygon" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawPolygon</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a polygon</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawpolygon.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawobject.html">DrawObject</a> calls <a href="#drawpolygon">DrawPolygon</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a> calls <a href="#drawpolygon">DrawPolygon</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtwofacetile.html">DrawTwoFaceTile</a> calls <a href="#drawpolygon">DrawPolygon</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">polygonType</span>          <span class="argumentEntry">Bits 6 and 7 determine the type of polygon to draw (the</span>
                        <span class="argumentEntry">calling subroutine is in brackets):</span>

                        <span class="argumentEntry">  * %00xxxxxx = quadrilateral (DrawOneFaceTile)</span>

                        <span class="argumentEntry">  * %01xxxxxx = object polygon (DrawObject)</span>

                        <span class="argumentEntry">  * %10xxxxxx = first triangle (DrawTwoFaceTile)</span>

                        <span class="argumentEntry">  * %11xxxxxx = second triangle (DrawTwoFaceTile)</span>

   <span class="argumentLabel">screenBufferType</span>     <span class="argumentEntry">The type of buffer to use:</span>

                        <span class="argumentEntry">  * 0 = left row buffer (for up/down pan)</span>
                        <span class="argumentEntry">        for the first 256 bytes of the 320-byte row</span>

                        <span class="argumentEntry">  * 1 = right row buffer (for up/down pan)</span>
                        <span class="argumentEntry">        for the last 64 bytes of the 320-byte row</span>

                        <span class="argumentEntry">  * 2 = column buffer (for left/right pan)</span>

   <span class="argumentLabel">drawViewAngles</span>       <span class="argumentEntry">The point data:</span>

                        <span class="argumentEntry">  * When drawing tile faces, this points to polygonPoint</span>

                        <span class="argumentEntry">  * When drawing object polygons, this points to a list</span>
                        <span class="argumentEntry">    of object-relative numbers of polygon points</span>


   <span class="argumentLabel">triangleStartPoint</span>   <span class="argumentEntry">When drawing a two-face tile as a pair of triangles,</span>
                        <span class="argumentEntry">this is the number of the starting point to use (0 or 1)</span>

</div></div>
<span class="label">.DrawPolygon</span><a id="drawpolygon" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">screenBufferType</a>   <span class="comment">\ If screenBufferType >= 2 then we are drawing into the</span>
 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ column buffer, so jump to poly2 as the column is</span>
 <span class="mne">BCS</span> <a class="popup destination">poly2</a>              <span class="comment">\ always drawn in one stage</span>

                        <span class="comment">\ If we get here then screenBufferType must be 0 or 1</span>
                        <span class="comment">\ and we are drawing into the left or right row buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The left row buffer covers the leftmost 256 bytes of</span>
                        <span class="comment">\ each screen row, while the right row buffer covers the</span>
                        <span class="comment">\ remaining 64 bytes</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It would be possible to draw the polygon into both</span>
                        <span class="comment">\ buffers at once, but drawing it separately is more</span>
                        <span class="comment">\ efficient as we don't need to manage the x-coordinate</span>
                        <span class="comment">\ as a 16-bit value</span>

 <span class="mne">JSR</span> <a class="popup destination">GetPolygonLines</a>    <span class="comment">\ Calculate the horizontal lines that make up the filled</span>
                        <span class="comment">\ polygon and prepare them for drawing into the screen</span>
                        <span class="comment">\ buffer</span>

 <span class="mne">BCS</span> <a class="popup destination">poly1</a>              <span class="comment">\ If the call to GetPolygonLines set the C flag then the</span>
                        <span class="comment">\ polygon is not visible in the screen buffer and should</span>
                        <span class="comment">\ not be drawn, so jump to poly1 to skip the following</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawPolygonLines</a>   <span class="comment">\ Draw the polygon into the screen buffer, drawing the</span>
                        <span class="comment">\ shape from top to bottom, horizontal and line by line</span>

 <span class="mne">LDY</span> <a class="popup variable">screenBufferType</a>   <span class="comment">\ Set A to the following:</span>
 <span class="mne">LDA</span> <a class="popup variable">polygonGoesRight</a>,<span class="register">Y</span> <span class="comment">\</span>
                        <span class="comment">\   * polygonGoesRight when screenBufferType = 0 (we</span>
                        <span class="comment">\     have just drawn into the left row buffer)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * polygonIsToLeft when screenBufferType = 1 (we</span>
                        <span class="comment">\     have just drawn into the right row buffer)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ If A = 1 then we do not need to draw in the other row</span>
 <span class="mne">BEQ</span> <a class="popup destination">poly3</a>              <span class="comment">\ buffer, because the polygon we just drew does not</span>
                        <span class="comment">\ extend beyond the relevant edge of the buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ More specifically:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If we have just drawn into the left row buffer and</span>
                        <span class="comment">\     polygonGoesRight = 1, then the polygon does not</span>
                        <span class="comment">\     extend right out of the left row buffer, so we</span>
                        <span class="comment">\     don't need to draw anything into the right row</span>
                        <span class="comment">\     buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * If we have just drawn into the right row buffer</span>
                        <span class="comment">\     and polygonGoesLeft = 1, then the polygon does not</span>
                        <span class="comment">\     extend left out of the right row buffer, so we</span>
                        <span class="comment">\     don't need to draw anything into the left row</span>
                        <span class="comment">\     buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In either case, jump to poly3 to return from the</span>
                        <span class="comment">\ subroutine without drawing the polygon into the other</span>
                        <span class="comment">\ row buffer</span>

<span class="label">.poly1</span><a id="poly1" class="anchor"></a>

                        <span class="comment">\ We have drawn the relevant parts of the polygon into</span>
                        <span class="comment">\ either the left row buffer or right row buffer and the</span>
                        <span class="comment">\ polygon extends into the other row buffer, so now we</span>
                        <span class="comment">\ draw the polygon into the other row buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">FlipBufferType</a>     <span class="comment">\ Flip the buffer type between 0 and 1 to swap between</span>
                        <span class="comment">\ the left row buffer and right row buffer, and</span>
                        <span class="comment">\ configure the new buffer accordingly</span>

<span class="label">.poly2</span><a id="poly2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetPolygonLines</a>    <span class="comment">\ Calculate the horizontal lines that make up the filled</span>
                        <span class="comment">\ polygon and prepare them for drawing into the screen</span>
                        <span class="comment">\ buffer</span>

 <span class="mne">BCS</span> <a class="popup destination">poly3</a>              <span class="comment">\ If the call to GetPolygonLines set the C flag then the</span>
                        <span class="comment">\ polygon is not visible in the screen buffer and should</span>
                        <span class="comment">\ not be drawn, so jump to poly3 to skip the following</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawPolygonLines</a>   <span class="comment">\ Draw the polygon into the screen buffer, drawing the</span>
                        <span class="comment">\ shape from top to bottom, horizontal and line by line</span>

<span class="label">.poly3</span><a id="poly3" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-generatelandscape" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GenerateLandscape</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Generate tile data for the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/generatelandscape.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#generatelandscape">GenerateLandscape</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#generatelandscape">GenerateLandscape</a></span>
</div>
<hr class="light">
 This routine populates the tileData table with tile data for each of the tile
 corners in the landscape. The landscape consists of 31x31 square tiles, made
 up of a 32x32 grid of tile corners.

 One byte of tile data is generated for each tile corner in the landscape. Each
 byte of tile data contains two pieces of information:

   * The low nibble of each byte contains the tile shape, which describes the
     layout and structure of the landscape on that tile.

   * The high nibble of each byte contains the altitude of the tile corner in
     the front-left corner of the tile (i.e. the corner closest to the
     landscape origin). We call this tile corner the "anchor".

 As each tile is defined by a tile corner and a shape, we tend to use the terms
 "tile" and "tile corner" interchangeably, depending on the context. That said,
 for tile corners along the furthest back and rightmost edges of the landscape,
 the shape data is ignored, as there is no landscape beyond the edges.

 See the GetTileShape routine for information on the different types of tile
 shape.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">doNotPlayLandscape</span>   <span class="argumentEntry">Controls how we return from the subroutine:</span>

                        <span class="argumentEntry">  * If bit 7 is set, return from the subroutine normally</span>

                        <span class="argumentEntry">  * If bit 7 is clear, jump to PreviewLandscape once the</span>
                        <span class="argumentEntry">    landscape is generated</span>

</div></div>
<span class="label">.GenerateLandscape</span><a id="generatelandscape" class="anchor"></a>

                        <span class="comment">\ We start by generating 81 seed numbers, though these</span>
                        <span class="comment">\ are ignored (with one exception)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ These numbers get stored in the stripData table, from</span>
                        <span class="comment">\ stripData+80 down to stripData+0, but there's no</span>
                        <span class="comment">\ specific reason for this - they could just as easily</span>
                        <span class="comment">\ be discarded</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The purpose of this step is to get the seed number</span>
                        <span class="comment">\ generator to a point where the output is predictable</span>
                        <span class="comment">\ and stable, so that every time we generate a sequence</span>
                        <span class="comment">\ of seed numbers for a landscape, they are exactly the</span>
                        <span class="comment">\ same each time while being unique to that landscape</span>
                        <span class="comment">\ number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ That said, the third seed number that's generated and</span>
                        <span class="comment">\ stored at stripData+78 is used by the anti-cracker</span>
                        <span class="comment">\ code in the SetCrackerSeed and CheckCrackerSeed</span>
                        <span class="comment">\ routines, as it contains the high byte of the BCD</span>
                        <span class="comment">\ landscape number (this is because the seed generator</span>
                        <span class="comment">\ is initialised using the landscape number, and the</span>
                        <span class="comment">\ third number out of the shift register is unchanged</span>
                        <span class="comment">\ and still contains the initial value of that byte -</span>
                        <span class="comment">\ see the InitialiseSeeds routine for more details)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">80</span>                <span class="comment">\ Set a counter in X so we can generate 81 seed numbers</span>

<span class="label">.land1</span><a id="land1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">STA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Set the X-th entry in the stripData table to the seed</span>
                        <span class="comment">\ number in A</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the counter</span>

 <span class="mne">BPL</span> <a class="popup destination">land1</a>              <span class="comment">\ Loop back until we have generated all 81 seed numbers</span>

                        <span class="comment">\ We now set the value of tileDataMultiplier for this</span>
                        <span class="comment">\ landscape, which is a multiplier that we apply to the</span>
                        <span class="comment">\ altitudes of the tile corners to alter the steepness</span>
                        <span class="comment">\ of the landscape</span>

 <span class="mne">LDA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If this is not landscape 0000, jump to land2</span>
 <span class="mne">BNE</span> <a class="popup destination">land2</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">24</span>                <span class="comment">\ This is landscape 0000, so set A = 24 to use for the</span>
                        <span class="comment">\ tile data multiplier in tileDataMultiplier</span>

 <span class="mne">BNE</span> <a class="popup destination">land3</a>              <span class="comment">\ Jump to land3 to skip the following (this BNE is</span>
                        <span class="comment">\ effectively a JMP as A is never zero)</span>

<span class="label">.land2</span><a id="land2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeed0To22</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to the range 0 to 22</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + 14</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">14</span>                <span class="comment">\</span>
                        <span class="comment">\ So A is now a number in the range 14 to 36</span>

<span class="label">.land3</span><a id="land3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tileDataMultiplier</a> <span class="comment">\ Set tileDataMultiplier = A</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this is 24 for landscape 0000 and in the range 14</span>
                        <span class="comment">\ to 36 for all other landscapes</span>

                        <span class="comment">\ We now populate the tileData table with tile corner</span>
                        <span class="comment">\ altitudes, which we store in the low nibble of the</span>
                        <span class="comment">\ tile data (for now)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ Call ProcessTileData with A = &80 to set the tile data</span>
 <span class="mne">JSR</span> <a class="popup destination">ProcessTileData</a>    <span class="comment">\ for the whole landscape to the next set of numbers</span>
                        <span class="comment">\ from the landscape's sequence of seed numbers</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00000000</span>         <span class="comment">\ Call SmoothTileData with bit 6 of A clear, to smooth</span>
 <span class="mne">JSR</span> <a class="popup destination">SmoothTileData</a>     <span class="comment">\ the landscape in lines of tile corners, working along</span>
                        <span class="comment">\ rows from left to right and along columns from front</span>
                        <span class="comment">\ to back, and smoothing each tile by setting each tile</span>
                        <span class="comment">\ corner's altitude to the average of its altitude with</span>
                        <span class="comment">\ the three following tile corners</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This process is repeated twice by the single call to</span>
                        <span class="comment">\ SmoothTileData</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Call ProcessTileData with A = 1 to scale the tile data</span>
 <span class="mne">JSR</span> <a class="popup destination">ProcessTileData</a>    <span class="comment">\ for the whole landscape by the tileDataMultiplier</span>
                        <span class="comment">\ before capping each byte of data to between 1 and 11</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This capping process ensures that when we place the</span>
                        <span class="comment">\ tile altitude in the top nibble of the tile data, we</span>
                        <span class="comment">\ never have both bits 6 and 7 set (these bits can</span>
                        <span class="comment">\ therefore be used to identify whether or not a tile</span>
                        <span class="comment">\ contains an object)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ Call SmoothTileData with bit 6 of A set, to smooth</span>
 <span class="mne">JSR</span> <a class="popup destination">SmoothTileData</a>     <span class="comment">\ the landscape in lines of tile corners, from the rear</span>
                        <span class="comment">\ row to the front row and then from the right column to</span>
                        <span class="comment">\ the left column, smoothing each outlier tile corner by</span>
                        <span class="comment">\ setting its altitude to that of its closest immediate</span>
                        <span class="comment">\ neighbour (where "closest" is in terms of altitude)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This smoothes over any single-point spikes or troughs</span>
                        <span class="comment">\ in each row and column</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This process is repeated twice by the single call to</span>
                        <span class="comment">\ SmoothTileData</span>

                        <span class="comment">\ The tileData table now contains the altitude of each</span>
                        <span class="comment">\ tile corner, with each altitude in the range 1 to 11,</span>
                        <span class="comment">\ so the altitude data is in the low nibble of each byte</span>
                        <span class="comment">\ of tile data</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now calculate the tile shape for the tiles anchored</span>
                        <span class="comment">\ at each tile corner in turn, where the anchor is in</span>
                        <span class="comment">\ the front-left corner of the tile (i.e. nearest the</span>
                        <span class="comment">\ origin)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that the last tile corners at the right end of</span>
                        <span class="comment">\ each row or at the back of each column do not anchor</span>
                        <span class="comment">\ any tiles, as they are at the edge (so their shapes</span>
                        <span class="comment">\ are not calculated)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We put the tile shape into the high nibble of the tile</span>
                        <span class="comment">\ data (for now)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Set zTile = 30 so we start iterating from the rear,</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ skipping the row right at the back as the tile corners</span>
                        <span class="comment">\ in that row do not anchor any tiles (so zTile iterates</span>
                        <span class="comment">\ from 30 to 0 in the outer loop)</span>

<span class="label">.land4</span><a id="land4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Set xTile = 30 so we start iterating from the right,</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ skipping the rightmost column as the tile corners</span>
                        <span class="comment">\ in that column do not anchor any tiles (so xTile</span>
                        <span class="comment">\ iterates from 30 to 0 in the inner loop)</span>

<span class="label">.land5</span><a id="land5" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileShape</a>       <span class="comment">\ Set X to the shape of the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This will be in the range 1 to 11 (so it fits into</span>
                        <span class="comment">\ the low nibble)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), which we ignore, but this also sets</span>
                        <span class="comment">\ the tile page in tileDataPage and the index in Y, so</span>
                        <span class="comment">\ tileDataPage+Y now points to the tile data entry in</span>
                        <span class="comment">\ the tileData table</span>

                        <span class="comment">\ We now put the tile shape into the high nibble of the</span>
                        <span class="comment">\ tile data, so the low nibble of the tile data contains</span>
                        <span class="comment">\ the tile altitude and the high nibble contains the</span>
                        <span class="comment">\ tile shape (for now)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Put the tile shape in X into the high nibble of A by</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ shifting X to the left by three spaces and OR'ing the</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ result into the tile data at tileData + Y</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ This works because both the tile altitude and tile</span>
 <span class="mne">ORA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ shape fit into the range 0 to 15, or four bits</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">DEC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Decrement the tile x-coordinate in the inner loop</span>

 <span class="mne">BPL</span> <a class="popup destination">land5</a>              <span class="comment">\ Loop back until we have processed all the tile corners</span>
                        <span class="comment">\ in the tile row at z-coordinate zTile, working from</span>
                        <span class="comment">\ right to left</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement outer loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">land4</a>              <span class="comment">\ Loop back until we have processed all the tile rows in</span>
                        <span class="comment">\ the landscape, working from the back of the landscape</span>
                        <span class="comment">\ all the way to the front row</span>

                        <span class="comment">\ By this point the high nibble of each byte of tile</span>
                        <span class="comment">\ data contains the tile shape and the low nibble</span>
                        <span class="comment">\ contains the tile altitude, so now we swap these</span>
                        <span class="comment">\ around</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We do this so that we can reuse bits 6 and 7 to in</span>
                        <span class="comment">\ each byte of tile data to store the presence of an</span>
                        <span class="comment">\ object on the tile, as moving the tile altitude into</span>
                        <span class="comment">\ the high nibble means that bits 6 and 7 will never</span>
                        <span class="comment">\ be set (as the altitude is in the range 0 to 11)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can therefore set both bit 6 and 7 to indicate that</span>
                        <span class="comment">\ a tile contains an object, and we can reuse the other</span>
                        <span class="comment">\ bits to store the object information (as we only ever</span>
                        <span class="comment">\ place objects on flat tiles, so we can discard the</span>
                        <span class="comment">\ shape data)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Call ProcessTileData with A = 2 to swap the high and</span>
 <span class="mne">JSR</span> <a class="popup destination">ProcessTileData</a>    <span class="comment">\ low nibbles of all the tile data for the whole</span>
                        <span class="comment">\ landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So now the low nibble of each byte of tile data</span>
                        <span class="comment">\ contains the tile shape and the high nibble contains</span>
                        <span class="comment">\ the tile altitude, as required</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also sets the N flag, so a BMI branch would be</span>
                        <span class="comment">\ taken at this point (see the following instruction)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the SmoothTileCorners routine has modified the</span>
                        <span class="comment">\ return address on the stack, then this RTS instruction</span>
                        <span class="comment">\ will actually take us to JumpToPreview+1, and the BMI</span>
                        <span class="comment">\ branch instruction at JumpToPreview+1 will be taken</span>
                        <span class="comment">\ because the call to ProcessTileData sets the N flag,</span>
                        <span class="comment">\ so this RTS will end up taking us to PreviewLandscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the SmoothTileCorners routine has not modified the</span>
                        <span class="comment">\ return address, then the RTS will take us to the</span>
                        <span class="comment">\ SecretCodeError routine, just after the original</span>
                        <span class="comment">\ caller, i.e. just after the JSR GenerateLandscape</span>
                        <span class="comment">\ instruction (which will either be at the end of the</span>
                        <span class="comment">\ main title loop if the player enters an incorrect</span>
                        <span class="comment">\ secret code, or when displaying a landscape's secret</span>
                        <span class="comment">\ code after the level is completed)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-processtiledata" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ProcessTileData</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Process the tile data for all tiles in the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/processtiledata.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#processtiledata">ProcessTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/generatelandscape.html">GenerateLandscape</a> calls <a href="#processtiledata">ProcessTileData</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">Controls what we do to the tile data:</span>

                        <span class="argumentEntry">  * 0 = zero all the tile data</span>

                        <span class="argumentEntry">  * 1 = scale all the tile data by the multiplier in</span>
                        <span class="argumentEntry">        tileDataMultiplier before capping it to a value</span>
                        <span class="argumentEntry">        between 1 and 11</span>

                        <span class="argumentEntry">  * 2 = swap the high and low nibbles of all the tile</span>
                        <span class="argumentEntry">        data</span>

                        <span class="argumentEntry">  * &80 = set the tile data to the next set of numbers</span>
                        <span class="argumentEntry">          from the landscape's sequence of seed numbers</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">N flag</span>               <span class="argumentEntry">The N flag is set (so a BMI branch will be taken)</span>

</div></div>
<span class="label">.ProcessTileData</span><a id="processtiledata" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">processAction</a>      <span class="comment">\ Store the action in processAction for later</span>

                        <span class="comment">\ We now loop through all the tiles in the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The landscape consists of 31x31 square tiles, like a</span>
                        <span class="comment">\ chess board that's sitting on a table in front of us,</span>
                        <span class="comment">\ going into the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The landscape is defined by the altitudes of the</span>
                        <span class="comment">\ corners of each of the tile, so that's a 32x32 grid of</span>
                        <span class="comment">\ altitudes</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The x-axis is along the front edge, from left to</span>
                        <span class="comment">\ right, while the z-axis goes into the screen, away</span>
                        <span class="comment">\ from us</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We iterate through the tile corners with a nested</span>
                        <span class="comment">\ loop, with zTile going from 31 to 0 (so that's from</span>
                        <span class="comment">\ back to front)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For each zTile, xTile also goes from 31 to 0, so</span>
                        <span class="comment">\ that's from right to left</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we work through the landscape, starting with the</span>
                        <span class="comment">\ row of tile corners at the back (which we work through</span>
                        <span class="comment">\ from right to left), and then doing the next row</span>
                        <span class="comment">\ forward, looping until we reach the front row</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set zTile = 31 so we start iterating from the back row</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ (so zTile iterates from 31 to 0 in the outer loop)</span>

<span class="label">.proc1</span><a id="proc1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set xTile = 31 so we start iterating from the right</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ end of the current row (so xTile iterates from 31 to 0</span>
                        <span class="comment">\ in the inner loop)</span>

<span class="label">.proc2</span><a id="proc2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), which we ignore, but this also sets</span>
                        <span class="comment">\ the tile page in tileDataPage and the index in Y, so</span>
                        <span class="comment">\ tileDataPage+Y now points to the tile data entry in</span>
                        <span class="comment">\ the tileData table</span>

 <span class="mne">LDA</span> <a class="popup variable">processAction</a>      <span class="comment">\ Set A to the argument that was passed to the routine</span>
                        <span class="comment">\ and which we stored in processAction,</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This specifies how we process the tile data</span>

 <span class="mne">BEQ</span> <a class="popup destination">proc8</a>              <span class="comment">\ If processAction = 0 then jump to proc8 to zero the</span>
                        <span class="comment">\ tile data for the tile anchored at (xTile, zTile)</span>

 <span class="mne">BMI</span> <a class="popup destination">proc7</a>              <span class="comment">\ If processAction = &80 then jump to proc7 to set the</span>
                        <span class="comment">\ tile data for the tile anchored at (xTile, zTile) to</span>
                        <span class="comment">\ the next number from the landscape's sequence of seed</span>
                        <span class="comment">\ numbers</span>

                        <span class="comment">\ If we get here then processAction must be 1 or 2 (as</span>
                        <span class="comment">\ the routine is only ever called with A = 0, 1, 2 or</span>
                        <span class="comment">\ &80)</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ If processAction = 1 then this sets the C flag,</span>
                        <span class="comment">\ otherwise processAction = 2 and this clears the C flag</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">BCS</span> <a class="popup destination">proc3</a>              <span class="comment">\ If the C flag is set then processAction = 1, so jump</span>
                        <span class="comment">\ to proc3</span>

                        <span class="comment">\ If we get here then processAction = 2, so now we swap</span>
                        <span class="comment">\ the high and low nibble of the tile data</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set bits 0-3 of T to the high nibble (bits 4-7) of the</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ tile data in A</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Set A once again to the tile data for the tile</span>
                        <span class="comment">\ anchored at (xTile, zTile)</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set bits 4-7 of A to the low nibble (bits 0-3) of the</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ tile data in A</span>
 <span class="mne">ASL</span> <span class="register">A</span>
 <span class="mne">ASL</span> <span class="register">A</span>

 <span class="mne">ORA</span> <a class="popup variable">T</a>                  <span class="comment">\ Merge A and T, so A now contains its original high</span>
                        <span class="comment">\ nibble in bits 0-3 (from T) and its original low</span>
                        <span class="comment">\ nibble in bits 4-7 (from A)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this swaps the high and low nibbles around in the</span>
                        <span class="comment">\ tile data in A</span>

 <span class="mne">JMP</span> <a class="popup destination">proc8</a>              <span class="comment">\ Jump to proc8 to store A as the tile data for the tile</span>
                        <span class="comment">\ we are processing</span>

<span class="label">.proc3</span><a id="proc3" class="anchor"></a>

                        <span class="comment">\ If we get here then processAction = 1, so we now do</span>
                        <span class="comment">\ various manipulations, including multiplying the</span>
                        <span class="comment">\ tile data by the multiplier in tileDataMultiplier</span>
                        <span class="comment">\ and capping the result to a positive number between</span>
                        <span class="comment">\ 1 and 11</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At this point the tile data contains a seed number,</span>
                        <span class="comment">\ so this process converts it into a value that we can</span>
                        <span class="comment">\ use as the altitude of the tile corner</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set A = tile data - 128</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">128</span>

 <span class="mne">PHP</span>                    <span class="comment">\ Store the flags from the subtraction, so we can set</span>
                        <span class="comment">\ the sign of the scaled altitude below</span>

 <span class="mne">BPL</span> <a class="popup destination">proc4</a>              <span class="comment">\ If the result of the subtraction in A is positive,</span>
                        <span class="comment">\ skip the following as A is already positive</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ The result in A is negative, so negate it using two's</span>
 <span class="mne">CLC</span>                    <span class="comment">\ complement, so we have:</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\</span>
                        <span class="comment">\   A = |tile data - 128|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This negation reflects negative altitudes from below</span>
                        <span class="comment">\ sea level to the equivalent altitude above sea level</span>

<span class="label">.proc4</span><a id="proc4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set U = A</span>
                        <span class="comment">\       = |tile data - 128|</span>

 <span class="mne">LDA</span> <a class="popup variable">tileDataMultiplier</a> <span class="comment">\ Set A to the multiplier that we need to apply to the</span>
                        <span class="comment">\ tile data, which is in the range 14 to 36</span>

 <span class="mne">JSR</span> <a class="popup destination">Multiply8x8</a>        <span class="comment">\ Set (A T) = A * U</span>
                        <span class="comment">\           = tileDataMultiplier * |tile data - 128|</span>

 <span class="mne">PLP</span>                    <span class="comment">\ Restore the flags from the subtraction above, so</span>
                        <span class="comment">\ the N flag contains the sign of (tile data - 128)</span>
                        <span class="comment">\ (clear if it is positive, set if it is negative)</span>

 <span class="mne">JSR</span> <a class="popup destination">Absolute16Bit</a>      <span class="comment">\ Set the sign of (A T) to match the result of the</span>
                        <span class="comment">\ subtraction above, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A T) = tileDataMultiplier * (tile data - 128)</span>

                        <span class="comment">\ So if the original tile data represents a landscape</span>
                        <span class="comment">\ altitude, with "sea level" at altitude 128, then the</span>
                        <span class="comment">\ high byte of this calculation in A represents a</span>
                        <span class="comment">\ scaling of the altitude by tileDataMultiplier / 256,</span>
                        <span class="comment">\ with the scaling centred around sea level</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that mountain peaks get higher and marine</span>
                        <span class="comment">\ trenches get deeper, stretching away from sea level</span>
                        <span class="comment">\ at altitude 128 in the original data</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As tileDataMultiplier is in the range 14 to 36, this</span>
                        <span class="comment">\ transforms the tile data values as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Values start out in the range 0 to 255</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Converting to |tile data - 128| translates them</span>
                        <span class="comment">\     into values in the range 0 to 127, representing</span>
                        <span class="comment">\     magnitudes of altitude (0 = sea level, 127 = top</span>
                        <span class="comment">\     of Everest or bottom of Mariana Trench, stack</span>
                        <span class="comment">\     contains flags denoting high altitude or murky</span>
                        <span class="comment">\     depths)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Multiplying by 14/256 (the minimum multiplier)</span>
                        <span class="comment">\     changes the range into 0 to 6</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Multiplying by 36/256 (the maximum multiplier)</span>
                        <span class="comment">\     changes the range into 0 to 17</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Reapplying the sign converts the magnitudes back</span>
                        <span class="comment">\     into depths or heights</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the above takes the seed numbers in the original</span>
                        <span class="comment">\ tile data and transforms then into values of A with a</span>
                        <span class="comment">\ maximum range of -17 to +17 (for higher multipliers)</span>
                        <span class="comment">\ or -6 to +6 (for lower multipliers)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now take this result and do various additions and</span>
                        <span class="comment">\ cappings to change the result into a positive number</span>
                        <span class="comment">\ between 1 and 11</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + 6</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\</span>
                        <span class="comment">\ So the ranges for A are now:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Minimum multiplier range is -1 to +13</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Maximum multiplier range is -11 to +23</span>

 <span class="mne">BPL</span> <a class="popup destination">proc5</a>              <span class="comment">\ If A is positive then jump to proc5 to skip the</span>
                        <span class="comment">\ following</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Otherwise A is negative, so set A = 0</span>

<span class="label">.proc5</span><a id="proc5" class="anchor"></a>

                        <span class="comment">\ By this point A is a positive number and the ranges</span>
                        <span class="comment">\ for A are now:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Minimum multiplier range is 0 to 13</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Maximum multiplier range is 0 to 23</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + 1</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

                        <span class="comment">\ By this point A is a positive number and the ranges</span>
                        <span class="comment">\ for A are now:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Minimum multiplier range is 1 to 14</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Maximum multiplier range is 1 to 24</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">12</span>                <span class="comment">\ If A &lt; 12 then jump to proc6 to skip the following</span>
 <span class="mne">BCC</span> <a class="popup destination">proc6</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">11</span>                <span class="comment">\ Otherwise A >= 12, so set A = 11</span>

<span class="label">.proc6</span><a id="proc6" class="anchor"></a>

                        <span class="comment">\ By this point, A is a positive number between 1 and 11</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For minimum values of the multiplier we have only lost</span>
                        <span class="comment">\ the very low and very high values in the range</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For maximum values of the multiplier we have lost</span>
                        <span class="comment">\ around one-third at the top end and one-third at the</span>
                        <span class="comment">\ bottom end</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can now use this as the altitude of the tile</span>
                        <span class="comment">\ corner, which we can feed into the smoothing routines</span>
                        <span class="comment">\ to generate a gently rolling landscape that is</span>
                        <span class="comment">\ suitable for the game</span>

 <span class="mne">JMP</span> <a class="popup destination">proc8</a>              <span class="comment">\ Jump to proc8 to store A as the tile data for the tile</span>
                        <span class="comment">\ we are processing</span>

<span class="label">.proc7</span><a id="proc7" class="anchor"></a>

                        <span class="comment">\ If we get here then the argument in A is &80, so we</span>
                        <span class="comment">\ fill the tile data table with seed numbers</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

<span class="label">.proc8</span><a id="proc8" class="anchor"></a>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Store A as the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">DEC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Decrement the tile x-coordinate in the inner loop</span>

 <span class="mne">BPL</span> <a class="popup destination">proc2</a>              <span class="comment">\ Loop back until we have processed all the tiles in the</span>
                        <span class="comment">\ tile row at z-coordinate zTile, working from right to</span>
                        <span class="comment">\ left</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement the outer loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">proc1</a>              <span class="comment">\ Loop back until we have processed all the tile rows in</span>
                        <span class="comment">\ the landscape, working from the back row of the</span>
                        <span class="comment">\ landscape all the way to the front row</span>

                        <span class="comment">\ Note that by this point the N flag is set, which means</span>
                        <span class="comment">\ a BMI branch would be taken (this is important when</span>
                        <span class="comment">\ analysing the intentionally confusing flow of the main</span>
                        <span class="comment">\ title loop created by the stack modifications in the</span>
                        <span class="comment">\ GenerateLandscape, SmoothTileCorners and JumpToPreview</span>
                        <span class="comment">\ routines)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-smoothtiledata" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SmoothTileData</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Smooth the entire landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/smoothtiledata.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/generatelandscape.html">GenerateLandscape</a> calls <a href="#smoothtiledata">SmoothTileData</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">Controls how we smooth the tile data:</span>

                        <span class="argumentEntry">  * Bit 6 clear = smooth each row/column of tile corners</span>
                        <span class="argumentEntry">                  by working along the row/column and</span>
                        <span class="argumentEntry">                  setting each tile corner's altitude to</span>
                        <span class="argumentEntry">                  the average of its altitude with the</span>
                        <span class="argumentEntry">                  three following tile corners, working</span>
                        <span class="argumentEntry">                  along rows from left to right and</span>
                        <span class="argumentEntry">                  along columns from front to back</span>

                        <span class="argumentEntry">  * Bit 6 set = smooth each row/column of tile corners</span>
                        <span class="argumentEntry">                by working along the row/column and</span>
                        <span class="argumentEntry">                setting the altitude of each outlier</span>
                        <span class="argumentEntry">                tile corner to that of its closest</span>
                        <span class="argumentEntry">                immediate neighbour in terms of altitude</span>
                        <span class="argumentEntry">                (i.e. smooth out single-point spikes or</span>
                        <span class="argumentEntry">                troughs in the row/column)</span>

</div></div>
<span class="label">.SmoothTileData</span><a id="smoothtiledata" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">smoothingAction</a>    <span class="comment">\ Store the action in smoothingAction so the calls to</span>
                        <span class="comment">\ SmoothTileCorners can access it</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ We perform the smoothing process twice, so set a loop</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ counter in loopCounter to count down from 2</span>

<span class="label">.smoo1</span><a id="smoo1" class="anchor"></a>

                        <span class="comment">\ We start by working our way through the landscape,</span>
                        <span class="comment">\ smoothing the row of tile corners at the back (i.e. at</span>
                        <span class="comment">\ tile z-coordinate 31), and then smoothing the next row</span>
                        <span class="comment">\ forward, looping until we reach the front row</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set zTile = 31 so we start iterating from the back row</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ (so zTile iterates from 31 to 0 in the following loop)</span>

<span class="label">.smoo2</span><a id="smoo2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">00000000</span>          <span class="comment">\ Call SmoothTileCorners with bit 7 of A clear to smooth</span>
 <span class="mne">JSR</span> <a class="popup destination">SmoothTileCorners</a>  <span class="comment">\ the row of tile corners at z-coordinate zTile</span>

 <span class="mne">DEC</span> <a class="popup variable">zTile</a>              <span class="comment">\ Decrement the tile z-coordinate to move forward by one</span>
                        <span class="comment">\ tile row</span>

 <span class="mne">BPL</span> <a class="popup destination">smoo2</a>              <span class="comment">\ Loop back until we have smoothed all 32 rows</span>

                        <span class="comment">\ Next we work our way through the landscape from right</span>
                        <span class="comment">\ to left, smoothing the column of tile corners on the</span>
                        <span class="comment">\ right (i.e. the column of tile corners going into the</span>
                        <span class="comment">\ screen at tile x-coordinate 31), and then smoothing</span>
                        <span class="comment">\ the next column to the left, looping until we reach</span>
                        <span class="comment">\ the column along the left edge of the landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set xTile = 31 so we start iterating from the right</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ column (so xTile iterates from 31 to 0 in the</span>
                        <span class="comment">\ following loop)</span>

<span class="label">.smoo3</span><a id="smoo3" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Call SmoothTileCorners with bit 7 of A set to smooth</span>
 <span class="mne">JSR</span> <a class="popup destination">SmoothTileCorners</a>  <span class="comment">\ the column of tile corners at x-coordinate xTile</span>

 <span class="mne">DEC</span> <a class="popup variable">xTile</a>              <span class="comment">\ Decrement the tile x-coordinate to move left by one</span>
                        <span class="comment">\ tile column</span>

 <span class="mne">BPL</span> <a class="popup destination">smoo3</a>              <span class="comment">\ Loop back until we have smoothed all 32 columns</span>

 <span class="mne">DEC</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BNE</span> <a class="popup destination">smoo1</a>              <span class="comment">\ Loop back until we have done the whole smoothing</span>
                        <span class="comment">\ process twice</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettiledata" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileData</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Get the tile data and tile data address for a specific tile</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettiledata.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/deleteobject.html">DeleteObject</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/findobjecttodrain.html">FindObjectToDrain</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/followgazevector_part_2_of_5.html">FollowGazeVector (Part 2 of 5)</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/generatelandscape.html">GenerateLandscape</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gethighesttiles.html">GetHighestTiles</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilealtitude.html">GetTileAltitude</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileshape.html">GetTileShape</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/placeobjectbelow.html">PlaceObjectBelow</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/placeobjectontile.html">PlaceObjectOnTile</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_1_of_2.html">ProcessActionKeys (Part 1 of 2)</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processtiledata.html">ProcessTileData</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/smoothtilecorners_part_1_of_4.html">SmoothTileCorners (Part 1 of 4)</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/smoothtilecorners_part_4_of_4.html">SmoothTileCorners (Part 4 of 4)</a> calls <a href="#gettiledata">GetTileData</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawncharacter3d_part_2_of_2.html">SpawnCharacter3D (Part 2 of 2)</a> calls <a href="#gettiledata">GetTileData</a></span>
</div>
<hr class="light">
 The tile data table at tileData is made up of sequences of 32 columns of tile
 corners going into the screen, where each column goes from z = 0 to 31 along
 the same x-coordinate, with the columns interleaved in steps of 4 like this:

   &0400-&041F = 32-corner column going into the screen at x =  0
   &0420-&043F = 32-corner column going into the screen at x =  4
   &0440-&045F = 32-corner column going into the screen at x =  8
   &0460-&047F = 32-corner column going into the screen at x = 12
   &0480-&049F = 32-corner column going into the screen at x = 16
   &04A0-&04BF = 32-corner column going into the screen at x = 20
   &04C0-&04DF = 32-corner column going into the screen at x = 24
   &04E0-&04FF = 32-corner column going into the screen at x = 28

   &0500-&051F = 32-corner column going into the screen at x =  1
   &0520-&053F = 32-corner column going into the screen at x =  5
   &0540-&055F = 32-corner column going into the screen at x =  9
   &0560-&057F = 32-corner column going into the screen at x = 13
   &0580-&059F = 32-corner column going into the screen at x = 17
   &05A0-&05BF = 32-corner column going into the screen at x = 21
   &05C0-&05DF = 32-corner column going into the screen at x = 25
   &05E0-&05FF = 32-corner column going into the screen at x = 29

   &0600-&061F = 32-corner column going into the screen at x =  2
   &0620-&063F = 32-corner column going into the screen at x =  6
   &0640-&065F = 32-corner column going into the screen at x = 10
   &0660-&067F = 32-corner column going into the screen at x = 14
   &0680-&069F = 32-corner column going into the screen at x = 18
   &06A0-&06BF = 32-corner column going into the screen at x = 22
   &06C0-&06DF = 32-corner column going into the screen at x = 26
   &06E0-&06FF = 32-corner column going into the screen at x = 30

   &0700-&071F = 32-corner column going into the screen at x =  3
   &0720-&073F = 32-corner column going into the screen at x =  7
   &0740-&075F = 32-corner column going into the screen at x = 11
   &0760-&077F = 32-corner column going into the screen at x = 15
   &0780-&079F = 32-corner column going into the screen at x = 19
   &07A0-&07BF = 32-corner column going into the screen at x = 23
   &07C0-&07DF = 32-corner column going into the screen at x = 27
   &07E0-&07FF = 32-corner column going into the screen at x = 31

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">xTile</span>                <span class="argumentEntry">A tile corner x-coordinate (0 to 31)</span>

   <span class="argumentLabel">zTile</span>                <span class="argumentEntry">A tile corner z-coordinate (0 to 31)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The tile data for the tile anchored at (xTile, zTile):</span>

                        <span class="argumentEntry">  * If the tile does not contain an object, then:</span>

                        <span class="argumentEntry">    * The tile shape is in the low nibble (0 to 15)</span>

                        <span class="argumentEntry">    * The tile altitude is in the high nibble (1 to 11)</span>

                        <span class="argumentEntry">  * If the tile contains an object, then:</span>

                        <span class="argumentEntry">    * Bits 0 to 5 contain the object number of the</span>
                        <span class="argumentEntry">      object on the tile (0 to 63)</span>

                        <span class="argumentEntry">    * Bits 6 and 7 are both set</span>

   <span class="argumentLabel">tileDataPage(1 0)</span>    <span class="argumentEntry">The address of the page containing the tile data</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The offset from tileDataPage(1 0) of the tile data</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Determines whether the tile contains an object:</span>

                        <span class="argumentEntry">  * Set if this tile contains an object</span>

                        <span class="argumentEntry">  * Clear if this tile does not contain an object</span>

</div></div>
<span class="label">.GetTileData</span><a id="gettiledata" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set Y = (xTile &lt;&lt; 3 and %11100000) + zTile</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\       = (xTile >> 2 and %00000111) &lt;&lt; 5 + zTile</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\       = (xTile div 4) * &20 + zTile</span>
 <span class="mne">ASL</span> <span class="register">A</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11100000</span>
 <span class="mne">ORA</span> <a class="popup variable">zTile</a>
 <span class="mne">TAY</span>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set A = bits 0-1 of xTile</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\       = xTile mod 4</span>

                        <span class="comment">\ The low byte of tileDataPage(1 0) gets set to zero in</span>
                        <span class="comment">\ ResetVariables and is never changed</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The low byte of tileData is also zero, as we know that</span>
                        <span class="comment">\ tileData is &0400</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in the following, we are just adding the high bytes</span>
                        <span class="comment">\ to get a result that is on a page boundary</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the following:</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">tileData</a><span class="bracket">)</span>      <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">tileDataPage</a><span class="operator">+</span><span class="decimal">1</span>     <span class="comment">\   tileDataPage(1 0) = tileData + (A 0)</span>
                        <span class="comment">\                     = tileData + (xTile mod 4) * &100</span>

                        <span class="comment">\ So we now have the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   tileDataPage(1 0) = tileData + (xTile mod 4) * &100</span>
                        <span class="comment">\</span>
                        <span class="comment">\   Y = (xTile div 4) * &20 + zTile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The address in tileDataPage(1 0) is the page within</span>
                        <span class="comment">\ tileData for the tile anchored at (xTile, zTile), and</span>
                        <span class="comment">\ is always one of &0400, &0500, &0600 or &0700 because</span>
                        <span class="comment">\ (xTile mod 4) is one of 0, 1, 2 or 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value of Y is the offset within that page of the</span>
                        <span class="comment">\ tile data for the tile anchored at (xTile, zTile)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can therefore fetch the tile data for the specified</span>
                        <span class="comment">\ tile using Y as an index offset from tileDataPage(1 0)</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set the C flag if A >= %11000000, which will be the</span>
                        <span class="comment">\ case if both bit 6 and bit 7 of A are set</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-absolute16bit"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-absolute16bit">Absolute16Bit</a> (category: Maths (Arithmetic))</div><div class="summary">Calculate the absolute value (modulus) of a 16-bit number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-checkforsamepankey"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-checkforsamepankey">CheckForSamePanKey</a> (category: Keyboard)</div><div class="summary">Check to see whether the same pan key is being held down compared to the last time we checked</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawflattile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawflattile">DrawFlatTile</a> (category: Drawing the landscape)</div><div class="summary">Draw a flat tile in the correct colour for the chess board effect that we use to draw the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscaperow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscaperow">DrawLandscapeRow</a> (category: Drawing the landscape)</div><div class="summary">Draw a row of tiles between the left visible edge and the right visible, in two parts towards each side of the viewer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a> (category: Drawing objects)</div><div class="summary">Draw a 3D object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawobjectstack"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a> (category: Drawing objects)</div><div class="summary">Draw an entire stack of objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawonefacetile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawonefacetile">DrawOneFaceTile</a> (category: Drawing the landscape)</div><div class="summary">Draw a tile with one quadrilateral (four-sided) face</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawpolygon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawpolygon">DrawPolygon</a> (category: Drawing polygons)</div><div class="summary">Draw a polygon</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawpolygonlines"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-1-of-4">DrawPolygonLines (Part 1 of 4)</a> (category: Drawing polygons)</div><div class="summary">Draw an analysed polygon into the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawslopingtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawslopingtile">DrawSlopingTile</a> (category: Drawing the landscape)</div><div class="summary">Draw a sloping tile that is not shape 4 or 12</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtileandobjects"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawtileandobjects">DrawTileAndObjects</a> (category: Drawing the landscape)</div><div class="summary">Draw a tile and any objects stacked on it</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtwofacetile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawtwofacetile">DrawTwoFaceTile</a> (category: Drawing the landscape)</div><div class="summary">Draw a tile with two triangular (three-sided) faces</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-flipbuffertype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-flipbuffertype">FlipBufferType</a> (category: Screen buffer)</div><div class="summary">Flip the buffer type between buffer type 0 (left row buffer) and buffer type 1 (right row buffer)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gethypotenuse"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-gethypotenuse">GetHypotenuse</a> (category: Maths (Geometry))</div><div class="summary">Calculate the hypotenuse from an angle and two triangle sides with one lookup and one multiplication (so without a square root)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gethypotenuseangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-gethypotenuseangle">GetHypotenuseAngle</a> (category: Maths (Geometry))</div><div class="summary">Calculate the angle of the hypotenuse in a right-angle triangle given the two non-hypotenuse sides (i.e. two orthogonal axes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseed0to22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-getnextseed0to22">GetNextSeed0To22</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to the next number from the landscape's sequence of seed numbers, converted to the range 0 to 22</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseednumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-getnextseednumber">GetNextSeedNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a seed number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getpitchangledelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-getpitchangledelta">GetPitchAngleDelta</a> (category: Maths (Geometry))</div><div class="summary">Calculate the pitch angle of a vector relative to an object's pitch angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getpolygonlines"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-2-of-6">GetPolygonLines (Part 2 of 6)</a> (category: Drawing polygons)</div><div class="summary">The main entry point for the routine to calculate the horizontal lines in filled polygon and prepare them for drawing on-screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettilealtitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_c.html#header-gettilealtitude">GetTileAltitude</a> (category: Landscape)</div><div class="summary">Calculate the altitude of a tile, optionally including platform objects and trees in the calculation</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettiledata">GetTileData</a> (category: Landscape)</div><div class="summary">Get the tile data and tile data address for a specific tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettileedgetoleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettileedgetoleft">GetTileEdgeToLeft</a> (category: Drawing the landscape)</div><div class="summary">Move one tile to the left along the tile row that we are analysing for view edges and tile angles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettileedgetoright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettileedgetoright">GetTileEdgeToRight</a> (category: Drawing the landscape)</div><div class="summary">Move one tile to the right along the tile row that we are analysing for view edges and tile angles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettileshape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-gettileshape">GetTileShape</a> (category: Landscape)</div><div class="summary">Calculate the shape of the tile anchored at (xTile, zTile)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettileviewangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-1-of-4">GetTileViewAngles (Part 1 of 4)</a> (category: Drawing the landscape)</div><div class="summary">Calculate the pitch and yaw angles for a tile corner, relative to a viewer object (e.g. the player), and whether it is on-screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettileviewedges"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a> (category: Drawing the landscape)</div><div class="summary">For a given tile row, work out the edges of the visible portion of the row in the current player view, as left to right tile numbers</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-multiply8x8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_a.html#header-multiply8x8">Multiply8x8</a> (category: Maths (Arithmetic))</div><div class="summary">Calculate (A T) = T * U</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-p"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#p">P</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processsound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a> (category: Sound)</div><div class="summary">Process any sound effects that have been configured so they play in the background (this is called regularly throughout gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processtiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a> (category: Landscape)</div><div class="summary">Process the tile data for all tiles in the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-q"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#q">Q</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-r"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#r">R</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-s"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#s">S</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoothtilecorners"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-1-of-4">SmoothTileCorners (Part 1 of 4)</a> (category: Landscape)</div><div class="summary">Smooth a row or column of tile corners (a "strip of tiles")</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoothtiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-smoothtiledata">SmoothTileData</a> (category: Landscape)</div><div class="summary">Smooth the entire landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#t">T</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#u">U</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-anglehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#anglehi">angleHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The low byte of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-anglelo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#anglelo">angleLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buff1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_e.html#buff1">buff1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-configureobjbuffer">ConfigureObjBuffer</a> (category: Screen buffer)</div><div class="summary">Contains an RTS</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffermaxyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#buffermaxyawhi">bufferMaxYawHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The maximum allowed yaw angle for points in the current screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bufferminyawhi">bufferMinYawHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The minimum allowed yaw angle for points in the current screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bufferminyawlo">bufferMinYawLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The minimum allowed yaw angle for points in the current screen buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferoriginhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bufferoriginhi">bufferOriginHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to add to yaw angles for the current screen buffer to convert them from having the origin in the buffer centre to having the origin on the left edge of the buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferoriginlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bufferoriginlo">bufferOriginLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to add to yaw angles for the current screen buffer to convert them from having the origin in the buffer centre to having the origin on the left edge of the buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffersminyaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_e.html#header-buffersminyaw">buffersMinYaw</a> (category: Screen buffer)</div><div class="summary">Minimum allowed yaw angles for points in the screen buffer ???</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffersorigin"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_e.html#header-buffersorigin">buffersOrigin</a> (category: Screen buffer)</div><div class="summary">The offset to add to yaw angles for each screen buffer to convert from the origin in the buffer centre to the origin on the left</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-considerobjects"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#considerobjects">considerObjects</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Controls whether the GetTileAltitude routine takes platform objects into consideration when calculating tile altitudes (bit 7) and returns details about the gaze vector (bit 6)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan1">dlan1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-1-of-3">DrawLandscapeView (Part 1 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan10">dlan10</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan11">dlan11</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan12">dlan12</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan13">dlan13</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan14">dlan14</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan15">dlan15</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan16">dlan16</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan17">dlan17</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan18">dlan18</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-3-of-3">DrawLandscapeView (Part 3 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan19">dlan19</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-3-of-3">DrawLandscapeView (Part 3 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan2">dlan2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-1-of-3">DrawLandscapeView (Part 1 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan20"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan20">dlan20</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-3-of-3">DrawLandscapeView (Part 3 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan21"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan21">dlan21</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-3-of-3">DrawLandscapeView (Part 3 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan22">dlan22</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-3-of-3">DrawLandscapeView (Part 3 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan3">dlan3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-1-of-3">DrawLandscapeView (Part 1 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan4">dlan4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan5">dlan5</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan6">dlan6</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan7">dlan7</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan8">dlan8</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dlan9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#dlan9">dlan9</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-2-of-3">DrawLandscapeView (Part 2 of 3)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-draw1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#draw1">draw1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscaperow">DrawLandscapeRow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-draw2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#draw2">draw2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscaperow">DrawLandscapeRow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-draw3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#draw3">draw3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscaperow">DrawLandscapeRow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-draw4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#draw4">draw4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscaperow">DrawLandscapeRow</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawviewangles">drawViewAngles</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address in drawViewAngles(1 0) of the pitch and yaw angles of the tile and polygon points that we are drawing in the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewpitchhi">drawViewPitchHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewpitchlo">drawViewPitchLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-drawviewyawhi">drawViewYawHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-drawviewyawlo">drawViewYawLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtableindex"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawingtableindex">drawingTableIndex</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The index into the drawing tables for the tile being analysed</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtableoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawingtableoffset">drawingTableOffset</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to use within the various drawing data tables for the tile we are analysing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtitlescreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#drawingtitlescreen">drawingTitleScreen</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to indicate whether we are currently drawing a title screen in the DrawTitleScreen routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge1">edge1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge2">edge2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge3">edge3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge4">edge4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge5">edge5</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge6">edge6</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge7">edge7</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge8">edge8</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edge9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#edge9">edge9</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewedges">GetTileViewEdges</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-game10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_g.html#game10">game10</a> in subroutine <a href="/source/all/the_sentinel_g.html#header-maingameloop">MainGameLoop</a> (category: Main game loop)</div><div class="summary">Jump to MainTitleLoop to restart the game</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keepcheckingpankey"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#keepcheckingpankey">keepCheckingPanKey</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the DrawLandscapeView routine aborts drawing if the pan key is released before it has finished</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-land1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#land1">land1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-generatelandscape">GenerateLandscape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-land2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#land2">land2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-generatelandscape">GenerateLandscape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-land3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#land3">land3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-generatelandscape">GenerateLandscape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-land4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#land4">land4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-generatelandscape">GenerateLandscape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-land5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#land5">land5</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-generatelandscape">GenerateLandscape</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapezero"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#landscapezero">landscapeZero</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that is set depending on whether we are playing landscape 0000</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-loopcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#loopcounter">loopCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A general-purpose loop counter</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectflags"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectflags">objectFlags</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">Object flags for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttypes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objecttypes">objectTypes</a> (category: 3D objects)</div><div class="summary">The object types table for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectyawangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objectyawangle">objectYawAngle</a> (category: 3D objects)</div><div class="summary">The yaw angle for each object (i.e. the horizontal direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pitchdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pitchdeltahi">pitchDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The delta between two pitch angles (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pitchdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#pitchdeltalo">pitchDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The delta between two pitch angles (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-poly1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#poly1">poly1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawpolygon">DrawPolygon</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-poly2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#poly2">poly2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawpolygon">DrawPolygon</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-poly3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#poly3">poly3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawpolygon">DrawPolygon</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygoncolours"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygoncolours">polygonColours</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The colours of the polygon that's being drawn in the DrawPolygon routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygongoesright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygongoesright">polygonGoesRight</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A flag to record whether the polygon we are drawing extends to the right of the screen buffer we are drawing in</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#polygonpoint">polygonPoint</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Up to five coordinates for the points of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygontype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygontype">polygonType</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Bits 6 and 7 determine the type of polygon to draw in the DrawPolygon routine (the calling subroutine is in brackets)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-prev1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_e.html#prev1">prev1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileedgetoleft">GetTileEdgeToLeft</a> (category: Drawing the landscape)</div><div class="summary">Return from the subroutine with the C flag set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc1">proc1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc2">proc2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc3">proc3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc4">proc4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc5">proc5</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc6">proc6</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc7">proc7</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-proc8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#proc8">proc8</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-processtiledata">ProcessTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#processaction">processAction</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Defines the following</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-quadrantoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#quadrantoffset">quadrantOffset</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset into the drawing tables for the quadrant containing the right edge of the viewing arc ???</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-quadrantoffsets"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_e.html#header-quadrantoffsets">quadrantOffsets</a> (category: Drawing the landscape)</div><div class="summary">Offsets into the tile view data tables for the four different viewing directions</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbuffertype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenbuffertype">screenBufferType</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The type of screen buffer that is currently being used</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenleftyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenleftyawhi">screenLeftYawHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of the yaw angle of the left edge of the screen, reduced into the range of a single 90-degree quadrant (so it's relative to the 90-degree viewing arc)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoo1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#smoo1">smoo1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-smoothtiledata">SmoothTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoo2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#smoo2">smoo2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-smoothtiledata">SmoothTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoo3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#smoo3">smoo3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-smoothtiledata">SmoothTileData</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-smoothingaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#smoothingaction">smoothingAction</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The action that's applied to tile data by the SmoothTileData routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stashoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#stashoffset">stashOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The offset into the secretCodeStash where we store a set of generated values for later checking in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stripdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-stripdata">stripData</a> (category: Landscape)</div><div class="summary">Storage for tile data when smoothing strips of tiles during the landscape generation process</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt1">talt1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt3">talt3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt4">talt4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt5">talt5</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt6">talt6</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt7">talt7</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt8">talt8</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#talt9">talt9</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang1">tang1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-1-of-4">GetTileViewAngles (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang10">tang10</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-4-of-4">GetTileViewAngles (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang11">tang11</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-4-of-4">GetTileViewAngles (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang2">tang2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-1-of-4">GetTileViewAngles (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang3">tang3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-2-of-4">GetTileViewAngles (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang4">tang4</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-2-of-4">GetTileViewAngles (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang5">tang5</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-2-of-4">GetTileViewAngles (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang6">tang6</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-2-of-4">GetTileViewAngles (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang7">tang7</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-3-of-4">GetTileViewAngles (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang8">tang8</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-3-of-4">GetTileViewAngles (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tang9">tang9</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-3-of-4">GetTileViewAngles (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-tiledata">tileData</a> (category: Landscape)</div><div class="summary">Altitude and shape data for landscape tiles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledatamultiplier"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#tiledatamultiplier">tileDataMultiplier</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A multiplier that we apply to the altitudes of the tile corners to alter the steepness of the landscape during landscape generation</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledatapage"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tiledatapage">tileDataPage</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address of the tileData page containing the current tile's data</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tileisonscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tileisonscreen">tileIsOnScreen</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Information on whether a tile is fully on-screen, partially on-screen or fully off-screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tileshapecolour"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-tileshapecolour">tileShapeColour</a> (category: Drawing the landscape)</div><div class="summary">Tile colours by shape and the orientation of the viewer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tileshapeoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tileshapeoffset">tileShapeOffset</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile shape we are drawing, amended to use as an offset into the tileShapeColour table</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tileviewdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tileviewdata">tileViewData</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">The tile data for tiles in the current landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-tilevisibility">tileVisibility</a> (category: Drawing the landscape)</div><div class="summary">A table for storing the visibility of each tile from the player's point of view, with one bit per tile (1 = visible, 0 = hidden)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tobj1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tobj1">tobj1</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawtileandobjects">DrawTileAndObjects</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tobj2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tobj2">tobj2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawtileandobjects">DrawTileAndObjects</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tobj3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_e.html#tobj3">tobj3</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-drawtileandobjects">DrawTileAndObjects</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-trianglestart"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_f.html#header-trianglestart">triangleStart</a> (category: Drawing polygons)</div><div class="summary">The number of the first point in each two-face shape that is drawn as a pair of triangles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-trianglestartpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#trianglestartpoint">triangleStartPoint</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the starting point for the tile shape being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingarcrightyaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingarcrightyaw">viewingArcRightYaw</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The yaw angle of the right edge of the viewing arc, where the arc is 90 degrees wide</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingobject">viewingObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingquadrantopp"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingquadrantopp">viewingQuadrantOpp</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The opposite quadrant number to that containing the right edge of the viewing arc ???</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingquadrantx4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingquadrantx4">viewingQuadrantx4</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The quadrant number containing the right edge of the viewing arc, multiplied by 4, for use when calculating the number of faces in a tile in DrawSlopingTile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-visibilebitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-visibilebitmask">visibileBitMask</a> (category: Drawing the landscape)</div><div class="summary">A table for converting a number in the range 0 to 7 into a bit mask with only that bit set, when counting from the left</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xbufferleft">xBufferLeft</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The left edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xbufferright">xBufferRight</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The right edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xbufferwidth">xBufferWidth</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The width in pixels of the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbuffersleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_e.html#header-xbuffersleft">xBuffersLeft</a> (category: Screen buffer)</div><div class="summary">The left edge of each screen buffer in pixels ???</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferswidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_e.html#header-xbufferswidth">xBuffersWidth</a> (category: Screen buffer)</div><div class="summary">The width of each screen buffer in pixels ???</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltaabsolutehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltaabsolutehi">xDeltaAbsoluteHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The absolute difference between two x-coordinates (high byte), i.e. |xDeltaHi|</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltahi">xDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two x-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltalo">xDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two x-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-xobject">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtile">xTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner x-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtileleftprevious"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtileleftprevious">xTileLeftPrevious</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The previous value of xTileViewLeft</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtiletodraw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtiletodraw">xTileToDraw</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The column number of the tile we are currently drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtileviewleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtileviewleft">xTileViewLeft</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile number at the left edge of the tile row we are currently processing when drawing the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtileviewleftedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtileviewleftedge">xTileViewLeftEdge</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile number at the left edge of the visible portion of the row we are currently processing when drawing the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtileviewright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtileviewright">xTileViewRight</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile number at the right edge of the tile row we are currently processing when drawing the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtileviewrightedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtileviewrightedge">xTileViewRightEdge</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile number at the right edge of the visible portion of the row we are currently processing when drawing the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtileviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtileviewer">xTileViewer</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile x-coordinate of the viewer, but with the axes rotated to match the orientation of the viewer, so we can draw the landscape along the line of sight, towards the viewer's tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtitleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtitleoffset">xTitleOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">An x-coordinate offset for drawing the title screen this is zero during gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjecthi">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjectlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjectlo">yObjectLo</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ystoretileview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ystoretileview">yStoreTileView</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage for Y so it can be preserved through calls to GetTileViewAngles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yawadjustmentlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yawadjustmentlo">yawAdjustmentLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A yaw adjustment to apply to the landscape drawing process so that when we update objects on-screen, we can yaw the viewer's gaze to the right to move the left edge of the object to the left edge of the screen so the object will fit into the screen buffer as efficiently as possible (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltaabsolutehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zdeltaabsolutehi">zDeltaAbsoluteHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The absolute difference between two z-coordinates (high byte), i.e. |zDeltaHi|</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zdeltahi">zDeltaHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two z-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zdeltalo">zDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two z-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-zobject">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ztile">zTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztileviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ztileviewer">zTileViewer</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile z-coordinate of the viewer, but with the axes rotated to match the orientation of the viewer, so we can draw the landscape along the line of sight, towards the viewer's tile</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_d.html">The Sentinel D source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_f.html">The Sentinel F source</a></nav>
				</div>
			</article>

<?php
include_once("../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
