<?php
include_once("../../templates/template_functions.php");
page_header("all_source", "the_sentinel_d.html", "The Sentinel D source", "The Sentinel D source", "The The Sentinel D source file in The Sentinel", "the_sentinel-index", "source_all_source", "the_sentinel_d", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_c.html">The Sentinel C source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_e.html">The Sentinel E source</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div><div><div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checkfortilecentre" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckForTileCentre</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Geometry)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate max(|xCoordLo - 128|, |zCoordLo - 128|)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checkfortilecentre.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilealtitude.html">GetTileAltitude</a> calls <a href="#checkfortilecentre">CheckForTileCentre</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">xCoordLo</span>             <span class="argumentEntry">The low byte of an x-coordinate for comparing to the</span>
                        <span class="argumentEntry">centre of a tile (i.e. a fractional part)</span>

   <span class="argumentLabel">zCoordLo</span>             <span class="argumentEntry">The low byte of an z-coordinate for comparing to the</span>
                        <span class="argumentEntry">centre of a tile (i.e. a fractional part)</span>

</div></div>
<span class="label">.CheckForTileCentre</span><a id="checkfortilecentre" class="anchor"></a>

                        <span class="comment">\ We check the distance of the fractional coordinate in</span>
                        <span class="comment">\ (xCoordLo, zCoordLo) from the centre of the tile by</span>
                        <span class="comment">\ subtracting from (128, 128), as 128 represents 0.5 in</span>
                        <span class="comment">\ fractional terms</span>

 <span class="mne">LDA</span> <a class="popup variable">xCoordLo</a>           <span class="comment">\ Set A = |xCoordLo - 128|</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">128</span>
 <span class="mne">BPL</span> <a class="popup destination">maxc1</a>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>

<span class="label">.maxc1</span><a id="maxc1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set T = |xCoordLo - 128|</span>

 <span class="mne">LDA</span> <a class="popup variable">zCoordLo</a>           <span class="comment">\ Set A = |zCoordLo - 128|</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">128</span>
 <span class="mne">BPL</span> <a class="popup destination">maxc2</a>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>

<span class="label">.maxc2</span><a id="maxc2" class="anchor"></a>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If A >= T then A is already set to the higher value</span>
 <span class="mne">BCS</span> <a class="popup destination">maxc3</a>              <span class="comment">\ out of A and T, so jump to maxc3</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ If we get here then A &lt; T, so set A to the value of T</span>
                        <span class="comment">\ so A is now set the higher value out of A and T</span>

<span class="label">.maxc3</span><a id="maxc3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ A is set to the higher value of A and T, so this does</span>
                        <span class="comment">\ the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   T = max(A, T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\     = max(|xCoordLo - 128|, |zCoordLo - 128|)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getobjectcoords" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetObjectCoords</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Get an object's coordinates</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getobjectcoords.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/followgazevector_part_1_of_5.html">FollowGazeVector (Part 1 of 5)</a> calls <a href="#getobjectcoords">GetObjectCoords</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getrowvisibility_part_1_of_2.html">GetRowVisibility (Part 1 of 2)</a> calls <a href="#getobjectcoords">GetObjectCoords</a></span>
</div>
<hr class="light">
 This routine fetches the cartesian coordinates of object #X as three 24-bit
 numbers, as follows:

   xCoord(Hi Lo Bot)

   yCoord(Hi Lo Bot)

   zCoord(Hi Lo Bot)

 The high byte can be thought of as the integer with low and bottom bytes as
 the fractional part.

 Tile corners are integers in the x- and z-axis, and objects are placed in the
 centre of tiles by setting the fractional part to 0.5. So an object that's
 been placed directly on the tile that's anchored at (2, y, 3) will appear at
 (2.5, y, 3.5).

 The y-coordinate - i.e. the altitude of the object above the tile itself -
 depends on the object type and whether it is stacked on top of another object.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">An object number</span>

</div></div>
<span class="label">.GetObjectCoords</span><a id="getobjectcoords" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set the bottom byte of each coordinate to zero</span>
 <span class="mne">STA</span> <a class="popup variable">xCoordBot</a>
 <span class="mne">STA</span> <a class="popup variable">yCoordBot</a>
 <span class="mne">STA</span> <a class="popup variable">zCoordBot</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">128</span>               <span class="comment">\ Set the low byte of the x- and -z-coordinates to 128</span>
 <span class="mne">STA</span> <a class="popup variable">xCoordLo</a>           <span class="comment">\ (which represents 0.5, so the object sits in the</span>
 <span class="mne">STA</span> <a class="popup variable">zCoordLo</a>           <span class="comment">\ middle of the tile on which it is placed)</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\ Set the low byte of the y-coordinate to the altitude</span>
 <span class="mne">STA</span> <a class="popup variable">yCoordLo</a>           <span class="comment">\ of object #X</span>

 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ Set the high byte of the x-coordinate to the value for</span>
 <span class="mne">STA</span> <a class="popup variable">xCoordHi</a>           <span class="comment">\ object #X from the xObject table</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ Set the high byte of the y-coordinate to the value for</span>
 <span class="mne">STA</span> <a class="popup variable">yCoordHi</a>           <span class="comment">\ object #X from the yObjectHi table</span>

 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\ Set the high byte of the z-coordinate to the value for</span>
 <span class="mne">STA</span> <a class="popup variable">zCoordHi</a>           <span class="comment">\ object #X from the zObject table</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-deleteobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DeleteObject</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Delete an object, removing it from the landscape and vacating its</span>
             <span class="headerEntry">object number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/deleteobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drainobjectenergy.html">DrainObjectEnergy</a> calls <a href="#deleteobject">DeleteObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/expendenemyenergy.html">ExpendEnemyEnergy</a> calls <a href="#deleteobject">DeleteObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/performhyperspace.html">PerformHyperspace</a> calls <a href="#deleteobject">DeleteObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls <a href="#deleteobject">DeleteObject</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the object to delete</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">X is preserved</span>

</div></div>
<span class="label">.DeleteObject</span><a id="deleteobject" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ Set (xTile, zTile) to the tile coordinates of the</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ tile containing object #X</span>
 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), which we ignore, but this also sets</span>
                        <span class="comment">\ the tile page in tileDataPage and the index in Y, so</span>
                        <span class="comment">\ tileDataPage+Y now points to the tile data entry in</span>
                        <span class="comment">\ the tileData table for object #X</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ Set A to the object flags for object #X</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ If both bits 6 and 7 of the object flags for object #X</span>
 <span class="mne">BCC</span> <a class="popup destination">delo1</a>              <span class="comment">\ are clear then object #X is not stacked on top of</span>
                        <span class="comment">\ another object, so jump to delo1 to remove object #X</span>
                        <span class="comment">\ from the tile itself</span>

                        <span class="comment">\ If we get here then object #X is stacked on top of</span>
                        <span class="comment">\ another object, and the number of that object is in</span>
                        <span class="comment">\ bits 0 to 5 of the object flags for object #X, which</span>
                        <span class="comment">\ is currently in A</span>

 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set bits of 6 and 7 of A to create a byte with the</span>
                        <span class="comment">\ number of the object below object #X in bits 0 to 5,</span>
                        <span class="comment">\ and bits 6 and 7 set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now set this as the updated tile data for the tile</span>
                        <span class="comment">\ that used to contain object #X at the top of the</span>
                        <span class="comment">\ stack, but which now contains the next object down on</span>
                        <span class="comment">\ the top of the stack instead</span>

 <span class="mne">BNE</span> <a class="popup destination">delo2</a>              <span class="comment">\ Jump to delo2 to store A as the new tile data for this</span>
                        <span class="comment">\ tile (this BNE is effectively a JMP as the value of A</span>
                        <span class="comment">\ before the ORA has to have at least one of bits 6 and</span>
                        <span class="comment">\ 7 set, so the result of the ORA is never zero)</span>

<span class="label">.delo1</span><a id="delo1" class="anchor"></a>

                        <span class="comment">\ If we get here then object #X is not stacked on top of</span>
                        <span class="comment">\ another object, so we can remove the object from the</span>
                        <span class="comment">\ tile by changing the tile data into the following</span>
                        <span class="comment">\ format:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The low nibble contains the tile shape, which in</span>
                        <span class="comment">\     this case is flat because only flat tiles can</span>
                        <span class="comment">\     contain objects, so we need to set the low nibble</span>
                        <span class="comment">\     to shape 0 (to indicate a flat tile)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The high nibble contains the altitude of the tile</span>
                        <span class="comment">\     corner in the front-left corner of the tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The altitude of object #X is a 16-bit value in</span>
                        <span class="comment">\ yObject(Hi Lo), where the yObjectLo part is</span>
                        <span class="comment">\ effectively a fractional part of the altitude that</span>
                        <span class="comment">\ describes how far the object is above the tile itself</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Tile altitudes are whole numbers, so the altitude of</span>
                        <span class="comment">\ the tile on which object #X is placed is given in the</span>
                        <span class="comment">\ high byte of the object's 16-bit altitude</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ Set the high nibble of A to the high byte of the</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ altitude of object #X (which is the tile's altitude)</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ and set the low nibble to zero to indicate a flat tile</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ A is now in the format required for the tileData table</span>
                        <span class="comment">\ for a flat tile that doesn't contain an object, so we</span>
                        <span class="comment">\ can update the tile's data to remove object #X from</span>
                        <span class="comment">\ the tile</span>

<span class="label">.delo2</span><a id="delo2" class="anchor"></a>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ Update the tile data for object #X to the value in A</span>
                        <span class="comment">\ (as we set Y to the relevant index with the call to</span>
                        <span class="comment">\ GetTileData above)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of the object flags for object #X to denote</span>
 <span class="mne">STA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ that object number X has not been allocated to an</span>
                        <span class="comment">\ object and is reusable, so this effectively deletes</span>
                        <span class="comment">\ the object</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-placeobjectontile" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PlaceObjectOnTile</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Place an object on a tile, putting it on top of any existing</span>
             <span class="headerEntry">boulders or towers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/placeobjectontile.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/addenemiestotiles.html">AddEnemiesToTiles</a> calls <a href="#placeobjectontile">PlaceObjectOnTile</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/placeobjectbelow.html">PlaceObjectBelow</a> calls <a href="#placeobjectontile">PlaceObjectOnTile</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls <a href="#placeobjectontile">PlaceObjectOnTile</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnplayer.html">SpawnPlayer</a> calls <a href="#placeobjectontile">PlaceObjectOnTile</a></span>
</div>
<hr class="light">
 This routine sets the following (if successful):

   * X-th entry in (xObject, yObject, zObject) is set to the 3D coordinate of
     the newly added object, where the y-coordinate is yObject(Hi Lo)

   * X-th entry in objectFlags, bit 7 is clear to indicate that object #X has
     been allocated to an object

   * X-th entry in objectFlags, bit 6 is set if we add the object on top of a
     boulder or tower (and the object number of the boulder/tower is in bits
     0-5)

   * X-th entry in yObjectLo = 224, so objects are spawned at a height of 224
     above the tile itself, or 0.875 tile widths (this is used for the gaze
     vector calculations, so this is effectively the height of the object's
     eyes above the tile)

   * X-th entry in objectPitchAngle = -11, so objects look slightly downwards
     at a pitch angle of 15.5 degrees

   * X-th entry in objectYawAngle is set to a multiple of 11.25 degrees, as
     determined by the next seed

   * tileData for the tile is set to the object number in X in bits 0 to 5, and
     bits 6 and 7 are set to indicate that the tile contains an object

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the object to add to the tile</span>

   <span class="argumentLabel">(xTile, zTile)</span>       <span class="argumentEntry">The tile coordinate where we place the object</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag:</span>

                        <span class="argumentEntry">  * Clear if we successfully added the object to the</span>
                        <span class="argumentEntry">    tile</span>

                        <span class="argumentEntry">  * Set if we failed to add the object to the tile (if</span>
                        <span class="argumentEntry">    the tile is occupied by an object that is not a</span>
                        <span class="argumentEntry">    a boulder or tower, for example)</span>

</div></div>
<span class="label">.PlaceObjectOnTile</span><a id="placeobjectontile" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTile</a>              <span class="comment">\ Set the 3D coordinate for object #X to (xTile, zTile)</span>
 <span class="mne">STA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ by updating the X-th entries in the xObject and</span>
 <span class="mne">LDA</span> <a class="popup variable">zTile</a>              <span class="comment">\ zObject tables</span>
 <span class="mne">STA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\</span>
                        <span class="comment">\ So this sets the x- and z-coordinates of the 3D</span>
                        <span class="comment">\ coordinate for our object; we set the y-coordinate</span>
                        <span class="comment">\ later</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), setting the C flag if the tile</span>
                        <span class="comment">\ contains an object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also sets the tile page in tileDataPage and the</span>
                        <span class="comment">\ tile number in Y, so tileDataPage+Y now points to the</span>
                        <span class="comment">\ tile data entry in the tileData table</span>

 <span class="mne">BCC</span> <a class="popup destination">objt4</a>              <span class="comment">\ If the C flag is clear then this tile does not already</span>
                        <span class="comment">\ have an object placed on it, so jump to objt4 to place</span>
                        <span class="comment">\ object #X on the tile</span>

 <span class="mne">STY</span> <a class="popup variable">tileNumber</a>         <span class="comment">\ Store the tile number in tileNumber so we can refer to</span>
                        <span class="comment">\ it later</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>         <span class="comment">\ Because the tile has an object on it, the tile data</span>
 <span class="mne">TAY</span>                    <span class="comment">\ contains the number of the top object on the tile in</span>
                        <span class="comment">\ bits 0 to 5, so extract the object number into Y (so</span>
                        <span class="comment">\ the tile effectively contains object #Y)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectTypes</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the type of object that's already on the tile</span>
                        <span class="comment">\ (i.e. the type of object #Y)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ If the tile contains a boulder (an object of type 3),</span>
 <span class="mne">BEQ</span> <a class="popup destination">objt1</a>              <span class="comment">\ jump to objt1 to put the new object on top of the</span>
                        <span class="comment">\ boulder</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ If the tile doesn't contain the Sentinel's tower (type</span>
 <span class="mne">BNE</span> <a class="popup destination">objt6</a>              <span class="comment">\ 6) then it must contain an object on which we can't</span>
                        <span class="comment">\ place our new object, so jump to objt6 to return from</span>
                        <span class="comment">\ the subroutine without adding the object to the tile</span>

<span class="label">.objt1</span><a id="objt1" class="anchor"></a>

                        <span class="comment">\ If we get here then the object already on the tile is</span>
                        <span class="comment">\ either a boulder (type 3) or the Sentinel's tower</span>
                        <span class="comment">\ (type 6)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In either case, we want to place our object on top of</span>
                        <span class="comment">\ the object that is already there, which we can do by</span>
                        <span class="comment">\ setting bit 6 of the object flags for the new object</span>
                        <span class="comment">\ and putting the number of the existing object into</span>
                        <span class="comment">\ bits 0 to 5</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set the object flags for the object that we are adding</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ (i.e. object #X) so that bit 6 is set, and bits 0 to 5</span>
 <span class="mne">STA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ contain the number of the object that is already on</span>
                        <span class="comment">\ the tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This denotes that our new object, object #X, is on top</span>
                        <span class="comment">\ of object #Y</span>

 <span class="mne">LDA</span> <a class="popup variable">objectTypes</a>,<span class="register">Y</span>      <span class="comment">\ If the object that's already on the tile is not the</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ Sentinel's tower (type 6), jump to objt2</span>
 <span class="mne">BNE</span> <a class="popup destination">objt2</a>

                        <span class="comment">\ If we get here then we are placing object #X on top of</span>
                        <span class="comment">\ the Sentinel's tower (type 6) in object #Y</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The next task is to calculate the altitude of the</span>
                        <span class="comment">\ object when it is placed on top of the tower (i.e. the</span>
                        <span class="comment">\ y-coordinate of the object, as the y-axis goes up and</span>
                        <span class="comment">\ down in our 3D world)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The tower is defined with a height of one coordinate</span>
                        <span class="comment">\ (where a tile-sized cube is one coordinate across)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object y-coordinates are stored as 16-bit numbers in</span>
                        <span class="comment">\ the form yObject(Hi Lo), with the low byte effectively</span>
                        <span class="comment">\ acting like a fractional part, so to work out the</span>
                        <span class="comment">\ y-coordinate for the object we are placing on top of</span>
                        <span class="comment">\ the boulder, we need to add (1 0) to the tower's</span>
                        <span class="comment">\ current y-coordinate, like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   yObject,X = yObject,Y + (1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We need to do this calculation for both bytes,</span>
                        <span class="comment">\ starting with the low byte</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectLo</a>,<span class="register">Y</span>        <span class="comment">\ First we add the low bytes, by adding 0 to the Y-th</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\ entry in yObjectLo and storing this in the low byte of</span>
                        <span class="comment">\ the X-th entry in yObjectLo (which we can do by simply</span>
                        <span class="comment">\ copying the Y-th entry into the X-th entry)</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag and set A = 1 so the addition at</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ objt3 will do the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   A = yObjectHi,Y + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This will add the high bytes of the calculation to</span>
                        <span class="comment">\ give the result we want:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A yObjectLo,X) = (yObjectHi,Y yObjectLo,Y) + (1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\                   = ((yObjectHi,Y + 1) yObjectLo,Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the subsequent jump to objt5 storing A in</span>
                        <span class="comment">\ yObjectHi,X as required</span>

 <span class="mne">BNE</span> <a class="popup destination">objt3</a>              <span class="comment">\ Jump to objt3 to do the calculation (this BNE is</span>
                        <span class="comment">\ effectively a JMP as A is never zero)</span>

<span class="label">.objt2</span><a id="objt2" class="anchor"></a>

                        <span class="comment">\ If we get here then we are placing our new object #X</span>
                        <span class="comment">\ on top of the boulder (type 3) in object #Y</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The next task is to calculate the altitude of the</span>
                        <span class="comment">\ object when it is placed on top of the boulder (i.e.</span>
                        <span class="comment">\ the y-coordinate of the object, as the y-axis goes up</span>
                        <span class="comment">\ and down in our 3D world)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Boulders are defined with a height of 0.5 coordinates</span>
                        <span class="comment">\ (where a tile-sized cube is one coordinate across)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object y-coordinates are stored as 16-bit numbers in</span>
                        <span class="comment">\ the form yObject(Hi Lo), with the low byte effectively</span>
                        <span class="comment">\ acting like a fractional part, so to work out the</span>
                        <span class="comment">\ y-coordinate for the object we are placing on top of</span>
                        <span class="comment">\ the boulder, we need to add (0 128) to the boulder's</span>
                        <span class="comment">\ current y-coordinate, like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   yObject,X = yObject,Y + (0 128)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We need to do this calculation for both bytes,</span>
                        <span class="comment">\ starting with the low byte</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectLo</a>,<span class="register">Y</span>        <span class="comment">\ First we add the low bytes, by adding 128 to the Y-th</span>
 <span class="mne">CLC</span>                    <span class="comment">\ entry in yObjectLo and storing this in the low byte of</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">128</span>               <span class="comment">\ the result in the X-th entry in yObjectLo</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so the following addition will add the high</span>
                        <span class="comment">\ bytes to give the result we want:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A yObjectLo,X) = (yObjectHi,Y yObjectLo,Y)</span>
                        <span class="comment">\                     + (0 128)</span>
                        <span class="comment">\</span>
                        <span class="comment">\                   = (yObjectHi,Y (yObjectLo,Y + 128))</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the subsequent jump to objt5 storing A in</span>
                        <span class="comment">\ yObjectHi,X as required</span>

<span class="label">.objt3</span><a id="objt3" class="anchor"></a>

 <span class="mne">ADC</span> <a class="popup variable">yObjectHi</a>,<span class="register">Y</span>        <span class="comment">\ Add A to the high byte of the y-coordinate of the</span>
                        <span class="comment">\ object beneath the one we are adding and store the</span>
                        <span class="comment">\ result in A</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So (A yObjectLo,X) now contains the y-coordinate of</span>
                        <span class="comment">\ the new object that we are placing on top of the</span>
                        <span class="comment">\ boulder or tower</span>

 <span class="mne">LDY</span> <a class="popup variable">tileNumber</a>         <span class="comment">\ Set Y to the tile number where we are adding the</span>
                        <span class="comment">\ object, which we stored above</span>

 <span class="mne">JMP</span> <a class="popup destination">objt5</a>              <span class="comment">\ Jump to objt5 to store A as the y-coordinate of the</span>
                        <span class="comment">\ new object on the tile, and update the various other</span>
                        <span class="comment">\ object and tile tables for the new object</span>

<span class="label">.objt4</span><a id="objt4" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the tile data for the tile on the stack so we</span>
                        <span class="comment">\ can retrieve it below</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Clear bit 7 of the object's flags to indicate that</span>
 <span class="mne">STA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ object #X is allocated to an object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">224</span>               <span class="comment">\ Set the object's entry in yObjectLo to 224</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\</span>
                        <span class="comment">\ This places objects well above the tile, at a height</span>
                        <span class="comment">\ of 224 / 256 = 0.875 coordinates above the tile itself</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is used for the gaze vector calculations, so this</span>
                        <span class="comment">\ is effectively the height of the object's eyes above</span>
                        <span class="comment">\ the tile</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Set A to the tile data for the tile, which we stored</span>
                        <span class="comment">\ on the stack above</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ The top nibble of the tile data contains the tile</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ altitude, so this sets A to the tile altitude</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>

                        <span class="comment">\ We now fall through into objt5 to set the tile</span>
                        <span class="comment">\ y-coordinate for object #X to the tile altitude in A</span>

<span class="label">.objt5</span><a id="objt5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ Set the high byte of the 3D y-coordinate for object #X</span>
                        <span class="comment">\ to the value of A by updating the X-th entry in the</span>
                        <span class="comment">\ yObjectHi table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now have a full 3D coordinate for the object in</span>
                        <span class="comment">\ (xObject, yObject, zObject), where yObject is stored</span>
                        <span class="comment">\ as a 16-bit number in yObject(Hi Lo)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set the tile data for this tile to object number X,</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ with bits 6 and 7 set to indicate that the tile now</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ contains an object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&F5</span>               <span class="comment">\ Set the object's pitch angle to -11, so the object</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a>,<span class="register">X</span> <span class="comment">\ looks down slightly at a pitch angle of 15.5 degrees</span>
                        <span class="comment">\ (as 360 * 11 / 256 = 15.5)</span>

                        <span class="comment">\ We now calculate the object's yaw angle, which</span>
                        <span class="comment">\ determines the direction in which it is facing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The degree system in the Sentinel looks like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\            0</span>
                        <span class="comment">\      -32   |   +32         Overhead view of object</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /             0 = looking straight ahead</span>
                        <span class="comment">\           \|/              +64 = looking sharp right</span>
                        <span class="comment">\   -64 -----+----- +64      -64 = looking sharp left</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment">\          / | \</span>
                        <span class="comment">\         /  |  \</span>
                        <span class="comment">\      -96   |   +96</span>
                        <span class="comment">\           128</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In this context, looking straight ahead means the</span>
                        <span class="comment">\ object is looking into the screen, towards the back of</span>
                        <span class="comment">\ the landscape</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111000</span>         <span class="comment">\ Convert A to be a multiple of 8 and in the range 0 to</span>
                        <span class="comment">\ 248 (i.e. 0 to 31 * 8)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This rotates the object so it is looking along one of</span>
                        <span class="comment">\ 32 fixed rotations, each of which is a multiple of</span>
                        <span class="comment">\ 11.25 degrees</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + 96</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">96</span>                <span class="comment">\</span>
                        <span class="comment">\ This doesn't change the fact that A is a multiple of</span>
                        <span class="comment">\ 11.25 degrees, so it's presumably intended to make the</span>
                        <span class="comment">\ player's rotation work well on the starting level</span>

 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ Set the object's objectYawAngle to the angle we just</span>
                        <span class="comment">\ calculated in A</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have successfully</span>
                        <span class="comment">\ added the object to the tile</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.objt6</span><a id="objt6" class="anchor"></a>

                        <span class="comment">\ If we get here then the tile already contains an</span>
                        <span class="comment">\ object and that object is not a boulder (type 3) or</span>
                        <span class="comment">\ tower (type 6), so we can't add the new object to the</span>
                        <span class="comment">\ tile</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that we have failed to add</span>
                        <span class="comment">\ the object to the tile</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-tilenumber" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">tileNumber</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The tile number to which we are adding an object in the</span>
             <span class="headerEntry">PlaceObjectOnTile routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/tilenumber.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/placeobjectontile.html">PlaceObjectOnTile</a> uses <a href="#tilenumber">tileNumber</a></span>
</div>
</div></div>
<span class="label">.tileNumber</span><a id="tilenumber" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawupdatedobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawUpdatedObject</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw an updated object on-screen, optionally with a dithered</span>
             <span class="headerEntry">effect, and with or without the surrounding landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawupdatedobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_8_of_8.html">ApplyTactics (Part 8 of 8)</a> calls <a href="#drawupdatedobject">DrawUpdatedObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#drawupdatedobject">DrawUpdatedObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a> calls <a href="#drawupdatedobject">DrawUpdatedObject</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">currentObject</span>        <span class="argumentEntry">The number of the object to update on-screen</span>

   <span class="argumentLabel">viewingObject</span>        <span class="argumentEntry">The number of the object that's viewing the object that</span>
                        <span class="argumentEntry">we are updating</span>

   <span class="argumentLabel">drawLandscape</span>        <span class="argumentEntry">Configure whether to draw the landscape behind the</span>
                        <span class="argumentEntry">object:</span>

                        <span class="argumentEntry">  * Bit 7 clear = draw the landscape behind the object</span>
                        <span class="argumentEntry">                  as well as the object</span>

                        <span class="argumentEntry">  * Bit 7 set = just draw the object, and configure the</span>
                        <span class="argumentEntry">                interrupt handler to draw random black</span>
                        <span class="argumentEntry">                dots on the screen if the Sentinel has</span>
                        <span class="argumentEntry">                won the game</span>

   <span class="argumentLabel">ditherObjectSights</span>   <span class="argumentEntry">Configure how the update is drawn onto the screen:</span>

                        <span class="argumentEntry">  * Bit 6 set = dither the updated object onto the</span>
                        <span class="argumentEntry">                screen</span>

                        <span class="argumentEntry">  * Bit 7 set = remove the sights from the screen</span>
                        <span class="argumentEntry">                before drawing the object</span>

   <span class="argumentLabel">screenBackground</span>     <span class="argumentEntry">The screen background to use when drawing the object:</span>

                        <span class="argumentEntry">  * 0 = fill with alternating colour 0/1 (blue/black)</span>
                        <span class="argumentEntry">        pixel rows, for the sky during gameplay</span>

                        <span class="argumentEntry">  * 3 = fill with solid colour 1 (black) and draw 240</span>
                        <span class="argumentEntry">        randomly positioned stars on the background,</span>
                        <span class="argumentEntry">        for the game over screen</span>

</div></div>
<span class="label">.updo1</span><a id="updo1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00000000</span>         <span class="comment">\ Clear bits 6 and 7 of ditherObjectSights so the next</span>
 <span class="mne">STA</span> <a class="popup variable">ditherObjectSights</a> <span class="comment">\ call to DrawUpdatedObject will, by default, draw the</span>
                        <span class="comment">\ object straight onto the screen without a dithered</span>
                        <span class="comment">\ effect, and will not remove the sights first</span>

 <span class="mne">STA</span> <a class="popup variable">drawLandscape</a>      <span class="comment">\ Clear bit 7 of drawLandscape so the next call to</span>
                        <span class="comment">\ DrawUpdatedObject will, by default, draw the landscape</span>
                        <span class="comment">\ behind the object</span>

 <span class="mne">STA</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ Clear bit 7 of doNotDitherObject to enable objects to</span>
                        <span class="comment">\ be updated on the screen with a dithered effect</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.DrawUpdatedObject</span><a id="drawupdatedobject" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetObjVisibility</a>   <span class="comment">\ Calculate whether any part of the current object is</span>
                        <span class="comment">\ visible on-screen and set the C flag as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Clear = at least some of the object is visible</span>
                        <span class="comment">\             on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set = the object is not visible on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the object is visible, also set the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * bufferColumns = the number of character columns</span>
                        <span class="comment">\     in the screen buffer that the object spans (capped</span>
                        <span class="comment">\     to a maximum value of 20)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * objYawOffset = the yaw offset of the left edge of</span>
                        <span class="comment">\     the object from the left edge of the screen, in</span>
                        <span class="comment">\     character columns</span>

 <span class="mne">BCS</span> <a class="popup destination">updo1</a>              <span class="comment">\ If the C flag is set then the object is not visible</span>
                        <span class="comment">\ on-screen, so jump to updo1 to reset the various</span>
                        <span class="comment">\ dither-related variables and return from the</span>
                        <span class="comment">\ subroutine as there is nothing to update on the screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">25</span>                <span class="comment">\ Set ditherOuterLoop = 25, so the dithered effect in</span>
 <span class="mne">STA</span> <a class="popup variable">ditherOuterLoop</a>    <span class="comment">\ the DitherScreenBuffer routine implements 25 outer</span>
                        <span class="comment">\ loops, where each inner loop dithers 255 pixels to the</span>
                        <span class="comment">\ screen</span>

 <span class="mne">LDA</span> <a class="popup variable">ditherObjectSights</a> <span class="comment">\ If bit 7 of ditherObjectSights is clear then we are</span>
 <span class="mne">BPL</span> <a class="popup destination">updo2</a>              <span class="comment">\ not configured to remove the sights before updating</span>
                        <span class="comment">\ the object on-screen, so jump to updo2 to skip the</span>
                        <span class="comment">\ following</span>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts to ensure that the screen doesn't</span>
                        <span class="comment">\ scroll while we are removing the sights, as that could</span>
                        <span class="comment">\ corrupt the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">RemoveSights</a>       <span class="comment">\ Bit 7 of ditherObjectSights is set, so we need to</span>
                        <span class="comment">\ remove the sights from the screen before we update the</span>
                        <span class="comment">\ object on-screen, so call the RemoveSights routine</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

<span class="label">.updo2</span><a id="updo2" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the viewing object</span>

 <span class="mne">LDA</span> <a class="popup variable">objYawOffset</a>       <span class="comment">\ Set yawAdjustment(Hi Lo) = (objYawOffset 0) / 2</span>
 <span class="mne">STA</span> <a class="popup variable">yawAdjustmentHi</a>    <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ This converts the yaw offset in objYawOffset from</span>
 <span class="mne">LSR</span> <a class="popup variable">yawAdjustmentHi</a>    <span class="comment">\ character columns into a yaw angle and stores the</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ result in yawAdjustment(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">yawAdjustmentLo</a>    <span class="comment">\</span>
                        <span class="comment">\ The custom screen mode 5 used by the game is 40</span>
                        <span class="comment">\ character columns wide, and the screen is 20 yaw</span>
                        <span class="comment">\ angles wide in terms of the game's coordinate system</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can simply halve the character column count in</span>
                        <span class="comment">\ objYawOffset to convert it into a yaw angle</span>

 <span class="mne">LDA</span> <a class="popup variable">yawAdjustmentHi</a>    <span class="comment">\ Add yawAdjustmentHi to the yaw angle for the viewing</span>
 <span class="mne">ADC</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ object, so the viewing object is now looking directly</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ at the left edge of the object, so when we draw the</span>
                        <span class="comment">\ object, we will draw it into the screen buffer with</span>
                        <span class="comment">\ the object aligned with the left edge of the buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The addition works because the ROR instruction clears</span>
                        <span class="comment">\ the C flag, as A is zero before the rotation</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero lastPanKeyPressed so that when we draw the screen</span>
 <span class="mne">STY</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ buffer onto the screen below, we draw the buffer onto</span>
                        <span class="comment">\ the screen in columns, working from left to right, in</span>
                        <span class="comment">\ the same way as for a pan to the right (which is what</span>
                        <span class="comment">\ a zero value of lastPanKeyPressed usually represents)</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Set up the screen buffer so it will hold an object</span>
 <span class="mne">JSR</span> <a class="popup destination">ConfigureObjBuffer</a> <span class="comment">\ with the number of character columns that the object</span>
                        <span class="comment">\ spans, as calculated by the call to GetObjVisibility</span>
                        <span class="comment">\ above</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The object might be too wide to fit into the screen</span>
                        <span class="comment">\ buffer (as we configure it as a column buffer to make</span>
                        <span class="comment">\ sure the entire visible part of the object fits into</span>
                        <span class="comment">\ the buffer height-wise), but this ensures that the</span>
                        <span class="comment">\ buffer contains as much of the visible part of the</span>
                        <span class="comment">\ object as possible</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">25</span>                <span class="comment">\ Set A = 25 to pass to FillScreen, so we fill the</span>
                        <span class="comment">\ screen buffer (as opposed to screen memory)</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">24</span>                <span class="comment">\ Set Y = 24 to pass to FillScreen, so we fill 24</span>
                        <span class="comment">\ character rows of the screen buffer</span>

 <span class="mne">LDX</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Set X = bufferColumns to pass to FillScreen, so we</span>
                        <span class="comment">\ fill bufferColumns character columns in the screen</span>
                        <span class="comment">\ buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">FillScreen</a>         <span class="comment">\ Call FillScreen to fill the screen buffer with the</span>
                        <span class="comment">\ background specified in screenBackground</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we are updating an object as part of the gameplay,</span>
                        <span class="comment">\ then screenBackground variable will have been zeroed</span>
                        <span class="comment">\ in DrawTitleView before the gameplay starts, so this</span>
                        <span class="comment">\ call to FillScreen will fill the buffer with</span>
                        <span class="comment">\ alternating colour 0/1 (blue/black) pixel rows, for</span>
                        <span class="comment">\ the sky</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If we are drawing an object on the game over screen</span>
                        <span class="comment">\ then screenBackground will be 3 and the background</span>
                        <span class="comment">\ will be a black screen with stars</span>

 <span class="mne">BIT</span> <a class="popup variable">drawLandscape</a>      <span class="comment">\ If bit 7 of drawLandscape is clear then we need to</span>
 <span class="mne">BPL</span> <a class="popup destination">updo3</a>              <span class="comment">\ draw both the object and the surrounding landscape, so</span>
                        <span class="comment">\ jump to updo3 to do this</span>

                        <span class="comment">\ If bit 7 of drawLandscape is set then we are showing</span>
                        <span class="comment">\ the game over screen, so we just need to draw the</span>
                        <span class="comment">\ object on its own and without the surrounding</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">LDY</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Draw the current object into the screen buffer</span>
 <span class="mne">JSR</span> <a class="popup destination">DrawObject</a>

 <span class="mne">JMP</span> <a class="popup destination">updo4</a>              <span class="comment">\ Jump to updo4 to skip the following instruction and</span>
                        <span class="comment">\ move on to updating the screen</span>

<span class="label">.updo3</span><a id="updo3" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeView</a>  <span class="comment">\ Draw the object into the screen buffer, as part of the</span>
                        <span class="comment">\ landscape view</span>

<span class="label">.updo4</span><a id="updo4" class="anchor"></a>

                        <span class="comment">\ By this point we have drawn the updated object into</span>
                        <span class="comment">\ the screen buffer, so we now need to copy the results</span>
                        <span class="comment">\ onto the screen</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set screenBufferAddr(1 0) to the address of the left</span>
 <span class="mne">JSR</span> <a class="popup destination">SetBufferAddress</a>   <span class="comment">\ column of the screen buffer</span>

 <span class="mne">LDX</span> <a class="popup variable">viewingObject</a>      <span class="comment">\ Set X to the viewing object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set yawAdjustmentLo = 0 so when we draw the landscape</span>
 <span class="mne">STA</span> <a class="popup variable">yawAdjustmentLo</a>    <span class="comment">\ again, it doesn't include the yaw adjustment for</span>
                        <span class="comment">\ drawing this object</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Subtract yawAdjustmentHi from the yaw angle for the</span>
 <span class="mne">LDA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ viewing, so the reverses the addition that we did</span>
 <span class="mne">SBC</span> <a class="popup variable">yawAdjustmentHi</a>    <span class="comment">\ above so the yaw angle of the viewing object is back</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a>,<span class="register">X</span>   <span class="comment">\ to the value it has for the normal landscape view</span>

                        <span class="comment">\ We now calculate the screen address of the left edge</span>
                        <span class="comment">\ of the object in the landscape view, as that's where</span>
                        <span class="comment">\ we want to copy the contents of the screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The landscape view is at viewScreenAddr(1 0) in screen</span>
                        <span class="comment">\ memory, and the number of character columns between</span>
                        <span class="comment">\ the left edge of the screen and the left edge of the</span>
                        <span class="comment">\ object is in objYawOffset, so now we convert the</span>
                        <span class="comment">\ character columns into screen memory bytes and add</span>
                        <span class="comment">\ that to viewScreenAddr(1 0), and that gives us the</span>
                        <span class="comment">\ address in screen memory of the top-left corner of the</span>
                        <span class="comment">\ object's position on-screen</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set (U A) = objYawOffset</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>
 <span class="mne">LDA</span> <a class="popup variable">objYawOffset</a>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set (U A) = (U A) * 8</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\           = objYawOffset * 8</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ROL</span> <a class="popup variable">U</a>                  <span class="comment">\ This converts the yaw offset in objYawOffset from</span>
                        <span class="comment">\ character columns into pixel bytes and stores the</span>
                        <span class="comment">\ result in (U A), as each character block contains</span>
                        <span class="comment">\ eight bytes</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We don't have to ROL the first two shifts into U as</span>
                        <span class="comment">\ we know objYawOffset is less than 40, so the first two</span>
                        <span class="comment">\ ASLs will only ever shift zeroes into the C flag</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set (A objScreenAddr) = viewScreenAddr(1 0) + (U A)</span>
 <span class="mne">ADC</span> <a class="popup variable">viewScreenAddr</a>
 <span class="mne">STA</span> <a class="popup variable">objScreenAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <a class="popup variable">U</a>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">updo5</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.updo5</span><a id="updo5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">objScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   objScreenAddr(1 0) = viewScreenAddr(1 0) + (U A)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this gives us the address in screen memory of the</span>
                        <span class="comment">\ top-left corner of the object's position on-screen</span>

 <span class="mne">BIT</span> <a class="popup variable">ditherObjectSights</a> <span class="comment">\ If bit 6 of ditherObjectSights is clear then we do not</span>
 <span class="mne">BVC</span> <a class="popup destination">updo7</a>              <span class="comment">\ draw the object on-screen with a dithered effect, so</span>
                        <span class="comment">\ jump to updo7 to skip the following and move straight</span>
                        <span class="comment">\ on to drawing the whole object to the screen</span>

 <span class="mne">BIT</span> <a class="popup variable">sentinelHasWon</a>     <span class="comment">\ If bit 7 of sentinelHasWon is clear then the Sentinel</span>
 <span class="mne">BPL</span> <a class="popup destination">updo6</a>              <span class="comment">\ has not won the game, so skip the following to leave</span>
                        <span class="comment">\ ditherOuterLoop set to 25, which is the correct amount</span>
                        <span class="comment">\ of time to spend dithering when updating objects on</span>
                        <span class="comment">\ landscape during gameplay</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">40</span>                <span class="comment">\ The Sentinel has won and we are therefore drawing the</span>
 <span class="mne">STA</span> <a class="popup variable">ditherOuterLoop</a>    <span class="comment">\ game over screen rather than updating an object in the</span>
                        <span class="comment">\ landscape, so set ditherOuterLoop = 40 to make the</span>
                        <span class="comment">\ dithered effect in the DitherScreenBuffer routine last</span>
                        <span class="comment">\ for 40 outer loops rather than 25, where each inner</span>
                        <span class="comment">\ loop dithers 255 pixels to the screen</span>

<span class="label">.updo6</span><a id="updo6" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">DitherScreenBuffer</a> <span class="comment">\ Dither the contents of the screen buffer onto the</span>
                        <span class="comment">\ screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that this process does not update the entire</span>
                        <span class="comment">\ object on-screen, so we will need to do that at updo7</span>
                        <span class="comment">\ below once we have finished dithering</span>

 <span class="mne">LDA</span> <a class="popup variable">sentinelHasWon</a>     <span class="comment">\ If bit 7 of sentinelHasWon is set then the Sentinel</span>
 <span class="mne">BMI</span> <a class="popup destination">updo11</a>             <span class="comment">\ has won the game and we are therefore drawing the game</span>
                        <span class="comment">\ over screen and we don't want to draw the victorious</span>
                        <span class="comment">\ enemy completely, so jump to updo11 to skip the part</span>
                        <span class="comment">\ where the object is fully drawn on-screen</span>

<span class="label">.updo7</span><a id="updo7" class="anchor"></a>

                        <span class="comment">\ By this point we have either finished dithering the</span>
                        <span class="comment">\ updated object onto the screen (if dithering was</span>
                        <span class="comment">\ configured), or dithering was not configured</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In either case we now need to draw the whole object</span>
                        <span class="comment">\ onto the screen</span>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts to ensure that the screen doesn't</span>
                        <span class="comment">\ scroll while we are removing the sights, as that could</span>
                        <span class="comment">\ corrupt the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">RemoveSights</a>       <span class="comment">\ Remove the sights from the screen before we update the</span>
                        <span class="comment">\ object on-screen by calling the RemoveSights routine</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of doNotDrawSights so the DrawSights routine</span>
 <span class="mne">ROR</span> <a class="popup variable">doNotDrawSights</a>    <span class="comment">\ does not draw the sights on-screen going forward</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This prevents the interrupt handler from drawing the</span>
                        <span class="comment">\ sights, in case it starts processing a sights-related</span>
                        <span class="comment">\ key press while we still are doing the updating</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a>      <span class="comment">\ Set toAddr(1 0) to the address of the object in screen</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>             <span class="comment">\ memory which we put into objScreenAddr(1 0) above, so</span>
 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ we copy the screen contents from the screen buffer to</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ the correct place on-screen</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ We are now going to loop through the character columns</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ that we want to copy to the screen, so set a loop</span>
                        <span class="comment">\ counter to the number of columns in bufferColumns,</span>
                        <span class="comment">\ which we set to the column count for covering the</span>
                        <span class="comment">\ whole object (or as many as we can fit into the column</span>
                        <span class="comment">\ buffer, at least)</span>

 <span class="mne">JMP</span> <a class="popup destination">updo10</a>             <span class="comment">\ We are now ready to copy the configured number of</span>
                        <span class="comment">\ character columns from the screen buffer to the</span>
                        <span class="comment">\ screen, so jump into the following loop at updo10</span>

<span class="label">.updo8</span><a id="updo8" class="anchor"></a>

                        <span class="comment">\ We have updated an on-screen character column, so now</span>
                        <span class="comment">\ we move to the next character column to the right</span>

 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a>      <span class="comment">\ Set (A objScreenAddr) = objScreenAddr(1 0) + 8</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ and (A toAddr) = objScreenAddr(1 0) + 8</span>
 <span class="mne">STA</span> <a class="popup variable">objScreenAddr</a>      <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>             <span class="comment">\ So this moves both the from and to addresses to the</span>
 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ next character column along</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">updo9</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.updo9</span><a id="updo9" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">objScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   objScreenAddr(1 0) = objScreenAddr(1 0) + 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   toAddr(1 0) = toAddr(1 0) + 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

<span class="label">.updo10</span><a id="updo10" class="anchor"></a>

                        <span class="comment">\ This is where we enter the screen-updating loop</span>

 <span class="mne">LDY</span> <a class="popup variable">lastPanKeyPressed</a>  <span class="comment">\ Set Y to the value of lastPanKeyPressed, which we set</span>
                        <span class="comment">\ to zero above</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Zero is normally the value for when we are panning the</span>
                        <span class="comment">\ screen to the right, but we use it here because when</span>
                        <span class="comment">\ we pan to the right, we draw the screen buffer onto</span>
                        <span class="comment">\ the screen in columns, working from left to right, and</span>
                        <span class="comment">\ that's also what we want to do when updating the</span>
                        <span class="comment">\ object</span>

 <span class="mne">JSR</span> <a class="popup destination">ShowScreenBuffer</a>   <span class="comment">\ Update the player's scrolling landscape view by</span>
                        <span class="comment">\ copying the relevant parts of the screen buffer into</span>
                        <span class="comment">\ screen memory</span>

 <span class="mne">DEC</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ Decrement the loop counter to move on to the next</span>
                        <span class="comment">\ character column in the updated object</span>

 <span class="mne">BNE</span> <a class="popup destination">updo8</a>              <span class="comment">\ Loop back to keep drawing character columns from the</span>
                        <span class="comment">\ screen buffer until we have drawn them all</span>

<span class="label">.updo11</span><a id="updo11" class="anchor"></a>

                        <span class="comment">\ We now need to check whether we have updated the whole</span>
                        <span class="comment">\ object on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The column buffer is 24 character rows tall and up to</span>
                        <span class="comment">\ 20 character columns wide, so if the on-screen object</span>
                        <span class="comment">\ wider than 20 character columns (i.e. wider than half</span>
                        <span class="comment">\ a screen width), then we can't fit the whole object</span>
                        <span class="comment">\ into the column buffer in one go, so we need to draw</span>
                        <span class="comment">\ it in two stages</span>

 <span class="mne">LDA</span> <a class="popup variable">objYawOffset</a>       <span class="comment">\ Set objYawOffset = objYawOffset + bufferColumns</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ This sets the yaw offset to the character column to</span>
 <span class="mne">STA</span> <a class="popup variable">objYawOffset</a>       <span class="comment">\ the right of the on-screen block that we just drew</span>
                        <span class="comment">\ to update the object</span>

 <span class="mne">LDA</span> <a class="popup variable">objYawWidth</a>        <span class="comment">\ Set A = objYawWidth - bufferColumns</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ We just drew bufferColumns character columns of the</span>
                        <span class="comment">\ object and objYawWidth contains the full width of the</span>
                        <span class="comment">\ on-screen object in character columns, so A now</span>
                        <span class="comment">\ contains the number of character columns that we still</span>
                        <span class="comment">\ have to draw</span>

 <span class="mne">BEQ</span> <a class="popup destination">updo12</a>             <span class="comment">\ If A = 0 then we have drawn the whole object, so jump</span>
                        <span class="comment">\ to updo12 to finish off</span>

                        <span class="comment">\ If we get here then A is non-zero so we still have</span>
                        <span class="comment">\ more of the object to update on-screen, so we update</span>
                        <span class="comment">\ the variables and loop back to draw the next set of</span>
                        <span class="comment">\ 20 character columns to the right, dithering them in</span>
                        <span class="comment">\ the same way if required</span>

 <span class="mne">STA</span> <a class="popup variable">objYawWidth</a>        <span class="comment">\ Set the width of the on-screen object to A so it</span>
                        <span class="comment">\ contains the number of character columns we still have</span>
                        <span class="comment">\ to draw</span>

 <span class="mne">STA</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Configure the buffer width to the correct size for the</span>
                        <span class="comment">\ second batch of character columns</span>

 <span class="mne">STA</span> <a class="popup variable">ditherOuterLoop</a>    <span class="comment">\ Set ditherOuterLoop to A, so the dithered effect in</span>
                        <span class="comment">\ the DitherScreenBuffer routine implements A outer</span>
                        <span class="comment">\ loops, where each inner loop dithers 255 pixels to the</span>
                        <span class="comment">\ screen</span>

 <span class="mne">JMP</span> <a class="popup destination">updo2</a>              <span class="comment">\ Jump back to updo2 to update the second part of the</span>
                        <span class="comment">\ on-screen object</span>

<span class="label">.updo12</span><a id="updo12" class="anchor"></a>

 <span class="mne">LSR</span> <a class="popup variable">doNotDrawSights</a>    <span class="comment">\ Clear bit 7 of doNotDrawSights so the DrawSights</span>
                        <span class="comment">\ routine is enabled once again</span>

 <span class="mne">LDA</span> <a class="popup variable">sightsAreVisible</a>   <span class="comment">\ If bit 7 of sightsAreVisible is clear then the sights</span>
 <span class="mne">BPL</span> <a class="popup destination">updo13</a>             <span class="comment">\ are not currently being shown on-screen, so jump to</span>
                        <span class="comment">\ updo13 to skip the following</span>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts to ensure that the screen doesn't</span>
                        <span class="comment">\ scroll while we are drawing the sights, as that could</span>
                        <span class="comment">\ corrupt the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawSights</a>         <span class="comment">\ Bit 7 of sightsAreVisible is set, so we need to draw</span>
                        <span class="comment">\ the sights that we removed when updating the object,</span>
                        <span class="comment">\ so call DrawSights to put them back</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

<span class="label">.updo13</span><a id="updo13" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">updo1</a>              <span class="comment">\ We have finished updating the object, so jump to updo1</span>
                        <span class="comment">\ to reset the various dither-related variables and</span>
                        <span class="comment">\ return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-screenbufferaddr" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">screenBufferAddr</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Storage for the address for the current drawing operation in the</span>
             <span class="headerEntry">screen buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/screenbufferaddr.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/setbufferaddress.html">SetBufferAddress</a> uses <a href="#screenbufferaddr">screenBufferAddr</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showbuffercolumn.html">ShowBufferColumn</a> uses <a href="#screenbufferaddr">screenBufferAddr</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/showscreenbuffer.html">ShowScreenBuffer</a> uses <a href="#screenbufferaddr">screenBufferAddr</a></span>
</div>
</div></div>
<span class="label">.screenBufferAddr</span><a id="screenbufferaddr" class="anchor"></a>

 <span class="mne">EQUW</span> <span class="hex">&0000</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-objscreenaddr" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">objScreenAddr</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The screen address of the object we are updating</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/objscreenaddr.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> uses <a href="#objscreenaddr">objScreenAddr</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> uses <a href="#objscreenaddr">objScreenAddr</a></span>
</div>
</div></div>
<span class="label">.objScreenAddr</span><a id="objscreenaddr" class="anchor"></a>

 <span class="mne">EQUW</span> <span class="hex">&0000</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-ditherouterloop" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">ditherOuterLoop</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A counter for the inner loop when dithering objects to the screen</span>
             <span class="headerEntry">in the DitherScreenBuffer routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/ditherouterloop.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> uses <a href="#ditherouterloop">ditherOuterLoop</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> uses <a href="#ditherouterloop">ditherOuterLoop</a></span>
</div>
</div></div>
<span class="label">.ditherOuterLoop</span><a id="ditherouterloop" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-yawadjustmenthi" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">yawAdjustmentHi</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The yaw offset of the left edge of the object being updated,</span>
             <span class="headerEntry">relative to the left edge of the screen, in yaw angles</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/yawadjustmenthi.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> uses <a href="#yawadjustmenthi">yawAdjustmentHi</a></span>
</div>
</div></div>
<span class="label">.yawAdjustmentHi</span><a id="yawadjustmenthi" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ A yaw adjustment to apply to the landscape drawing</span>
                        <span class="comment">\ process so that when we update objects on-screen, we</span>
                        <span class="comment">\ can yaw the viewer's gaze to the right to move the</span>
                        <span class="comment">\ left edge of the object to the left edge of the screen</span>
                        <span class="comment">\ so the object will fit into the screen buffer as</span>
                        <span class="comment">\ efficiently as possible (high byte)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getobjvisibility" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetObjVisibility</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate whether any part of an object is visible on-screen, and</span>
             <span class="headerEntry">if so, which character columns it spans on the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getobjvisibility.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkobjvisibility.html">CheckObjVisibility</a> calls <a href="#getobjvisibility">GetObjVisibility</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#getobjvisibility">GetObjVisibility</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">currentObject</span>        <span class="argumentEntry">The number of the object to check</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">The object's visibility:</span>

                        <span class="argumentEntry">  * Clear = at least some of the object is visible</span>
                        <span class="argumentEntry">            on-screen</span>

                        <span class="argumentEntry">  * Set = the object is not visible on-screen</span>

   <span class="argumentLabel">bufferColumns</span>        <span class="argumentEntry">If the object is visible, this is set to the number of</span>
                        <span class="argumentEntry">character columns in the screen buffer that the object</span>
                        <span class="argumentEntry">spans</span>

   <span class="argumentLabel">objYawOffset</span>         <span class="argumentEntry">If the object is visible, this is set to the yaw offset</span>
                        <span class="argumentEntry">of the left edge of the object from the left edge of the</span>
                        <span class="argumentEntry">screen, in character columns</span>

</div></div>
<span class="label">.GetObjVisibility</span><a id="getobjvisibility" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set Y to the number of the object to check (so we are</span>
                        <span class="comment">\ checking object #Y)</span>

 <span class="mne">CPY</span> <a class="popup variable">playerObject</a>       <span class="comment">\ If this is the player object, jump to objv6 to return</span>
 <span class="mne">BEQ</span> <a class="popup destination">objv6</a>              <span class="comment">\ from the subroutine with the C flag set to indicate</span>
                        <span class="comment">\ that the object is not visible on-screen, as the</span>
                        <span class="comment">\ player can never see themselves</span>

 <span class="mne">JSR</span> <a class="popup destination">GetObjectAngles</a>    <span class="comment">\ Calculate the angles and distances of the vector from</span>
                        <span class="comment">\ the viewer to object #Y and put them into the</span>
                        <span class="comment">\ following variables:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set objectViewYaw(Hi Lo) to the yaw angle of the</span>
                        <span class="comment">\     viewer's gaze towards the object, relative to the</span>
                        <span class="comment">\     screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set hypotenuse(Hi Lo) to the length of the 3D</span>
                        <span class="comment">\     vector from the viewer to the object when</span>
                        <span class="comment">\     projected down onto the ground plane</span>

                        <span class="comment">\ We now work out the width of the object that we are</span>
                        <span class="comment">\ looking at so we can work out whether any of it is</span>
                        <span class="comment">\ on-screen</span>

 <span class="mne">LDY</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set X to the type of the object that we are checking</span>
 <span class="mne">LDX</span> <a class="popup variable">objectTypes</a>,<span class="register">Y</span>

 <span class="mne">LDA</span> <a class="popup variable">objectHalfWidth</a>,<span class="register">X</span>  <span class="comment">\ Set A to half the object width for this object type,</span>
                        <span class="comment">\ as a fraction of a tile</span>

 <span class="mne">CMP</span> <a class="popup variable">minObjWidth</a>        <span class="comment">\ If A &lt; minObjWidth then set A = minObjWidth, so:</span>
 <span class="mne">BCS</span> <a class="popup destination">objv1</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">minObjWidth</a>        <span class="comment">\   A = max(minObjWidth, objectHalfWidth)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if minObjWidth is non-zero, we consider the object</span>
                        <span class="comment">\ to be at least as wide as minObjWidth for the purposes</span>
                        <span class="comment">\ of calculating whether it is visible on-screen</span>

<span class="label">.objv1</span><a id="objv1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\ Set (A xDeltaLo) = (0 A)</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\                  = max(minObjWidth, objectHalfWidth)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So xDeltaLo is the width of the object</span>

 <span class="mne">STA</span> <a class="popup variable">minObjWidth</a>        <span class="comment">\ Set minObjWidth = 0 as we have used this figure in the</span>
                        <span class="comment">\ visibility calculation for the object, so we need to</span>
                        <span class="comment">\ reset it for the next time we check an object (so the</span>
                        <span class="comment">\ default value for minObjWidth is zero and it is only</span>
                        <span class="comment">\ overridden when a large object is replaced by a</span>
                        <span class="comment">\ smaller object)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetPitchAngleDelta</a> <span class="comment">\ At this point we construct a right-angled triangle</span>
                        <span class="comment">\ with adjacent side hypotenuse(Hi Lo) and opposite</span>
                        <span class="comment">\ side xDeltaLo, like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\                                   object</span>
                        <span class="comment">\                                  _.-+</span>
                        <span class="comment">\                              _.-   |</span>
                        <span class="comment">\                          _.-       |</span>
                        <span class="comment">\                      _.-           |</span>
                        <span class="comment">\                  _.-               |  xDeltaLo</span>
                        <span class="comment">\              _.-                   |</span>
                        <span class="comment">\           .- angle(Hi Lo)          |</span>
                        <span class="comment">\   viewer +--------------------------+</span>
                        <span class="comment">\               hypotenuse(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This triangle is flat on the ground with the viewer at</span>
                        <span class="comment">\ the corner</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The adjacent side of length hypotenuse(Hi Lo) along</span>
                        <span class="comment">\ the bottom of the triangle represents the projection</span>
                        <span class="comment">\ onto the ground of the vector from the viewer to the</span>
                        <span class="comment">\ object, as if there were a light shining down from</span>
                        <span class="comment">\ above, so this is the projection of the gaze vector</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We want to calculate angle(Hi Lo), as that's the yaw</span>
                        <span class="comment">\ angle delta between the projected gaze vector and the</span>
                        <span class="comment">\ edge of the object, as the object has a yaw angle of</span>
                        <span class="comment">\ xDeltaLo from the object centre to the side (as it's</span>
                        <span class="comment">\ the half-width of the object)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can then use this yaw angle delta to work out</span>
                        <span class="comment">\ whether the left and right edges of the object are</span>
                        <span class="comment">\ within the left-right viewing arc of the screen, and</span>
                        <span class="comment">\ therefore whether any part of the object is within the</span>
                        <span class="comment">\ screen bounds</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To do this we call GetPitchAngleDelta, not because we</span>
                        <span class="comment">\ are calculating a pitch angle, but because this</span>
                        <span class="comment">\ routine calculates the angle of the above triangle as</span>
                        <span class="comment">\ part of the process of calculating a pitch angle delta</span>
                        <span class="comment">\ (so we just ignore the pitch angle result here)</span>

                        <span class="comment">\ We now check whether the object is on screen in terms</span>
                        <span class="comment">\ of yaw angles, so that's checking the object's edges</span>
                        <span class="comment">\ against the left and right edges of the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We start by checking the object against the left edge</span>
                        <span class="comment">\ of the screen</span>

 <span class="mne">LDA</span> <a class="popup variable">objectViewYawLo</a>    <span class="comment">\ Set (A T) = objectViewYaw(Hi Lo) - angle(Hi Lo)</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">angleLo</a>            <span class="comment">\ So (A T) contains the yaw angle of the left edge of</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ the object, relative to the screen</span>
 <span class="mne">LDA</span> <a class="popup variable">objectViewYawHi</a>
 <span class="mne">SBC</span> <a class="popup variable">angleHi</a>

 <span class="mne">BPL</span> <a class="popup destination">objv2</a>              <span class="comment">\ If the result in (A T) is positive then the left edge</span>
                        <span class="comment">\ of the object is to the right of the left screen edge,</span>
                        <span class="comment">\ so jump to objv2 to see how far it is to the right</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ (A T) is negative, so the left edge of the object is</span>
                        <span class="comment">\ to the left of the left screen edge, so set A = 0 to</span>
                        <span class="comment">\ use as the yaw offset of the left edge of the object</span>
                        <span class="comment">\ in objYawOffset</span>

 <span class="mne">BEQ</span> <a class="popup destination">objv3</a>              <span class="comment">\ Jump to objv3 to set objYawOffset to zero and move on</span>
                        <span class="comment">\ to the checks for the right edge of the object</span>

<span class="label">.objv2</span><a id="objv2" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ Double the yaw angle in (A T)</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\</span>
                        <span class="comment">\ This converts the yaw angle into character columns in</span>
                        <span class="comment">\ screen memory</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The custom screen mode 5 used by the game is 40</span>
                        <span class="comment">\ character columns wide, and the screen is 20 yaw</span>
                        <span class="comment">\ angles wide in terms of the game's coordinate system</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can simply double the yaw angle in (A T) to</span>
                        <span class="comment">\ convert it into on-screen character columns</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">40</span>                <span class="comment">\ If A >= 40 then the left edge is past the right edge</span>
 <span class="mne">BCS</span> <a class="popup destination">objv6</a>              <span class="comment">\ of the screen (as the screen is 40 columns wide),</span>
                        <span class="comment">\ which means the object is not visible, so jump to</span>
                        <span class="comment">\ objv6 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set to indicate that the object is not visible</span>
                        <span class="comment">\ on-screen</span>

<span class="label">.objv3</span><a id="objv3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">objYawOffset</a>       <span class="comment">\ Set objYawOffset to A, so it contains the yaw offset</span>
                        <span class="comment">\ of the left edge of the object from the left edge of</span>
                        <span class="comment">\ the screen, in character columns</span>

                        <span class="comment">\ We now check the object against the right edge of the</span>
                        <span class="comment">\ screen</span>

 <span class="mne">LDA</span> <a class="popup variable">objectViewYawLo</a>    <span class="comment">\ Set (A T) = objectViewYaw(Hi Lo) + angle(Hi Lo)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">angleLo</a>            <span class="comment">\ So (A T) contains the yaw angle of the right edge of</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ the object, relative to the screen</span>
 <span class="mne">LDA</span> <a class="popup variable">objectViewYawHi</a>
 <span class="mne">ADC</span> <a class="popup variable">angleHi</a>

 <span class="mne">BMI</span> <a class="popup destination">objv6</a>              <span class="comment">\ If the result in (A T) is negative then the right edge</span>
                        <span class="comment">\ of the object is to the left of the left screen edge,</span>
                        <span class="comment">\ so jump to objv6 to return from the subroutine with</span>
                        <span class="comment">\ the C flag set to indicate that the object is not</span>
                        <span class="comment">\ visible on-screen</span>

                        <span class="comment">\ If we get here then the right edge of the object is to</span>
                        <span class="comment">\ the right of the left screen edge, and we know from</span>
                        <span class="comment">\ the first test that the left edge of the object is to</span>
                        <span class="comment">\ the left of the right screen edge, so some of the</span>
                        <span class="comment">\ object must be on-screen</span>

 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ Double the yaw angle in (A T)</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\</span>
                        <span class="comment">\ This converts the yaw angle into character columns in</span>
                        <span class="comment">\ screen memory</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The custom screen mode 5 used by the game is 40</span>
                        <span class="comment">\ character columns wide, and the screen is 20 yaw</span>
                        <span class="comment">\ angles wide in terms of the game's coordinate system</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can simply double the yaw angle in (A T) to</span>
                        <span class="comment">\ convert it into on-screen character columns</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">40</span>                <span class="comment">\ If A >= 40 then set A = 39, so A = max(39, A)</span>
 <span class="mne">BCC</span> <a class="popup destination">objv4</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">39</span>                <span class="comment">\ This sets A to the yaw angle offset of the right edge</span>
                        <span class="comment">\ of the object, in on-screen character columns, clipped</span>
                        <span class="comment">\ to fit within the screen width of 40 columns</span>

<span class="label">.objv4</span><a id="objv4" class="anchor"></a>

 <span class="mne">CLC</span>                    <span class="comment">\ Set objYawWidth = A + 1 - objYawOffset</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\</span>
 <span class="mne">SEC</span>                    <span class="comment">\ This sets objYawWidth to the difference between the</span>
 <span class="mne">SBC</span> <a class="popup variable">objYawOffset</a>       <span class="comment">\ yaw offsets for the right and left edges, so that's</span>
 <span class="mne">STA</span> <a class="popup variable">objYawWidth</a>        <span class="comment">\ the width of the object in on-screen character columns</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We add 1 to ensure we take the fractional part of the</span>
                        <span class="comment">\ yaw offsets into account, as we have ignored the low</span>
                        <span class="comment">\ byte in T for this calculation</span>

 <span class="mne">BEQ</span> <a class="popup destination">objv6</a>              <span class="comment">\ If objYawWidth = 0 then the object has no on-screen</span>
                        <span class="comment">\ width, so jump to objv6 to return from the subroutine</span>
                        <span class="comment">\ with the C flag set to indicate that the object is not</span>
                        <span class="comment">\ visible on-screen</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">21</span>                <span class="comment">\ If A >= 21 then set A = 20, so A = max(20, A)</span>
 <span class="mne">BCC</span> <a class="popup destination">objv5</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">20</span>                <span class="comment">\ This clips A to the maximum of 20 character columns as</span>
                        <span class="comment">\ this is the maximum width of the screen buffer when</span>
                        <span class="comment">\ configured as a column buffer</span>

<span class="label">.objv5</span><a id="objv5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Configure the screen buffer to use A character columns</span>
                        <span class="comment">\ for drawing the object</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Note that this has a maximum value of 20, which is why</span>
                        <span class="comment">\ close-up objects that take up a large amount of space</span>
                        <span class="comment">\ on-screen are absorbed in two stages, left then right,</span>
                        <span class="comment">\ as the object it too wide to fit into the column</span>
                        <span class="comment">\ buffer's maximum width of 20 character columns, or</span>
                        <span class="comment">\ half a screen</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that the object is</span>
                        <span class="comment">\ visible on-screen</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.objv6</span><a id="objv6" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that the object is not</span>
                        <span class="comment">\ visible on-screen</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-objecthalfwidth" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">objectHalfWidth</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Each object's width in terms of tile widths, for half the object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/objecthalfwidth.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getobjvisibility.html">GetObjVisibility</a> uses <a href="#objecthalfwidth">objectHalfWidth</a></span>
</div>
</div></div>
<span class="label">.objectHalfWidth</span><a id="objecthalfwidth" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">62</span>                <span class="comment">\ Object type 0: Robot                       0.242 tiles</span>

 <span class="mne">EQUB</span> <span class="decimal">70</span>                <span class="comment">\ Object type 1: Sentry                      0.273 tiles</span>

 <span class="mne">EQUB</span> <span class="decimal">114</span>               <span class="comment">\ Object type 2: Tree                        0.445 tiles</span>

 <span class="mne">EQUB</span> <span class="decimal">122</span>               <span class="comment">\ Object type 3: Boulder                     0.477 tiles</span>

 <span class="mne">EQUB</span> <span class="decimal">74</span>                <span class="comment">\ Object type 4: Meanie                      0.289 tiles</span>

 <span class="mne">EQUB</span> <span class="decimal">78</span>                <span class="comment">\ Object type 5: The Sentinel                0.305 tiles</span>

 <span class="mne">EQUB</span> <span class="decimal">193</span>               <span class="comment">\ Object type 6: Sentinel's tower            0.754 tiles</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-spawnobject" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnObject</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Add a new object of the specified type to the objectTypes table</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/spawnobject.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/addenemiestotiles.html">AddEnemiesToTiles</a> calls <a href="#spawnobject">SpawnObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/expendenemyenergy.html">ExpendEnemyEnergy</a> calls <a href="#spawnobject">SpawnObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/performhyperspace.html">PerformHyperspace</a> calls <a href="#spawnobject">SpawnObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnplayer.html">SpawnPlayer</a> calls <a href="#spawnobject">SpawnObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawntrees.html">SpawnTrees</a> calls <a href="#spawnobject">SpawnObject</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls via <a href="#spawnobject">SpawnObject+3</a></span></span>
</div>
<hr class="light">
 This routine spawns a new object by searching the objectFlags table for a free
 number to allocate. If there is no free number then the routine returns with
 the C flag set, otherwise the C flag is clear, X and currentObject are set to
 the number of the new object, and the object type is added to the objectTypes
 table.

 Note that this routine only adds the object to the objectTypes table; it
 doesn't update the flags or add any other information about the object.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The type of object to spawn:</span>

                        <span class="argumentEntry">  * 0 = Robot (one of which is the player)</span>

                        <span class="argumentEntry">  * 1 = Sentry</span>

                        <span class="argumentEntry">  * 2 = Tree</span>

                        <span class="argumentEntry">  * 3 = Boulder</span>

                        <span class="argumentEntry">  * 4 = Meanie</span>

                        <span class="argumentEntry">  * 5 = The Sentinel</span>

                        <span class="argumentEntry">  * 6 = The Sentinel's tower</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the new object (if successful)</span>

   <span class="argumentLabel">currentObject</span>        <span class="argumentEntry">The number of the new object (if successful)</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag:</span>

                        <span class="argumentEntry">  * Clear if the object was successfully spawned</span>

                        <span class="argumentEntry">  * Set if there is no free number for the new object</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">SpawnObject+3</span>        <span class="argumentEntry">Spawn an object of the type specified in keyPress</span>

                        <span class="argumentEntry">The keyPress and objectType variables share the same</span>
                        <span class="argumentEntry">memory location, so this lets us store object types in</span>
                        <span class="argumentEntry">the key press codes in keyLoggerConfig, so that pressing</span>
                        <span class="argumentEntry">one of the "create" keys will automatically spawn that</span>
                        <span class="argumentEntry">type of object</span>

</div></div>
<span class="label">.SpawnObject</span><a id="spawnobject" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">objectType</a>         <span class="comment">\ Store the object type in objectType for future</span>
                        <span class="comment">\ reference</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ In order to be able to create a new object, we need to</span>
                        <span class="comment">\ find an unallocated object number in the objectFlags</span>
                        <span class="comment">\ table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The game can support up to 64 objects, each with its</span>
                        <span class="comment">\ own number (0 to 63), so set a counter in X to work</span>
                        <span class="comment">\ through the object numbers until we find one that is</span>
                        <span class="comment">\ not allocated to an object</span>

<span class="label">.sobj1</span><a id="sobj1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ Set A to the object flags for object #X, which are</span>
                        <span class="comment">\ stored in the X-th entry in the objectFlags table</span>

 <span class="mne">BMI</span> <a class="popup destination">sobj2</a>              <span class="comment">\ If bit 7 of object flags for object #X is set then</span>
                        <span class="comment">\ this object number is not yet allocated to an object,</span>
                        <span class="comment">\ so jump to sobj2 use this number for our new object</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Otherwise decrement the counter in X to move on to the</span>
                        <span class="comment">\ next object number</span>

 <span class="mne">BPL</span> <a class="popup destination">sobj1</a>              <span class="comment">\ Loop back to sobj1 to check the next object number</span>

 <span class="mne">SEC</span>                    <span class="comment">\ If we get here then we have checked all 64 object</span>
                        <span class="comment">\ numbers and none of them are free, so set the C flag</span>
                        <span class="comment">\ to indicate that we have failed to spawn the object</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.sobj2</span><a id="sobj2" class="anchor"></a>

                        <span class="comment">\ If we get here then we have found an unallocated</span>
                        <span class="comment">\ object number in the objectFlags table at index X</span>

 <span class="mne">STX</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set currentObject to the object number in X</span>

 <span class="mne">LDA</span> <a class="popup variable">objectType</a>         <span class="comment">\ Set the corresponding entry in the objectTypes table</span>
 <span class="mne">STA</span> <a class="popup variable">objectTypes</a>,<span class="register">X</span>      <span class="comment">\ to the object type that we are spawning, which we</span>
                        <span class="comment">\ stored in objectType above</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have successfully</span>
                        <span class="comment">\ added a new object to the objectFlags table</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-updateplayerenergy" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">UpdatePlayerEnergy</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Update the player's energy levels by adding or subtracting the</span>
             <span class="headerEntry">amount of energy in a specific object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/updateplayerenergy.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/performhyperspace.html">PerformHyperspace</a> calls <a href="#updateplayerenergy">UpdatePlayerEnergy</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls <a href="#updateplayerenergy">UpdatePlayerEnergy</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the object whose energy is being added to</span>
                        <span class="argumentEntry">or subtracted from the player's energy</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Controls whether we add or subtract the energy:</span>

                        <span class="argumentEntry">  * Clear = add object #X's energy to the player's</span>
                        <span class="argumentEntry">            energy</span>

                        <span class="argumentEntry">  * Set = Subtract object #X's energy from the player's</span>
                        <span class="argumentEntry">          energy</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Result flag:</span>

                        <span class="argumentEntry">  * Clear if the player still has a positive energy</span>
                        <span class="argumentEntry">    level after the update</span>

                        <span class="argumentEntry">  * Set if the player now has a negative energy level,</span>
                        <span class="argumentEntry">    which means the Sentinel has won</span>

</div></div>
<span class="label">.UpdatePlayerEnergy</span><a id="updateplayerenergy" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">objectTypes</a>,<span class="register">X</span>      <span class="comment">\ Set Y to the object type of object #X</span>

 <span class="mne">LDA</span> <a class="popup variable">playerEnergy</a>       <span class="comment">\ Set A to the player's current energy level</span>

 <span class="mne">BCC</span> <a class="popup destination">uple1</a>              <span class="comment">\ If the C flag argument is clear, jump to uple1 to add</span>
                        <span class="comment">\ the energies</span>

                        <span class="comment">\ Otherwise the C flag argument is set, so we subtract</span>
                        <span class="comment">\ object #X's energy from the player's energy in A</span>

 <span class="mne">SBC</span> <a class="popup variable">objectTypeEnergy</a>,<span class="register">Y</span> <span class="comment">\ The objectTypeEnergy table contains the energy levels</span>
                        <span class="comment">\ for each of the object types, so this subtracts the</span>
                        <span class="comment">\ energy of object #X from the player's energy in A</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The subtraction works because we know the C flag is</span>
                        <span class="comment">\ set, as we just passed through a BCC</span>

 <span class="mne">BCS</span> <a class="popup destination">uple2</a>              <span class="comment">\ If the subtraction didn't underflow then the player</span>
                        <span class="comment">\ still has some energy left, so jump to uple2 to return</span>
                        <span class="comment">\ from the subroutine with the C flag clear</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The player now has negative energy, so return from the</span>
                        <span class="comment">\ subroutine with the C flag set to indicate this</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.uple1</span><a id="uple1" class="anchor"></a>

                        <span class="comment">\ If we get here then the C flag argument is clear, so</span>
                        <span class="comment">\ we add object #X's energy to the player's energy in A</span>

 <span class="mne">ADC</span> <a class="popup variable">objectTypeEnergy</a>,<span class="register">Y</span> <span class="comment">\ The objectTypeEnergy table contains the energy levels</span>
                        <span class="comment">\ for each of the object types, so this adds the energy</span>
                        <span class="comment">\ of object #X to the player's energy in A</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The addition works because we know the C flag is</span>
                        <span class="comment">\ clear, as we got here by taking a BCC</span>

<span class="label">.uple2</span><a id="uple2" class="anchor"></a>

 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Cap the value in A to a maximum of 63, so the player's</span>
                        <span class="comment">\ energy is always in the range 0 to 63</span>

 <span class="mne">STA</span> <a class="popup variable">playerEnergy</a>       <span class="comment">\ Update the player's energy level to the new level in A</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that the player still has</span>
                        <span class="comment">\ a positive amount of energy (i.e. 0 or above)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-objecttypeenergy" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">objectTypeEnergy</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">3D objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The amount of energy required to create each object or the amount</span>
             <span class="headerEntry">energy acquired when absorbing each object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/objecttypeenergy.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updateplayerenergy.html">UpdatePlayerEnergy</a> uses <a href="#objecttypeenergy">objectTypeEnergy</a></span>
</div>
</div></div>
<span class="label">.objectTypeEnergy</span><a id="objecttypeenergy" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Object type 0: Robot                    3 energy units</span>

 <span class="mne">EQUB</span> <span class="decimal">3</span>                 <span class="comment">\ Object type 1: Sentry                   3 energy units</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Object type 2: Tree                      1 energy unit</span>

 <span class="mne">EQUB</span> <span class="decimal">2</span>                 <span class="comment">\ Object type 3: Boulder                  2 energy units</span>

 <span class="mne">EQUB</span> <span class="decimal">1</span>                 <span class="comment">\ Object type 4: Meanie                    1 energy unit</span>

 <span class="mne">EQUB</span> <span class="decimal">4</span>                 <span class="comment">\ Object type 5: The Sentinel             4 energy units</span>

 <span class="mne">EQUB</span> <span class="decimal">0</span>                 <span class="comment">\ Object type 6: Sentinel's tower         0 energy units</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-performhyperspace" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">PerformHyperspace</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Hyperspace the player to a brand new tile, ideally at the same</span>
             <span class="headerEntry">altitude as the current tile</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/performhyperspace.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_2_of_8.html">ApplyTactics (Part 2 of 8)</a> calls <a href="#performhyperspace">PerformHyperspace</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_1_of_2.html">ProcessActionKeys (Part 1 of 2)</a> calls <a href="#performhyperspace">PerformHyperspace</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Returns:</span>

                        <span class="argumentEntry">  * Clear if the hyperspace was a success, or if the</span>
                        <span class="argumentEntry">    player didn't have enough energy to hyperspace</span>

                        <span class="argumentEntry">  * Set if we could not spawn a robot to use as the</span>
                        <span class="argumentEntry">    destination for the hyperspace</span>

</div></div>
<span class="label">.PerformHyperspace</span><a id="performhyperspace" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Spawn a robot (an object of type 0), returning the</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnObject</a>        <span class="comment">\ object number of the new object in X and currentObject</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set A to the high byte of the altitude of the player</span>
 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ object (i.e. the high byte of the player object's</span>
                        <span class="comment">\ y-coordinate in yObjectHi)</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Increment A so it's one coordinate higher than the</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ player object, so the call to PlaceObjectBelow will</span>
                        <span class="comment">\ try to hyperspace the player to the same height as</span>
                        <span class="comment">\ before</span>

 <span class="mne">LDX</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set X to the object number of the new robot that we</span>
                        <span class="comment">\ spawned above</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectBelow</a>   <span class="comment">\ Attempt to place the new robot on a tile that is below</span>
                        <span class="comment">\ the maximum altitude specified in A (though we may end</span>
                        <span class="comment">\ up placing the object higher than this)</span>

 <span class="mne">BCS</span> <a class="popup destination">hypr4</a>              <span class="comment">\ If the call to PlaceObjectBelow sets the C flag then</span>
                        <span class="comment">\ the object has not been successfully placed, so jump</span>
                        <span class="comment">\ to hypr4 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set to indicate that we haven't managed to hyperspace</span>
                        <span class="comment">\ the player</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Call UpdatePlayerEnergy with the C flag set to</span>
 <span class="mne">JSR</span> <a class="popup destination">UpdatePlayerEnergy</a> <span class="comment">\ subtract the amount of energy in object #X from the</span>
                        <span class="comment">\ player's energy</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object #X is the robot we just spawned, so this will</span>
                        <span class="comment">\ subtract three energy units from the player</span>

 <span class="mne">BCC</span> <a class="popup destination">hypr1</a>              <span class="comment">\ If the player still has positive energy then the call</span>
                        <span class="comment">\ to UpdatePlayerEnergy will clear the C flag, so jump</span>
                        <span class="comment">\ to hypr1 to keep going</span>

                        <span class="comment">\ If we get here then the player doesn't have enough</span>
                        <span class="comment">\ energy to create a robot for hyperspacing</span>

 <span class="mne">JSR</span> <a class="popup destination">DeleteObject</a>       <span class="comment">\ Delete object #X and remove it from the landscape, so</span>
                        <span class="comment">\ we remove the robot that we just spawned</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set screenBackground = 3 so the next time the screen</span>
 <span class="mne">STA</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ is cleared, it shows a black background with stars</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of hyperspaceEndsGame to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ game has ended with a hyperspace, and clear bit 6 to</span>
                        <span class="comment">\ indicate that the game has ended because the player</span>
                        <span class="comment">\ has run out of energy</span>

 <span class="mne">BNE</span> <a class="popup destination">hypr3</a>              <span class="comment">\ Jump to hypr3 to return from the subroutine (this BNE</span>
                        <span class="comment">\ is effectively a JMP as A is never zero)</span>

<span class="label">.hypr1</span><a id="hypr1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call the PlayMusic routine with A = 0 to play the</span>
 <span class="mne">JSR</span> <a class="popup destination">PlayMusic</a>          <span class="comment">\ hyperspace music</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ If the player is not on the Sentinel's tile in terms</span>
 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ of the x-coordinate, jump to hypr2</span>
 <span class="mne">CMP</span> <a class="popup variable">xTileSentinel</a>
 <span class="mne">BNE</span> <a class="popup destination">hypr2</a>

 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\ If the player is not on the Sentinel's tile in terms</span>
 <span class="mne">CMP</span> <a class="popup variable">zTileSentinel</a>      <span class="comment">\ of the z-coordinate, jump to hypr2</span>
 <span class="mne">BNE</span> <a class="popup destination">hypr2</a>

                        <span class="comment">\ The player is on the Sentinel's tile in both axes, so</span>
                        <span class="comment">\ they must have hyperspaced while standing on top of</span>
                        <span class="comment">\ the Sentinel's tower, so they have just completed this</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set bit 7 of hyperspaceEndsGame to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ game has ended with a hyperspace, and set bit 6 to</span>
                        <span class="comment">\ indicate that the game has ended because the player</span>
                        <span class="comment">\ has won by hyperspacing from the Sentinel's tower</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of doNotPlayLandscape so that when we finish</span>
 <span class="mne">STA</span> <a class="popup variable">doNotPlayLandscape</a> <span class="comment">\ the landscape, the landscape generation process will</span>
                        <span class="comment">\ return normally, without previewing the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As the last step in winning a game is to hyperspace</span>
                        <span class="comment">\ onto the Sentinel's tower, this ensures that winning a</span>
                        <span class="comment">\ level will then display that landscape's secret code</span>
                        <span class="comment">\ rather than displaying the preview and making us play</span>
                        <span class="comment">\ it again</span>

<span class="label">.hypr2</span><a id="hypr2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">FocusOnKeyAction</a>   <span class="comment">\ Tell the game to start focusing effort on the key</span>
                        <span class="comment">\ action that has been initiated (i.e. the hyperspace)</span>

 <span class="mne">LDX</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set the player's object number to that of the new</span>
 <span class="mne">STX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ robot that we spawned above, so this effectively</span>
                        <span class="comment">\ performs the hyperspace into the new robot</span>

<span class="label">.hypr3</span><a id="hypr3" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of playerHasMovedTile to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">playerHasMovedTile</a> <span class="comment">\ player has moved to a new tile</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have successfully</span>
                        <span class="comment">\ hyperspaced the player</span>

<span class="label">.hypr4</span><a id="hypr4" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawobjectstack" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawObjectStack</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing objects</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw an entire stack of objects</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawobjectstack.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#drawobjectstack">DrawObjectStack</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The tile data for the tile containing the stack</span>

</div></div>
<span class="label">.DrawObjectStack</span><a id="drawobjectstack" class="anchor"></a>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>         <span class="comment">\ Because the tile has an object on it, the tile data</span>
 <span class="mne">STA</span> <a class="popup variable">topObjectOnStack</a>   <span class="comment">\ contains the number of the top object on the tile in</span>
                        <span class="comment">\ bits 0 to 5, so extract the object number into</span>
                        <span class="comment">\ topObjectOnStack</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now count the number of objects that are stacked on</span>
                        <span class="comment">\ the tile, so initialise a counter in X</span>

<span class="label">.stak1</span><a id="stak1" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the object counter in X to record that we</span>
                        <span class="comment">\ have found an object in the stack</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>         <span class="comment">\ Because the tile has an object on it, the tile data</span>
 <span class="mne">TAY</span>                    <span class="comment">\ contains the number of the top object on the tile in</span>
                        <span class="comment">\ bits 0 to 5, so extract the object number into Y (so</span>
                        <span class="comment">\ object #Y is on the tile, though it might be part of</span>
                        <span class="comment">\ an object stack)</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the object flags for the object on the tile</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%01000000</span>         <span class="comment">\ If bit 6 of the object flags for object #Y is set</span>
 <span class="mne">BCS</span> <a class="popup destination">stak1</a>              <span class="comment">\ then object #Y is stacked on top of another object,</span>
                        <span class="comment">\ and that object number is in bits 0 to 5 of the object</span>
                        <span class="comment">\ flags, so jump to stak1 to increase the object count,</span>
                        <span class="comment">\ extract that object number from A and check the flags</span>
                        <span class="comment">\ again (so this works down through the stack of objects</span>
                        <span class="comment">\ until we reach the object at the bottom of the stack)</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Set objectStackCounter = X - 1 so we can use it as a</span>
 <span class="mne">STX</span> <a class="popup variable">objectStackCounter</a> <span class="comment">\ counter as we work through all the objects in the</span>
                        <span class="comment">\ stack</span>

 <span class="mne">BEQ</span> <a class="popup destination">stak7</a>              <span class="comment">\ If there is only one object on the tile then the stack</span>
                        <span class="comment">\ size will be zero, so jump to stak7 to draw the object</span>
                        <span class="comment">\ stack from object #Y down (which in this case will</span>
                        <span class="comment">\ just draw object #Y)</span>

                        <span class="comment">\ If we get here then there is more than one object in</span>
                        <span class="comment">\ the stack, so we now work out in which direction to</span>
                        <span class="comment">\ draw the stack: top to bottom or bottom to top</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the player is at a lower altitude than the object</span>
                        <span class="comment">\ at the bottom of the stack, then the whole stack is</span>
                        <span class="comment">\ above the player and the object on the top of the</span>
                        <span class="comment">\ stack is the furthest away, so we need to draw the</span>
                        <span class="comment">\ stack from top to bottom</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If it's the other way around and the player is at the</span>
                        <span class="comment">\ same or higher altitude than the bottom of the stack,</span>
                        <span class="comment">\ then we need to draw the stack from bottom to top, as</span>
                        <span class="comment">\ the bottom object is the furthest away</span>
                        <span class="comment">\</span>
                        <span class="comment">\ There is one exception: if the object stack is the</span>
                        <span class="comment">\ Sentinel's tower and we are at the exact same height</span>
                        <span class="comment">\ as the tower, then we draw the stack from top to</span>
                        <span class="comment">\ bottom to ensure the Sentinel's feet are correctly</span>
                        <span class="comment">\ hidden by the platform</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At this point, object #Y is the bottom object in the</span>
                        <span class="comment">\ stack and object #topObjectOnStack is the top object</span>

<span class="label">.stak2</span><a id="stak2" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set X to the object number of the player</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\ Set (A T) to the vertical distance between the player</span>
 <span class="mne">SEC</span>                    <span class="comment">\ and the object we are drawing, as follows:</span>
 <span class="mne">SBC</span> <a class="popup variable">yObjectLo</a>,<span class="register">Y</span>        <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\   (A T) = yObject,X - yObject,Y</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ And then the high bytes</span>
 <span class="mne">SBC</span> <a class="popup variable">yObjectHi</a>,<span class="register">Y</span>

 <span class="mne">BMI</span> <a class="popup destination">stak6</a>              <span class="comment">\ If the result is negative then the player (object #X)</span>
                        <span class="comment">\ is at a lower altitude than the object we are drawing</span>
                        <span class="comment">\ (object #Y), so jump to stak6 to draw the entire</span>
                        <span class="comment">\ object stack from top to bottom, starting with the top</span>
                        <span class="comment">\ object and working down to the bottom</span>

                        <span class="comment">\ If we get here then the player is level with or higher</span>
                        <span class="comment">\ than the object we are drawing (object #Y)</span>

 <span class="mne">ORA</span> <a class="popup variable">T</a>                  <span class="comment">\ If at least one of A and T is non-zero then (A T) > 0,</span>
 <span class="mne">BNE</span> <a class="popup destination">stak3</a>              <span class="comment">\ then the player is at a higher altitude than the</span>
                        <span class="comment">\ object we are drawing, so jump to stak3 to skip the</span>
                        <span class="comment">\ following check</span>

                        <span class="comment">\ If we get here then the player is level with the</span>
                        <span class="comment">\ object we are drawing, so we need to check whether</span>
                        <span class="comment">\ we are thinking of drawing the Sentinel's tower,</span>
                        <span class="comment">\ because if we are, we need to draw the Sentinel before</span>
                        <span class="comment">\ the tower to ensure the Sentinel's feet are correctly</span>
                        <span class="comment">\ hidden by the platform</span>

 <span class="mne">LDA</span> <a class="popup variable">objectTypes</a>,<span class="register">Y</span>      <span class="comment">\ If the object we are drawing is the Sentinel's tower</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ (an object of type 6), then jump to stak6 to draw the</span>
 <span class="mne">BEQ</span> <a class="popup destination">stak6</a>              <span class="comment">\ entire object stack from top to bottom, starting with</span>
                        <span class="comment">\ the top object (the Sentinel) and working down to the</span>
                        <span class="comment">\ bottom object (the tower)</span>

<span class="label">.stak3</span><a id="stak3" class="anchor"></a>

                        <span class="comment">\ If we get here then the player is higher than the</span>
                        <span class="comment">\ object we are drawing (object #Y), so we need to draw</span>
                        <span class="comment">\ the object stack upwards, from the bottom to the top</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This process is a bit convoluted, as the object flags</span>
                        <span class="comment">\ only store object numbers that are below other objects</span>
                        <span class="comment">\ rather than above, so we have to repeatedly count down</span>
                        <span class="comment">\ the stack to work out which object to draw next</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The first time we enter this loop, object #Y is the</span>
                        <span class="comment">\ object at the bottom of the stack, so this loop draws</span>
                        <span class="comment">\ the stack from the very bottom to the top</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The second time we enter this loop, object #Y is the</span>
                        <span class="comment">\ object above the original object #Y, so it's the next</span>
                        <span class="comment">\ object up</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We loop around until we have drawn the whole stack</span>
                        <span class="comment">\ from bottom to top</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This loop therefore draws object #Y and then works out</span>
                        <span class="comment">\ which object is above object #Y in the stack and loops</span>
                        <span class="comment">\ back to repeat the process, until we reach the top of</span>
                        <span class="comment">\ the stack</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawObject</a>         <span class="comment">\ Draw object #Y onto the screen or into the screen</span>
                        <span class="comment">\ buffer</span>

                        <span class="comment">\ We now work out which object is above object #Y, which</span>
                        <span class="comment">\ we do by counting down the stack by the right amount,</span>
                        <span class="comment">\ from the top object down</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This count is stored in objectStackCounter, which</span>
                        <span class="comment">\ contains the number of objects we still have to draw,</span>
                        <span class="comment">\ which is the same as the number of objects above</span>
                        <span class="comment">\ object #Y</span>

 <span class="mne">LDY</span> <a class="popup variable">topObjectOnStack</a>   <span class="comment">\ Set Y to the number of the object on top of the stack,</span>
                        <span class="comment">\ so we can start counting down from the top</span>

 <span class="mne">DEC</span> <a class="popup variable">objectStackCounter</a> <span class="comment">\ Decrement the object stack counter as we have just</span>
                        <span class="comment">\ drawn object #Y</span>

 <span class="mne">BMI</span> <a class="popup destination">stak8</a>              <span class="comment">\ If we have drawn all the objects in the stack then the</span>
                        <span class="comment">\ counter will now be negative, so jump to stak8 to</span>
                        <span class="comment">\ return from the subroutine as we have drawn the whole</span>
                        <span class="comment">\ stack</span>

 <span class="mne">LDX</span> <a class="popup variable">objectStackCounter</a> <span class="comment">\ Otherwise set X to the updated object stack counter,</span>
                        <span class="comment">\ which is the number of objects above the object that</span>
                        <span class="comment">\ we just drew</span>

 <span class="mne">BPL</span> <a class="popup destination">stak5</a>              <span class="comment">\ Jump to stak5 to start counting down the stack for X</span>
                        <span class="comment">\ objects from the top, to give us the object that's</span>
                        <span class="comment">\ above object #Y in the stack (this BPL is effectively</span>
                        <span class="comment">\ a JMP as we know objectStackCounter is positive, so X</span>
                        <span class="comment">\ must also be positive)</span>

<span class="label">.stak4</span><a id="stak4" class="anchor"></a>

                        <span class="comment">\ If we get here then we need to move down the object</span>
                        <span class="comment">\ stack by one place from object #Y, updating Y to the</span>
                        <span class="comment">\ number of the next object down</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the object flags for object #Y</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>         <span class="comment">\ Object #Y is stacked on top of another object, so the</span>
 <span class="mne">TAY</span>                    <span class="comment">\ number of the object below is in bits 0 to 5 of the</span>
                        <span class="comment">\ object flags, so extract the next object number down</span>
                        <span class="comment">\ the stack into Y</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the counter in X as we have just moved down</span>
                        <span class="comment">\ the stack by one place</span>

<span class="label">.stak5</span><a id="stak5" class="anchor"></a>

                        <span class="comment">\ This is the entry point for the loop that counts X</span>
                        <span class="comment">\ objects down the stack, from the top object down</span>

 <span class="mne">BNE</span> <a class="popup destination">stak4</a>              <span class="comment">\ If X &lt;> 0 then loop back to stak4 to move down the</span>
                        <span class="comment">\ stack</span>

 <span class="mne">BEQ</span> <a class="popup destination">stak2</a>              <span class="comment">\ Otherwise jump to stak2 to draw object #Y, as that is</span>
                        <span class="comment">\ the next object down the stack from the object we just</span>
                        <span class="comment">\ drew (this BEQ is effectively a JMP as we just passed</span>
                        <span class="comment">\ through a BNE)</span>

<span class="label">.stak6</span><a id="stak6" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">topObjectOnStack</a>   <span class="comment">\ Set Y = topObjectOnStack so the following loop draws</span>
                        <span class="comment">\ the entire object stack from top to bottom, starting</span>
                        <span class="comment">\ with the top object and working down to the bottom</span>

<span class="label">.stak7</span><a id="stak7" class="anchor"></a>

                        <span class="comment">\ This loop draws all the objects in the stack in turn,</span>
                        <span class="comment">\ from object #Y at the top, all the way down to the</span>
                        <span class="comment">\ object at the bottom of the stack</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawObject</a>         <span class="comment">\ Draw object #Y onto the screen or into the screen</span>
                        <span class="comment">\ buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">objectFlags</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the object flags for the object we just drew</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00111111</span>         <span class="comment">\ If object #Y is stacked on top of another object, then</span>
 <span class="mne">TAY</span>                    <span class="comment">\ the number of the object below is in bits 0 to 5 of</span>
                        <span class="comment">\ the object flags, so extract the next object number</span>
                        <span class="comment">\ down the stack into Y, so we can draw that object next</span>

 <span class="mne">DEC</span> <a class="popup variable">objectStackCounter</a> <span class="comment">\ Decrement the object stack counter as we have just</span>
                        <span class="comment">\ drawn an object</span>

 <span class="mne">BPL</span> <a class="popup destination">stak7</a>              <span class="comment">\ Loop back until we have drawn all the objects in the</span>
                        <span class="comment">\ stack, from object #Y down to the bottom of the stack</span>

<span class="label">.stak8</span><a id="stak8" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-fillscreen" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">FillScreen</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Fill a rectangular in screen memory or the screen buffer with the</span>
             <span class="headerEntry">specified background</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/fillscreen.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/clearscreen.html">ClearScreen</a> calls <a href="#fillscreen">FillScreen</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#fillscreen">FillScreen</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> calls <a href="#fillscreen">FillScreen</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">Determines whether we fill screen memory or the screen</span>
                        <span class="argumentEntry">buffer:</span>

                        <span class="argumentEntry">  * 0 = fill the screen</span>

                        <span class="argumentEntry">  * 25 = fill the screen buffer</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of character columns to fill</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The number of character rows to fill</span>

   <span class="argumentLabel">screenBackground</span>     <span class="argumentEntry">The type of background to fill the rectangle with:</span>

                        <span class="argumentEntry">  * 0 = fill with alternating colour 0/1 (blue/black)</span>
                        <span class="argumentEntry">        pixel rows, for the sky during gameplay</span>

                        <span class="argumentEntry">  * 1 = fill with solid colour 0 (blue)</span>

                        <span class="argumentEntry">  * 2 = fill with dithered pixels in colour 0 (blue)</span>
                        <span class="argumentEntry">        and colour 3 (e.g. green in landscape 0000)</span>
                        <span class="argumentEntry">        by alternating colour 3/0/3/0 and 0/3/0/3</span>
                        <span class="argumentEntry">        pixel bytes</span>

                        <span class="argumentEntry">  * 3 = fill with solid colour 1 (black)</span>

</div></div>
<span class="label">.FillScreen</span><a id="fillscreen" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">fillRowNumber</a>      <span class="comment">\ Set fillRowNumber = A, so we start filling from this</span>
                        <span class="comment">\ character row number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ When we are filling the screen buffer, this value is</span>
                        <span class="comment">\ 25 + the row number, so we can use this value as a</span>
                        <span class="comment">\ lookup into the screenRowAddrLo and screenRowAddrHi</span>
                        <span class="comment">\ tables, and it will return the corresponding address</span>
                        <span class="comment">\ from the bufferRowAddrLo or bufferRowAddrHi table, to</span>
                        <span class="comment">\ give us the row address in the screen buffer</span>

 <span class="mne">STY</span> <a class="popup variable">screenRowCounter</a>   <span class="comment">\ Set screenRowCounter = Y, so we will fill this many</span>
                        <span class="comment">\ character rows</span>

 <span class="mne">TXA</span>                    <span class="comment">\ If X &lt; 32 then each character row in the fill will fit</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ into 256 bytes (as each character block is eight bytes</span>
 <span class="mne">BCC</span> <a class="popup destination">fill1</a>              <span class="comment">\ and 32 * 8 = 256), so jump to fill1 to set bit 7 of</span>
                        <span class="comment">\ moreColumnsToFill to record this fact</span>

                        <span class="comment">\ If we get here then each character row in the fill</span>
                        <span class="comment">\ needs more than 256 bytes, so we set A to the number</span>
                        <span class="comment">\ of columns that we need to fill beyond the 256-byte</span>
                        <span class="comment">\ limit, which we get by subtracting 32 from the total</span>
                        <span class="comment">\ number of columns we need to fill</span>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set A = X - 32 to store in moreColumnsToFill below</span>
                        <span class="comment">\ (this subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC instruction, so we know the C flag is set)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set X = 32 to set as the value of columnCounter below,</span>
                        <span class="comment">\ so we fill 32 columns in the first iteration around</span>
                        <span class="comment">\ the fill loop, and then fill moreColumnsToFill columns</span>
                        <span class="comment">\ in the second iteration</span>

 <span class="mne">BNE</span> <a class="popup destination">fill2</a>              <span class="comment">\ Jump to fill2 to skip the following instruction (this</span>
                        <span class="comment">\ BNE is effectively a JMP as X is never zero)</span>

<span class="label">.fill1</span><a id="fill1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of moreColumnsToFill in the next instruction</span>
                        <span class="comment">\ to indicate that this fill does not require more than</span>
                        <span class="comment">\ 32 columns</span>

<span class="label">.fill2</span><a id="fill2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">moreColumnsToFill</a>  <span class="comment">\ Set moreColumnsToFill to the value of A that we set</span>
                        <span class="comment">\ above</span>

 <span class="mne">STX</span> <a class="popup variable">columnCounter</a>      <span class="comment">\ Set columnCounter to the updated value of X, so this</span>
                        <span class="comment">\ contains the number of columns to fill in the first</span>
                        <span class="comment">\ iteration around the fill loop (i.e. the total number</span>
                        <span class="comment">\ of columns if it's less than 32, or 32 if we need to</span>
                        <span class="comment">\ do the fill in two stages)</span>

 <span class="mne">LDX</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ Set T to the backgroundEven pixel byte for the screen</span>
 <span class="mne">LDA</span> <a class="popup variable">backgroundEven</a>,<span class="register">X</span>   <span class="comment">\ background type in screenBackground, to give us the</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ pixel byte we should be clearing the screen to for</span>
                        <span class="comment">\ even pixel rows</span>

 <span class="mne">LDA</span> <a class="popup variable">backgroundOdd</a>,<span class="register">X</span>    <span class="comment">\ Set U to the backgroundOdd pixel byte for the screen</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ background type in screenBackground, to give us the</span>
                        <span class="comment">\ pixel byte we should be clearing the screen to for odd</span>
                        <span class="comment">\ pixel rows</span>

<span class="label">.fill3</span><a id="fill3" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">fillRowNumber</a>      <span class="comment">\ Set (Q P) to the entry from the screenRowAddrLo and</span>
 <span class="mne">LDA</span> <a class="popup variable">screenRowAddrLo</a>,<span class="register">X</span>  <span class="comment">\ screenRowAddrHi tables for the character row whose</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\ number is in fillRowNumber</span>
 <span class="mne">LDA</span> <a class="popup variable">screenRowAddrHi</a>,<span class="register">X</span>  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>                  <span class="comment">\ When we are filling the screen buffer, fillRowNumber</span>
                        <span class="comment">\ is 25 + the row number, so we can use this value as a</span>
                        <span class="comment">\ lookup into the screenRowAddrLo and screenRowAddrHi</span>
                        <span class="comment">\ tables, and it will return the corresponding address</span>
                        <span class="comment">\ from the bufferRowAddrLo or bufferRowAddrHi table, to</span>
                        <span class="comment">\ give us the row address in the screen buffer</span>

 <span class="mne">LDX</span> <a class="popup variable">columnCounter</a>      <span class="comment">\ Set X to the number of columns that we need to fill</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set loopCounter = 1 so we only do a maximum of two</span>
 <span class="mne">STA</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ fill stages, to prevent an incorrectly configured fill</span>
                        <span class="comment">\ from filling up more than 64 columns</span>

                        <span class="comment">\ We now fill X character blocks from screen address</span>
                        <span class="comment">\ (Q P) onwards, alternating each pixel row between the</span>
                        <span class="comment">\ pixel bytes in T and U</span>

<span class="label">.fill4</span><a id="fill4" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Set Y = &FF so we increment Y to zero at the start of</span>
                        <span class="comment">\ the following loop, so we can use it as an index into</span>
                        <span class="comment">\ the block of screen memory starting at (P Q)</span>

<span class="label">.fill5</span><a id="fill5" class="anchor"></a>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the first byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set the first byte in the character block to T</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the second byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set the second byte in the character block to U</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the third byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set the third byte in the character block to T</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the fourth byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set the fourth byte in the character block to U</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the fifth byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set the fifth byte in the character block to T</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the sixth byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set the sixth byte in the character block to U</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the seventh byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set the seventh byte in the character block to T</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the index in Y to point to the eighth byte</span>
                        <span class="comment">\ in the character block</span>

 <span class="mne">LDA</span> <a class="popup variable">U</a>                  <span class="comment">\ Set the eighth byte in the character block to U</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the column counter in X</span>

 <span class="mne">BNE</span> <a class="popup destination">fill5</a>              <span class="comment">\ Loop back until we have filled X character blocks</span>

 <span class="mne">DEC</span> <a class="popup variable">loopCounter</a>        <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BMI</span> <a class="popup destination">fill6</a>              <span class="comment">\ If we have already run two fill loops, jump to fill6</span>
                        <span class="comment">\ to move on to the next row, so we never do more than</span>
                        <span class="comment">\ two fill stages</span>

 <span class="mne">LDX</span> <a class="popup variable">moreColumnsToFill</a>  <span class="comment">\ Set X to the value of moreColumnsToFill, which either</span>
                        <span class="comment">\ has bit 7 set, or contains the number of columns we</span>
                        <span class="comment">\ still need to fill on top of the 32 we just filled</span>

 <span class="mne">BMI</span> <a class="popup destination">fill6</a>              <span class="comment">\ If bit 7 of moreColumnsToFill is set then each row in</span>
                        <span class="comment">\ the fill fits into 256 bytes, so we will have already</span>
                        <span class="comment">\ filled in the required bytes and can jump to fill6 to</span>
                        <span class="comment">\ move on to the next row</span>

 <span class="mne">INC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Increment the high byte of (Q P) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">JMP</span> <a class="popup destination">fill4</a>              <span class="comment">\ Loop back to fill4 to continue filling along the</span>
                        <span class="comment">\ character row, filling the number of columns in X to</span>
                        <span class="comment">\ take us to the correct total number for the row</span>

<span class="label">.fill6</span><a id="fill6" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">fillRowNumber</a>      <span class="comment">\ Increment the row number to move down to the next</span>
                        <span class="comment">\ character row</span>

 <span class="mne">DEC</span> <a class="popup variable">screenRowCounter</a>   <span class="comment">\ Decrement the row counter</span>

 <span class="mne">BNE</span> <a class="popup destination">fill3</a>              <span class="comment">\ Loop back to fill the next character row until we have</span>
                        <span class="comment">\ filled the number of rows in screenRowCounter</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-backgroundeven" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">backgroundEven</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pixel bytes for even pixel rows in the screen background</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/backgroundeven.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/fillscreen.html">FillScreen</a> uses <a href="#backgroundeven">backgroundEven</a></span>
</div>
</div></div>
<span class="label">.backgroundEven</span><a id="backgroundeven" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%00000000</span>         <span class="comment">\ Background 0 = colour 0 (even)</span>
                        <span class="comment">\                colour 1 (odd)</span>

 <span class="mne">EQUB</span> <span class="binary">%00000000</span>         <span class="comment">\ Background 1 = colour 0 (even)</span>
                        <span class="comment">\                colour 0 (odd)</span>

 <span class="mne">EQUB</span> <span class="binary">%10101010</span>         <span class="comment">\ Background 2 = colour 3/0/3/0 (even)</span>
                        <span class="comment">\                colour 0/3/0/3 (odd)</span>

 <span class="mne">EQUB</span> <span class="binary">%00001111</span>         <span class="comment">\ Background 3 = colour 1 (even)</span>
                        <span class="comment">\                colour 1 (odd)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-backgroundodd" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">backgroundOdd</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pixel bytes for odd pixel rows in the screen background</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/backgroundodd.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/fillscreen.html">FillScreen</a> uses <a href="#backgroundodd">backgroundOdd</a></span>
</div>
</div></div>
<span class="label">.backgroundOdd</span><a id="backgroundodd" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%00001111</span>         <span class="comment">\ Background 0 = colour 0 (even)</span>
                        <span class="comment">\                colour 1 (odd)</span>

 <span class="mne">EQUB</span> <span class="binary">%00000000</span>         <span class="comment">\ Background 1 = colour 0 (even)</span>
                        <span class="comment">\                colour 0 (odd)</span>

 <span class="mne">EQUB</span> <span class="binary">%01010101</span>         <span class="comment">\ Background 2 = colour 3/0/3/0 (even)</span>
                        <span class="comment">\                colour 0/3/0/3 (odd)</span>

 <span class="mne">EQUB</span> <span class="binary">%00001111</span>         <span class="comment">\ Background 3 = colour 1 (even)</span>
                        <span class="comment">\                colour 1 (odd)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-pixelbitmask" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">pixelBitMask</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table for converting a pixel number in the range 0 to 3 into a</span>
             <span class="headerEntry">screen mode 5 bit mask with that pixel's bits set and others clear</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/pixelbitmask.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> uses <a href="#pixelbitmask">pixelBitMask</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawrandomdots.html">DrawRandomDots</a> uses <a href="#pixelbitmask">pixelBitMask</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawsights.html">DrawSights</a> uses <a href="#pixelbitmask">pixelBitMask</a></span>
</div>
</div></div>
<span class="label">.pixelBitMask</span><a id="pixelbitmask" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%10001000</span>         <span class="comment">\ Pixel bit mask with pixel 0 set</span>

 <span class="mne">EQUB</span> <span class="binary">%01000100</span>         <span class="comment">\ Pixel bit mask with pixel 1 set</span>

 <span class="mne">EQUB</span> <span class="binary">%00100010</span>         <span class="comment">\ Pixel bit mask with pixel 2 set</span>

 <span class="mne">EQUB</span> <span class="binary">%00010001</span>         <span class="comment">\ Pixel bit mask with pixel 3 set</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-colourpixels" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">colourPixels</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table that maps logical colours 0 to 3 to a four-pixel byte in</span>
             <span class="headerEntry">that colour</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/colourpixels.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_1_of_4.html">DrawPolygonLines (Part 1 of 4)</a> uses <a href="#colourpixels">colourPixels</a></span>
</div>
</div></div>
<span class="label">.colourPixels</span><a id="colourpixels" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%00000000</span>         <span class="comment">\ Four pixels of colour 0</span>
 <span class="mne">EQUB</span> <span class="binary">%00001111</span>         <span class="comment">\ Four pixels of colour 1</span>
 <span class="mne">EQUB</span> <span class="binary">%11110000</span>         <span class="comment">\ Four pixels of colour 2</span>
 <span class="mne">EQUB</span> <span class="binary">%11111111</span>         <span class="comment">\ Four pixels of colour 3</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-pixelstoleft" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">pixelsToLeft</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pixel byte with all the pixels to the left of position X set</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/pixelstoleft.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a> uses <a href="#pixelstoleft">pixelsToLeft</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_3_of_4.html">DrawPolygonLines (Part 3 of 4)</a> uses <a href="#pixelstoleft">pixelsToLeft</a></span>
</div>
</div></div>
<span class="label">.pixelsToLeft</span><a id="pixelstoleft" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%00000000</span>
 <span class="mne">EQUB</span> <span class="binary">%10001000</span>
 <span class="mne">EQUB</span> <span class="binary">%11001100</span>
 <span class="mne">EQUB</span> <span class="binary">%11101110</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-pixelstoright" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">pixelsToRight</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pixel byte with all the pixels to the right of position X set</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/pixelstoright.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a> uses <a href="#pixelstoright">pixelsToRight</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_3_of_4.html">DrawPolygonLines (Part 3 of 4)</a> uses <a href="#pixelstoright">pixelsToRight</a></span>
</div>
</div></div>
<span class="label">.pixelsToRight</span><a id="pixelstoright" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%01110111</span>
 <span class="mne">EQUB</span> <span class="binary">%00110011</span>
 <span class="mne">EQUB</span> <span class="binary">%00010001</span>
 <span class="mne">EQUB</span> <span class="binary">%00000000</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-leftpixels" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">leftPixels</span>                                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pixel byte with all the pixels to the right of position X + 1 set,</span>
             <span class="headerEntry">to give the complementary pixel byte to pixelsToRight</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/leftpixels.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a> uses <a href="#leftpixels">leftPixels</a></span>
</div>
</div></div>
<span class="label">.leftPixels</span><a id="leftpixels" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%10001000</span>
 <span class="mne">EQUB</span> <span class="binary">%11001100</span>
 <span class="mne">EQUB</span> <span class="binary">%11101110</span>
 <span class="mne">EQUB</span> <span class="binary">%11111111</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-buffersoffsetlo" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">buffersOffsetLo</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">An offset to add to the address of the right column screen buffer</span>
             <span class="headerEntry">(low byte)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/buffersoffsetlo.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_1_of_4.html">DrawPolygonLines (Part 1 of 4)</a> uses <a href="#buffersoffsetlo">buffersOffsetLo</a></span>
</div>
</div></div>
<span class="label">.buffersOffsetLo</span><a id="buffersoffsetlo" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">96</span><span class="bracket">)</span>
 <span class="mne">EQUB</span> <span class="operator">LO</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-buffersoffsethi" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">buffersOffsetHi</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">An offset to add to the address of the right column screen buffer</span>
             <span class="headerEntry">(low byte)</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/buffersoffsethi.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygonlines_part_1_of_4.html">DrawPolygonLines (Part 1 of 4)</a> uses <a href="#buffersoffsethi">buffersOffsetHi</a></span>
</div>
</div></div>
<span class="label">.buffersOffsetHi</span><a id="buffersoffsethi" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">96</span><span class="bracket">)</span>
 <span class="mne">EQUB</span> <span class="operator">HI</span><span class="bracket">(</span><span class="decimal">0</span><span class="bracket">)</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawpolygonlines-part-1-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawPolygonLines (Part 1 of 4)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw an analysed polygon into the screen buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawpolygonlines_part_1_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygon.html">DrawPolygon</a> calls <a href="#drawpolygonlines">DrawPolygonLines</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">yPolygonTop</span>          <span class="argumentEntry">The pixel line number of the top of the polygon (the</span>
                        <span class="argumentEntry">highest y-coordinate in the polygon)</span>

   <span class="argumentLabel">yPolygonBottom</span>       <span class="argumentEntry">The pixel line number of the bottom of the polygon (the</span>
                        <span class="argumentEntry">lowest y-coordinate in the polygon)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">polygonGoesRight</span>     <span class="argumentEntry">A flag to record whether the polygon fitted into the</span>
                        <span class="argumentEntry">screen buffer:</span>

                        <span class="argumentEntry">  * Not 1 = at least one line in the polygon we just</span>
                        <span class="argumentEntry">            drew extends past the right edge of the</span>
                        <span class="argumentEntry">            buffer</span>

                        <span class="argumentEntry">  * 1 = the default value</span>

   <span class="argumentLabel">polygonGoesLeft</span>      <span class="argumentEntry">A flag to record whether the polygon fitted into the</span>
                        <span class="argumentEntry">screen buffer:</span>

                        <span class="argumentEntry">  * Not 1 = at least one line in the polygon we just</span>
                        <span class="argumentEntry">            drew extends past the left edge of the</span>
                        <span class="argumentEntry">            buffer</span>

                        <span class="argumentEntry">  * 1 = the default value</span>

</div></div>
<span class="label">.DrawPolygonLines</span><a id="drawpolygonlines" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Set polygonGoesRight = 1 as the default value, which</span>
 <span class="mne">STA</span> <a class="popup variable">polygonGoesRight</a>   <span class="comment">\ we can change to a different value if the polygon</span>
                        <span class="comment">\ extends to the right of the screen buffer</span>

 <span class="mne">STA</span> <a class="popup variable">polygonGoesLeft</a>    <span class="comment">\ Set polygonGoesLeft = 1 as the default value, which</span>
                        <span class="comment">\ we can change to a different value if the polygon</span>
                        <span class="comment">\ extends to the left of the screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ Set X = (yPolygonTop + yPolygonBottom) / 2</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ So X is the pixel line number of the middle pixel line</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ in the polygon</span>
 <span class="mne">TAX</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonRight</a>,<span class="register">X</span>    <span class="comment">\ If the pixel x-coordinate of the right edge is less</span>
 <span class="mne">CMP</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">X</span>     <span class="comment">\ than the pixel x-coordinate of the left edge for the</span>
 <span class="mne">BCC</span> <a class="popup destination">dpol2</a>              <span class="comment">\ middle line, then the polygon must be facing away from</span>
                        <span class="comment">\ us, so jump to dpol2 to return from the subroutine</span>
                        <span class="comment">\ without drawing the polygon</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">240</span>               <span class="comment">\ Set T = 240 - yPolygonTop - 1</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ So T contains the screen y-coordinate of polygon pixel</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ line number yPolygonTop (as the screen y-coordinates</span>
                        <span class="comment">\ increase as you go down the screen, unlike the polygon</span>
                        <span class="comment">\ pixel line numbers which follow the same direction as</span>
                        <span class="comment">\ the normal 3D world y-axis, which increases as you go</span>
                        <span class="comment">\ up the screen)</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set A = T / 8</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ So A is the number of the character row that contains</span>
                        <span class="comment">\ the screen y-coordinate in T</span>

 <span class="mne">CLC</span>                    <span class="comment">\ If we are configured to draw into the screen buffer</span>
 <span class="mne">ADC</span> <a class="popup variable">screenOrBuffer</a>     <span class="comment">\ then screenOrBuffer will be 25, so this makes us fetch</span>
                        <span class="comment">\ row addresses from bufferRowAddrLo and bufferRowAddrHi</span>
                        <span class="comment">\ (as bufferRowAddrLo - screenRowAddrLo is 25)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Otherwise we are configured to draw directly onto the</span>
                        <span class="comment">\ screen and screenOrBuffer is zero, in which case this</span>
                        <span class="comment">\ addition doesn't change anything</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the offset within the screenRowAddr(Hi Lo)</span>
                        <span class="comment">\ table of the character row containing y-coordinate</span>
                        <span class="comment">\ yPolygonTop, for either the screen or screen buffer</span>
                        <span class="comment">\ (as configured in screenOrBuffer)</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set A = T mod 8</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000111</span>         <span class="comment">\</span>
                        <span class="comment">\ So T contains the offset within the character block at</span>
                        <span class="comment">\ the start of the character row that contains screen</span>
                        <span class="comment">\ y-coordinate T</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set (S R) = A + screenRowAddr(Hi Lo) for row X</span>
 <span class="mne">ADC</span> <a class="popup variable">screenRowAddrLo</a>,<span class="register">X</span>  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\ So (S R) contains the screen address of the start of</span>
 <span class="mne">LDA</span> <a class="popup variable">screenRowAddrHi</a>,<span class="register">X</span>  <span class="comment">\ the pixel row containing the pixel line number in</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\ yPolygonTop</span>

 <span class="mne">LDY</span> <a class="popup variable">screenBufferType</a>   <span class="comment">\ If this is the right row screen buffer then Y = 1, so</span>
 <span class="mne">LDA</span> <a class="popup variable">R</a>                  <span class="comment">\ add the following to (S R):</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">buffersOffsetLo</a>,<span class="register">Y</span>  <span class="comment">\   (S R) = (S R) + 96 ???</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">S</a>                  <span class="comment">\ This addition is performed for all buffer types, but</span>
 <span class="mne">ADC</span> <a class="popup variable">buffersOffsetHi</a>,<span class="register">Y</span>  <span class="comment">\ the addition is only non-zero for the right row buffer</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>

 <span class="mne">LDA</span> <a class="popup variable">polygonColours</a>     <span class="comment">\ Set A to the polygon colour byte for the polygon we</span>
                        <span class="comment">\ we are drawing</span>

 <span class="mne">BIT</span> <a class="popup variable">blendPolygonEdges</a>  <span class="comment">\ If bit 7 of blendPolygonEdges is clear then polygon</span>
 <span class="mne">BPL</span> <a class="popup destination">dpol1</a>              <span class="comment">\ edges should be drawn in the edge colour, so jump to</span>
                        <span class="comment">\ dpol1 to skip the following</span>

                        <span class="comment">\ If we get here then bit 7 of blendPolygonEdges is set,</span>
                        <span class="comment">\ so we draw the polygon edges in the same colour as the</span>
                        <span class="comment">\ polygon body (i.e. the fill colour), so the edges</span>
                        <span class="comment">\ blend into the body</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We typically do this for distant objects, as distinct</span>
                        <span class="comment">\ edge colours can make those object look messy</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11001111</span>         <span class="comment">\ Copy the fill colour from bits 2-3 of the polygon</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ colour byte into the edge colour in bits 4-5, so the</span>
 <span class="mne">LDA</span> <a class="popup variable">polygonColours</a>     <span class="comment">\ polygon edge colour merges into the polygon body</span>
 <span class="mne">ASL</span> <span class="register">A</span>
 <span class="mne">ASL</span> <span class="register">A</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00110000</span>
 <span class="mne">ORA</span> <a class="popup variable">T</a>

<span class="label">.dpol1</span><a id="dpol1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">dpol16</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Modify the following instruction in part 3:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   ORA edgePixelsLeft+&3C,X -></span>
                        <span class="comment">\                 ORA edgePixelsLeft + polygonColours,X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so the ORA instruction uses the correct byte for the</span>
                        <span class="comment">\ the specified polygon colours from the edgePixelsLeft</span>
                        <span class="comment">\ table</span>

 <span class="mne">STA</span> <a class="popup variable">dpol10</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Modify the following instruction in part 2:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   ORA edgePixelsLeft+&3C,X -></span>
                        <span class="comment">\                 ORA edgePixelsLeft + polygonColours,X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so the ORA instruction uses the correct byte for the</span>
                        <span class="comment">\ the specified polygon colours from the edgePixelsLeft</span>
                        <span class="comment">\ table</span>

 <span class="mne">ORA</span> <span class="hash">#</span><span class="hex">&40</span>               <span class="comment">\ Modify the following instruction in part 2:</span>
 <span class="mne">STA</span> <a class="popup variable">dpol14</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\</span>
                        <span class="comment">\   ORA edgePixelsRight+&3C,X -></span>
                        <span class="comment">\                 ORA edgePixelsRight + polygonColours,X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so the ORA instruction uses the correct byte for the</span>
                        <span class="comment">\ the specified polygon colours from the edgePixelsRight</span>
                        <span class="comment">\ table</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set Y to the fill colour from bits 2-3 of the polygon</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ colour byte</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>
 <span class="mne">TAY</span>

 <span class="mne">LDA</span> <a class="popup variable">colourPixels</a>,<span class="register">Y</span>     <span class="comment">\ Set polygonFillPixels to a pixel byte containing four</span>
 <span class="mne">STA</span> <a class="popup variable">polygonFillPixels</a>  <span class="comment">\ pixels set to the fill colour for the polygon</span>

 <span class="mne">LDY</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ Set Y to the pixel line number of the top of the</span>
                        <span class="comment">\ polygon (the highest y-coordinate in the polygon in</span>
                        <span class="comment">\ terms of 3D world coordinates, so higher values are</span>
                        <span class="comment">\ higher up the screen)</span>

 <span class="mne">STY</span> <a class="popup variable">yPolygonLine</a>       <span class="comment">\ Store the top pixel line number in yPolygonLine</span>

 <span class="mne">CPY</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ If yPolygonTop >= yPolygonBottom then there is at</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol13</a>             <span class="comment">\ least one visible line to draw in this polygon, so</span>
                        <span class="comment">\ jump to dpol13 to draw the polygon, starting from</span>
                        <span class="comment">\ row Y</span>

<span class="label">.dpol2</span><a id="dpol2" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawpolygonlines-part-2-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawPolygonLines (Part 2 of 4)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Process the line overflowing the sides of the buffer, or fitting</span>
             <span class="headerEntry">into one pixel byte, and loop on to the next polygon pixel line</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.dpol3</span><a id="dpol3" class="anchor"></a>

                        <span class="comment">\ We jump back here to move on to the next pixel line in</span>
                        <span class="comment">\ the polygon</span>

 <span class="mne">LDY</span> <a class="popup variable">yPolygonLine</a>       <span class="comment">\ Set Y to the number of the polygon pixel line we are</span>
                        <span class="comment">\ drawing (which decrements as we draw the polygon from</span>
                        <span class="comment">\ top to bottom)</span>

 <span class="mne">CPY</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ If Y = yPolygonBottom then we have reached the bottom</span>
 <span class="mne">BEQ</span> <a class="popup destination">dpol2</a>              <span class="comment">\ of the polygon, so jump to dpol2 to return from the</span>
                        <span class="comment">\ subroutine as the whole polygon has now been drawn</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set A = Y mod 8</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000111</span>         <span class="comment">\</span>
                        <span class="comment">\ So A is the number of the polygon pixel line within</span>
                        <span class="comment">\ the current character row</span>

 <span class="mne">BNE</span> <a class="popup destination">dpol11</a>             <span class="comment">\ If A is non-zero then the next polygon line (which</span>
                        <span class="comment">\ will be on polygon pixel row A - 1) will still be in</span>
                        <span class="comment">\ the same character row, so jump to dpol11 to move down</span>
                        <span class="comment">\ one pixel line</span>

                        <span class="comment">\ If we get here then A = 0, so the next polygon pixel</span>
                        <span class="comment">\ line is in a different character row, so we need to</span>
                        <span class="comment">\ move on to the next character row in the screen or the</span>
                        <span class="comment">\ screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">R</a>                  <span class="comment">\ Set (A R) = (S R) + &139</span>
 <span class="mne">CLC</span>                    <span class="comment">\           = (S R) + 320 - 7</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&39</span>               <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\ We add 320 to move on to the next row down on the</span>
 <span class="mne">LDA</span> <a class="popup variable">S</a>                  <span class="comment">\ screen, but we want to be in the top pixel row within</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&01</span>               <span class="comment">\ that character row, so we subtract 7 to move up to the</span>
                        <span class="comment">\ top of the character block (as each row is eight pixel</span>
                        <span class="comment">\ bytes high)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&53</span>               <span class="comment">\ If the result of the addition is less than &5300, then</span>
 <span class="mne">BNE</span> <a class="popup destination">dpol4</a>              <span class="comment">\ we have not reached the end of row 15 in the screen</span>
                        <span class="comment">\ buffer, so jump to dpol4 to skip the following</span>

                        <span class="comment">\ If we get here then we need to wrap the screen buffer</span>
                        <span class="comment">\ address around so we move from screenBufferRow15 to</span>
                        <span class="comment">\ screenBufferRow16</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferRowAddrLo</a><span class="operator">+</span><span class="decimal">16</span> <span class="comment">\ Set (A R) to the address of screenBufferRow16 from the</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\ bufferRowAddr(Hi Lo)</span>
 <span class="mne">LDA</span> <a class="popup variable">bufferRowAddrHi</a><span class="operator">+</span><span class="decimal">16</span>

<span class="label">.dpol4</span><a id="dpol4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (S R) = (S R) + 320 - 7</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

 <span class="mne">BNE</span> <a class="popup destination">dpol12</a>             <span class="comment">\ Jump to dpol12 to draw the next polygon pixel line</span>
                        <span class="comment">\ (this BNE is effectively a JMP as the high byte of the</span>
                        <span class="comment">\ address in A is never zero)</span>

<span class="label">.dpol5</span><a id="dpol5" class="anchor"></a>

                        <span class="comment">\ If we get here then the right edge of the polygon line</span>
                        <span class="comment">\ we are drawing extends past the left edge of the</span>
                        <span class="comment">\ screen buffer</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set polygonGoesLeft = 0 to denote that the polygon</span>
 <span class="mne">STA</span> <a class="popup variable">polygonGoesLeft</a>    <span class="comment">\ extends past the left edge of the buffer, so if we</span>
                        <span class="comment">\ are drawing in the right row buffer, this makes us</span>
                        <span class="comment">\ draw the rest of the polygon in the left row buffer</span>
                        <span class="comment">\ in the DrawPolygon routine</span>

 <span class="mne">BEQ</span> <a class="popup destination">dpol3</a>              <span class="comment">\ Jump to dpol3 to move on to the next pixel line in the</span>
                        <span class="comment">\ polygon (this BEQ is effectively a JMP as A is always</span>
                        <span class="comment">\ zero)</span>

<span class="label">.dpol6</span><a id="dpol6" class="anchor"></a>

                        <span class="comment">\ If we get here then the left edge of the polygon line</span>
                        <span class="comment">\ we are drawing extends past the right edge of the</span>
                        <span class="comment">\ screen buffer</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set polygonGoesRight = 0 to denote that the polygon</span>
 <span class="mne">STA</span> <a class="popup variable">polygonGoesRight</a>   <span class="comment">\ extends past the right edge of the buffer, so if we</span>
                        <span class="comment">\ are drawing in the left row buffer, this makes us draw</span>
                        <span class="comment">\ the rest of the polygon in the right row buffer in the</span>
                        <span class="comment">\ DrawPolygon routine</span>

 <span class="mne">BEQ</span> <a class="popup destination">dpol3</a>              <span class="comment">\ Jump to dpol3 to move on to the next pixel line in the</span>
                        <span class="comment">\ polygon (this BEQ is effectively a JMP as A is always</span>
                        <span class="comment">\ zero)</span>

<span class="label">.dpol7</span><a id="dpol7" class="anchor"></a>

                        <span class="comment">\ If we get here then the right edge of the polygon line</span>
                        <span class="comment">\ we are drawing extends past the right edge of the</span>
                        <span class="comment">\ screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">xBufferWidth</a>       <span class="comment">\ Set xPolygonRightEdge = xBufferWidth * 2</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonRightEdge</a>  <span class="comment">\ This sets the screen x-coordinate of the right end of</span>
                        <span class="comment">\ the polygon line we are drawing to the right edge of</span>
                        <span class="comment">\ the screen buffer (we double the value in xBufferWidth</span>
                        <span class="comment">\ to get the x-coordinate because ???)</span>

 <span class="mne">STA</span> <a class="popup variable">polygonGoesRight</a>   <span class="comment">\ Set polygonGoesRight to the value of A, which is at</span>
                        <span class="comment">\ least 2 because xBufferWidth is non-zero and we just</span>
                        <span class="comment">\ doubled it, so this has the same effect in the</span>
                        <span class="comment">\ DrawPolygon routine as setting polygonGoesRight to 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, this denotes that the polygon extends</span>
                        <span class="comment">\ past the right edge of the buffer, so if we are</span>
                        <span class="comment">\ drawing in the left row buffer, this makes us draw the</span>
                        <span class="comment">\ rest of the polygon in the right row buffer in the</span>
                        <span class="comment">\ DrawPolygon routine</span>

 <span class="mne">BNE</span> <a class="popup destination">dpol15</a>             <span class="comment">\ Jump to dpol15 to draw the left edge and fill line for</span>
                        <span class="comment">\ this polygon line (this BNE is effectively a JMP as A</span>
                        <span class="comment">\ is never zero)</span>

<span class="label">.dpol8</span><a id="dpol8" class="anchor"></a>

                        <span class="comment">\ If we get here then the left edge of the polygon line</span>
                        <span class="comment">\ we are drawing extends past the left edge of the</span>
                        <span class="comment">\ screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore need to draw the left end of the line in</span>
                        <span class="comment">\ the screen buffer without the edge byte, and with the</span>
                        <span class="comment">\ fill portion starting at the buffer's left edge</span>

 <span class="mne">LDA</span> <a class="popup variable">R</a>                  <span class="comment">\ Set (Q P) = (S R) - 8</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ This sets (Q P) to the very first byte in the screen</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\ row, so we don't reserve the first byte for the left</span>
 <span class="mne">LDA</span> <a class="popup variable">S</a>                  <span class="comment">\ edge in part 4 and instead draw the fill portion of</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ the polygon line from the left edge of the screen row</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set polygonGoesLeft = 0 to denote that the polygon</span>
 <span class="mne">STA</span> <a class="popup variable">polygonGoesLeft</a>    <span class="comment">\ extends past the left edge of the buffer, so if we</span>
                        <span class="comment">\ are drawing in the right row buffer, this makes us</span>
                        <span class="comment">\ draw the rest of the polygon in the left row buffer</span>
                        <span class="comment">\ in the DrawPolygon routine</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&F8</span>               <span class="comment">\ Set A = -8 to set the left edge of the line to the</span>
                        <span class="comment">\ left edge of the screen (this is the same as setting</span>
                        <span class="comment">\ the left edge to 0 and then subtracting 8 for the same</span>
                        <span class="comment">\ reason we subtracted 8 from (Q P) above)</span>

 <span class="mne">BNE</span> <a class="popup destination">dpol17</a>             <span class="comment">\ Jump to dpol17 to draw the polygon line in part 4</span>
                        <span class="comment">\ (this BNE is effectively a JMP as A is never zero)</span>

<span class="label">.dpol9</span><a id="dpol9" class="anchor"></a>

                        <span class="comment">\ If we get here then the pixel byte offset for the left</span>
                        <span class="comment">\ edge is the same as the pixel byte offset for the</span>
                        <span class="comment">\ right edge, so we need to draw both the left and right</span>
                        <span class="comment">\ edges within the same pixel byte</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set X to the pixel number within the character block</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ of the left edge of the polygon (as each character</span>
 <span class="mne">TAX</span>                    <span class="comment">\ block contains four pixels)</span>

 <span class="mne">LDA</span> <a class="popup variable">currentPixelByte</a>   <span class="comment">\ Set A to the current screen contents for the pixel</span>
                        <span class="comment">\ byte containing the right edge (which is the same as</span>
                        <span class="comment">\ the pixel byte containing the left edge)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We set this to the result of a LDA (R),Y instruction</span>
                        <span class="comment">\ in part 3, so this is the same as fetching the current</span>
                        <span class="comment">\ screen contents with LDA (R),Y</span>

 <span class="mne">AND</span> <a class="popup variable">pixelsToLeft</a>,<span class="register">X</span>     <span class="comment">\ Clear the pixels to the right of the left edge by</span>
                        <span class="comment">\ AND'ing the current screen contents with a pixel byte</span>
                        <span class="comment">\ with all the pixels to the left of position X set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the existing screen contents for the</span>
                        <span class="comment">\ pixels outside the polygon line, and with the polygon</span>
                        <span class="comment">\ line pixels cleared, so now we can OR the polygon line</span>
                        <span class="comment">\ pixels into the space we just cleared</span>

<span class="label">.dpol10</span><a id="dpol10" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">edgePixelsLeft</a><span class="operator">+</span><span class="hex">&3C</span>,<span class="register">X</span>   <span class="comment">\ This instruction is modified in part 1 to point to</span>
                            <span class="comment">\ the correct entry for the specified polygon</span>
                            <span class="comment">\ colour:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   ORA edgePixelsLeft + polygonColours,X</span>
                            <span class="comment">\</span>
                            <span class="comment">\ So this inserts the left edge of the polygon into</span>
                            <span class="comment">\ the right part of the pixel byte in the correct</span>
                            <span class="comment">\ colours for the currently configured fill and edge</span>
                            <span class="comment">\ colours, with the edge pixels starting at pixel</span>
                            <span class="comment">\ number X within the byte and ending at the right</span>
                            <span class="comment">\ end of the pixel byte</span>
                            <span class="comment">\</span>
                            <span class="comment">\ The original value of edgePixelsLeft+&3C is just</span>
                            <span class="comment">\ workspace noise and has no meaning, it just sets</span>
                            <span class="comment">\ the high byte to HI(edgePixelsLeft)</span>

 <span class="mne">AND</span> <a class="popup variable">leftPixels</a>,<span class="register">X</span>       <span class="comment">\ Clear all the pixels to the right of the right edge</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ and store the result in T, so this contains the pixel</span>
                        <span class="comment">\ byte with the left edge in-place and the pixels for</span>
                        <span class="comment">\ the right edge cleared</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The leftPixels bit mask is the complementary pixel</span>
                        <span class="comment">\ byte to pixelsToRight, which we are about to use to</span>
                        <span class="comment">\ fill in the right edge</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the current screen contents of the byte we</span>
                        <span class="comment">\ are drawing both edges into</span>

 <span class="mne">AND</span> <a class="popup variable">pixelsToRight</a>,<span class="register">X</span>    <span class="comment">\ Clear the pixels to the left of the right edge by</span>
                        <span class="comment">\ AND'ing the current screen contents with a pixel byte</span>
                        <span class="comment">\ with all the pixels to the right of position X set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the existing screen contents for the</span>
                        <span class="comment">\ pixels outside the polygon line, and with the polygon</span>
                        <span class="comment">\ line pixels cleared, so now we can OR the polygon line</span>
                        <span class="comment">\ pixels into the space we just cleared</span>

 <span class="mne">ORA</span> <a class="popup variable">T</a>                  <span class="comment">\ Insert the right edge of the polygon into the pixel</span>
                        <span class="comment">\ byte, with the edge pixels starting at the left end</span>
                        <span class="comment">\ of the pixel byte and ending at pixel number X within</span>
                        <span class="comment">\ the byte</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Poke the pixel byte containing the left and right</span>
                        <span class="comment">\ edges into screen memory</span>

 <span class="mne">JMP</span> <a class="popup destination">dpol3</a>              <span class="comment">\ Jump to dpol3 to move on to the next pixel line in the</span>
                        <span class="comment">\ polygon</span>

<span class="label">.dpol11</span><a id="dpol11" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">R</a>                  <span class="comment">\ Increment the screen address in (S R) to move down one</span>
                        <span class="comment">\ pixel row within the character row, ready for drawing</span>
                        <span class="comment">\ the next polygon pixel line</span>

<span class="label">.dpol12</span><a id="dpol12" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the polygon line number in yPolygonLine to</span>
 <span class="mne">STY</span> <a class="popup variable">yPolygonLine</a>       <span class="comment">\ move down one line in the polygon, from the top to the</span>
                        <span class="comment">\ bottom</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawpolygonlines-part-3-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawPolygonLines (Part 3 of 4)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the left and right edges of the polygon line and fall into</span>
             <span class="headerEntry">part 4 to draw the line in between</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawpolygonlines_part_3_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.dpol13</span><a id="dpol13" class="anchor"></a>

                        <span class="comment">\ This is the entry point for the loop that spans parts</span>
                        <span class="comment">\ 2, 3 and 4</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We jump here from part 1 with Y set to the number of</span>
                        <span class="comment">\ the polygon pixel line at the top of the polygon</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also get here on later iterations with Y set to the</span>
                        <span class="comment">\ polygon pixel to draw next</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In either case we draw polygon pixel line Y and steps</span>
                        <span class="comment">\ down the polygon one pixel line at a time until we</span>
                        <span class="comment">\ reach the bottom</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonRight</a>,<span class="register">Y</span>    <span class="comment">\ Set A to the pixel x-coordinate of the right edge for</span>
                        <span class="comment">\ the line we are drawing</span>

 <span class="mne">CMP</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">Y</span>     <span class="comment">\ If the pixel x-coordinate of the right edge is less</span>
 <span class="mne">BCC</span> <a class="popup destination">dpol2</a>              <span class="comment">\ than the pixel x-coordinate of the left edge for the</span>
                        <span class="comment">\ line we are drawing, then the polygon must be facing</span>
                        <span class="comment">\ away from us, so jump to dpol2 to return from the</span>
                        <span class="comment">\ subroutine without drawing the polygon</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the pixel x-coordinate of the right edge</span>

 <span class="mne">SBC</span> <a class="popup variable">xBufferLeft</a>        <span class="comment">\ Set A = A - xBufferLeft</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A is the distance between the right edge of the</span>
                        <span class="comment">\ polygon and the left edge of the buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works because we just passed through</span>
                        <span class="comment">\ a BCC, so we know the C flag is set</span>

 <span class="mne">BCC</span> <a class="popup destination">dpol5</a>              <span class="comment">\ If the subtraction underflowed then the right edge of</span>
                        <span class="comment">\ the polygon is before the left edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol5 in part 2 to process this</span>

 <span class="mne">CMP</span> <a class="popup variable">xBufferWidth</a>       <span class="comment">\ If A >= xBufferWidth then the right edge of the</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol7</a>              <span class="comment">\ polygon is beyond the right edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol7 in part 2 to process this</span>

                        <span class="comment">\ If we get here then the left and right edges of the</span>
                        <span class="comment">\ polygon are both within the screen buffer</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set Y to the offset within the character row of the</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111000</span>         <span class="comment">\ pixel byte containing the right edge of the polygon</span>
 <span class="mne">TAY</span>                    <span class="comment">\ ???</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set X to the pixel number within the character block</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ of the left edge of the polygon (as each character</span>
 <span class="mne">TAX</span>                    <span class="comment">\ block contains four pixels)</span>

 <span class="mne">STY</span> <a class="popup variable">xPolygonRightEdge</a>  <span class="comment">\ Store the pixel byte offset within the character row</span>
                        <span class="comment">\ of the right edge of the polygon in xPolygonRightEdge</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the current screen contents of the pixel byte</span>
                        <span class="comment">\ where we want to draw the right edge of the polygon</span>

 <span class="mne">STA</span> <a class="popup variable">currentPixelByte</a>   <span class="comment">\ Store the current screen contents for the right edge</span>
                        <span class="comment">\ of the polygon in currentPixelByte, in case we need</span>
                        <span class="comment">\ to draw the left and right edges in the same pixel</span>
                        <span class="comment">\ byte</span>

 <span class="mne">AND</span> <a class="popup variable">pixelsToRight</a>,<span class="register">X</span>    <span class="comment">\ Clear the pixels to the left of the right edge by</span>
                        <span class="comment">\ AND'ing the current screen contents with a pixel byte</span>
                        <span class="comment">\ with all the pixels to the right of position X set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the existing screen contents for the</span>
                        <span class="comment">\ pixels outside the polygon line, and with the polygon</span>
                        <span class="comment">\ line pixels cleared, so now we can OR the polygon line</span>
                        <span class="comment">\ pixels into the space we just cleared</span>

<span class="label">.dpol14</span><a id="dpol14" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">edgePixelsRight</a><span class="operator">+</span><span class="hex">&3C</span>,<span class="register">X</span>  <span class="comment">\ This instruction is modified in part 1 to point to</span>
                            <span class="comment">\ the correct entry for the specified polygon</span>
                            <span class="comment">\ colour:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   ORA edgePixelsRight + polygonColours,X</span>
                            <span class="comment">\</span>
                            <span class="comment">\ So this inserts the right edge of the polygon into</span>
                            <span class="comment">\ the left part of the pixel byte in the correct</span>
                            <span class="comment">\ colours for the currently configured fill and edge</span>
                            <span class="comment">\ colours, with the edge pixels starting at the left</span>
                            <span class="comment">\ end of the pixel byte and ending at pixel number X</span>
                            <span class="comment">\ within the byte</span>
                            <span class="comment">\</span>
                            <span class="comment">\ The original value of edgePixelsRight+&3C is just</span>
                            <span class="comment">\ workspace noise and has no meaning, it just sets</span>
                            <span class="comment">\ the high byte to HI(edgePixelsRight)</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Poke the pixel byte containing the right edge into</span>
                        <span class="comment">\ screen memory, so we have now drawn the right edge of</span>
                        <span class="comment">\ the polygon line</span>

<span class="label">.dpol15</span><a id="dpol15" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">yPolygonLine</a>       <span class="comment">\ Set A to the pixel x-coordinate of the left edge for</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">Y</span>     <span class="comment">\ the line we are drawing</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the pixel x-coordinate of the left edge</span>

 <span class="mne">CMP</span> <a class="popup variable">xBufferRight</a>       <span class="comment">\ If A >= xBufferRight then the left edge of the</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol6</a>              <span class="comment">\ polygon is beyond the right edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol6 in part 2 to process this</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set A = A - xBufferLeft</span>
 <span class="mne">SBC</span> <a class="popup variable">xBufferLeft</a>        <span class="comment">\</span>
                        <span class="comment">\ So A is the distance between the left edge of the</span>
                        <span class="comment">\ polygon and the left edge of the buffer</span>

 <span class="mne">BCC</span> <a class="popup destination">dpol8</a>              <span class="comment">\ If the subtraction underflowed then the left edge of</span>
                        <span class="comment">\ the polygon is before the left edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol8 in part 2 to process this</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set Y to the offset within the character row of the</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111000</span>         <span class="comment">\ pixel byte containing the left edge of the polygon ???</span>
 <span class="mne">TAY</span>

 <span class="mne">CPY</span> <a class="popup variable">xPolygonRightEdge</a>  <span class="comment">\ If Y >= xPolygonRightEdge then the pixel byte offset</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol9</a>              <span class="comment">\ for the left edge is the same as the pixel byte offset</span>
                        <span class="comment">\ for the right edge, so jump to dpol9 to draw both</span>
                        <span class="comment">\ edges within the same pixel byte</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set X to the pixel number within the character block</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ of the left edge of the polygon (as each character</span>
 <span class="mne">TAX</span>                    <span class="comment">\ block contains four pixels)</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the current screen contents of the pixel byte</span>
                        <span class="comment">\ where we want to draw the left edge of the polygon</span>

 <span class="mne">AND</span> <a class="popup variable">pixelsToLeft</a>,<span class="register">X</span>     <span class="comment">\ Clear the pixels to the right of the left edge by</span>
                        <span class="comment">\ AND'ing the current screen contents with a pixel byte</span>
                        <span class="comment">\ with all the pixels to the left of position X set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the existing screen contents for the</span>
                        <span class="comment">\ pixels outside the polygon line, and with the polygon</span>
                        <span class="comment">\ line pixels cleared, so now we can OR the polygon line</span>
                        <span class="comment">\ pixels into the space we just cleared</span>

<span class="label">.dpol16</span><a id="dpol16" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">edgePixelsLeft</a><span class="operator">+</span><span class="hex">&3C</span>,<span class="register">X</span>   <span class="comment">\ This instruction is modified in part 1 to point to</span>
                            <span class="comment">\ the correct entry for the specified polygon</span>
                            <span class="comment">\ colour:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   ORA edgePixelsLeft + polygonColours,X</span>
                            <span class="comment">\</span>
                            <span class="comment">\ So this inserts the left edge of the polygon into</span>
                            <span class="comment">\ the right part of the pixel byte in the correct</span>
                            <span class="comment">\ colours for the currently configured fill and edge</span>
                            <span class="comment">\ colours, with the edge pixels starting at pixel</span>
                            <span class="comment">\ number X within the byte and ending at the right</span>
                            <span class="comment">\ end of the pixel byte</span>
                            <span class="comment">\</span>
                            <span class="comment">\ The original value of edgePixelsLeft+&3C is just</span>
                            <span class="comment">\ workspace noise and has no meaning, it just sets</span>
                            <span class="comment">\ the high byte to HI(edgePixelsLeft)</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Poke the pixel byte containing the left edge into</span>
                        <span class="comment">\ screen memory, so we have now drawn the left edge of</span>
                        <span class="comment">\ the polygon line</span>

                        <span class="comment">\ Fall through into part 4 to draw a line between the</span>
                        <span class="comment">\ left and right edges to finish off this line of the</span>
                        <span class="comment">\ polygon</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-drawpolygonlines-part-4-of-4" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawPolygonLines (Part 4 of 4)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a horizontal pixel line of a specific length in character</span>
             <span class="headerEntry">columns</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/drawpolygonlines_part_4_of_4.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ We now draw the horizontal line between the left and</span>
                        <span class="comment">\ right edges to complete the drawing of this polygon</span>
                        <span class="comment">\ line, before looping back to draw the rest of the</span>
                        <span class="comment">\ polygon</span>

 <span class="mne">TYA</span>                    <span class="comment">\ Set (Q P) = (S R) + Y</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">R</a>                  <span class="comment">\ So (Q P) contains the screen address of the pixel byte</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\ containing the left edge of the polygon line</span>
 <span class="mne">LDA</span> <a class="popup variable">S</a>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>

 <span class="mne">TYA</span>                    <span class="comment">\ Set A = Y</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the pixel byte offset within the screen</span>
                        <span class="comment">\ character row of the left edge of the polygon line</span>

<span class="label">.dpol17</span><a id="dpol17" class="anchor"></a>

                        <span class="comment">\ We now draw a horizontal line that starts in the left</span>
                        <span class="comment">\ with the character column to the right of (Q P), as</span>
                        <span class="comment">\ (Q P) contains the left edge</span>
                        <span class="comment">\</span>
                        <span class="comment">\ And we want the line to end in the character column</span>
                        <span class="comment">\ before the right edge, which we drew at pixel byte</span>
                        <span class="comment">\ offset xPolygonRightEdge</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At this point, A contains the pixel byte offset of the</span>
                        <span class="comment">\ left edge</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we want to draw a line between pixel byte offset A</span>
                        <span class="comment">\ and pixel byte offset xPolygonRightEdge</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Each character block contains eight bytes, so in terms</span>
                        <span class="comment">\ of character columns, we want to draw a line that's</span>
                        <span class="comment">\ this number of character columns wide:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (xPolygonRightEdge - A) / 8</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The following unrolled loop implements this, but in a</span>
                        <span class="comment">\ reverse manner that means we have to negate the above</span>
                        <span class="comment">\ value to calculate the correct entry point (as well as</span>
                        <span class="comment">\ incorporating the fact that the jump points are spaced</span>
                        <span class="comment">\ out by four bytes)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set A = (A - xPolygonRightEdge) / 2</span>
 <span class="mne">SBC</span> <a class="popup variable">xPolygonRightEdge</a>  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ So that's the above character column calculation, but</span>
                        <span class="comment">\ negated and multiplied by 4</span>

 <span class="mne">STA</span> <a class="popup variable">dpol18</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Modify the following instruction below:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   BCC dpol19 -> BCC A</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so the BCC instruction jumps to the offset given in A,</span>
                        <span class="comment">\ so the following routine draws a line of the length</span>
                        <span class="comment">\ given in A, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 0 * 4, draw from column 31 to column 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 1 * 4, draw from column 30 to column 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 2 * 4, draw from column 29 to column 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\     ...</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 28 * 4, draw from column 3 to column 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 29 * 4, draw from column 2 to column 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * When A = 30 * 4, draw from column 1 to column 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This works because there are four bytes in each of the</span>
                        <span class="comment">\ LDY/STA instruction pairs below, and when the BCC is</span>
                        <span class="comment">\ executed, the operand of the BCC is added to the</span>
                        <span class="comment">\ address of the first instruction after the BCC</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, this routine draws a line of length</span>
                        <span class="comment">\ 31 - (A / 4) character columns</span>

 <span class="mne">LDA</span> <a class="popup variable">polygonFillPixels</a>  <span class="comment">\ Set A to the contents of polygonFillPixels, which we</span>
                        <span class="comment">\ set in part 1 to a pixel byte containing four pixels</span>
                        <span class="comment">\ set to the fill colour for the polygon</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the pixel byte we should use for drawing the line</span>
                        <span class="comment">\ is in A</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the BCC instruction below jumps to</span>
                        <span class="comment">\ the correct entry to draw the specified number of</span>
                        <span class="comment">\ character columns</span>

<span class="label">.dpol18</span><a id="dpol18" class="anchor"></a>

 <span class="mne">BCC</span> <a class="popup destination">dpol19</a>             <span class="comment">\ This instruction is modified in part 3 to jump to the</span>
                        <span class="comment">\ correct entry in the following list for drawing a</span>
                        <span class="comment">\ horizontal pixel line of the specified length</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The line length is specified in character columns (1</span>
                        <span class="comment">\ to 31) and the drawing starts with the pixel byte to</span>
                        <span class="comment">\ the right of the pixel byte whose screen address is</span>
                        <span class="comment">\ in (Q P), so (Q P) contains the left cap of the line</span>
                        <span class="comment">\ and the line fills the polygon to the right for the</span>
                        <span class="comment">\ specified number of character columns</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The line is drawn from right to left to enable the</span>
                        <span class="comment">\ routine to be joined at the correct point for the</span>
                        <span class="comment">\ required line length</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">31</span>            <span class="comment">\ Draw a line from column 31 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">30</span>            <span class="comment">\ Draw a line from column 30 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">29</span>            <span class="comment">\ Draw a line from column 29 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">28</span>            <span class="comment">\ Draw a line from column 28 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">27</span>            <span class="comment">\ Draw a line from column 27 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">26</span>            <span class="comment">\ Draw a line from column 26 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">25</span>            <span class="comment">\ Draw a line from column 25 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">24</span>            <span class="comment">\ Draw a line from column 24 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">23</span>            <span class="comment">\ Draw a line from column 23 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">22</span>            <span class="comment">\ Draw a line from column 22 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">21</span>            <span class="comment">\ Draw a line from column 21 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">20</span>            <span class="comment">\ Draw a line from column 20 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">19</span>            <span class="comment">\ Draw a line from column 19 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">18</span>            <span class="comment">\ Draw a line from column 18 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">17</span>            <span class="comment">\ Draw a line from column 17 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">16</span>            <span class="comment">\ Draw a line from column 16 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">15</span>            <span class="comment">\ Draw a line from column 15 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">14</span>            <span class="comment">\ Draw a line from column 14 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">13</span>            <span class="comment">\ Draw a line from column 13 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">12</span>            <span class="comment">\ Draw a line from column 12 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">11</span>            <span class="comment">\ Draw a line from column 11 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">10</span>            <span class="comment">\ Draw a line from column 10 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">9</span>             <span class="comment">\ Draw a line from column 9 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">8</span>             <span class="comment">\ Draw a line from column 8 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">7</span>             <span class="comment">\ Draw a line from column 7 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">6</span>             <span class="comment">\ Draw a line from column 6 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">5</span>             <span class="comment">\ Draw a line from column 5 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">4</span>             <span class="comment">\ Draw a line from column 4 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">3</span>             <span class="comment">\ Draw a line from column 3 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">2</span>             <span class="comment">\ Draw a line from column 2 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">8</span> <span class="operator">*</span> <span class="decimal">1</span>             <span class="comment">\ Draw a line from column 1 to column 1</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>

<span class="label">.dpol19</span><a id="dpol19" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">dpol3</a>              <span class="comment">\ Loop back to part 2 to move on to the next pixel line</span>
                        <span class="comment">\ in the polygon</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-gettilevisibility" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileVisibility</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">For each tile in the landscape, calculate whether the player can</span>
             <span class="headerEntry">see that tile, to speed up the process of drawing the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/gettilevisibility.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#gettilevisibility">GetTileVisibility</a></span>
</div>
<hr class="light">
 This routine sets a single bit in the tileVisibility table that records the
 visibility of that tile from the player's perspective (where 1 = visible,
 0 = hidden).

 The position of the bit within the tileVisibility table is calculated in a
 rather complicated manner, presumably to make it harder to follow what's going
 on.

</div></div>
<span class="label">.GetTileVisibility</span><a id="gettilevisibility" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ If bit 7 of hyperspaceEndsGame is set then the game</span>
 <span class="mne">BMI</span> <a class="popup destination">tvis5</a>              <span class="comment">\ has ended because of a hyperspace, so jump to tvis5</span>
                        <span class="comment">\ to return from the subroutine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This check appears to be unnecessary, as we only call</span>
                        <span class="comment">\ GetTileVisibility from game2 in MainGameLoop, and we</span>
                        <span class="comment">\ only reach game2 when bit 7 of hyperspaceEndsGame is</span>
                        <span class="comment">\ clear, so this BMI will never be taken</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 to use when we zero the tileVisibility table</span>

 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Set drawingTableOffset = 0 so the call to first call</span>
                        <span class="comment">\ to GetRowVisibility (for tile row 31) will populate</span>
                        <span class="comment">\ the table at oddVisibility with the tile visibilities</span>
                        <span class="comment">\ of the row being analysed</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">127</span>               <span class="comment">\ We now zero the tileVisibility table, so set a counter</span>
                        <span class="comment">\ in X for zeroing 128 bytes</span>

<span class="label">.tvis1</span><a id="tvis1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a>,<span class="register">X</span>   <span class="comment">\ Zero the X-th byte of the tileVisibility table to</span>
                        <span class="comment">\ indicate hidden tiles</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">tvis1</a>              <span class="comment">\ Loop back until we have zeroed both variables</span>

 <span class="mne">JSR</span> <a class="popup destination">GetTileAltitudes</a>   <span class="comment">\ Calculate tile corner altitudes and maximum tile</span>
                        <span class="comment">\ corner altitudes for each tile in the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This also sets the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (Q P) = &6000</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * (S R) = &6020</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we have P = 0 and R = &20, ready to pass to the</span>
                        <span class="comment">\ GetRowVisibility routine (which expects these values)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set zTileRow = 31 so the call to GetRowVisibility</span>
 <span class="mne">STA</span> <a class="popup variable">zTileRow</a>           <span class="comment">\ analyses the back row of tiles</span>

 <span class="mne">JSR</span> <a class="popup destination">GetRowVisibility</a>   <span class="comment">\ Calculate whether each tile corner in the rearmost row</span>
                        <span class="comment">\ is obscured from the player by any intervening</span>
                        <span class="comment">\ landscape, putting the results into 32 entries in the</span>
                        <span class="comment">\ table at oddVisibility (as drawingTableOffset = 0) as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %00000000 if the tile corner is not visible from</span>
                        <span class="comment">\     the player's position</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %11111111 if the tile corner is visible from the</span>
                        <span class="comment">\     player's position</span>

 <span class="mne">DEC</span> <a class="popup variable">zTileRow</a>           <span class="comment">\ Decrement zTileRow to move forward by one tile row</span>

<span class="label">.tvis2</span><a id="tvis2" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ Flip drawingTableOffset between 0 and 32, so each</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ call to GetRowVisibility alternates between storing</span>
 <span class="mne">STA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ the tile visibilities in oddVisibility and</span>
                        <span class="comment">\ evenVisibility</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We EOR with 32 because:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   evenVisibility - oddVisibility = 32</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can add the result in drawingTableOffset to</span>
                        <span class="comment">\ oddVisibility to point to the correct table for</span>
                        <span class="comment">\ storing the results</span>

 <span class="mne">JSR</span> <a class="popup destination">GetRowVisibility</a>   <span class="comment">\ Calculate whether each tile corner in the row at</span>
                        <span class="comment">\ zTileRow is obscured from the player by any</span>
                        <span class="comment">\ intervening landscape, putting the results into 32</span>
                        <span class="comment">\ entries in the table at either oddVisibility or</span>
                        <span class="comment">\ evenVisibility (depending on the parity of zTileRow)</span>
                        <span class="comment">\ as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %00000000 if the tile corner is not visible from</span>
                        <span class="comment">\     the player's position</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %11111111 if the tile corner is visible from the</span>
                        <span class="comment">\     player's position</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the current row is in either oddVisibility or</span>
                        <span class="comment">\ evenVisibility and the previous row is in the other</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The call also sets (Q P) to the address of the table</span>
                        <span class="comment">\ that contains the altitude and flatness data for tile</span>
                        <span class="comment">\ corner row zTileRow, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (Q P) = &6000 + (zTileRow 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Each value in the table at (Q P) contains the flatness</span>
                        <span class="comment">\ of the tile in bit 0 and the altitude of the tile</span>
                        <span class="comment">\ corner in bits 1-4</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set V to the high byte of the y-coordinate of the</span>
 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ player object</span>
 <span class="mne">STA</span> <a class="popup variable">V</a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">30</span>                <span class="comment">\ Set X = 30 to use as the column number, so we start</span>
                        <span class="comment">\ iterating from the right, skipping the rightmost</span>
                        <span class="comment">\ column as the tile corners in that column do not</span>
                        <span class="comment">\ anchor any tiles (so X iterates from 30 to 0 in the</span>
                        <span class="comment">\ following loop)</span>

<span class="label">.tvis3</span><a id="tvis3" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the X-th entry from (Q P), which contains the</span>
 <span class="mne">TAY</span>                    <span class="comment">\ altitude and flatness of the X-th tile in the row at</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ zTileRow</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ Set Y to a bit mask containing all set bits, to use</span>
                        <span class="comment">\ for flagging tiles as being visible in the calculation</span>
                        <span class="comment">\ below</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Shift bit 0 into the C flag, so it contains the shape,</span>
                        <span class="comment">\ and set A as the altitude of the tile</span>

 <span class="mne">BCS</span> <a class="popup destination">tvis4</a>              <span class="comment">\ If the tile is not flat then the C flag will be set,</span>
                        <span class="comment">\ so jump to tvis4 with Y set to the bit mask for</span>
                        <span class="comment">\ visible tiles</span>

 <span class="mne">CMP</span> <a class="popup variable">V</a>                  <span class="comment">\ If A &lt;= V then the tile is at the same altitude or</span>
 <span class="mne">BCC</span> <a class="popup destination">tvis4</a>              <span class="comment">\ lower than the high byte of the player object's</span>
 <span class="mne">BEQ</span> <a class="popup destination">tvis4</a>              <span class="comment">\ altitude (which is the player's altitude rounded down</span>
                        <span class="comment">\ to the nearest integer), so jump to tvis4 with Y set</span>
                        <span class="comment">\ to the bit mask for visible tiles</span>

                        <span class="comment">\ If we get here then the tile is flat and it is at a</span>
                        <span class="comment">\ higher altitude than the player object, so</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to zero to get a bit mask containing all</span>
                        <span class="comment">\ clear bits, to use for flagging tiles as not being</span>
                        <span class="comment">\ visible in the calculation below</span>

<span class="label">.tvis4</span><a id="tvis4" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">W</a>                  <span class="comment">\ Store the bit mask we just calculated in W</span>

                        <span class="comment">\ We now store this tile's visibility as a single bit in</span>
                        <span class="comment">\ in the tileVisibility table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ First we need to calculate the location of this tile's</span>
                        <span class="comment">\ bit in the table, which we do by encoding the tile</span>
                        <span class="comment">\ column number in X and row number in zTileRow into an</span>
                        <span class="comment">\ offset into the table (in T) and a bit mask lookup</span>
                        <span class="comment">\ (in Y)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Presumably this calculation is complex to make it</span>
                        <span class="comment">\ harder for people to work out what's going on (at</span>
                        <span class="comment">\ least, I can't figure out why it's done this way)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ X is the column number of the tile we are analysing,</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ in the range 0 to 30 (%00000 to %11110), so shift that</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ number into the top five bits of A and clear the last</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ two bits, so that bits 5-7 contain bits 2-4 of the</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11100000</span>         <span class="comment">\ column number</span>

 <span class="mne">ORA</span> <a class="popup variable">zTileRow</a>           <span class="comment">\ zTileRow is the row number of the tile we are</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ analysing, again in the range 0 to 30 (%00000 to</span>
                        <span class="comment">\ %11110), so put this into bits 0 to 4 of A and shift</span>
                        <span class="comment">\ the whole thing to the right, so we lose bit 0 of the</span>
                        <span class="comment">\ row number into the C flag (which we capture below)</span>
                        <span class="comment">\ and bits 0 to 3 contain bits 1 to 4 of zTileRow</span>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set T to the value of A, so we now have the following</span>
                        <span class="comment">\ in T:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bit 7 is clear</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 4-6 contain bits 2-4 of the column number</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Bits 0-3 contain bits 1-4 of the row number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We have now encoded the tile number in T, which we can</span>
                        <span class="comment">\ use as an index into the tileVisibility table when</span>
                        <span class="comment">\ storing the tile's visibility</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set bits 0 to 2 of Y as follows:</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\    * Bit 0 contains bit 0 of the of the tile row (via</span>
 <span class="mne">TAY</span>                    <span class="comment">\      the C flag from above)</span>
                        <span class="comment">\</span>
                        <span class="comment">\    * Bits 1-2 contain bits 0-1 of the column number</span>

 <span class="mne">LDA</span> <a class="popup variable">visibileBitMask</a>,<span class="register">Y</span>  <span class="comment">\ Set bitMask to a byte with all bits set except the</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ Y-th bit, counting from the left (so when Y is 0, bit</span>
 <span class="mne">STA</span> <a class="popup variable">bitMask</a>            <span class="comment">\ 7 is clear, when Y is 1, bit 6 is clear and so on)</span>

 <span class="mne">LDA</span> <a class="popup variable">oddVisibility</a>,<span class="register">X</span>    <span class="comment">\ Set A to the combined visibility of the four tile</span>
 <span class="mne">ORA</span> <a class="popup variable">oddVisibility</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span>  <span class="comment">\ corners for the tile we are analysing, by OR'ing the</span>
 <span class="mne">ORA</span> <a class="popup variable">evenVisibility</a>,<span class="register">X</span>   <span class="comment">\ visibility bytes that we set for the four corners in</span>
 <span class="mne">ORA</span> <a class="popup variable">evenVisibility</a><span class="operator">+</span><span class="decimal">1</span>,<span class="register">X</span> <span class="comment">\ the call to GetRowVisibility:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * oddVisibility+X contains the visibility for the</span>
                        <span class="comment">\     tile's anchor (i.e. the X-th corner)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * oddVisibility+X+1 contains the visibility for the</span>
                        <span class="comment">\     corner to the right of the tile's anchor</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * evenVisibility+X contains the visibility for the</span>
                        <span class="comment">\     corner behind the tile's anchor (i.e. the corner</span>
                        <span class="comment">\     on the same x-coordinate but from the previous</span>
                        <span class="comment">\     row's analysis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * evenVisibility+X+1 contains the visibility for the</span>
                        <span class="comment">\     corner just to the right of the last one</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The GetRowVisibility routine sets visibility in the</span>
                        <span class="comment">\ oddVisibility and evenVisibility tables as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %00000000 if the tile corner is not visible</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * %11111111 if the tile corner is visible</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So OR'ing the four tile corners will give %11111111 if</span>
                        <span class="comment">\ any of the tile corners are visible, and %00000000 if</span>
                        <span class="comment">\ none of them are visible</span>

 <span class="mne">AND</span> <a class="popup variable">W</a>                  <span class="comment">\ Apply the W bit mask from above, which we set to</span>
                        <span class="comment">\ %0000000 for tiles that are flat and above the level</span>
                        <span class="comment">\ of the player, and %11111111 otherwise</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this forces A to 0 (to indicate a hidden tile) for</span>
                        <span class="comment">\ tiles that are flat and too high to be seen by the</span>
                        <span class="comment">\ player, and leaves A alone for other tiles</span>

 <span class="mne">AND</span> <a class="popup variable">visibileBitMask</a>,<span class="register">Y</span>  <span class="comment">\ At this point A is either %00000000 for a hidden tile</span>
                        <span class="comment">\ or %11111111 for a visible tile, so AND'ing it with</span>
                        <span class="comment">\ the Y-th entry in visibileBitMask (which is a bit mask</span>
                        <span class="comment">\ with all bits set except the Y-th bit, counting from</span>
                        <span class="comment">\ the left) will clear all bits except the Y-th bit,</span>
                        <span class="comment">\ which will be 0 for non-visible tiles and 1 for</span>
                        <span class="comment">\ visible tiles</span>

 <span class="mne">STA</span> <a class="popup variable">U</a>                  <span class="comment">\ Store A in U, so U contains all clear bits apart from</span>
                        <span class="comment">\ the Y-th bit, which contains the visibility of the</span>
                        <span class="comment">\ tile we are processing</span>

 <span class="mne">LDY</span> <a class="popup variable">T</a>                  <span class="comment">\ Set A to the T-th byte in the tileVisibility table,</span>
 <span class="mne">LDA</span> <a class="popup variable">tileVisibility</a>,<span class="register">Y</span>   <span class="comment">\ which is where we want to store our visibility bit for</span>
                        <span class="comment">\ the tile we are processing</span>

 <span class="mne">AND</span> <a class="popup variable">bitMask</a>            <span class="comment">\ We set bitMask above to a byte with all bits set</span>
                        <span class="comment">\ except the Y-th bit, counting from the left, which</span>
                        <span class="comment">\ matches the bit that we used in U to store the tile's</span>
                        <span class="comment">\ visibility bit, so this AND clears that bit in the</span>
                        <span class="comment">\ byte we just fetched from the tileVisibility table</span>

 <span class="mne">ORA</span> <a class="popup variable">U</a>                  <span class="comment">\ U contains all clear bits apart from the Y-th bit,</span>
                        <span class="comment">\ which contains the visibility of the tile we are</span>
                        <span class="comment">\ processing, so this inserts that bit into the byte</span>
                        <span class="comment">\ we just fetched from the tileVisibility table</span>

 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a>,<span class="register">Y</span>   <span class="comment">\ Store the updated byte in the tileVisibility table so</span>
                        <span class="comment">\ it contains the visibility bit for the tile in column</span>
                        <span class="comment">\ X on row zTileRow</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the column number to move left to the next</span>
                        <span class="comment">\ tile in the row</span>

 <span class="mne">BPL</span> <a class="popup destination">tvis3</a>              <span class="comment">\ Loop back until we have processed all the tiles in the</span>
                        <span class="comment">\ row</span>

 <span class="mne">DEC</span> <a class="popup variable">zTileRow</a>           <span class="comment">\ Decrement zTileRow to move forward by one tile row</span>

 <span class="mne">BPL</span> <a class="popup destination">tvis2</a>              <span class="comment">\ Loop back until we have processed all the tile rows in</span>
                        <span class="comment">\ the landscape</span>

<span class="label">.tvis5</span><a id="tvis5" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-visibilebitmask" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">visibileBitMask</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">A table for converting a number in the range 0 to 7 into a bit</span>
             <span class="headerEntry">mask with only that bit set, when counting from the left</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/main/variable/visibilebitmask.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettileviewangles_part_3_of_4.html">GetTileViewAngles (Part 3 of 4)</a> uses <a href="#visibilebitmask">visibileBitMask</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilevisibility.html">GetTileVisibility</a> uses <a href="#visibilebitmask">visibileBitMask</a></span>
</div>
</div></div>
<span class="label">.visibileBitMask</span><a id="visibilebitmask" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="binary">%10000000</span>
 <span class="mne">EQUB</span> <span class="binary">%01000000</span>
 <span class="mne">EQUB</span> <span class="binary">%00100000</span>
 <span class="mne">EQUB</span> <span class="binary">%00010000</span>
 <span class="mne">EQUB</span> <span class="binary">%00001000</span>
 <span class="mne">EQUB</span> <span class="binary">%00000100</span>
 <span class="mne">EQUB</span> <span class="binary">%00000010</span>
 <span class="mne">EQUB</span> <span class="binary">%00000001</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getrowvisibility-part-1-of-2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetRowVisibility (Part 1 of 2)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set up the calculations to determine whether each tile corner in a</span>
             <span class="headerEntry">tile row is obscured from the player by any intervening landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getrowvisibility_part_1_of_2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/gettilevisibility.html">GetTileVisibility</a> calls <a href="#getrowvisibility">GetRowVisibility</a></span>
</div>
<hr class="light">
 This routine populates a specified table with the visibility of each tile
 corner in a row, populating the table with 32 entries as follows:

   * %00000000 if the tile corner is not visible from the player's position

   * %11111111 if the tile corner is visible from the player's position

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">zTileRow</span>             <span class="argumentEntry">The tile z-coordinate of the tile row to analyse</span>

   <span class="argumentLabel">drawingTableOffset</span>   <span class="argumentEntry">Defines where we store the results of the analysis:</span>

                        <span class="argumentEntry">  * oddVisibility when drawingTableOffset = 0</span>

                        <span class="argumentEntry">  * evenVisibility when drawingTableOffset = 32</span>

   <span class="argumentLabel">P</span>                    <span class="argumentEntry">P is always zero, so (Q P) is of the form &xx00</span>

   <span class="argumentLabel">R</span>                    <span class="argumentEntry">R is always &20, so (S R) is of the form &xx20</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">(Q P)</span>                <span class="argumentEntry">The address of the table that contains the altitude and</span>
                        <span class="argumentEntry">shape data for tile row zTileRow, like this:</span>

                        <span class="argumentEntry">  * (Q P) = &6000 + (zTileRow 0)</span>

</div></div>
<span class="label">.GetRowVisibility</span><a id="getrowvisibility" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">zTileRow</a>           <span class="comment">\ Set the high byte of (Q P) to &60 + zTileRow</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ This gives us the address where the GetTileAltitudes</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>                  <span class="comment">\ routine stored the altitude data for tile row zTileRow</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This works because we only ever call this routine with</span>
                        <span class="comment">\ P = 0, and row zTile = 0 is at &6000, row zTile = 1 is</span>
                        <span class="comment">\ at &6100 and so on</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set xTileRow = 31 so we start iterating from the right</span>
 <span class="mne">STA</span> <a class="popup variable">xTileRow</a>           <span class="comment">\ end of the current row (so xTileRow iterates from 31</span>
                        <span class="comment">\ to in the following loop)</span>

                        <span class="comment">\ We now loop through each tile corner in the row, from</span>
                        <span class="comment">\ right to left, in a loop that's split over part 1 and</span>
                        <span class="comment">\ part 2 (and which has an anti-cracker interlude in the</span>
                        <span class="comment">\ middle that has nothing to do with visibility checks)</span>

<span class="label">.rvis1</span><a id="rvis1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set T = 0, so we can use it to capture the longest</span>
 <span class="mne">STY</span> <a class="popup variable">T</a>                  <span class="comment">\ axis in the vector calculation below</span>

 <span class="mne">DEY</span>                    <span class="comment">\ Set traceStepCounter = 255, so we start off by tracing</span>
 <span class="mne">STY</span> <a class="popup variable">traceStepCounter</a>   <span class="comment">\ 255 steps (as the initial calculation calculates the</span>
                        <span class="comment">\ vector to trace by dividing the full vector from the</span>
                        <span class="comment">\ player to the tile corner by 256)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We may reduce the number of steps below to make the</span>
                        <span class="comment">\ process more efficient</span>

 <span class="mne">LDY</span> <a class="popup variable">xTileRow</a>           <span class="comment">\ Set yTileRow to the altitude of the tile corner we are</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ analysing</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">yTileRow</a>           <span class="comment">\ The value in the table at (Q P) contains the flatness</span>
                        <span class="comment">\ of the tile in bit 0 and the altitude of the tile</span>
                        <span class="comment">\ corner in bits 1-4, so we shift this value right by</span>
                        <span class="comment">\ one place to extract the altitude</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Fetch the cartesian coordinates of the player object</span>
 <span class="mne">JSR</span> <a class="popup destination">GetObjectCoords</a>    <span class="comment">\ as three 24-bit numbers, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xCoord(Hi Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   yCoord(Hi Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   zCoord(Hi Lo Bot)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ We now work through all three axes in turn, so set an</span>
                        <span class="comment">\ axis counter in X to iterate through 2, 1 and 0 (for</span>
                        <span class="comment">\ the z-axis, y-axis and x-axis respectively)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The comments in the following loop will concentrate on</span>
                        <span class="comment">\ the x-axis to keep things simple</span>

<span class="label">.rvis2</span><a id="rvis2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the high byte of (xVector yVector zVector), which</span>
 <span class="mne">STA</span> <a class="popup variable">xVectorHi</a>,<span class="register">X</span>        <span class="comment">\ we will use to store the vector from the player to the</span>
                        <span class="comment">\ tile corner</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set xVector(Lo Bot) =</span>
 <span class="mne">SBC</span> <a class="popup variable">xCoordLo</a>,<span class="register">X</span>         <span class="comment">\             ((xTileRow 0) - xCoord(Hi Lo)) / 256</span>
 <span class="mne">STA</span> <a class="popup variable">xVectorBot</a>,<span class="register">X</span>       <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">xTileRow</a>,<span class="register">X</span>         <span class="comment">\ So xVector(Lo Bot) contains the distance in the x-axis</span>
 <span class="mne">SBC</span> <a class="popup variable">xCoordHi</a>,<span class="register">X</span>         <span class="comment">\ from the player to the tile corner that we are</span>
 <span class="mne">STA</span> <a class="popup variable">xVectorLo</a>,<span class="register">X</span>        <span class="comment">\ analysing, divided by 256</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The "divided by 256" part is subtle and important</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We want to divide the vector from the player to the</span>
                        <span class="comment">\ tile corner into small steps, so we can move along the</span>
                        <span class="comment">\ vector sequentially, checking on each step whether the</span>
                        <span class="comment">\ vector is passing below ground level (in which case we</span>
                        <span class="comment">\ will know that the line of sight from the player to</span>
                        <span class="comment">\ the tile corner is obstructed by landscape)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The above calculation subtracts two high byte/low byte</span>
                        <span class="comment">\ 16-bit numbers in (xTileRow 0) and xCoord(Hi Lo) and</span>
                        <span class="comment">\ puts the result into a low byte/bottom byte 16-bit</span>
                        <span class="comment">\ number in xVector(Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the same as dividing the result of the</span>
                        <span class="comment">\ subtraction by 256, which we can see if we consider</span>
                        <span class="comment">\ that this would be the normal high/low calculation:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xVector(Hi Lo) =  (xTileRow 0) - xCoord(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and we also have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xVector(Lo Bot) = xVector(Hi Lo) / 256</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so we get:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xVector(Lo Bot)</span>
                        <span class="comment">\           = ((xTileRow 0) - xCoord(Hi Lo)) / 256</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Also, it's worth noting that this is the vector from</span>
                        <span class="comment">\ the player to the tile corner, because if you add this</span>
                        <span class="comment">\ vector to the player's coordinates 256 times, then you</span>
                        <span class="comment">\ get the tile corner's coordinates</span>

 <span class="mne">BPL</span> <a class="popup destination">rvis3</a>              <span class="comment">\ If the result is positive, jump to rvis3, with the low</span>
                        <span class="comment">\ byte of the result (xVectorLo) in A</span>

 <span class="mne">DEC</span> <a class="popup variable">xVectorHi</a>,<span class="register">X</span>        <span class="comment">\ The result is negative, so set xVectorHi to %11111111</span>
                        <span class="comment">\ so it can be used as the high byte for the negative</span>
                        <span class="comment">\ 24-bit number in xVector(Hi Lo Bot)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Negate the result as follows (note that we ignore the</span>
 <span class="mne">SEC</span>                    <span class="comment">\ bottom byte, as we are only interested in the low byte</span>
 <span class="mne">SBC</span> <a class="popup variable">xVectorBot</a>,<span class="register">X</span>       <span class="comment">\ of the result):</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xVectorLo</a>,<span class="register">X</span>        <span class="comment">\   (A *) = -xVector(Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this makes (A *) positive, to give this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (A *) = |xVectorLo xVectorBot|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the low byte of the result |xVectorLo| is in A</span>

<span class="label">.rvis3</span><a id="rvis3" class="anchor"></a>

                        <span class="comment">\ By this point we have the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * A = |xVectorLo|</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * xVectorHi is either 0 or %11111111, depending on</span>
                        <span class="comment">\     the sign of xVector(Lo Bot)</span>

 <span class="mne">CMP</span> <a class="popup variable">T</a>                  <span class="comment">\ If A >= T then set T = A, so T keeps a record of the</span>
 <span class="mne">BCC</span> <a class="popup destination">rvis4</a>              <span class="comment">\ largest value of |xVectorLo| across all three axes</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\</span>
                        <span class="comment">\ In other words, once we have finished looping through</span>
                        <span class="comment">\ all three axes, T will contain the magnitude of the</span>
                        <span class="comment">\ longest axis in the vector:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   T = max(|xVectorLo|, |yVectorLo|, |zVectorLo|)</span>

<span class="label">.rvis4</span><a id="rvis4" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the axis counter in X to move on to the next</span>
                        <span class="comment">\ axis</span>

 <span class="mne">BPL</span> <a class="popup destination">rvis2</a>              <span class="comment">\ Loop back until we have processed all three axes</span>

                        <span class="comment">\ At this point X is set to 255, which we use below when</span>
                        <span class="comment">\ checking the secret entry code in CheckSecretStash</span>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ If:</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\   T * 4 &lt; 6</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\</span>
 <span class="mne">BCC</span> <a class="popup destination">rvis10</a>             <span class="comment">\ then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   T &lt; 1.5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and:</span>
                        <span class="comment">\</span>
                        <span class="comment">\  max(|xVectorLo|, |yVectorLo|, |zVectorLo|) &lt; 1.5</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, if this is true, then the longest axis</span>
                        <span class="comment">\ of the vector from player to the tile corner is less</span>
                        <span class="comment">\ than 1.5 (where each tile is of size 1), so the tile</span>
                        <span class="comment">\ corner we are analysing is within 1.5 tile widths of</span>
                        <span class="comment">\ the player</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We automatically mark all these close-by tiles as</span>
                        <span class="comment">\ being potentially visible, so we jump to rvis10 with</span>
                        <span class="comment">\ the C flag clear to store &FF as the visibility result</span>
                        <span class="comment">\ (to record that this corner is potentially visible)</span>

                        <span class="comment">\ The next step is an optimisation</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We could trace the vector from the player to the tile</span>
                        <span class="comment">\ corner in steps of 256, but given that the landscape</span>
                        <span class="comment">\ is only 32 tile corners across in each direction, this</span>
                        <span class="comment">\ would mean that most of the time we would be stepping</span>
                        <span class="comment">\ along the vector while staying above the same tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Instead we can scale up the size of our steps and do</span>
                        <span class="comment">\ fewer of them, and as long as each individual step is</span>
                        <span class="comment">\ smaller than a tile width, we can still check every</span>
                        <span class="comment">\ landscape tile along the line of sight</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore double the value in A, which contains the</span>
                        <span class="comment">\ longest side of the vector, to be as high as possible</span>
                        <span class="comment">\ while still fitting into one byte (which represents a</span>
                        <span class="comment">\ fraction of a tile as it's the low byte of the vector)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At the same time we double the size of the vector by</span>
                        <span class="comment">\ doubling the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   xVector(Hi Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   yVector(Hi Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   zVector(Hi Lo Bot)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ though we don't actually need to shift the high bytes</span>
                        <span class="comment">\ as we won't be shifting data out of the low bytes and</span>
                        <span class="comment">\ they are either zero or %11111111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Because we have doubled the size of the vector, we</span>
                        <span class="comment">\ also halve the number of steps in traceStepCounter</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This reduces the number of steps in the ray-tracing</span>
                        <span class="comment">\ process as far as possible while keeping the size of</span>
                        <span class="comment">\ each step to less than one tile (so that the tracing</span>
                        <span class="comment">\ process still steps through each tile en route)</span>

<span class="label">.rvis5</span><a id="rvis5" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">xVectorBot</a>         <span class="comment">\ Double xVector(Lo Bot) to double the size of the</span>
 <span class="mne">ROL</span> <a class="popup variable">xVectorLo</a>          <span class="comment">\ vector</span>
 <span class="mne">ASL</span> <a class="popup variable">yVectorBot</a>
 <span class="mne">ROL</span> <a class="popup variable">yVectorLo</a>
 <span class="mne">ASL</span> <a class="popup variable">zVectorBot</a>
 <span class="mne">ROL</span> <a class="popup variable">zVectorLo</a>

 <span class="mne">LSR</span> <a class="popup variable">traceStepCounter</a>   <span class="comment">\ Halve traceStepCounter to halve the number of steps in</span>
                        <span class="comment">\ the tracing process</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift A to the left to shift bit 7 into the C flag, to</span>
                        <span class="comment">\ detect when A is as big as it can be within one byte</span>

 <span class="mne">BCC</span> <a class="popup destination">rvis5</a>              <span class="comment">\ Loop back to repeat the above scalings until we have</span>
                        <span class="comment">\ scaled up the vector as much as we can</span>

                        <span class="comment">\ So xVector(Hi Lo Bot) now contains the vector from the</span>
                        <span class="comment">\ player to the tile corner, divided by 256 and scaled</span>
                        <span class="comment">\ up as far as possible while still keeping the vector</span>
                        <span class="comment">\ within the dimensions of a tile, and traceStepCounter</span>
                        <span class="comment">\ contains the number of times this vector fits into the</span>
                        <span class="comment">\ original vector from the player to the tile corner</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can therefore trace the vector from the player to</span>
                        <span class="comment">\ the tile corner by taking the player's coordinates and</span>
                        <span class="comment">\ adding the xVector(Hi Lo Bot) vector traceStepCounter</span>
                        <span class="comment">\ times, knowing that together, these steps will stop</span>
                        <span class="comment">\ over every tile between the player and the tile corner</span>
                        <span class="comment">\ in the process (we may stop over some tiles more than</span>
                        <span class="comment">\ once, but that's OK)</span>

 <span class="mne">LDA</span> <a class="popup variable">zCoordHi</a>           <span class="comment">\ Set zCoordHi = zCoordHi + &60</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ This sets zCoordHi to the high byte of the address for</span>
 <span class="mne">STA</span> <a class="popup variable">zCoordHi</a>           <span class="comment">\ the extracted altitude data for the tile row on which</span>
                        <span class="comment">\ the player is standing (as zCoordHi is the integer</span>
                        <span class="comment">\ part of the player's z-coordinate, which is the number</span>
                        <span class="comment">\ of the row containing the player)</span>

                        <span class="comment">\ We now have a short interlude to check the secret code</span>
                        <span class="comment">\ stash, as part of the game's anti-cracker code, and we</span>
                        <span class="comment">\ pick up the tile visibility code in part 2</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-checksecretstash" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">CheckSecretStash</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Check whether the secret code stash is correctly set up, as part</span>
             <span class="headerEntry">of the anti-cracker code</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/checksecretstash.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.CheckSecretStash</span><a id="checksecretstash" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">doNotCheckSecret</a>   <span class="comment">\ If bit 7 of doNotCheckSecret is set then jump down to</span>
 <span class="mne">BMI</span> <a class="popup destination">stas2</a>              <span class="comment">\ part 2 of GetRowVisibility to skip checking the secret</span>
                        <span class="comment">\ code stash</span>

                        <span class="comment">\ The following code does a check on the secret entry</span>
                        <span class="comment">\ code for the current landscape to ensure that it</span>
                        <span class="comment">\ matches the entered code in the keyboard input buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the check fails, then the game restarts by jumping</span>
                        <span class="comment">\ to MainTitleLoop to display the title screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, the following code checks for four bytes</span>
                        <span class="comment">\ in the secretCodeStash that correspond to the results</span>
                        <span class="comment">\ of the comparisons made in the CheckSecretCode routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that crackers who manage to bypass the</span>
                        <span class="comment">\ CheckSecretCode routine will find that the game</span>
                        <span class="comment">\ restarts, unless they also disable this rather</span>
                        <span class="comment">\ well-hidden check</span>

 <span class="mne">LDA</span> <a class="popup variable">stashOffset</a><span class="operator">-</span><span class="decimal">255</span>,<span class="register">X</span>  <span class="comment">\ We know that X is 255 from the loop above, so this</span>
                        <span class="comment">\ sets A = stashOffset</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value of stashOffset is set in the SetSecretStash</span>
                        <span class="comment">\ routine during the landscape drawing process, where it</span>
                        <span class="comment">\ is set to a value that is unique and consistent for</span>
                        <span class="comment">\ each individual landscape</span>

                        <span class="comment">\ We now set stashAddr(1 0) to point to the four bytes</span>
                        <span class="comment">\ in the secretCodeStash that correspond to the four</span>
                        <span class="comment">\ comparisons we made for the secret entry code in the</span>
                        <span class="comment">\ CheckSecretCode routine</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set stashAddr = A + 41</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">41</span>                <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">stashAddr</a>          <span class="comment">\ So that's the low byte</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set X = 3 so we can use it to count four bytes in the</span>
                        <span class="comment">\ loop below (as well as in the following calculation)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set stashAddr+1 = HI(secretCodeStash) - 3 + 3</span>
 <span class="mne">CLC</span>                    <span class="comment">\                 = HI(secretCodeStash)</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">secretCodeStash</a><span class="bracket">)</span> <span class="operator">-</span> <span class="decimal">3</span>
 <span class="mne">STA</span> <a class="popup variable">stashAddr</a><span class="operator">+</span><span class="decimal">1</span>

                        <span class="comment">\ So we now have the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   stashAddr(1 0) = secretCodeStash + stashOffset + 41</span>
                        <span class="comment">\</span>
                        <span class="comment">\ When the secretCodeStash gets populated in the</span>
                        <span class="comment">\ CheckSecretCode routine, we add one byte for each</span>
                        <span class="comment">\ iteration and comparison in the secret code generation</span>
                        <span class="comment">\ process</span>
                        <span class="comment">\</span>
                        <span class="comment">\ That process starts by performing 38 iterations and</span>
                        <span class="comment">\ storing the results in the secretCodeStash from offset</span>
                        <span class="comment">\ stashOffset to stashOffset + 37</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It then generates the four BCD numbers that make up</span>
                        <span class="comment">\ the secret code, storing the results in the stash from</span>
                        <span class="comment">\ offset stashOffset + 38 to stashOffset + 41</span>
                        <span class="comment">\</span>
                        <span class="comment">\ (And it then generates one more result, but we ignore</span>
                        <span class="comment">\ that)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So stashAddr(1 0) points to the last of those bytes in</span>
                        <span class="comment">\ the secretCodeStash, i.e. the byte at stashOffset + 41</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value that is stashed in the secretCodeStash is</span>
                        <span class="comment">\ the result of subtracting the entered code from the</span>
                        <span class="comment">\ generated code, which will be zero if they match, and</span>
                        <span class="comment">\ then %01111111 is added to the result (%01111111 being</span>
                        <span class="comment">\ the object flags for the Sentinel, which is all part</span>
                        <span class="comment">\ of the obfuscation of this process)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if the secretCodeStash contains %01111111, this</span>
                        <span class="comment">\ means that particular byte matched, so if all four</span>
                        <span class="comment">\ bytes at offset stashOffset + 38 to stashOffset + 41</span>
                        <span class="comment">\ equal %01111111, this means the secret code was deemed</span>
                        <span class="comment">\ correct by CheckSecretCode</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 so we can fetch a value from the address in</span>
                        <span class="comment">\ stashAddr(1 0) in the following (we don't change its</span>
                        <span class="comment">\ value)</span>

                        <span class="comment">\ We use X as the loop counter to work through all four</span>
                        <span class="comment">\ bytes, as we set it to 3 above</span>

<span class="label">.stas1</span><a id="stas1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">stashAddr</a><span class="bracket">)</span>,<span class="register">Y</span>      <span class="comment">\ Fetch the contents of address stashAddr(1 0)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%01111111</span>         <span class="comment">\ If it does not match %01111111 then this byte from the</span>
 <span class="mne">BNE</span> <a class="popup destination">talt2</a>              <span class="comment">\ secret code was not matched by the CheckSecretCode</span>
                        <span class="comment">\ routine (so it must have been bypassed by crackers),</span>
                        <span class="comment">\ so jump to MainTitleLoop via talt2 to restart the game</span>

 <span class="mne">DEC</span> <a class="popup variable">stashAddr</a>          <span class="comment">\ Decrement stashAddr(1 0) to point to the previous byte</span>
                        <span class="comment">\ in memory (we decrement as we initialised stashAddr</span>
                        <span class="comment">\ above to point to the last result byte in memory, so</span>
                        <span class="comment">\ this moves on to the next of the four bytes)</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">stas1</a>              <span class="comment">\ Loop back until we have checked all four secret code</span>
                        <span class="comment">\ bytes</span>

                        <span class="comment">\ The four code bytes have now been checked, but we have</span>
                        <span class="comment">\ one more check to do, that of the comparison just</span>
                        <span class="comment">\ before the four bytes</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This comparison would have been between inputBuffer+4</span>
                        <span class="comment">\ and a BCD number from the landscape's sequence of seed</span>
                        <span class="comment">\ numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ When the landscape code is entered, it is converted</span>
                        <span class="comment">\ into four BCD numbers in inputBuffer, and the rest of</span>
                        <span class="comment">\ the buffer is padded out with &FF, so inputBuffer+4</span>
                        <span class="comment">\ contains &FF at the point of comparison</span>
                        <span class="comment">\</span>
                        <span class="comment">\ &FF is not a valid BCD number, so it can never match a</span>
                        <span class="comment">\ BCD number from the landscape's sequence of seed</span>
                        <span class="comment">\ numbers, so we know that this comparison can never</span>
                        <span class="comment">\ have matched</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if stashAddr(1 0) contains %01111111 to indicate a</span>
                        <span class="comment">\ match, then we know that the stash has been modified</span>
                        <span class="comment">\ by a cracker, so we restart the game</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">stashAddr</a><span class="bracket">)</span>,<span class="register">Y</span>      <span class="comment">\ Fetch the contents of address stashAddr(1 0)</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%01111111</span>         <span class="comment">\ If it matches %01111111 then we know the stash has</span>
 <span class="mne">BEQ</span> <a class="popup destination">talt2</a>              <span class="comment">\ been compromised, so jump to MainTitleLoop via talt2</span>
                        <span class="comment">\ to restart the game</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of doNotCheckSecret so we do not repeat the</span>
 <span class="mne">ROR</span> <a class="popup variable">doNotCheckSecret</a>   <span class="comment">\ secret code check again (at least, until we reach the</span>
                        <span class="comment">\ next landscape)</span>

<span class="label">.stas2</span><a id="stas2" class="anchor"></a>

                        <span class="comment">\ Fall through into part 2 of GetRowVisibility to</span>
                        <span class="comment">\ continue with the visibility calculations</span>


<div class="headerBlockWrapper"><div class="headerBlock"><a id="header-getrowvisibility-part-2-of-2" class="anchor"></a><span class="headerLabel">       Name:</span> <span class="headerEntry">GetRowVisibility (Part 2 of 2)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate whether each tile corner in a tile row is obscured from</span>
             <span class="headerEntry">the player by any intervening landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/main/subroutine/getrowvisibility_part_2_of_2.html">on its own page</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ In part 1 we set up xVector(Hi Lo Bot) with the vector</span>
                        <span class="comment">\ from the player to the tile corner, split up into</span>
                        <span class="comment">\ traceStepCounter steps, each of which is smaller than</span>
                        <span class="comment">\ the size of a tile</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can therefore trace the vector from the player to</span>
                        <span class="comment">\ the tile corner by taking the player's coordinates and</span>
                        <span class="comment">\ adding the vector:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   [ xVector(Hi Lo Bot) ]</span>
                        <span class="comment">\   [ yVector(Hi Lo Bot) ]</span>
                        <span class="comment">\   [ zVector(Hi Lo Bot) ]</span>
                        <span class="comment">\</span>
                        <span class="comment">\ traceStepCounter times, knowing that together, these</span>
                        <span class="comment">\ steps will stop over every tile between the player and</span>
                        <span class="comment">\ the tile corner in the process (we may stop over some</span>
                        <span class="comment">\ tiles more than once, but that's OK)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ I'll refer to this vector as the player's gaze, as it</span>
                        <span class="comment">\ represents the line-of-sight from the player to the</span>
                        <span class="comment">\ tile corner we are analysing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So now we step along the player's gaze, checking on</span>
                        <span class="comment">\ each step whether the gaze is passing over a tile that</span>
                        <span class="comment">\ has a high enough altitude to block the player's view</span>
                        <span class="comment">\ of the tile corner we are analysing</span>

<span class="label">.rvis6</span><a id="rvis6" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ We now work through all three axes in turn, so set an</span>
                        <span class="comment">\ axis counter in X to iterate through 2, 1 and 0 (for</span>
                        <span class="comment">\ the z-axis, y-axis and x-axis respectively)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The comments in the following loop will concentrate on</span>
                        <span class="comment">\ the x-axis to keep things simple</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the initial addition at rvis8 will</span>
                        <span class="comment">\ start properly</span>

 <span class="mne">BCC</span> <a class="popup destination">rvis8</a>              <span class="comment">\ Jump into the following loop at rvis8 so we start off</span>
                        <span class="comment">\ that calculations with the z-axis and skip the bottom</span>
                        <span class="comment">\ byte</span>

<span class="label">.rvis7</span><a id="rvis7" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xCoordBot</a>,<span class="register">X</span>        <span class="comment">\ For the y-axis calculation, we include the bottom byte</span>
 <span class="mne">ADC</span> <a class="popup variable">xVectorBot</a>,<span class="register">X</span>       <span class="comment">\ for more accuracy, so we calculate the following:</span>
 <span class="mne">STA</span> <a class="popup variable">xCoordBot</a>,<span class="register">X</span>        <span class="comment">\</span>
                        <span class="comment">\   xCoord(Hi Lo Bot) += xVector(Hi Lo Bot)</span>

<span class="label">.rvis8</span><a id="rvis8" class="anchor"></a>

                        <span class="comment">\ This is where we join the loop to add the next step to</span>
                        <span class="comment">\ the vector containing the current position along the</span>
                        <span class="comment">\ player's gaze towards the tile corner we're analysing</span>

 <span class="mne">LDA</span> <a class="popup variable">xCoordLo</a>,<span class="register">X</span>         <span class="comment">\ Set xCoord(Hi Lo) += xVector(Hi Lo)</span>
 <span class="mne">ADC</span> <a class="popup variable">xVectorLo</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">xCoordLo</a>,<span class="register">X</span>
 <span class="mne">LDA</span> <a class="popup variable">xCoordHi</a>,<span class="register">X</span>
 <span class="mne">ADC</span> <a class="popup variable">xVectorHi</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">xCoordHi</a>,<span class="register">X</span>

                        <span class="comment">\ The calculation above adds the scaled vector from the</span>
                        <span class="comment">\ player to the tile corner, which is in xVector, to the</span>
                        <span class="comment">\ player's object coordinate, which is in xCoord</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this calculation effectively follows the player's</span>
                        <span class="comment">\ gaze towards the tile corner, adding one of the steps</span>
                        <span class="comment">\ to the vector x-coordinate in xVector(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We repeat this for all three axes, calculating the</span>
                        <span class="comment">\ x- and z-axes with 16-bit accuracy, and the y-axis</span>
                        <span class="comment">\ with 24-bit accuracy (as y-coordinates are stored in</span>
                        <span class="comment">\ this way)</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so the following additions work</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the axis counter</span>

 <span class="mne">BEQ</span> <a class="popup destination">rvis8</a>              <span class="comment">\ If we are just about to calculate the x-axis, jump</span>
                        <span class="comment">\ back to rvis8 to skip the bottom byte</span>

 <span class="mne">BPL</span> <a class="popup destination">rvis7</a>              <span class="comment">\ If we are about to calculate the y-axis, jump back to</span>
                        <span class="comment">\ rvis7 to include the bottom byte</span>

                        <span class="comment">\ We now work out whether this step has made the</span>
                        <span class="comment">\ player's gaze pass over a tile that is high enough to</span>
                        <span class="comment">\ block the player's view of the tile corner that we are</span>
                        <span class="comment">\ heading for</span>

 <span class="mne">LDA</span> <a class="popup variable">zCoordHi</a>           <span class="comment">\ Set the top byte of (S R) to the high byte of the</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\ z-coordinate of our current step along gaze vector</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Because we added &60 to the starting z-coordinate in</span>
                        <span class="comment">\ part 1, this will point to the &xx20 table of altitude</span>
                        <span class="comment">\ data for the tile row over which the gaze is passing</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The GetTileAltitude routine populates the &xx20 table</span>
                        <span class="comment">\ with the altitude of the highest tile corner for each</span>
                        <span class="comment">\ tile, so (S R) now points to this data for the row</span>
                        <span class="comment">\ over which we are passing</span>

 <span class="mne">LDY</span> <a class="popup variable">xCoordHi</a>           <span class="comment">\ Set Y to the high byte of the x-coordinate of our</span>
                        <span class="comment">\ current step along gaze vector, which is the tile</span>
                        <span class="comment">\ x-coordinate of the tile that the gaze vector is</span>
                        <span class="comment">\ currently passing over</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This means that (S R) + Y will contain the altitude</span>
                        <span class="comment">\ of the highest tile corner for the tile that we are</span>
                        <span class="comment">\ passing over</span>

 <span class="mne">LDA</span> <a class="popup variable">yCoordHi</a>           <span class="comment">\ Set A to the high byte of the y-coordinate of our</span>
                        <span class="comment">\ current step along gaze vector</span>

 <span class="mne">CMP</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ If yCoordHi &lt; (S R) + Y then the altitude of the gaze</span>
 <span class="mne">BCC</span> <a class="popup destination">rvis9</a>              <span class="comment">\ vector is lower than the altitude of the highest point</span>
                        <span class="comment">\ of the landscape on the tile over which we are</span>
                        <span class="comment">\ passing, which means the gaze vector has hit the</span>
                        <span class="comment">\ landscape before reaching the end</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So jump to rvis9 to record that this tile corner is</span>
                        <span class="comment">\ not visible from the player's perspective, as it is</span>
                        <span class="comment">\ hidden behind a higher part of the landscape between</span>
                        <span class="comment">\ the player and the tile corner</span>

 <span class="mne">DEC</span> <a class="popup variable">traceStepCounter</a>   <span class="comment">\ Otherwise decrement the step counter to keep moving</span>
                        <span class="comment">\ along the vector</span>

 <span class="mne">BNE</span> <a class="popup destination">rvis6</a>              <span class="comment">\ If we haven't yet done all the steps, loop back to</span>
                        <span class="comment">\ rvis6 to do the next step in the ray-trace</span>

                        <span class="comment">\ If we get here then we have finished the ray-tracing</span>
                        <span class="comment">\ process and we didn't bump into any tiles on the way,</span>
                        <span class="comment">\ so the tile corner is not obscured by the landscape</span>
                        <span class="comment">\ and is therefore deemed to be visible</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag so we store %11111111 in the</span>
                        <span class="comment">\ visibility table to indicate that this tile corner is</span>
                        <span class="comment">\ visible</span>

 <span class="mne">BCC</span> <a class="popup destination">rvis10</a>             <span class="comment">\ Jump to rvis10 to store the result (this BCC is</span>
                        <span class="comment">\ effectively a JMP as the C flag is always clear)</span>

<span class="label">.rvis9</span><a id="rvis9" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag so we store %00000000 in the visibility</span>
                        <span class="comment">\ table to indicate that this tile corner is not visible</span>

<span class="label">.rvis10</span><a id="rvis10" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTileRow</a>           <span class="comment">\ Set Y = drawingTableOffset + xTileRow</span>
 <span class="mne">ORA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\</span>
 <span class="mne">TAY</span>                    <span class="comment">\ The value of drawingTableOffset is either 0 or 32, so</span>
                        <span class="comment">\ this creates an index in Y that we can use to store</span>
                        <span class="comment">\ the result in either oddVisibility (when it is 0) or</span>
                        <span class="comment">\ evenVisibility when it is 32)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 - 0 - (1 - C)</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\       = C - 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so this sets:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * A = %00000000 if the C flag is set (not visible)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * A = %11111111 if the C flag is clear (visible)</span>

 <span class="mne">STA</span> <a class="popup variable">oddVisibility</a>,<span class="register">Y</span>    <span class="comment">\ Store the result in either the oddVisibility or</span>
                        <span class="comment">\ evenVisibility table, as determined by the value of</span>
                        <span class="comment">\ drawingTableOffset</span>

 <span class="mne">DEC</span> <a class="popup variable">xTileRow</a>           <span class="comment">\ Decrement xTileRow to move left along the tile row we</span>
                        <span class="comment">\ are analysing</span>

 <span class="mne">BMI</span> <a class="popup destination">rvis11</a>             <span class="comment">\ If we have already processed the leftmost tile then</span>
                        <span class="comment">\ jump to rvis11 to return from the subroutine</span>

 <span class="mne">JMP</span> <a class="popup destination">rvis1</a>              <span class="comment">\ Otherwise jump back to part 1 to analyse the next tile</span>
                        <span class="comment">\ to the left</span>

<span class="label">.rvis11</span><a id="rvis11" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>


</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-configureobjbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-configureobjbuffer">ConfigureObjBuffer</a> (category: Screen buffer)</div><div class="summary">Set up the variables required to configure the screen buffer for updating an object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-deleteobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-deleteobject">DeleteObject</a> (category: 3D objects)</div><div class="summary">Delete an object, removing it from the landscape and vacating its object number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherscreenbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">DitherScreenBuffer</a> (category: Screen buffer)</div><div class="summary">Dither the contents of the screen buffer onto the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscapeview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-drawlandscapeview-part-1-of-3">DrawLandscapeView (Part 1 of 3)</a> (category: Drawing the landscape)</div><div class="summary">Set up a number of variables for drawing the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-drawobject">DrawObject</a> (category: Drawing objects)</div><div class="summary">Draw a 3D object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-drawsights">DrawSights</a> (category: Sights)</div><div class="summary">Draw the sights on the screen, saving the existing screen contents in the sights pixel byte stash</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fillscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a> (category: Graphics)</div><div class="summary">Fill a rectangular in screen memory or the screen buffer with the specified background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-focusonkeyaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-focusonkeyaction">FocusOnKeyAction</a> (category: Keyboard)</div><div class="summary">Tell the game to start focusing effort on the action that has been initiated, such as a pan of the landscape, absorb, transfer etc.</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseednumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_f.html#header-getnextseednumber">GetNextSeedNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a seed number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getobjvisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a> (category: Gameplay)</div><div class="summary">Calculate whether any part of an object is visible on-screen, and if so, which character columns it spans on the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getobjectangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-getobjectangles">GetObjectAngles</a> (category: 3D objects)</div><div class="summary">Calculate the angles and distances of the vector from the viewer to a specific object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getobjectcoords"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-getobjectcoords">GetObjectCoords</a> (category: 3D objects)</div><div class="summary">Get an object's coordinates</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getpitchangledelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_i.html#header-getpitchangledelta">GetPitchAngleDelta</a> (category: Maths (Geometry))</div><div class="summary">Calculate the pitch angle of a vector relative to an object's pitch angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getrowvisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-1-of-2">GetRowVisibility (Part 1 of 2)</a> (category: Drawing the landscape)</div><div class="summary">Set up the calculations to determine whether each tile corner in a tile row is obscured from the player by any intervening landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettilealtitudes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a> (category: Drawing the landscape)</div><div class="summary">Calculate tile corner altitudes and maximum tile corner altitudes for each tile in the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_e.html#header-gettiledata">GetTileData</a> (category: Landscape)</div><div class="summary">Get the tile data and tile data address for a specific tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-p"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#p">P</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-placeobjectbelow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_b.html#header-placeobjectbelow">PlaceObjectBelow</a> (category: 3D objects)</div><div class="summary">Attempt to place an object on a tile that is below the maximum altitude specified in A</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playmusic"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_j.html#header-playmusic">PlayMusic</a> (category: Sound)</div><div class="summary">Play a piece of music</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processsound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-processsound">ProcessSound</a> (category: Sound)</div><div class="summary">Process any sound effects that have been configured so they play in the background (this is called regularly throughout gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-q"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#q">Q</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-r"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#r">R</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-removesights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-removesights">RemoveSights</a> (category: Sights)</div><div class="summary">Remove the sights from the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-s"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#s">S</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setbufferaddress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-setbufferaddress">SetBufferAddress</a> (category: Screen buffer)</div><div class="summary">Set screenBufferAddr(1 0) to the address from which the interrupt handler should fetch new content to scroll onto the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-showscreenbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_g.html#header-showscreenbuffer">ShowScreenBuffer</a> (category: Screen buffer)</div><div class="summary">Update the player's scrolling landscape view by copying the relevant parts of the screen buffer into screen memory</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-spawnobject">SpawnObject</a> (category: 3D objects)</div><div class="summary">Add a new object of the specified type to the objectTypes table</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#t">T</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#u">U</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateplayerenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_d.html#header-updateplayerenergy">UpdatePlayerEnergy</a> (category: Gameplay)</div><div class="summary">Update the player's energy levels by adding or subtracting the amount of energy in a specific object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-v"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#v">V</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-w"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#w">W</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-anglehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#anglehi">angleHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The low byte of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-anglelo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#anglelo">angleLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The high byte of an angle</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-backgroundeven"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-backgroundeven">backgroundEven</a> (category: Graphics)</div><div class="summary">Pixel bytes for even pixel rows in the screen background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-backgroundodd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-backgroundodd">backgroundOdd</a> (category: Graphics)</div><div class="summary">Pixel bytes for odd pixel rows in the screen background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#bitmask">bitMask</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Used to return a bit mask from the GetTilesAtAltitude routine that has a matching number of leading zeroes as the number of tile blocks at a specific altitude</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-blendpolygonedges"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#blendpolygonedges">blendPolygonEdges</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to determine whether polygon edges are drawn in the same colour as the polygon fill, thus blending the edges into the polygon body</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffercolumns"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#buffercolumns">bufferColumns</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of character columns in the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferrowaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-bufferrowaddrhi">bufferRowAddrHi</a> (category: Screen buffer)</div><div class="summary">Address lookup table for character rows in the screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferrowaddrlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-bufferrowaddrlo">bufferRowAddrLo</a> (category: Screen buffer)</div><div class="summary">Address lookup table for character rows in the screen buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffersoffsethi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-buffersoffsethi">buffersOffsetHi</a> (category: Screen buffer)</div><div class="summary">An offset to add to the address of the right column screen buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffersoffsetlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-buffersoffsetlo">buffersOffsetLo</a> (category: Screen buffer)</div><div class="summary">An offset to add to the address of the right column screen buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-colourpixels"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-colourpixels">colourPixels</a> (category: Graphics)</div><div class="summary">A table that maps logical colours 0 to 3 to a four-pixel byte in that colour</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-columncounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#columncounter">columnCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter for the number of columns to fill in the FillScreen routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-currentobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#currentobject">currentObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the object we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-currentpixelbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#currentpixelbyte">currentPixelByte</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The original contents of the screen behind the right edge of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-delo1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#delo1">delo1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-deleteobject">DeleteObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-delo2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#delo2">delo2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-deleteobject">DeleteObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherobjectsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ditherobjectsights">ditherObjectSights</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Configures how an updated object is drawn onto the screen in the DrawUpdatedObject routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherouterloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-ditherouterloop">ditherOuterLoop</a> (category: Screen buffer)</div><div class="summary">A counter for the inner loop when dithering objects to the screen in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotchecksecret"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotchecksecret">doNotCheckSecret</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to control whether we perform the secret code check that's buried in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotditherobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotditherobject">doNotDitherObject</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the DitherScreenBuffer routine can update an object on the screen using a dithered effect</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotdrawsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotdrawsights">doNotDrawSights</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that controls whether we draw the sights in the DrawSights routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotplaylandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#donotplaylandscape">doNotPlayLandscape</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag that controls whether we preview and play the landscape after generating it</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol1">dpol1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-1-of-4">DrawPolygonLines (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol10">dpol10</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol11">dpol11</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol12">dpol12</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol13">dpol13</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-3-of-4">DrawPolygonLines (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol14">dpol14</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-3-of-4">DrawPolygonLines (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol15">dpol15</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-3-of-4">DrawPolygonLines (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol16">dpol16</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-3-of-4">DrawPolygonLines (Part 3 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol17">dpol17</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-4-of-4">DrawPolygonLines (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol18">dpol18</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-4-of-4">DrawPolygonLines (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol19">dpol19</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-4-of-4">DrawPolygonLines (Part 4 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol2">dpol2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-1-of-4">DrawPolygonLines (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol3">dpol3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol4">dpol4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol5">dpol5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol6">dpol6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol7">dpol7</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol8">dpol8</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#dpol9">dpol9</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-2-of-4">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#drawlandscape">drawLandscape</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Configures whether to draw the landscape behind the object in the DrawUpdatedObject routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtableoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#drawingtableoffset">drawingTableOffset</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The offset to use within the various drawing data tables for the tile we are analysing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edgepixelsleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-edgepixelsleft">edgePixelsLeft</a> (category: Drawing polygons)</div><div class="summary">Table to convert a polygon colours byte and a pixel offset (0-3) into a pixel byte for the left edge of the polygon pixel line</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edgepixelsright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-edgepixelsright">edgePixelsRight</a> (category: Drawing polygons)</div><div class="summary">Table to convert a polygon colours byte and a pixel offset (0-3) into a pixel byte for the right edge of the polygon pixel line</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-evenvisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#evenvisibility">evenVisibility</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">The visibility of tiles corners in even rows as they are processed by the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fill1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#fill1">fill1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fill2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#fill2">fill2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fill3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#fill3">fill3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fill4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#fill4">fill4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fill5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#fill5">fill5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fill6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#fill6">fill6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-fillscreen">FillScreen</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fillrownumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#fillrownumber">fillRowNumber</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the character row we are currently filling in the FillScreen routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hyperspaceendsgame"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#hyperspaceendsgame">hyperspaceEndsGame</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Records whether the player performing a hyperspace has just ended the game</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#hypr1">hypr1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-performhyperspace">PerformHyperspace</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#hypr2">hypr2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-performhyperspace">PerformHyperspace</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#hypr3">hypr3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-performhyperspace">PerformHyperspace</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#hypr4">hypr4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-performhyperspace">PerformHyperspace</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-lastpankeypressed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#lastpankeypressed">lastPanKeyPressed</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The direction of the last pan key that was pressed (which may not still be held down)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-leftpixels"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-leftpixels">leftPixels</a> (category: Graphics)</div><div class="summary">Pixel byte with all the pixels to the right of position X + 1 set, to give the complementary pixel byte to pixelsToRight</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-loopcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#loopcounter">loopCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A general-purpose loop counter</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxc1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#maxc1">maxc1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-checkfortilecentre">CheckForTileCentre</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxc2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#maxc2">maxc2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-checkfortilecentre">CheckForTileCentre</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxc3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#maxc3">maxc3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-checkfortilecentre">CheckForTileCentre</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-minobjwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#minobjwidth">minObjWidth</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The on-screen width to use when updating objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-morecolumnstofill"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#morecolumnstofill">moreColumnsToFill</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Stores the number of extra columns we need to fill in the FillScreen routine after filling up to 32 columns</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-objscreenaddr">objScreenAddr</a> (category: Screen buffer)</div><div class="summary">The screen address of the object we are updating</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objyawoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objyawoffset">objYawOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw offset of the left edge of the object being analysed in GetObjVisibility, relative to the left edge of the screen, in on-screen character columns</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objyawwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objyawwidth">objYawWidth</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The width of the visible portion of the object being analysed in GetObjVisibility, in on-screen character columns</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectflags"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectflags">objectFlags</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">Object flags for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecthalfwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-objecthalfwidth">objectHalfWidth</a> (category: Gameplay)</div><div class="summary">Each object's width in terms of tile widths, for half the object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#objectpitchangle">objectPitchAngle</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">The pitch angle for each object (i.e. the vertical direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectstackcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectstackcounter">objectStackCounter</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A counter for the objects in an object stack, for use when drawing the stack</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objecttype">objectType</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The type of object that we are spawning</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttypeenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-objecttypeenergy">objectTypeEnergy</a> (category: 3D objects)</div><div class="summary">The amount of energy required to create each object or the amount energy acquired when absorbing each object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objecttypes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objecttypes">objectTypes</a> (category: 3D objects)</div><div class="summary">The object types table for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectviewyawhi">objectViewYawHi</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw angle of the object being analysed, relative to the current viewer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectviewyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#objectviewyawlo">objectViewYawLo</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The yaw angle of the object being analysed, relative to the current viewer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectyawangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-objectyawangle">objectYawAngle</a> (category: 3D objects)</div><div class="summary">The yaw angle for each object (i.e. the horizontal direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objt1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objt1">objt1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objt2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objt2">objt2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objt3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objt3">objt3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objt4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objt4">objt4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objt5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objt5">objt5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objt6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objt6">objt6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-placeobjectontile">PlaceObjectOnTile</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objv1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objv1">objv1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objv2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objv2">objv2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objv3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objv3">objv3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objv4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objv4">objv4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objv5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objv5">objv5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objv6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#objv6">objv6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getobjvisibility">GetObjVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-oddvisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#oddvisibility">oddVisibility</a> in workspace <a href="/source/all/workspaces.html#header-stack-variables">Stack variables</a></div><div class="summary">The visibility of tiles corners in odd rows as they are processed by the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelstoleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-pixelstoleft">pixelsToLeft</a> (category: Graphics)</div><div class="summary">Pixel byte with all the pixels to the left of position X set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelstoright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-pixelstoright">pixelsToRight</a> (category: Graphics)</div><div class="summary">Pixel byte with all the pixels to the right of position X set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playerenergy">playerEnergy</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The player's energy level (in the range 0 to 63)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerhasmovedtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#playerhasmovedtile">playerHasMovedTile</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record whether the player has moved to a new tile by transferring or hyperspacing, so we can decide whether to regenerate the player's landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#playerobject">playerObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the player object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygoncolours"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygoncolours">polygonColours</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The colours of the polygon that's being drawn in the DrawPolygon routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonfillpixels"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygonfillpixels">polygonFillPixels</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A pixel byte containing four pixels set to the fill colour for the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygongoesleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygongoesleft">polygonGoesLeft</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A flag to record whether the polygon we are drawing extends to the left of the screen buffer we are drawing in</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygongoesright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#polygongoesright">polygonGoesRight</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A flag to record whether the polygon we are drawing extends to the right of the screen buffer we are drawing in</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis1">rvis1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-1-of-2">GetRowVisibility (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis10">rvis10</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-2-of-2">GetRowVisibility (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis11">rvis11</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-2-of-2">GetRowVisibility (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis2">rvis2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-1-of-2">GetRowVisibility (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis3">rvis3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-1-of-2">GetRowVisibility (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis4">rvis4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-1-of-2">GetRowVisibility (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis5">rvis5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-1-of-2">GetRowVisibility (Part 1 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis6">rvis6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-2-of-2">GetRowVisibility (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis7">rvis7</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-2-of-2">GetRowVisibility (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis8">rvis8</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-2-of-2">GetRowVisibility (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rvis9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#rvis9">rvis9</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-getrowvisibility-part-2-of-2">GetRowVisibility (Part 2 of 2)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbackground"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#screenbackground">screenBackground</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The type of screen background when clearing the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbuffertype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenbuffertype">screenBufferType</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The type of screen buffer that is currently being used</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenorbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenorbuffer">screenOrBuffer</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Controls whether the graphics routines draw directly onto the screen, or into the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenrowaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-screenrowaddrhi">screenRowAddrHi</a> (category: Graphics)</div><div class="summary">Address lookup table for character rows in screen memory (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenrowaddrlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-screenrowaddrlo">screenRowAddrLo</a> (category: Screen buffer)</div><div class="summary">Address lookup table for character rows in screen memory (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenrowcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#screenrowcounter">screenRowCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A counter for filling screen rows in the FillScreen routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-secretcodestash"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/all/the_sentinel_h.html#header-secretcodestash">secretCodeStash</a> (category: Landscape)</div><div class="summary">A stash for calculated values for each iteration in the CheckSecretCode routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sentinelhaswon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sentinelhaswon">sentinelHasWon</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">A flag to record when the player runs out of energy (i.e. the energy level goes negative), at which point the Sentinel wins</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsarevisible"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#sightsarevisible">sightsAreVisible</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">Controls whether the sights are being shown</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sobj1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#sobj1">sobj1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-spawnobject">SpawnObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sobj2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#sobj2">sobj2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-spawnobject">SpawnObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak1">stak1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak2">stak2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak3">stak3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak4">stak4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak5">stak5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak6">stak6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak7">stak7</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stak8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stak8">stak8</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawobjectstack">DrawObjectStack</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stas1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stas1">stas1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-checksecretstash">CheckSecretStash</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stas2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#stas2">stas2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-checksecretstash">CheckSecretStash</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stashaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#stashaddr">stashAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address of the four bytes in the secretCodeStash that correspond to the landscape's secret code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stashoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#stashoffset">stashOffset</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The offset into the secretCodeStash where we store a set of generated values for later checking in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-talt2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Entry point <a href="/source/all/the_sentinel_e.html#talt2">talt2</a> in subroutine <a href="/source/all/the_sentinel_e.html#header-gettilealtitudes">GetTileAltitudes</a> (category: Drawing the landscape)</div><div class="summary">Jump to MainTitleLoop via game10</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledatapage"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tiledatapage">tileDataPage</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The address of the tileData page containing the current tile's data</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilenumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-tilenumber">tileNumber</a> (category: 3D objects)</div><div class="summary">The tile number to which we are adding an object in the PlaceObjectOnTile routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_h.html#header-tilevisibility">tileVisibility</a> (category: Drawing the landscape)</div><div class="summary">A table for storing the visibility of each tile from the player's point of view, with one bit per tile (1 = visible, 0 = hidden)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-toaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#toaddr">toAddr</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">An address, typically used as a destination address when copying</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-topobjectonstack"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#topobjectonstack">topObjectOnStack</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The number of the object on the top of an object stack</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tracestepcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#tracestepcounter">traceStepCounter</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of steps in the ray-tracing process when calculating tile visibility in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvis1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#tvis1">tvis1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-gettilevisibility">GetTileVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvis2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#tvis2">tvis2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-gettilevisibility">GetTileVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvis3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#tvis3">tvis3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-gettilevisibility">GetTileVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvis4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#tvis4">tvis4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-gettilevisibility">GetTileVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvis5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#tvis5">tvis5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-gettilevisibility">GetTileVisibility</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo1">updo1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo10">updo10</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo11">updo11</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo12">updo12</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo13">updo13</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo2">updo2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo3">updo3</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo4">updo4</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo5">updo5</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo6">updo6</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo7">updo7</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo8">updo8</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updo9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#updo9">updo9</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-drawupdatedobject">DrawUpdatedObject</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-uple1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#uple1">uple1</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-updateplayerenergy">UpdatePlayerEnergy</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-uple2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/all/the_sentinel_d.html#uple2">uple2</a> in subroutine <a href="/source/all/the_sentinel_d.html#header-updateplayerenergy">UpdatePlayerEnergy</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#viewscreenaddr">viewScreenAddr</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The screen address of the player's scrolling landscape view, which is just below the icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#viewingobject">viewingObject</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The number of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-visibilebitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-visibilebitmask">visibileBitMask</a> (category: Drawing the landscape)</div><div class="summary">A table for converting a number in the range 0 to 7 into a bit mask with only that bit set, when counting from the left</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xbufferleft">xBufferLeft</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The left edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xbufferright">xBufferRight</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The right edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xbufferwidth">xBufferWidth</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The width in pixels of the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xcoordbot"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xcoordbot">xCoordBot</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of an object or point (bottom byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xcoordhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xcoordhi">xCoordHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of an object or point (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xcoordlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xcoordlo">xCoordLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of an object or point (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xdeltalo">xDeltaLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The difference between two x-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-xobject">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-xpolygonleft">xPolygonLeft</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the left edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_i.html#header-xpolygonright">xPolygonRight</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the right edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonrightedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xpolygonrightedge">xPolygonRightEdge</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The screen x-coordinate of the right edge of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtile">xTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner x-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilerow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xtilerow">xTileRow</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile x-coordinate of the tile we are analysing in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#xtilesentinel">xTileSentinel</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The tile x-coordinate of the Sentinel</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xvectorbot"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xvectorbot">xVectorBot</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of a vector (bottom byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xvectorhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xvectorhi">xVectorHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of a vector (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xvectorlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#xvectorlo">xVectorLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The x-coordinate of a vector (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ycoordbot"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ycoordbot">yCoordBot</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of an object or point (bottom byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ycoordhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ycoordhi">yCoordHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of an object or point (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ycoordlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ycoordlo">yCoordLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of an object or point (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjecthi">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjectlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-yobjectlo">yObjectLo</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygonbottom"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ypolygonbottom">yPolygonBottom</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the bottom of the polygon being drawn (where higher y-coordinates are up the screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygonline"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ypolygonline">yPolygonLine</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The polygon y-coordinate of the pixel line being drawn in the DrawPolygonLines routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygontop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ypolygontop">yPolygonTop</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of the top of the polygon being drawn (where higher y-coordinates are up the screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ytilerow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ytilerow">yTileRow</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile y-coordinate of the tile we are analysing in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yvectorbot"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yvectorbot">yVectorBot</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of a vector (bottom byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yvectorlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yvectorlo">yVectorLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The y-coordinate of a vector (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yawadjustmenthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_d.html#header-yawadjustmenthi">yawAdjustmentHi</a> (category: Screen buffer)</div><div class="summary">The yaw offset of the left edge of the object being updated, relative to the left edge of the screen, in yaw angles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yawadjustmentlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#yawadjustmentlo">yawAdjustmentLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">A yaw adjustment to apply to the landscape drawing process so that when we update objects on-screen, we can yaw the viewer's gaze to the right to move the left edge of the object to the left edge of the screen so the object will fit into the screen buffer as efficiently as possible (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zcoordbot"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zcoordbot">zCoordBot</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The z-coordinate of an object or point (bottom byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zcoordhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zcoordhi">zCoordHi</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The z-coordinate of an object or point (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zcoordlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zcoordlo">zCoordLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The z-coordinate of an object or point (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/all/the_sentinel_a.html#header-zobject">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ztile">zTile</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilerow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#ztilerow">zTileRow</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The tile z-coordinate of the tile we are analysing in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/the_sentinel_a.html#ztilesentinel">zTileSentinel</a> in workspace <a href="/source/all/the_sentinel_a.html#header-main-variable-workspace">Main variable workspace</a></div><div class="summary">The tile z-coordinate of the Sentinel</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zvectorbot"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zvectorbot">zVectorBot</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The z-coordinate of a vector (bottom byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zvectorlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/all/workspaces.html#zvectorlo">zVectorLo</a> in workspace <a href="/source/all/workspaces.html#header-zero-page">Zero page</a></div><div class="summary">The z-coordinate of a vector (low byte)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/all/the_sentinel_c.html">The Sentinel C source</a><a class="next" rel="next" title="Next routine" href="/source/all/the_sentinel_e.html">The Sentinel E source</a></nav>
				</div>
			</article>

<?php
include_once("../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
