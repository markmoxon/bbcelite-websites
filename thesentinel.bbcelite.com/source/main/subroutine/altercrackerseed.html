<?php
include_once("../../../templates/template_functions.php");
page_header("cracker_protection", "subroutine_altercrackerseed.html", "The AlterCrackerSeed subroutine", "Cracker protection: AlterCrackerSeed", "Annotated code for the AlterCrackerSeed subroutine in The Sentinel", "the_sentinel-code", "source_cracker_protection", "subroutine_altercrackerseed", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/checkenemygaze_part_1_of_2.html">CheckEnemyGaze (Part 1 of 2)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/checkenemygaze_part_2_of_2.html">CheckEnemyGaze (Part 2 of 2)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">AlterCrackerSeed</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Create an altered version of the anti-cracker seed-related data,</span>
             <span class="headerEntry">as part of the anti-cracker code</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_c.html#header-altercrackerseed">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.AlterCrackerSeed</span><a id="altercrackerseed" class="anchor"></a>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set X = 7, to add to the cracker seed when its last</span>
                        <span class="comment">\ digit is 9, so we effectively add 700 to the</span>
                        <span class="comment">\ landscape number</span>

 <span class="mne">LDA</span> <a class="popup variable">CrackerSeed</a><span class="operator">+</span><span class="decimal">1</span><span class="operator">-</span><span class="decimal">7</span>,<span class="register">X</span>  <span class="comment">\ Set T to the contents of CrackerSeed+1, which we set</span>
 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ in the SetCrackerSeed routine to the high byte of the</span>
                        <span class="comment">\ binary coded decimal (BCD) landscape number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if the landscape number 0123, T contains 01 in BCD</span>
                        <span class="comment">\ format</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Set A to the second digit in the BCD landscape number</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">9</span>                 <span class="comment">\ If the second digit in the BCD number is 9, skip the</span>
 <span class="mne">BEQ</span> <a class="popup destination">alts1</a>              <span class="comment">\ following instruction so that X stays set to 7</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Otherwise set X = 1, for when the second digit is in</span>
                        <span class="comment">\ the range 0 to 8, so we effectively add 100 to the</span>
                        <span class="comment">\ landscape number</span>

<span class="label">.alts1</span><a id="alts1" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set alteredSeed = T + X</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">T</a>                  <span class="comment">\ Note that this addition is not done in BCD mode, so we</span>
 <span class="mne">STA</span> <a class="popup variable">alteredSeed</a>        <span class="comment">\ know that the following is true:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   alteredSeed > T</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   alteredSeed > CrackerSeed+1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ as the largest possible value of T is &99 when the</span>
                        <span class="comment">\ value of X is the largest possible at 7, and:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   &99 + 7 = &A0</span>
                        <span class="comment">\</span>
                        <span class="comment">\ so the addition never overflows and the result in</span>
                        <span class="comment">\ alteredSeed is greater than the original high byte in</span>
                        <span class="comment">\ CrackerSeed+1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This fact is used in the CheckCrackerSeed routine to</span>
                        <span class="comment">\ ensure that this part of the anti-cracker code has</span>
                        <span class="comment">\ been run correctly</span>

                        <span class="comment">\ Fall through into part 2 of CheckEnemyGaze to continue</span>
                        <span class="comment">\ checking the enemy's gaze</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-crackerseed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/crackerseed.html">CrackerSeed</a> (category: Cracker protection)</div><div class="summary">Obfuscated storage for the high byte of the landscape number as part of the anti-cracker code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#t">T</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-alteredseed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#alteredseed">alteredSeed</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">An altered version of the anti-cracker seed-related data that gets created in AlterCrackerSeed and checked in CheckCreckerSeed as part of the anti-cracker code</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-alts1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/altercrackerseed.html#alts1">alts1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/checkenemygaze_part_1_of_2.html">CheckEnemyGaze (Part 1 of 2)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/checkenemygaze_part_2_of_2.html">CheckEnemyGaze (Part 2 of 2)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
