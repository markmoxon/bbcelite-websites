<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_the_landscape", "subroutine_drawslopingtile.html", "The DrawSlopingTile subroutine", "Drawing the landscape: DrawSlopingTile", "Annotated code for the DrawSlopingTile subroutine in The Sentinel", "the_sentinel-code", "source_drawing_the_landscape", "subroutine_drawslopingtile", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawtwofacetile.html">DrawTwoFaceTile</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawSlopingTile</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw a sloping tile that is not shape 4 or 12</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_e.html#header-drawslopingtile">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls <a href="#drawslopingtile">DrawSlopingTile</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The shape of the tile to draw (not 0, 4 or 12)</span>

</div></div>
<span class="label">.DrawSlopingTile</span><a id="drawslopingtile" class="anchor"></a>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the tile shape so we can retrieve it later</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set Y = (A - viewingQuadrantx4) mod 16</span>
 <span class="mne">SBC</span> <a class="popup variable">viewingQuadrantx4</a>  <span class="comment">\</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00001111</span>         <span class="comment">\ Tiles are grouped into four groups, so this sets the</span>
 <span class="mne">TAY</span>                    <span class="comment">\ correct group for the orientation of the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In other words, this makes the shape numbers relative</span>
                        <span class="comment">\ to the viewer's orientation, so we can set the correct</span>
                        <span class="comment">\ colours for the shape's faces</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, it realigns the following tile shape</span>
                        <span class="comment">\ numbers so that the numbering starts in the quadrant</span>
                        <span class="comment">\ where the player is facing:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   1    0 0            Y = 1-3 when facing 12 o'clock</span>
                        <span class="comment">\        1 1              = 5-7 when facing 9 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 6 o'clock</span>
                        <span class="comment">\   2    1 1              = 13-15 when facing 3 o'clock</span>
                        <span class="comment">\        0 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   3    1 0</span>
                        <span class="comment">\        1 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\</span>
                        <span class="comment">\   5    1 0            Y = 1-3 when facing 3 o'clock</span>
                        <span class="comment">\        1 0              = 5-7 when facing 12 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 9 o'clock</span>
                        <span class="comment">\   6    1 0              = 13-15 when facing 6 o'clock</span>
                        <span class="comment">\        0 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   7    1 1</span>
                        <span class="comment">\        1 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\</span>
                        <span class="comment">\   9    1 1            Y = 1-3 when facing 6 o'clock</span>
                        <span class="comment">\        0 0              = 5-7 when facing 3 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 12 o'clock</span>
                        <span class="comment">\   10   0 1              = 13-15 when facing 9 o'clock</span>
                        <span class="comment">\        0 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\   11   0 0</span>
                        <span class="comment">\        1 0</span>
                        <span class="comment">\</span>
                        <span class="comment">\</span>
                        <span class="comment">\   13   0 1            Y = 1-3 when facing 9 o'clock</span>
                        <span class="comment">\        0 1              = 5-7 when facing 6 o'clock</span>
                        <span class="comment">\                         = 9-11 when facing 3 o'clock</span>
                        <span class="comment">\   14   0 0              = 13-15 when facing 12 o'clock</span>
                        <span class="comment">\        0 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   15   0 1</span>
                        <span class="comment">\        1 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use this value below when calculating the colours</span>
                        <span class="comment">\ of the two faces in two-face tiles</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ If Y mod 4 = 1 then the tile shape is the first shape</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00000001</span>         <span class="comment">\ in one of the groups above, so it's a single sloping</span>
 <span class="mne">BEQ</span> <a class="popup destination">DrawOneFaceTile</a>    <span class="comment">\ face from one horizontal edge to another, so jump to</span>
                        <span class="comment">\ DrawOneFaceTile to draw this one-face tile</span>

                        <span class="comment">\ If we get here then the tile shape is the second or</span>
                        <span class="comment">\ third shape in one of the groups above, so one corner</span>
                        <span class="comment">\ is a different altitude to the others</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now use the value of Y to pick the correct value</span>
                        <span class="comment">\ for triangleStartPoint and the correct tileShapeColour</span>
                        <span class="comment">\ table offset for the tile colour, so we can pass them</span>
                        <span class="comment">\ to DrawTwoFaceTile to draw the tile</span>

 <span class="mne">LDA</span> <a class="popup variable">triangleStart</a>,<span class="register">Y</span>    <span class="comment">\ Set triangleStartPoint = 1 for Y = 6, 7, 14, 15 ???</span>
 <span class="mne">STA</span> <a class="popup variable">triangleStartPoint</a> <span class="comment">\                          0 for Y = 2, 3, 10, 11</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A = 1 for tile shapes 6, 7, 14, 15</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000100</span>         <span class="comment">\         0 for tile shapes 2, 3, 10, 11</span>
 <span class="mne">LSR</span> <span class="register">A</span>
 <span class="mne">LSR</span> <span class="register">A</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set C flag if viewingQuadrantOpp = 1 and A = 1</span>
 <span class="mne">ADC</span> <a class="popup variable">viewingQuadrantOpp</a> <span class="comment">\            or viewingQuadrantOpp = 2</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\            or viewingQuadrantOpp = 3</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Clear C flag if viewingQuadrantOpp = 0</span>
                        <span class="comment">\              or viewingQuadrantOpp = 1 and A = 0</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the tile shape to pass to DrawTwoFaceTile</span>

 <span class="mne">BCS</span> <a class="popup destination">DrawTwoFaceTile</a>    <span class="comment">\ Add 16 to the tile shape if the C flag is clear ???</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="decimal">16</span>

                        <span class="comment">\ Fall through into DrawTwoFaceTile to draw the tile</span>
                        <span class="comment">\ with two triangular (three-sided) faces</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawonefacetile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a> (category: Drawing the landscape)</div><div class="summary">Draw a tile with one quadrilateral (four-sided) face</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtwofacetile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/drawtwofacetile.html">DrawTwoFaceTile</a> (category: Drawing the landscape)</div><div class="summary">Draw a tile with two triangular (three-sided) faces</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-trianglestart"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/trianglestart.html">triangleStart</a> (category: Drawing polygons)</div><div class="summary">The number of the first point in each two-face shape that is drawn as a pair of triangles</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-trianglestartpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#trianglestartpoint">triangleStartPoint</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of the starting point for the tile shape being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingquadrantopp"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#viewingquadrantopp">viewingQuadrantOpp</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The opposite quadrant number to that containing the right edge of the viewing arc ???</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingquadrantx4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#viewingquadrantx4">viewingQuadrantx4</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The quadrant number containing the right edge of the viewing arc, multiplied by 4, for use when calculating the number of faces in a tile in DrawSlopingTile</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawtwofacetile.html">DrawTwoFaceTile</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
