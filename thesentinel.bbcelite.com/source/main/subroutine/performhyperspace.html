<?php
include_once("../../../templates/template_functions.php");
page_header("gameplay", "subroutine_performhyperspace.html", "The PerformHyperspace subroutine", "Gameplay: PerformHyperspace", "Annotated code for the PerformHyperspace subroutine in The Sentinel", "the_sentinel-code", "source_gameplay", "subroutine_performhyperspace", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/objecttypeenergy.html">objectTypeEnergy</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawobjectstack.html">DrawObjectStack</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">PerformHyperspace</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Hyperspace the player to a brand new tile, ideally at the same</span>
             <span class="headerEntry">altitude as the current tile</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_d.html#header-performhyperspace">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_2_of_8.html">ApplyTactics (Part 2 of 8)</a> calls <a href="#performhyperspace">PerformHyperspace</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_1_of_2.html">ProcessActionKeys (Part 1 of 2)</a> calls <a href="#performhyperspace">PerformHyperspace</a></span>
</div>
<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Returns:</span>

                        <span class="argumentEntry">  * Clear if the hyperspace was a success, or if the</span>
                        <span class="argumentEntry">    player didn't have enough energy to hyperspace</span>

                        <span class="argumentEntry">  * Set if we could not spawn a robot to use as the</span>
                        <span class="argumentEntry">    destination for the hyperspace</span>

</div></div>
<span class="label">.PerformHyperspace</span><a id="performhyperspace" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Spawn a robot (an object of type 0), returning the</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnObject</a>        <span class="comment">\ object number of the new object in X and currentObject</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set A to the high byte of the altitude of the player</span>
 <span class="mne">LDA</span> <a class="popup variable">yObjectHi</a>,<span class="register">X</span>        <span class="comment">\ object (i.e. the high byte of the player object's</span>
                        <span class="comment">\ y-coordinate in yObjectHi)</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Increment A so it's one coordinate higher than the</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ player object, so the call to PlaceObjectBelow will</span>
                        <span class="comment">\ try to hyperspace the player to the same height as</span>
                        <span class="comment">\ before</span>

 <span class="mne">LDX</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set X to the object number of the new robot that we</span>
                        <span class="comment">\ spawned above</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectBelow</a>   <span class="comment">\ Attempt to place the new robot on a tile that is below</span>
                        <span class="comment">\ the maximum altitude specified in A (though we may end</span>
                        <span class="comment">\ up placing the object higher than this)</span>

 <span class="mne">BCS</span> <a class="popup destination">hypr4</a>              <span class="comment">\ If the call to PlaceObjectBelow sets the C flag then</span>
                        <span class="comment">\ the object has not been successfully placed, so jump</span>
                        <span class="comment">\ to hypr4 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set to indicate that we haven't managed to hyperspace</span>
                        <span class="comment">\ the player</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Call UpdatePlayerEnergy with the C flag set to</span>
 <span class="mne">JSR</span> <a class="popup destination">UpdatePlayerEnergy</a> <span class="comment">\ subtract the amount of energy in object #X from the</span>
                        <span class="comment">\ player's energy</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Object #X is the robot we just spawned, so this will</span>
                        <span class="comment">\ subtract three energy units from the player</span>

 <span class="mne">BCC</span> <a class="popup destination">hypr1</a>              <span class="comment">\ If the player still has positive energy then the call</span>
                        <span class="comment">\ to UpdatePlayerEnergy will clear the C flag, so jump</span>
                        <span class="comment">\ to hypr1 to keep going</span>

                        <span class="comment">\ If we get here then the player doesn't have enough</span>
                        <span class="comment">\ energy to create a robot for hyperspacing</span>

 <span class="mne">JSR</span> <a class="popup destination">DeleteObject</a>       <span class="comment">\ Delete object #X and remove it from the landscape, so</span>
                        <span class="comment">\ we remove the robot that we just spawned</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Set screenBackground = 3 so the next time the screen</span>
 <span class="mne">STA</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ is cleared, it shows a black background with stars</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of hyperspaceEndsGame to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ game has ended with a hyperspace, and clear bit 6 to</span>
                        <span class="comment">\ indicate that the game has ended because the player</span>
                        <span class="comment">\ has run out of energy</span>

 <span class="mne">BNE</span> <a class="popup destination">hypr3</a>              <span class="comment">\ Jump to hypr3 to return from the subroutine (this BNE</span>
                        <span class="comment">\ is effectively a JMP as A is never zero)</span>

<span class="label">.hypr1</span><a id="hypr1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Call the PlayMusic routine with A = 0 to play the</span>
 <span class="mne">JSR</span> <a class="popup destination">PlayMusic</a>          <span class="comment">\ hyperspace music</span>

 <span class="mne">LDX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ If the player is not on the Sentinel's tile in terms</span>
 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ of the x-coordinate, jump to hypr2</span>
 <span class="mne">CMP</span> <a class="popup variable">xTileSentinel</a>
 <span class="mne">BNE</span> <a class="popup destination">hypr2</a>

 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">X</span>          <span class="comment">\ If the player is not on the Sentinel's tile in terms</span>
 <span class="mne">CMP</span> <a class="popup variable">zTileSentinel</a>      <span class="comment">\ of the z-coordinate, jump to hypr2</span>
 <span class="mne">BNE</span> <a class="popup destination">hypr2</a>

                        <span class="comment">\ The player is on the Sentinel's tile in both axes, so</span>
                        <span class="comment">\ they must have hyperspaced while standing on top of</span>
                        <span class="comment">\ the Sentinel's tower, so they have just completed this</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Set bit 7 of hyperspaceEndsGame to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">hyperspaceEndsGame</a> <span class="comment">\ game has ended with a hyperspace, and set bit 6 to</span>
                        <span class="comment">\ indicate that the game has ended because the player</span>
                        <span class="comment">\ has won by hyperspacing from the Sentinel's tower</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of doNotPlayLandscape so that when we finish</span>
 <span class="mne">STA</span> <a class="popup variable">doNotPlayLandscape</a> <span class="comment">\ the landscape, the landscape generation process will</span>
                        <span class="comment">\ return normally, without previewing the landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As the last step in winning a game is to hyperspace</span>
                        <span class="comment">\ onto the Sentinel's tower, this ensures that winning a</span>
                        <span class="comment">\ level will then display that landscape's secret code</span>
                        <span class="comment">\ rather than displaying the preview and making us play</span>
                        <span class="comment">\ it again</span>

<span class="label">.hypr2</span><a id="hypr2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">FocusOnKeyAction</a>   <span class="comment">\ Tell the game to start focusing effort on the key</span>
                        <span class="comment">\ action that has been initiated (i.e. the hyperspace)</span>

 <span class="mne">LDX</span> <a class="popup variable">currentObject</a>      <span class="comment">\ Set the player's object number to that of the new</span>
 <span class="mne">STX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ robot that we spawned above, so this effectively</span>
                        <span class="comment">\ performs the hyperspace into the new robot</span>

<span class="label">.hypr3</span><a id="hypr3" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of playerHasMovedTile to indicate that the</span>
 <span class="mne">STA</span> <a class="popup variable">playerHasMovedTile</a> <span class="comment">\ player has moved to a new tile</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have successfully</span>
                        <span class="comment">\ hyperspaced the player</span>

<span class="label">.hypr4</span><a id="hypr4" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-deleteobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/deleteobject.html">DeleteObject</a> (category: 3D objects)</div><div class="summary">Delete an object, removing it from the landscape and vacating its object number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-focusonkeyaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/focusonkeyaction.html">FocusOnKeyAction</a> (category: Keyboard)</div><div class="summary">Tell the game to start focusing effort on the action that has been initiated, such as a pan of the landscape, absorb, transfer etc.</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-placeobjectbelow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/placeobjectbelow.html">PlaceObjectBelow</a> (category: 3D objects)</div><div class="summary">Attempt to place an object on a tile that is below the maximum altitude specified in A</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playmusic"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/playmusic.html">PlayMusic</a> (category: Sound)</div><div class="summary">Play a piece of music</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/spawnobject.html">SpawnObject</a> (category: 3D objects)</div><div class="summary">Add a new object of the specified type to the objectTypes table</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-updateplayerenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/updateplayerenergy.html">UpdatePlayerEnergy</a> (category: Gameplay)</div><div class="summary">Update the player's energy levels by adding or subtracting the amount of energy in a specific object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-currentobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#currentobject">currentObject</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of the object we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotplaylandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#donotplaylandscape">doNotPlayLandscape</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A flag that controls whether we preview and play the landscape after generating it</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hyperspaceendsgame"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#hyperspaceendsgame">hyperspaceEndsGame</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Records whether the player performing a hyperspace has just ended the game</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/performhyperspace.html#hypr1">hypr1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/performhyperspace.html#hypr2">hypr2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/performhyperspace.html#hypr3">hypr3</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-hypr4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/performhyperspace.html#hypr4">hypr4</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerhasmovedtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#playerhasmovedtile">playerHasMovedTile</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A flag to record whether the player has moved to a new tile by transferring or hyperspacing, so we can decide whether to regenerate the player's landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#playerobject">playerObject</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of the player object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbackground"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#screenbackground">screenBackground</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The type of screen background when clearing the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xobject.html">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#xtilesentinel">xTileSentinel</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The tile x-coordinate of the Sentinel</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/yobjecthi.html">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/zobject.html">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilesentinel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#ztilesentinel">zTileSentinel</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The tile z-coordinate of the Sentinel</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/objecttypeenergy.html">objectTypeEnergy</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawobjectstack.html">DrawObjectStack</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
