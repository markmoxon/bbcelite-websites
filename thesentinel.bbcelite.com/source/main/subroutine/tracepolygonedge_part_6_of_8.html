<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_polygons", "subroutine_tracepolygonedge_part_6_of_8.html", "The TracePolygonEdge (Part 6 of 8) subroutine", "Drawing polygons: TracePolygonEdge (Part 6 of 8)", "Annotated code for the TracePolygonEdge (Part 6 of 8) subroutine in The Sentinel", "the_sentinel-code", "source_drawing_polygons", "subroutine_tracepolygonedge_part_6_of_8", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">GetPolygonLines (Part 6 of 6)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/tracepolygonedge_part_7_of_8.html">TracePolygonEdge (Part 7 of 8)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 6 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a polygon edge where the start or end point x-coordinates</span>
             <span class="headerEntry">are two-byte numbers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-6-of-8">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tred35</span><a id="tred35" class="anchor"></a>

                        <span class="comment">\ If we get here then at least one of xEdgeStartHi and</span>
                        <span class="comment">\ xEdgeEndHi is non-zero</span>

 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set xEdgeDelta = xEdgeStart(Hi Lo) - xEdgeEnd(Hi Lo)</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\ So xEdgeDelta contains the x-axis delta along the edge</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ we are tracing (we can discard the high byte as we</span>
 <span class="mne">LDA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ know it will be zero)</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">BPL</span> <a class="popup destination">tred36</a>             <span class="comment">\ If the result is positive, jump to tred36 to skip the</span>
                        <span class="comment">\ following, as the delta is already the correct sign</span>
                        <span class="comment">\ for the absolute value</span>

                        <span class="comment">\ If we get here then xEdgeDelta is negative and the</span>
                        <span class="comment">\ start point is to the left of the end point</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Negate xEdgeDelta as follows:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\   xEdgeDelta = 0 - xEdgeDelta</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\</span>
                        <span class="comment">\ So xEdgeDelta is positive and contains the absolute</span>
                        <span class="comment">\ value of the x-axis delta</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&E8</span>               <span class="comment">\ Set A to the opcode for the INX instruction, so we</span>
                        <span class="comment">\ trace along the edge by incrementing X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%00000000</span>         <span class="comment">\ Set A to use as the high byte in yEdgeDeltaHi for a</span>
                        <span class="comment">\ positive 16-bit number</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&E6</span>               <span class="comment">\ Set Y to the opcode for the INC zp instruction, so we</span>
                        <span class="comment">\ trace along the edge by incrementing Y</span>

 <span class="mne">JMP</span> <a class="popup destination">tred37</a>             <span class="comment">\ Jump to tred37 to keep going</span>

<span class="label">.tred36</span><a id="tred36" class="anchor"></a>

                        <span class="comment">\ If we get here then xEdgeDelta is positive and the</span>
                        <span class="comment">\ start point is to the right of the end point</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="hex">&CA</span>               <span class="comment">\ Set A to the opcode for the DEX instruction, so we</span>
                        <span class="comment">\ trace along the edge by decrementing X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ Set A to use as the high byte in yEdgeDeltaHi for a</span>
                        <span class="comment">\ negative 16-bit number</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&C6</span>               <span class="comment">\ Set Y to the opcode for the DEC zp instruction, so we</span>
                        <span class="comment">\ trace along the edge by decrementing Y</span>

<span class="label">.tred37</span><a id="tred37" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">T</a>                  <span class="comment">\ Store the INC/DEC opcode in T so we can retrieve it</span>
                        <span class="comment">\ in parts 7 and 8</span>

 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set the high byte of yEdgeDelta(Hi Lo) to be negative</span>
                        <span class="comment">\ when we are moving along the x-axis from right to left</span>
                        <span class="comment">\ and positive when we are moving along the x-axis from</span>
                        <span class="comment">\ left to right</span>

 <span class="mne">LDY</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set the status flags on the comparison of xEdgeDelta</span>
 <span class="mne">CPY</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ and yEdgeDeltaLo, so we can decide which axis has the</span>
                        <span class="comment">\ longer side along the polygon edge (and therefore</span>
                        <span class="comment">\ which axis we should step along when tracing the edge)</span>

 <span class="mne">LDY</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ Set (A Y) = (xPolygonAddrHi yEdgeStartLo) to use as</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ the storage address in the modification below</span>

 <span class="mne">BCS</span> <a class="popup destination">tred46</a>             <span class="comment">\ If xEdgeDelta >= yEdgeDeltaLo then the x-axis delta is</span>
                        <span class="comment">\ the biggest and the edge has a shallow gradient, so</span>
                        <span class="comment">\ jump to part 8 to trace the edge by stepping along the</span>
                        <span class="comment">\ x-axis</span>

                        <span class="comment">\ Otherwise the edge has a steep gradient, so fall</span>
                        <span class="comment">\ through into part 7 to trace the edge by stepping</span>
                        <span class="comment">\ along the y-axis</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#t">T</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred36"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_6_of_8.html#tred36">tred36</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred37"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_6_of_8.html#tred37">tred37</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred46"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_8_of_8.html#tred46">tred46</a> in subroutine <a href="/source/main/subroutine/tracepolygonedge_part_8_of_8.html">TracePolygonEdge (Part 8 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgedelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgedelta">xEdgeDelta</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The scaled and signed x-axis delta between two polygon points when tracing the polygon edges (single byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgeendhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgeendhi">xEdgeEndHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the end point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgeendlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgeendlo">xEdgeEndLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the end point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestarthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgestarthi">xEdgeStartHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgestartlo">xEdgeStartLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xpolygonaddrhi">xPolygonAddrHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The high byte of the address of the table where we store the x-coordinate of the polygon line being processed, so this is either HI(xPolygonLeft) or HI(xPolygonRight)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgedeltahi">yEdgeDeltaHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgedeltalo">yEdgeDeltaLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgestartlo">yEdgeStartLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">GetPolygonLines (Part 6 of 6)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/tracepolygonedge_part_7_of_8.html">TracePolygonEdge (Part 7 of 8)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
