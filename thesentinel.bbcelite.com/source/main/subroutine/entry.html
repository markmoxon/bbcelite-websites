<?php
include_once("../../../templates/template_functions.php");
page_header("setup", "subroutine_entry.html", "The Entry subroutine", "Setup: Entry", "Annotated code for the Entry subroutine in The Sentinel", "the_sentinel-code", "source_setup", "subroutine_entry", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/clearmemory.html">ClearMemory</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">Entry</span>                                                   <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Setup</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The main entry point for the game</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_j.html#header-entry">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="directive"> ORG &6D00              </span><span class="comment">\ Set the assembly address to &6D00</span>

<span class="label">.Entry</span><a id="entry" class="anchor"></a>

                        <span class="comment">\ We start by copying the game code in memory as</span>
                        <span class="comment">\ follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &1900-&6CFF is copied to &0400-&57FF</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The game binary has a load address of &1900 and an</span>
                        <span class="comment">\ execution address of &6D00 (the address of this</span>
                        <span class="comment">\ routine)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&00</span>               <span class="comment">\ Set (Q P) = &1900</span>
 <span class="mne">STA</span> <a class="popup variable">P</a>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">R</a>                  <span class="comment">\ We use this as the source address for the copy</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&19</span>
 <span class="mne">STA</span> <a class="popup variable">Q</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&04</span>               <span class="comment">\ Set (S R) = &0400</span>
 <span class="mne">STA</span> <a class="popup variable">S</a>                  <span class="comment">\</span>
                        <span class="comment">\ We use this as the destination address for the copy</span>

<span class="label">.entr1</span><a id="entr1" class="anchor"></a>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set up a byte counter in Y</span>

<span class="label">.entr2</span><a id="entr2" class="anchor"></a>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">P</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Copy the Y-th byte of (Q P) to the Y-th byte of (S R)</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the byte counter</span>

 <span class="mne">BNE</span> <a class="popup destination">entr2</a>              <span class="comment">\ Loop back until we have copied a whole page of bytes</span>

 <span class="mne">INC</span> <a class="popup variable">Q</a>                  <span class="comment">\ Increment the high byte of (Q P) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">INC</span> <a class="popup variable">S</a>                  <span class="comment">\ Increment the high byte of (S R) to point to the next</span>
                        <span class="comment">\ page in memory</span>

 <span class="mne">LDA</span> <a class="popup variable">Q</a>                  <span class="comment">\ Loop back until (Q P) reaches &6D00, at which point we</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&6D</span>               <span class="comment">\ have copied all the game code</span>
 <span class="mne">BNE</span> <a class="popup destination">entr1</a>

 <span class="mne">JMP</span> <a class="popup destination">ConfigureMachine</a>   <span class="comment">\ Jump to ConfigureMachine to configure the computer,</span>
                        <span class="comment">\ ready for a new game</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-configuremachine"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/configuremachine.html">ConfigureMachine</a> (category: Setup)</div><div class="summary">Configure the custom screen mode, set the break handler to clear memory, move code, reset timers and set the interrupt handler</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-p"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#p">P</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-q"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#q">Q</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-r"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#r">R</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-s"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#s">S</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-entr1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/entry.html#entr1">entr1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-entr2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/entry.html#entr2">entr2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/clearmemory.html">ClearMemory</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
