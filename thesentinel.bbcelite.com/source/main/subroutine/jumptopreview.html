<?php
include_once("../../../templates/template_functions.php");
page_header("cracker_protection", "subroutine_jumptopreview.html", "The JumpToPreview subroutine", "Cracker protection: JumpToPreview", "Annotated code for the JumpToPreview subroutine in The Sentinel", "the_sentinel-code", "source_cracker_protection", "subroutine_jumptopreview", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/decayscreentoblack.html">DecayScreenToBlack</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">JumpToPreview</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">An intentionally confusing jump point for controlling the main</span>
             <span class="headerEntry">title loop flow when returning from the GenerateLandscape routine</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_j.html#header-jumptopreview">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/smoothtilecorners_part_2_of_4.html">SmoothTileCorners (Part 2 of 4)</a> calls <a href="#jumptopreview">JumpToPreview</a></span>
</div>
</div></div>
<span class="label">.JumpToPreview</span><a id="jumptopreview" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="hex">&4C</span>               <span class="comment">\ This byte is never executed, as the stack modification</span>
                        <span class="comment">\ in the SmoothTileData routine sets the return address</span>
                        <span class="comment">\ on the stack to JumpToPreview, and the RTS instruction</span>
                        <span class="comment">\ will therefore jump to JumpToPreview+1 (as that's how</span>
                        <span class="comment">\ the RTS instruction works)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This byte is the opcode for a JMP instruction, so this</span>
                        <span class="comment">\ makes it look like there is a JumpToPreview routine</span>
                        <span class="comment">\ that contains the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   &4C &30 &3F     JMP &3F30</span>
                        <span class="comment">\</span>
                        <span class="comment">\ as the BMI instruction below assembles into &30 &3F</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This would jump to a valid instruction halfway through</span>
                        <span class="comment">\ the ConfigureMachine routine, so this byte, although</span>
                        <span class="comment">\ unused, is presumably a JMP opcode to confuse any</span>
                        <span class="comment">\ crackers who have reached this point in their analysis</span>

 <span class="mne">BMI</span> <a class="popup destination">PreviewLandscape</a>   <span class="comment">\ We only get here if the stack has been modified by the</span>
                        <span class="comment">\ SmoothTileData routine, which makes the RTS at the end</span>
                        <span class="comment">\ end of the GenerateLandscape routine jump here</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The penultimate instruction in GenerateLandscape is a</span>
                        <span class="comment">\ call to the ProcessTileData routine, which happens to</span>
                        <span class="comment">\ set the N flag, so when the RTS instruction jumps here</span>
                        <span class="comment">\ using the modified return address, this BMI branch is</span>
                        <span class="comment">\ taken, so this instruction is effectively a JMP to the</span>
                        <span class="comment">\ PreviewLandscape routine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-previewlandscape"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> (category: Landscape)</div><div class="summary">Draw an aerial preview of the landscape</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/decayscreentoblack.html">DecayScreenToBlack</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/spawntitleobject.html">SpawnTitleObject</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
