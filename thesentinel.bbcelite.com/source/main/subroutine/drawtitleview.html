<?php
include_once("../../../templates/template_functions.php");
page_header("title_screen", "subroutine_drawtitleview.html", "The DrawTitleView subroutine", "Title screen: DrawTitleView", "Annotated code for the DrawTitleView subroutine in The Sentinel", "the_sentinel-code", "source_title_screen", "subroutine_drawtitleview", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/keyloggerconfig.html">keyLoggerConfig</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/ytextviewer.html">yTextViewer</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawTitleView</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the main title screen, the secret code screen or the</span>
             <span class="headerEntry">landscape preview</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_b.html#header-drawtitleview">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#drawtitleview">DrawTitleView</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#drawtitleview">DrawTitleView</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The object to draw on the title screen:</span>

                        <span class="argumentEntry">  * 0 = draw a robot on the right of the screen for the</span>
                        <span class="argumentEntry">        secret code screen</span>

                        <span class="argumentEntry">  * 5 = draw the Sentinel on the right of the screen for</span>
                        <span class="argumentEntry">        the main title screen</span>

                        <span class="argumentEntry">  * &80 = draw the landscape preview</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The screen background:</span>

                        <span class="argumentEntry">  * 1 = fill with solid colour 0 (blue) for the main</span>
                        <span class="argumentEntry">        title screen</span>

                        <span class="argumentEntry">  * 3 = fill with solid colour 1 (black) and draw 240</span>
                        <span class="argumentEntry">        randomly positioned stars in colour 2 (white,</span>
                        <span class="argumentEntry">        yellow, cyan or red), for the secret code screen</span>
                        <span class="argumentEntry">        and landscape preview</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The view type:</span>

                        <span class="argumentEntry">  * 0 = landscape preview</span>

                        <span class="argumentEntry">  * 1 = main title screen or secret code screen</span>

</div></div>
<span class="label">.DrawTitleView</span><a id="drawtitleview" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ Set titleObjectToDraw to the object that we are</span>
                        <span class="comment">\ drawing so we can refer to it throughout the title</span>
                        <span class="comment">\ routines</span>

 <span class="mne">STX</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ Set screenBackground to the type of background to draw</span>
                        <span class="comment">\ for the title screen or landscape preview</span>

                        <span class="comment">\ We start by setting the correct colour for any drop</span>
                        <span class="comment">\ shadow text on the title screen (i.e. text that uses</span>
                        <span class="comment">\ the standard font and which is printed twice with an</span>
                        <span class="comment">\ offset to give a drop-shadow effect, as opposed to the</span>
                        <span class="comment">\ large 3D text which is drawn as 3D objects)</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the background type</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Set X = 2 to use as the colour for the rear character</span>
                        <span class="comment">\ of a drop shadow (this is red on the title screens or</span>
                        <span class="comment">\ white/yellow/cyan/red in the landscape preview)</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">3</span>                 <span class="comment">\ Update the VDU codes at vduShadowFront so the front</span>
 <span class="mne">STA</span> <a class="popup variable">vduShadowFront</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ character of the dropdown text is printed in colour</span>
                        <span class="comment">\ A EOR 3, so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 2 (red) for the solid blue background</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 0 (blue) for the star background</span>

 <span class="mne">BEQ</span> <a class="popup destination">tvew1</a>              <span class="comment">\ If we just set the colour of the front character to</span>
                        <span class="comment">\ blue, skip the following instruction</span>

 <span class="mne">INX</span>                    <span class="comment">\ Set X = 3 to use as the colour for the rear character</span>
                        <span class="comment">\ of a drop shadow (this is yellow on the title screens</span>
                        <span class="comment">\ green/red/yellow/cyan in the landscape preview)</span>

<span class="label">.tvew1</span><a id="tvew1" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">vduShadowRear</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ Update the VDU codes at vduShadowRear so the rear</span>
                        <span class="comment">\ character of the dropdown text is printed in colour X,</span>
                        <span class="comment">\ so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 3 (yellow) for the solid blue background</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Colour 2 for the star background, which is red for</span>
                        <span class="comment">\     the secret code screen, or white/yellow/cyan/red</span>
                        <span class="comment">\     in the landscape preview)</span>

 <span class="mne">STY</span> <a class="popup variable">viewType</a>           <span class="comment">\ Set viewType to the view type so we can use it as an</span>
                        <span class="comment">\ index into the screen configuration tables to set up</span>
                        <span class="comment">\ the correct perspective depending on whether this is</span>
                        <span class="comment">\ a landscape preview (Y = 0) or a title screen (Y = 1)</span>

                        <span class="comment">\ We now set up object #16 to use as the viewing object</span>
                        <span class="comment">\ for the large 3D text blocks, using the values from</span>
                        <span class="comment">\ the configuration tables</span>

 <span class="mne">LDA</span> <a class="popup variable">yTextViewer</a>,<span class="register">Y</span>      <span class="comment">\ Set the y-coordinate of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">yObjectHi</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">textViewerPitch</a>,<span class="register">Y</span>  <span class="comment">\ Set the pitch angle of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">objectPitchAngle</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">xTextViewer</a>,<span class="register">Y</span>      <span class="comment">\ Set the x-coordinate of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">xObject</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">zTextViewer</a>,<span class="register">Y</span>      <span class="comment">\ Set the z-coordinate of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">zObject</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">textViewerYaw</a>,<span class="register">Y</span>    <span class="comment">\ Set the yaw angle of the viewer in object #16</span>
 <span class="mne">STA</span> <a class="popup variable">objectYawAngle</a><span class="operator">+</span><span class="decimal">16</span>

 <span class="mne">LDA</span> <a class="popup variable">titleOffset</a>,<span class="register">Y</span>      <span class="comment">\ Store the title offset on the stack so we can retrieve</span>
 <span class="mne">PHA</span>                    <span class="comment">\ it below</span>

 <span class="mne">JSR</span> <a class="popup destination">ClearScreen</a>        <span class="comment">\ Clear the screen to the screen background specified in</span>
                        <span class="comment">\ screenBackground (so that's blue for the main title</span>
                        <span class="comment">\ screen or black with stars for the secret code screen</span>
                        <span class="comment">\ or landscape preview)</span>

 <span class="mne">LDA</span> <a class="popup variable">titleObjectToDraw</a>  <span class="comment">\ If bit 7 of titleObjectToDraw is set then we are</span>
 <span class="mne">BMI</span> <a class="popup destination">tvew2</a>              <span class="comment">\ drawing the landscape preview, so skip the following</span>
                        <span class="comment">\ instruction as there is no 3D object on the right of</span>
                        <span class="comment">\ the screen</span>

 <span class="mne">JSR</span> <a class="popup destination">DrawTitleObjects</a>   <span class="comment">\ Otherwise call DrawTitleObjects to draw an object of</span>
                        <span class="comment">\ type A (so that's 0 for a robot or 5 for the Sentinel)</span>
                        <span class="comment">\ standing on top of a tower on the right side of the</span>
                        <span class="comment">\ screen</span>

<span class="label">.tvew2</span><a id="tvew2" class="anchor"></a>

 <span class="mne">PLA</span>                    <span class="comment">\ Set xTitleOffset to the title offset, which will only</span>
 <span class="mne">STA</span> <a class="popup variable">xTitleOffset</a>       <span class="comment">\ be non-zero when we are drawing the large 3D text on</span>
                        <span class="comment">\ the main title screen or secret code screen</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">16</span>                <span class="comment">\ Set the viewing object to object #16</span>
 <span class="mne">STX</span> <a class="popup variable">viewingObject</a>

 <span class="mne">JSR</span> <a class="popup destination">DrawLandscapeView</a>  <span class="comment">\ Draw the landscape view to display the large 3D text</span>
                        <span class="comment">\ (for the title screens) or draw the landscape preview</span>

 <span class="mne">LDA</span> <a class="popup variable">viewType</a>           <span class="comment">\ If viewType is non-zero then this is the main title</span>
 <span class="mne">BNE</span> <a class="popup destination">tvew4</a>              <span class="comment">\ screen or secret code screen, so jump to tvew4 to skip</span>
                        <span class="comment">\ the following</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">127</span>               <span class="comment">\ We just drew the landscape preview, so we now reset</span>
                        <span class="comment">\ the tile visibilities so we're ready to play the game,</span>
                        <span class="comment">\ so set a byte counter in X to work through the 128</span>
                        <span class="comment">\ bytes in the tileVisibility table</span>

 <span class="mne">STX</span> <a class="popup variable">viewType</a>           <span class="comment">\ Set viewType to a non-zero value (it doesn't matter</span>
                        <span class="comment">\ what) so the GetObjectAngles routine will process</span>
                        <span class="comment">\ angles for the game's landscape from now on</span>

<span class="label">.tvew3</span><a id="tvew3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a>,<span class="register">X</span>   <span class="comment">\ Zero the X-th byte in the tileVisibility table</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">tvew3</a>              <span class="comment">\ Loop back until we have zeroed the whole</span>
                        <span class="comment">\ tileVisibility table</span>

<span class="label">.tvew4</span><a id="tvew4" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set xTitleOffset = 0 to remove the x-coordinate offset</span>
 <span class="mne">STA</span> <a class="popup variable">xTitleOffset</a>       <span class="comment">\ that we used for the text, as is it not needed during</span>
                        <span class="comment">\ gameplay</span>

 <span class="mne">STA</span> <a class="popup variable">screenBackground</a>   <span class="comment">\ Set screenBackground = 0 so if we start the game after</span>
                        <span class="comment">\ showing this title screen, the FillScreen routine will</span>
                        <span class="comment">\ clear the screen buffers to the blue and black sky,</span>
                        <span class="comment">\ which is the only screen background we need during</span>
                        <span class="comment">\ gameplay</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-clearscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/clearscreen.html">ClearScreen</a> (category: Graphics)</div><div class="summary">Clear the screen to a specified background</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawlandscapeview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/drawlandscapeview_part_1_of_3.html">DrawLandscapeView (Part 1 of 3)</a> (category: Drawing the landscape)</div><div class="summary">Set up a number of variables for drawing the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawtitleobjects"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/drawtitleobjects.html">DrawTitleObjects</a> (category: Title screen)</div><div class="summary">Draw an object on top of a tower on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/stack_variables.html#objectpitchangle">objectPitchAngle</a> in workspace <a href="/source/main/workspace/stack_variables.html">Stack variables</a></div><div class="summary">The pitch angle for each object (i.e. the vertical direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectyawangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/objectyawangle.html">objectYawAngle</a> (category: 3D objects)</div><div class="summary">The yaw angle for each object (i.e. the horizontal direction in which they are facing)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbackground"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#screenbackground">screenBackground</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The type of screen background when clearing the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-textviewerpitch"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/textviewerpitch.html">textViewerPitch</a> (category: Title screen)</div><div class="summary">The pitch angle of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-textvieweryaw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/textvieweryaw.html">textViewerYaw</a> (category: Title screen)</div><div class="summary">The yaw angle of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/tilevisibility.html">tileVisibility</a> (category: Drawing the landscape)</div><div class="summary">A table for storing the visibility of each tile from the player's point of view, with one bit per tile (1 = visible, 0 = hidden)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleobjecttodraw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#titleobjecttodraw">titleObjectToDraw</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The object we are drawing in the DrawTitleView routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-titleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/titleoffset.html">titleOffset</a> (category: Title screen)</div><div class="summary">An offset to apply to the large 3D text for the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawtitleview.html#tvew1">tvew1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawtitleview.html#tvew2">tvew2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawtitleview.html#tvew3">tvew3</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tvew4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawtitleview.html#tvew4">tvew4</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-vdushadowfront"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/vdushadowfront.html">vduShadowFront</a> (category: Text)</div><div class="summary">VDU commands for printing the front character of a drop shadow</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-vdushadowrear"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/vdushadowrear.html">vduShadowRear</a> (category: Text)</div><div class="summary">VDU commands for printing the rear character of a drop shadow</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewtype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/viewtype.html">viewType</a> (category: Title screen)</div><div class="summary">Storage for the type of title view we are drawing in DrawTitleView (title screen or landscape preview)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewingobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#viewingobject">viewingObject</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of the viewing object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xobject.html">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtextviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xtextviewer.html">xTextViewer</a> (category: Title screen)</div><div class="summary">The x-coordinate of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtitleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#xtitleoffset">xTitleOffset</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">An x-coordinate offset for drawing the title screen this is zero during gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjecthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/yobjecthi.html">yObjectHi</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ytextviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/ytextviewer.html">yTextViewer</a> (category: Title screen)</div><div class="summary">The y-coordinate of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/zobject.html">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztextviewer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/ztextviewer.html">zTextViewer</a> (category: Title screen)</div><div class="summary">The z-coordinate of the viewer for the large 3D text on the title screen</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/keyloggerconfig.html">keyLoggerConfig</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/ytextviewer.html">yTextViewer</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
