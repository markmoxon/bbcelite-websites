<?php
include_once("../../../templates/template_functions.php");
page_header("sound", "subroutine_makesound.html", "The MakeSound subroutine", "Sound: MakeSound", "Annotated code for the MakeSound subroutine in The Sentinel", "the_sentinel-code", "source_sound", "subroutine_makesound", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getplayerenergybcd.html">GetPlayerEnergyBCD</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/defineenvelope.html">DefineEnvelope</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">MakeSound</span>                                               <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sound</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Make a sound</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_g.html#header-makesound">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drainobjectenergy.html">DrainObjectEnergy</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processactionkeys_part_2_of_2.html">ProcessActionKeys (Part 2 of 2)</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processgameplay.html">ProcessGameplay</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processmusic.html">ProcessMusic</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processsound.html">ProcessSound</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processvolumekeys.html">ProcessVolumeKeys</a> calls <a href="#makesound">MakeSound</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_2_of_8.html">ApplyTactics (Part 2 of 8)</a> calls via <a href="#makesound">MakeSound-6</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/applytactics_part_6_of_8.html">ApplyTactics (Part 6 of 8)</a> calls via <a href="#makesound">MakeSound-6</a></span></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/processsound.html">ProcessSound</a> calls via <a href="#makesound">MakeSound-6</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of the sound to make (0 to 6):</span>

                        <span class="argumentEntry">  * 0 = rotating enemy (two-part)</span>

                        <span class="argumentEntry">  * 1 = rotating meanie (two-part)</span>

                        <span class="argumentEntry">  * 2 = create/absorb object white noise</span>

                        <span class="argumentEntry">  * 3 = music</span>

                        <span class="argumentEntry">  * 4 = scanner</span>

                        <span class="argumentEntry">  * 5 = ping</span>

                        <span class="argumentEntry">  * 6 = game over (two-part)</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">MakeSound-6</span>          <span class="argumentEntry">Make a two-part sound at the pitches defined in X and Y,</span>
                        <span class="argumentEntry">where X is the pitch for sound data block #0 and Y is</span>
                        <span class="argumentEntry">the pitch for sound data block #1</span>

</div></div>
 <span class="mne">STX</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">4</span>        <span class="comment">\ Set the third parameter of sound data block #0 to X,</span>
                        <span class="comment">\ to set the pitch of the first sound</span>

 <span class="mne">STY</span> <a class="popup variable">soundData</a><span class="operator">+</span><span class="decimal">12</span>       <span class="comment">\ Set the third parameter of sound data block #1 to X,</span>
                        <span class="comment">\ to set the pitch of the second sound</span>

<span class="label">.MakeSound</span><a id="makesound" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the sound number on the stack</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Decrement A, keeping the result positive</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>
 <span class="mne">BCS</span> <a class="popup destination">soun1</a>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

<span class="label">.soun1</span><a id="soun1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">DefineEnvelope</a>     <span class="comment">\ Define envelope data A from the envelopeData table, so</span>
                        <span class="comment">\ sounds #0 and #1 both define envelope data 0, while</span>
                        <span class="comment">\ sounds #2 to #6 define envelope data 1 to 5</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the sound number from the stack and put it</span>
 <span class="mne">TAX</span>                    <span class="comment">\ into X, so we can use it as an index</span>

 <span class="mne">LDA</span> <a class="popup variable">soundNumberData</a>,<span class="register">X</span>  <span class="comment">\ Set A to the corresponding entry from soundNumberData</span>
                        <span class="comment">\ for the sound number in X, which tells us which blocks</span>
                        <span class="comment">\ of sound data to use from the soundData table when</span>
                        <span class="comment">\ making the sound</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ If A &lt;> 1 then jump to soun2 to make the sound using</span>
 <span class="mne">BNE</span> <a class="popup destination">soun2</a>              <span class="comment">\ the sound data in soundData block number A</span>

                        <span class="comment">\ If A = 1 then this is a two-part sound, with the first</span>
                        <span class="comment">\ part using the sound data in soundData block number A</span>
                        <span class="comment">\ and the second using the sound data in soundData block</span>
                        <span class="comment">\ zero</span>

 <span class="mne">JSR</span> <a class="popup destination">soun2</a>              <span class="comment">\ Call soun2 to make the first sound using the sound</span>
                        <span class="comment">\ data in soundData block number A</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 and fall through into soun2 to make the</span>
                        <span class="comment">\ second sound using the sound data in soundData block</span>
                        <span class="comment">\ zero</span>

<span class="label">.soun2</span><a id="soun2" class="anchor"></a>

                        <span class="comment">\ At this point we have the number of a soundData block</span>
                        <span class="comment">\ in A, in the range 0 to 4, so now we make the sound</span>
                        <span class="comment">\ using that sound data</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set (Y X) = soundData + A * 8</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ starting with the low byte (we set the high byte in</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">soundData</a><span class="bracket">)</span>     <span class="comment">\ MakeSoundEnvelope)</span>
 <span class="mne">TAX</span>                    <span class="comment">\</span>
                        <span class="comment">\ Each sound data block in soundData contains 8 bytes</span>
                        <span class="comment">\ of data, so this sets (Y X) to the address within</span>
                        <span class="comment">\ the soundData table of the data block specified in A</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ Set A = 7 for the OSWORD command to make a sound</span>

 <span class="mne">BNE</span> <a class="popup destination">MakeSoundEnvelope</a>  <span class="comment">\ Jump to MakeSoundEnvelope to set up Y and apply the</span>
                        <span class="comment">\ OSWORD command to the (Y X) block, which makes the</span>
                        <span class="comment">\ relevant sound (this BNE is effectively a JMP as A is</span>
                        <span class="comment">\ never zero)</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-defineenvelope"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/defineenvelope.html">DefineEnvelope</a> (category: Sound)</div><div class="summary">Define a sound envelope</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-makesoundenvelope"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/makesoundenvelope.html">MakeSoundEnvelope</a> (category: Sound)</div><div class="summary">Either make a sound or set up an envelope</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soun1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/makesound.html#soun1">soun1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soun2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/makesound.html#soun2">soun2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sounddata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/sounddata.html">soundData</a> (category: Sound)</div><div class="summary">OSWORD blocks for making the various game sounds</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-soundnumberdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/soundnumberdata.html">soundNumberData</a> (category: Sound)</div><div class="summary">A table to map a sound number (0 to 6) to the sound data block(s) that are used to make the sound</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getplayerenergybcd.html">GetPlayerEnergyBCD</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/defineenvelope.html">DefineEnvelope</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
