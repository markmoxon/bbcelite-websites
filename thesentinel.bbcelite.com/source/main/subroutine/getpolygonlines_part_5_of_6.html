<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_polygons", "subroutine_getpolygonlines_part_5_of_6.html", "The GetPolygonLines (Part 5 of 6) subroutine", "Drawing polygons: GetPolygonLines (Part 5 of 6)", "Annotated code for the GetPolygonLines (Part 5 of 6) subroutine in The Sentinel", "the_sentinel-code", "source_drawing_polygons", "subroutine_getpolygonlines_part_5_of_6", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getpolygonlines_part_4_of_6.html">GetPolygonLines (Part 4 of 6)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/tracepolygonedge_part_1_of_8.html">TracePolygonEdge (Part 1 of 8)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 5 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Loop through all the edges in the polygon and call the correct</span>
             <span class="headerEntry">routines to process one-byte, two-byte or horizontal edges</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-5-of-6">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.gpol9</span><a id="gpol9" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set yPolygonTop = 0 to record the y-coordinate of the</span>
 <span class="mne">STA</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ top of the polygon, where higher y-coordinates are up</span>
                        <span class="comment">\ the screen (so this sets the top of the polygon to the</span>
                        <span class="comment">\ bottom of the screen, so we can bump it up as we work</span>
                        <span class="comment">\ through the polygon)</span>

 <span class="mne">STA</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ Set xMaxHorizontal = 0 so we can use it to keep track</span>
                        <span class="comment">\ of the maximum x-coordinates of any polygon edges that</span>
                        <span class="comment">\ are horizontal</span>

 <span class="mne">STA</span> <a class="popup variable">horizontalEdges</a>    <span class="comment">\ Set horizontalEdges = 0 so we can use it to keep track</span>
                        <span class="comment">\ of how many polygon edges are horizontal</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ Set yPolygonBottom = 255 to record the y-coordinate of</span>
 <span class="mne">STA</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ the bottom of the polygon, where higher y-coordinates</span>
                        <span class="comment">\ are up the screen (so this sets the bottom of the</span>
                        <span class="comment">\ polygon to the top of the screen, so we can move it</span>
                        <span class="comment">\ down as we work through the polygon)</span>

 <span class="mne">STA</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ Set xMinHorizontal = 255 so we can use it to keep</span>
                        <span class="comment">\ track of the minimum x-coordinates of any polygon</span>
                        <span class="comment">\ edges that are horizontal</span>

 <span class="mne">STA</span> <a class="popup variable">drawPolygon</a>        <span class="comment">\ Set drawPolygon to a non-zero value, so by default the</span>
                        <span class="comment">\ polygon will not be drawn, though we will set this to</span>
                        <span class="comment">\ zero later if the polygon should be drawn</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ We now loop through all the edges of the polygon, so</span>
                        <span class="comment">\ set a loop counter in Y to work through all the edges</span>
                        <span class="comment">\ of the polygon (three for a triangle, four for a</span>
                        <span class="comment">\ quadrilateral)</span>

<span class="label">.gpol10</span><a id="gpol10" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">polygonEdge</a>        <span class="comment">\ Store the polygon edge number that we are about to</span>
                        <span class="comment">\ process in polygonEdge, so we can retrieve it at the</span>
                        <span class="comment">\ end of the loop</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">drawViewAngles</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ Set X to the offset within the drawing tables of the</span>
 <span class="mne">TAX</span>                    <span class="comment">\ Y-th point in the polygon</span>

 <span class="mne">INY</span>                    <span class="comment">\ Set Y to the offset within the drawing tables of the</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">drawViewAngles</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ Y+1-st point in the polygon</span>
 <span class="mne">TAY</span>

                        <span class="comment">\ So Y and X are the offsets within the drawing tables</span>
                        <span class="comment">\ of the start and end points for the polygon edge that</span>
                        <span class="comment">\ we are processing</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">xPolygonLeft</a><span class="bracket">)</span>  <span class="comment">\ Set xPolygonAddrHi to the high byte of the address of</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ the xPolygonLeft table, so this value can be used to</span>
                        <span class="comment">\ modify the instructions for storing the polygon line</span>
                        <span class="comment">\ x-coordinates as we process them</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The default is therefore to store the x-coordinate of</span>
                        <span class="comment">\ the left end of the polygon line at xPolygonLeft</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>  <span class="comment">\ Set (A yEdgeDeltaLo) to the following:</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\       drawViewPitch(Hi Lo) for point #Y</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\                 - drawViewPitch(Hi Lo) for point #X</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ So (A yEdgeDeltaLo) contains the difference in pitch</span>
                        <span class="comment">\ angle between the two points, or the delta along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">BPL</span> <a class="popup destination">gpol11</a>             <span class="comment">\ If the result in (A yEdgeDeltaLo) is positive then</span>
                        <span class="comment">\ point #Y is higher than point #X and (A yEdgeDeltaLo)</span>
                        <span class="comment">\ already has the correct sign for the absolute value,</span>
                        <span class="comment">\ so jump to gpol11 to skip the following</span>

                        <span class="comment">\ If we get here then point #X is higher than point #Y,</span>
                        <span class="comment">\ so we swap them around</span>

 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set yEdgeDelta(Hi Lo) = (A yEdgeDeltaLo)</span>

 <span class="mne">INC</span> <a class="popup variable">xPolygonAddrHi</a>     <span class="comment">\ Increment xPolygonAddrHi to HI(xPolygonRight), so when</span>
                        <span class="comment">\ we modify the instructions for storing the polygon</span>
                        <span class="comment">\ line x-coordinates, they are stored in the table for</span>
                        <span class="comment">\ the right end of the polygon line at xPolygonRight ???</span>

 <span class="mne">STX</span> <a class="popup variable">T</a>                  <span class="comment">\ Swap X and Y around, so point #Y is now higher than</span>
 <span class="mne">STY</span> <a class="popup variable">U</a>                  <span class="comment">\ point #X</span>
 <span class="mne">LDX</span> <a class="popup variable">U</a>
 <span class="mne">LDY</span> <a class="popup variable">T</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set (A yEdgeDeltaLo) = -yEdgeDelta(Hi Lo)</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ So yEdgeDelta(Hi Lo) is now positive</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaLo</a>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>
 <span class="mne">SBC</span> <a class="popup variable">yEdgeDeltaHi</a>

<span class="label">.gpol11</span><a id="gpol11" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ Set yEdgeDelta(Hi Lo) = (A yEdgeDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So point #Y is higher than point #X, and we have a</span>
                        <span class="comment">\ positive value in yEdgeDelta(Hi Lo) that contains the</span>
                        <span class="comment">\ y-axis delta between the two points</span>
                        <span class="comment">\</span>
                        <span class="comment">\ xPolygonAddrHi will also point to the correct table</span>
                        <span class="comment">\ for storing the polygon line (left or right) ???</span>

 <span class="mne">BIT</span> <a class="popup variable">xPolygonPointScale</a> <span class="comment">\ If bit 6 of xPolygonPointScale is clear then the pixel</span>
 <span class="mne">BVC</span> <a class="popup destination">gpol13</a>             <span class="comment">\ x-coordinates of all the polygon points fit into</span>
                        <span class="comment">\ single-byte numbers, so jump to gpol13 to process the</span>
                        <span class="comment">\ edge accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">Y</span>  <span class="comment">\ If both of the high bytes for point #X and point #Y</span>
 <span class="mne">ORA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ are zero then the x-coordinates for these particular</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol13</a>             <span class="comment">\ points happen to fit into single-byte numbers, so</span>
                        <span class="comment">\ jump to gpol13 to process the edge accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ If yEdgeDeltaHi is non-zero then the y-axis delta is</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol12</a>             <span class="comment">\ non-zero, so jump to part 6 via gpol12 to process the</span>
                        <span class="comment">\ edge accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ If yEdgeDeltaLo = 0 then we know yEdgeDelta(Hi Lo)</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol15</a>             <span class="comment">\ must be zero as we passed through the BNE above, so</span>
                        <span class="comment">\ the polygon edge is horizontal and we jump to gpol15</span>
                        <span class="comment">\ to move on to the next polygon edge ???</span>

<span class="label">.gpol12</span><a id="gpol12" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">gpol22</a>             <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     two-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is non-zero</span>
                        <span class="comment">\     and positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we jump to part 6 to process this edge accordingly</span>

<span class="label">.gpol13</span><a id="gpol13" class="anchor"></a>

                        <span class="comment">\ If we get here then the x-coordinates for points #X</span>
                        <span class="comment">\ and #Y fit into single-byte numbers</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaHi</a>       <span class="comment">\ If yEdgeDeltaHi is zero then the y-axis delta also</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol14</a>             <span class="comment">\ fits into a single-byte number, so jump to gpol14</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the high bytes for both points' x-coordinates,</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">Y</span>  <span class="comment">\ because we are about to process the edge using</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonPointHi</a>,<span class="register">X</span>  <span class="comment">\ two-byte calculations, and the high bytes don't get</span>
                        <span class="comment">\ written when the x-coordinates of all the polygon</span>
                        <span class="comment">\ points fit into single-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So this just ensures that the high bytes are correctly</span>
                        <span class="comment">\ set up so we can use the value of xPolygonPoint(Hi Lo)</span>
                        <span class="comment">\ in the calculations and get the correct x-coordinate</span>
                        <span class="comment">\ values</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol22</a>             <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     single-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y have had</span>
                        <span class="comment">\     their high bytes zeroed so they can be used as</span>
                        <span class="comment">\     two-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is a</span>
                        <span class="comment">\     two-byte number that is non-zero and positive</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we jump to part 6 to process this edge accordingly</span>

<span class="label">.gpol14</span><a id="gpol14" class="anchor"></a>

                        <span class="comment">\ If we get here then:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The x-coordinates for points #X and #Y are both</span>
                        <span class="comment">\     single-byte numbers</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * The y-axis delta in yEdgeDelta(Hi Lo) is a</span>
                        <span class="comment">\     single-byte number and is therefore equal to</span>
                        <span class="comment">\     yEdgeDeltaLo</span>

 <span class="mne">LDA</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ If yEdgeDeltaLo = 0 then yEdgeDelta(Hi Lo) = 0, so</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol19</a>             <span class="comment">\ jump to gpol19 to process this</span>

                        <span class="comment">\ We now set up the start and end points so that the</span>
                        <span class="comment">\ edge is either horizontal or slopes downwards when</span>
                        <span class="comment">\ moving from the start to the end, as that's what the</span>
                        <span class="comment">\ TracePolygonEdge routine expects</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We know that point #Y is higher than point #X as we</span>
                        <span class="comment">\ set that up above, so we trace along the line from</span>
                        <span class="comment">\ the start at point #Y to the end at point #X</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">Y</span>  <span class="comment">\ Set yEdgeStart(Hi Lo) = drawViewPitch(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartHi</a>       <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">Y</span>  <span class="comment">\ So this sets the y-coordinate of the start point in</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeStartLo</a>       <span class="comment">\ point #Y (the lower point)</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ Set yEdgeEnd(Hi Lo) = drawViewPitch(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndHi</a>         <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\ So this sets the y-coordinate of the end point in</span>
 <span class="mne">STA</span> <a class="popup variable">yEdgeEndLo</a>         <span class="comment">\ point #X (the higher point)</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">Y</span>  <span class="comment">\ Set xEdgeStart(Hi Lo) = (0 xPolygonPointLo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\</span>
                        <span class="comment">\ So this sets the x-coordinate of the start point in</span>
                        <span class="comment">\ point #Y (the lower point), starting with the low</span>
                        <span class="comment">\ bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Set xEdgeEnd(Hi Lo) = (0 xPolygonPointLo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndLo</a>         <span class="comment">\</span>
                        <span class="comment">\ So this sets the x-coordinate of the start point in</span>
                        <span class="comment">\ point #Y (the lower point), starting with the low</span>
                        <span class="comment">\ bytes</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Zero the high bytes of xEdgeStart(Hi Lo) and</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeStartHi</a>       <span class="comment">\ xEdgeEnd(Hi Lo)</span>
 <span class="mne">STA</span> <a class="popup variable">xEdgeEndHi</a>

 <span class="mne">JSR</span> <a class="popup destination">TracePolygonEdge</a>   <span class="comment">\ Trace the polygon edge, populating the xPolygonRight</span>
                        <span class="comment">\ or xPolygonLeft table with the x-coordinate of the</span>
                        <span class="comment">\ edge for each y-coordinate</span>

<span class="label">.gpol15</span><a id="gpol15" class="anchor"></a>

                        <span class="comment">\ We now move on to the next edge in the polygon</span>

 <span class="mne">LDY</span> <a class="popup variable">polygonEdge</a>        <span class="comment">\ Set Y to the number of the polygon edge that we have</span>
                        <span class="comment">\ been processing</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment Y to move on to the next edge in the polygon</span>

 <span class="mne">CPY</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ If we have processed all the edges in the polygon then</span>
 <span class="mne">BEQ</span> <a class="popup destination">gpol16</a>             <span class="comment">\ jump to gpol16 to keep going</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol10</a>             <span class="comment">\ Otherwise loop back to gpol10 to process the next edge</span>
                        <span class="comment">\ in the polygon</span>

<span class="label">.gpol16</span><a id="gpol16" class="anchor"></a>

                        <span class="comment">\ We have processed all the edges in the polygon, so now</span>
                        <span class="comment">\ we work out whether the polygon is visible in the</span>
                        <span class="comment">\ current screen buffer</span>

 <span class="mne">LDA</span> <a class="popup variable">horizontalEdges</a>    <span class="comment">\ If horizontalEdges does not match polygonEdgeCount</span>
 <span class="mne">CMP</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ then not every edge in the polygon was horizontal, so</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol17</a>             <span class="comment">\ jump to gpol17 to skip the following</span>

                        <span class="comment">\ If we get here then every edge in the polygon is</span>
                        <span class="comment">\ horizontal, so the entire polygon appears within a</span>
                        <span class="comment">\ single horizontal line</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewPitchHi</a>,<span class="register">X</span>  <span class="comment">\ If the high byte of the view-relative pitch angle for</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol17</a>             <span class="comment">\ point #X is non-zero then point #X is definitely not</span>
                        <span class="comment">\ on-screen, and so neither is the horizontal line, so</span>
                        <span class="comment">\ jump to gpol17 to skip the following</span>

 <span class="mne">LDY</span> <a class="popup variable">drawViewPitchLo</a>,<span class="register">X</span>  <span class="comment">\ Set Y to the low byte of the view-relative pitch angle</span>
                        <span class="comment">\ for point #X (and therefore the pitch angle for the</span>
                        <span class="comment">\ horizontal line)</span>

 <span class="mne">CPY</span> <a class="popup variable">minPitchAngle</a>      <span class="comment">\ If Y &lt; minPitchAngle then the line is not within the</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol17</a>             <span class="comment">\ screen buffer as the pitch angle is below the minimum</span>
                        <span class="comment">\ value in the buffer, so jump to gpol17 to skip the</span>
                        <span class="comment">\ following</span>

 <span class="mne">CPY</span> <a class="popup variable">maxPitchAngle</a>      <span class="comment">\ If Y >= maxPitchAngle hen the line is not within the</span>
 <span class="mne">BCS</span> <a class="popup destination">gpol17</a>             <span class="comment">\ screen buffer as the pitch angle is above the maximum</span>
                        <span class="comment">\ value in the buffer, so jump to gpol17 to skip the</span>
                        <span class="comment">\ following</span>

                        <span class="comment">\ If we get here then the polygon is a single horizontal</span>
                        <span class="comment">\ line and it appears within the screen buffer, so we</span>
                        <span class="comment">\ configure the result to return a single polygon line</span>
                        <span class="comment">\ with the y-coordinate of single horizontal line, and</span>
                        <span class="comment">\ with the maximum and minimum x-coordinates that we</span>
                        <span class="comment">\ have been calculating in xMinHorizontal and</span>
                        <span class="comment">\ xMaxHorizontal</span>

 <span class="mne">STY</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ Set both the top and bottom polygon y-coordinates to</span>
 <span class="mne">STY</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ the low byte of the view-relative pitch angle for</span>
                        <span class="comment">\ point #X</span>

 <span class="mne">LDA</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ Set the left edge of the polygon line to the</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">Y</span>     <span class="comment">\ x-coordinate in xMinHorizontal</span>

 <span class="mne">LDA</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ Set the right edge of the polygon line to the</span>
 <span class="mne">STA</span> <a class="popup variable">xPolygonRight</a>,<span class="register">Y</span>    <span class="comment">\ x-coordinate in xMaxHorizontal</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set drawPolygon = 0 so the polygon gets drawn</span>
 <span class="mne">STA</span> <a class="popup variable">drawPolygon</a>

<span class="label">.gpol17</span><a id="gpol17" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">drawPolygon</a>        <span class="comment">\ If drawPolygon is non-zero then the polygon should not</span>
 <span class="mne">BNE</span> <a class="popup destination">gpol18</a>             <span class="comment">\ be drawn, so jump to gpol18 to return from the</span>
                        <span class="comment">\ subroutine with the C flag set</span>

 <span class="mne">LDA</span> <a class="popup variable">yPolygonTop</a>        <span class="comment">\ If yPolygonTop &lt; yPolygonBottom then there are no</span>
 <span class="mne">CMP</span> <a class="popup variable">yPolygonBottom</a>     <span class="comment">\ visible lines to draw in the polygon, so jump to</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol18</a>             <span class="comment">\ gpol18 to return from the subroutine with the C flag</span>
                        <span class="comment">\ set</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that the polygon is</span>
                        <span class="comment">\ visible in the current screen buffer and should be</span>
                        <span class="comment">\ drawn</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.gpol18</span><a id="gpol18" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set the C flag to indicate that the polygon is not</span>
                        <span class="comment">\ visible in the current screen buffer and should not be</span>
                        <span class="comment">\ drawn</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.gpol19</span><a id="gpol19" class="anchor"></a>

                        <span class="comment">\ If we get here then yEdgeDelta(Hi Lo) = 0, so this</span>
                        <span class="comment">\ polygon edge is horizontal</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonPointLo</a>,<span class="register">X</span>  <span class="comment">\ Set A = xPolygonPointLo for point #X</span>

 <span class="mne">CMP</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ Set xMaxHorizontal = max(xMaxHorizontal, A)</span>
 <span class="mne">BCC</span> <a class="popup destination">gpol20</a>             <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xMaxHorizontal</a>     <span class="comment">\ So xMaxHorizontal keeps track of the maximum</span>
                        <span class="comment">\ x-coordinate of all the horizontal polygon edges</span>

<span class="label">.gpol20</span><a id="gpol20" class="anchor"></a>

 <span class="mne">CMP</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ Set xMinHorizontal = min(xMinHorizontal, A)</span>
 <span class="mne">BCS</span> <a class="popup destination">gpol21</a>             <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">xMinHorizontal</a>     <span class="comment">\ So xMinHorizontal keeps track of the minimum</span>
                        <span class="comment">\ x-coordinate of all the horizontal polygon edges</span>

<span class="label">.gpol21</span><a id="gpol21" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">horizontalEdges</a>    <span class="comment">\ Increment horizontalEdges so we keep a count of all</span>
                        <span class="comment">\ the horizontal polygon edges</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol15</a>             <span class="comment">\ Jump to gpol15 to move on to the next polygon edge</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#t">T</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tracepolygonedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/tracepolygonedge_part_1_of_8.html">TracePolygonEdge (Part 1 of 8)</a> (category: Drawing polygons)</div><div class="summary">Trace a polygon edge, populating xPolygonRight or xPolygonLeft with the x-coordinate of the edge for each y-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#u">U</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawpolygon"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#drawpolygon">drawPolygon</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">A flag to record whether the polygon we are currently processing contains any visible pixels, so it can be used to control whether we actually draw the polygon</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewangles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#drawviewangles">drawViewAngles</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The address in drawViewAngles(1 0) of the pitch and yaw angles of the tile and polygon points that we are drawing in the landscape view</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/drawviewpitchhi.html">drawViewPitchHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewpitchlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/drawviewpitchlo.html">drawViewPitchLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the pitch angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol10">gpol10</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol11">gpol11</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol12"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol12">gpol12</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol13"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol13">gpol13</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol14"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol14">gpol14</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol15">gpol15</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol16">gpol16</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol17">gpol17</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol18">gpol18</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol19">gpol19</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol20"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol20">gpol20</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol21"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_5_of_6.html#gpol21">gpol21</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_6_of_6.html#gpol22">gpol22</a> in subroutine <a href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">GetPolygonLines (Part 6 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-horizontaledges"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#horizontaledges">horizontalEdges</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">A counter to keep track of how many polygon edges are horizontal in the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#maxpitchangle">maxPitchAngle</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The maximum pitch angle that fits into the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-minpitchangle"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#minpitchangle">minPitchAngle</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The minimum pitch angle that fits into the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#polygonedge">polygonEdge</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number the side of the polygon that we are currently processing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonedgecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#polygonedgecount">polygonEdgeCount</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of sides in the polygon we are drawing, which is one less than the number of points in the polygon's point list (as the last point in the list is always a repeat of the first point)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgeendhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgeendhi">xEdgeEndHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the end point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgeendlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgeendlo">xEdgeEndLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the end point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestarthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgestarthi">xEdgeStartHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgestartlo">xEdgeStartLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xmaxhorizontal"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xmaxhorizontal">xMaxHorizontal</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">A variable to keep track of the maximum x-coordinates of any polygon edges that are horizontal in the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xminhorizontal"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xminhorizontal">xMinHorizontal</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">A variable to keep track of the minimum x-coordinates of any polygon edges that are horizontal in the polygon we are drawing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xpolygonaddrhi">xPolygonAddrHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The high byte of the address of the table where we store the x-coordinate of the polygon line being processed, so this is either HI(xPolygonLeft) or HI(xPolygonRight)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xpolygonleft.html">xPolygonLeft</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the left edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonpointhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xpolygonpointhi.html">xPolygonPointHi</a> (category: Drawing polygons)</div><div class="summary">Pixel x-coordinates for all the points in the polygon that we are currently drawing (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonpointlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xpolygonpointlo.html">xPolygonPointLo</a> (category: Drawing polygons)</div><div class="summary">Pixel x-coordinates for all the points in the polygon that we are currently drawing (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonpointscale"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xpolygonpointscale">xPolygonPointScale</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">A flag to record whether the pixel x-coordinate of the polygon points being processed fit into one or two bytes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xpolygonright.html">xPolygonRight</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the right edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgedeltahi">yEdgeDeltaHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgedeltalo">yEdgeDeltaLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgeendhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgeendhi">yEdgeEndHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the end point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgeendlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgeendlo">yEdgeEndLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the end point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgestarthi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgestarthi">yEdgeStartHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the start point in the polygon edge being processed (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgestartlo">yEdgeStartLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygonbottom"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ypolygonbottom">yPolygonBottom</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the bottom of the polygon being drawn (where higher y-coordinates are up the screen)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygontop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ypolygontop">yPolygonTop</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The y-coordinate of the top of the polygon being drawn (where higher y-coordinates are up the screen)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getpolygonlines_part_4_of_6.html">GetPolygonLines (Part 4 of 6)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/tracepolygonedge_part_1_of_8.html">TracePolygonEdge (Part 1 of 8)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
