<?php
include_once("../../../templates/template_functions.php");
page_header("text", "subroutine_digittonumber.html", "The DigitToNumber subroutine", "Text: DigitToNumber", "Annotated code for the DigitToNumber subroutine in The Sentinel", "the_sentinel-code", "source_text", "subroutine_digittonumber", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/stringtonumber.html">StringToNumber</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/print2digitbcd.html">Print2DigitBCD</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">DigitToNumber</span>                                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Convert a digit from the input buffer into a number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_g.html#header-digittonumber">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/stringtonumber.html">StringToNumber</a> calls <a href="#digittonumber">DigitToNumber</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The offset into the input buffer of the digit to convert</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The numerical value of the digit (0 to 9), where spaces</span>
                        <span class="argumentEntry">are converted to 0</span>

</div></div>
<span class="label">.DigitToNumber</span><a id="digittonumber" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">inputBuffer</a>,<span class="register">Y</span>      <span class="comment">\ Set A to the ASCII digit from the input buffer that we</span>
                        <span class="comment">\ want to convert</span>

 <span class="mne">CPY</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ If Y &lt; 4 then jump to dnum1 to skip the following</span>
 <span class="mne">BCC</span> <a class="popup destination">dnum1</a>

                        <span class="comment">\ Y is 4 or more, so we set this character in the input</span>
                        <span class="comment">\ buffer to &FF so that as we work through the buffer in</span>
                        <span class="comment">\ the StringToNumber routine, converting pairs of ASCII</span>
                        <span class="comment">\ digits into single-byte BCD numbers, we backfill the</span>
                        <span class="comment">\ buffer with &FF</span>

 <span class="mne">PHA</span>                    <span class="comment">\ Set the Y-th character in the input buffer to &FF,</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ making sure not to corrupt the value of A</span>
 <span class="mne">STA</span> <a class="popup variable">inputBuffer</a>,<span class="register">Y</span>
 <span class="mne">PLA</span>

<span class="label">.dnum1</span><a id="dnum1" class="anchor"></a>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="character">' '</span>               <span class="comment">\ If the character in the input buffer is not a space</span>
 <span class="mne">BNE</span> <a class="popup destination">dnum2</a>              <span class="comment">\ then it must be a digit, so jump to dmum2 to convert</span>
                        <span class="comment">\ it into a number</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ Otherwise the character from the input buffer is a</span>
                        <span class="comment">\ space, so set A to ASCII "0" so we return a value of</span>
                        <span class="comment">\ zero in the following subtraction</span>

<span class="label">.dnum2</span><a id="dnum2" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Convert the ASCII digit into a number by subtracting</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="character">'0'</span>               <span class="comment">\ ASCII "0"</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dnum1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/digittonumber.html#dnum1">dnum1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dnum2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/digittonumber.html#dnum2">dnum2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-inputbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#inputbuffer">inputBuffer</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The eight-byte keyboard input buffer</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/stringtonumber.html">StringToNumber</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/print2digitbcd.html">Print2DigitBCD</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
