<?php
include_once("../../../templates/template_functions.php");
page_header("maths_geometry", "subroutine_getangleinradians.html", "The GetAngleInRadians subroutine", "Maths (Geometry): GetAngleInRadians", "Annotated code for the GetAngleInRadians subroutine in The Sentinel", "the_sentinel-code", "source_maths_geometry", "subroutine_getangleinradians", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/crackerseed.html">CrackerSeed</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/multiply8x16.html">Multiply8x16</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">GetAngleInRadians</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Geometry)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Convert a 16-bit angle into radians, restricted to a quarter</span>
             <span class="headerEntry">circle</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_a.html#header-getangleinradians">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getrotationmatrix_part_1_of_5.html">GetRotationMatrix (Part 1 of 5)</a> calls <a href="#getangleinradians">GetAngleInRadians</a></span>
</div>
<hr class="light">
 This routine is from Revs, Geoff Crammond's previous game.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">(A T)</span>                <span class="argumentEntry">A yaw angle (-128 to +127)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">(U A)</span>                <span class="argumentEntry">The angle, reduced to a quarter circle, converted to</span>
                        <span class="argumentEntry">radians, and halved</span>

</div></div>
<span class="label">.GetAngleInRadians</span><a id="getangleinradians" class="anchor"></a>

 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ Set (V T) = (A T) &lt;&lt; 2</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <a class="popup variable">T</a>                  <span class="comment">\ This shift multiplies (A T) by four, removing bits 6</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ and 7 in the process</span>
 <span class="mne">STA</span> <a class="popup variable">V</a>                  <span class="comment">\</span>
                        <span class="comment">\ The degree system in the Sentinel looks like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\            0</span>
                        <span class="comment">\      -32   |   +32         Overhead view of player</span>
                        <span class="comment">\         \  |  /</span>
                        <span class="comment">\          \ | /             0 = looking straight ahead</span>
                        <span class="comment">\           \|/              +64 = looking sharp right</span>
                        <span class="comment">\   -64 -----+----- +64      -64 = looking sharp left</span>
                        <span class="comment">\           /|\</span>
                        <span class="comment">\          / | \</span>
                        <span class="comment">\         /  |  \</span>
                        <span class="comment">\      -96   |   +96</span>
                        <span class="comment">\           128</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The top byte of (A T) is in this range, so shifting to</span>
                        <span class="comment">\ the left by two places drops bits 6 and 7 and scales</span>
                        <span class="comment">\ the angle into the range 0 to 252, as follows:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 0 to 63 (%00000000 to %00111111)</span>
                        <span class="comment">\     -> 0 to 252 (%00000000 to %11111100)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * 64 to 127 (%01000000 to %01111111)</span>
                        <span class="comment">\     -> 0 to 252 (%00000000 to %11111100)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * -1 to -64 (%11111111 to %11000000)</span>
                        <span class="comment">\     -> 252 to 0 (%11111100 to %00000000)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * -65 to -128 (%10111111 to %10000000)</span>
                        <span class="comment">\     -> 252 to 0 (%11111100 to %00000000)</span>

                        <span class="comment">\ We now convert this number from a Revs angle into</span>
                        <span class="comment">\ radians</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value of (V T) represents a quarter-circle, which</span>
                        <span class="comment">\ is PI/2 radians, but we actually multiply by PI/4 to</span>
                        <span class="comment">\ return the angle in radians divided by 2, to prevent</span>
                        <span class="comment">\ overflow in the GetRotationMatrix routine</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">201</span>               <span class="comment">\ Set U = 201</span>
 <span class="mne">STA</span> <a class="popup variable">U</a>

                        <span class="comment">\ Fall through into Multiply8x16 to calculate:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (U A) = U * (V T) / 256</span>
                        <span class="comment">\         = 201 * (V T) / 256</span>
                        <span class="comment">\         = (201 / 256) * (V T)</span>
                        <span class="comment">\         = (3.14 / 4) * (V T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we return (U A) = PI/4 * (V T)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ which is the original angle, reduced to a quarter</span>
                        <span class="comment">\ circle, converted to radians, and halved</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#t">T</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-u"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#u">U</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-v"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#v">V</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/crackerseed.html">CrackerSeed</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/multiply8x16.html">Multiply8x16</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
