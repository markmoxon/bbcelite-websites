<?php
include_once("../../../templates/template_functions.php");
page_header("screen_buffer", "subroutine_configureobjbuffer.html", "The ConfigureObjBuffer subroutine", "Screen buffer: ConfigureObjBuffer", "Annotated code for the ConfigureObjBuffer subroutine in The Sentinel", "the_sentinel-code", "source_screen_buffer", "subroutine_configureobjbuffer", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/buffersminyaw.html">buffersMinYaw</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">ConfigureObjBuffer</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set up the variables required to configure the screen buffer for</span>
             <span class="headerEntry">updating an object</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_e.html#header-configureobjbuffer">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#configureobjbuffer">ConfigureObjBuffer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a> calls via <a href="#buff1">buff1</a></span></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The number of the character columns to configure</span>

<hr class="light">
<span class="subheader"> Other entry points:</span>

   <span class="argumentLabel">buff1</span>                <span class="argumentEntry">Contains an RTS</span>

</div></div>
<span class="label">.ConfigureObjBuffer</span><a id="configureobjbuffer" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set T to the number of character columns we need to</span>
                        <span class="comment">\ configure to contain the object we are drawing</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ This converts the number of character columns into</span>
                        <span class="comment">\ a yaw angle by dividing by 2</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The custom screen mode 5 used by the game is 40</span>
                        <span class="comment">\ character columns wide, and the screen is 20 yaw</span>
                        <span class="comment">\ angles wide in terms of the game's coordinate system</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we can simply double the character column count in</span>
                        <span class="comment">\ A to convert it into a yaw angle</span>

 <span class="mne">STA</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ Set bufferMinYaw(Hi Lo) = A</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\                         = T / 2</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMinYawLo</a>     <span class="comment">\ So this stores the character column count as a yaw</span>
                        <span class="comment">\ angle in bufferMinYaw(Hi Lo), where the low byte is</span>
                        <span class="comment">\ effectively a fractional part</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This gives us the yaw angle of the left edge of the</span>
                        <span class="comment">\ screen buffer ???</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ Set bufferMaxYawHi = bufferMinYawHi / 2</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ and with bit 7 flipped ???</span>
 <span class="mne">STA</span> <a class="popup variable">bufferMaxYawHi</a>

 <span class="mne">LDA</span> <a class="popup variable">T</a>                  <span class="comment">\ Set xBufferWidth = T * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ This gives us the width of the buffer in pixels</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferWidth</a>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set xBufferRight = 128 + T * 2</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111100</span>         <span class="comment">\</span>
 <span class="mne">ORA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ rounded down to a multiple of 4 ???</span>
 <span class="mne">STA</span> <a class="popup variable">xBufferRight</a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set xBufferLeft = xBufferRight - xBufferWidth</span>
 <span class="mne">SBC</span> <a class="popup variable">xBufferWidth</a>
 <span class="mne">STA</span> <a class="popup variable">xBufferLeft</a>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set bufferOrigin(Hi Lo) = xBufferLeft / 8</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ starting with the high byte</span>
 <span class="mne">STA</span> <a class="popup variable">bufferOriginHi</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ And then the low byte</span>
 <span class="mne">ROR</span> <span class="register">A</span>
 <span class="mne">STA</span> <a class="popup variable">bufferOriginLo</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">2</span>                 <span class="comment">\ Configure the screen buffer as a column buffer</span>
 <span class="mne">STA</span> <a class="popup variable">screenBufferType</a>

<span class="label">.buff1</span><a id="buff1" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#t">T</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffermaxyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#buffermaxyawhi">bufferMaxYawHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The maximum allowed yaw angle for points in the current screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#bufferminyawhi">bufferMinYawHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The minimum allowed yaw angle for points in the current screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#bufferminyawlo">bufferMinYawLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The minimum allowed yaw angle for points in the current screen buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferoriginhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#bufferoriginhi">bufferOriginHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The offset to add to yaw angles for the current screen buffer to convert them from having the origin in the buffer centre to having the origin on the left edge of the buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferoriginlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#bufferoriginlo">bufferOriginLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The offset to add to yaw angles for the current screen buffer to convert them from having the origin in the buffer centre to having the origin on the left edge of the buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbuffertype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#screenbuffertype">screenBufferType</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The type of screen buffer that is currently being used</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xbufferleft">xBufferLeft</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The left edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xbufferright">xBufferRight</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The right edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xbufferwidth">xBufferWidth</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The width in pixels of the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/buffersminyaw.html">buffersMinYaw</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawtileandobjects.html">DrawTileAndObjects</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
