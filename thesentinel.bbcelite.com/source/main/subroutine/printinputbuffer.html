<?php
include_once("../../../templates/template_functions.php");
page_header("text", "subroutine_printinputbuffer.html", "The PrintInputBuffer subroutine", "Text: PrintInputBuffer", "Annotated code for the PrintInputBuffer subroutine in The Sentinel", "the_sentinel-code", "source_text", "subroutine_printinputbuffer", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/readnumber.html">ReadNumber</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/stringtonumber.html">StringToNumber</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">PrintInputBuffer</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Text</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Print the contents of the keyboard input buffer</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-printinputbuffer">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/readnumber.html">ReadNumber</a> calls <a href="#printinputbuffer">PrintInputBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">T</span>                    <span class="argumentEntry">The size of the input buffer</span>

</div></div>
<span class="label">.PrintInputBuffer</span><a id="printinputbuffer" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of textDropShadow so the following text is</span>
 <span class="mne">ROR</span> <a class="popup variable">textDropShadow</a>     <span class="comment">\ printed without a drop shadow</span>

                        <span class="comment">\ We now print the contents of the input buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Key presses are stored in the input buffer using an</span>
                        <span class="comment">\ ascending stack, with new input being pushed into</span>
                        <span class="comment">\ inputBuffer, so to print the contents of the buffer,</span>
                        <span class="comment">\ we need to print it backwards, from the oldest input</span>
                        <span class="comment">\ at index T - 1 down to the most recent input at</span>
                        <span class="comment">\ index 0</span>

 <span class="mne">LDX</span> <a class="popup variable">T</a>                  <span class="comment">\ Set X = T - 1 so we can use X as an index into the</span>
 <span class="mne">DEX</span>                    <span class="comment">\ buffer, starting from the oldest input</span>

<span class="label">.pinb1</span><a id="pinb1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">inputBuffer</a>,<span class="register">X</span>      <span class="comment">\ Set A to the X-th entry in the input buffer</span>

 <span class="mne">JSR</span> <a class="popup destination">PrintDigit</a>         <span class="comment">\ Print the numerical digit in A</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the buffer index</span>

 <span class="mne">BPL</span> <a class="popup destination">pinb1</a>              <span class="comment">\ Loop back until we have printed the whole buffer</span>

                        <span class="comment">\ We now want to backspace by the number of characters</span>
                        <span class="comment">\ we just printed, to leave the cursor at the start of</span>
                        <span class="comment">\ the printed number</span>

 <span class="mne">LDX</span> <a class="popup variable">T</a>                  <span class="comment">\ Set X to the size of the input buffer, which we can</span>
                        <span class="comment">\ use as a character counter in the following loop to</span>
                        <span class="comment">\ ensure we backspace by the correct number of</span>
                        <span class="comment">\ characters to reach the start of printed number</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set A = 8 to perform a series of VDU 8 commands, each</span>
                        <span class="comment">\ of which will backspace the cursor by one character</span>

<span class="label">.pinb2</span><a id="pinb2" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">PrintDigit</a>         <span class="comment">\ Print the character in A, which performs a VDU 8 to</span>
                        <span class="comment">\ backspace the cursor by one character</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the character counter</span>

 <span class="mne">BNE</span> <a class="popup destination">pinb2</a>              <span class="comment">\ Loop back until we have backspaced to the start of the</span>
                        <span class="comment">\ buffer contents that we just printed</span>

 <span class="mne">LSR</span> <a class="popup variable">textDropShadow</a>     <span class="comment">\ Clear bit 7 of textDropShadow so text tokens are once</span>
                        <span class="comment">\ again printed with drop shadows</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printdigit"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/printdigit.html">PrintDigit</a> (category: Text)</div><div class="summary">Print a numerical digit, printing zero as a capital "O"</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-t"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#t">T</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-inputbuffer"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#inputbuffer">inputBuffer</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The eight-byte keyboard input buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pinb1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/printinputbuffer.html#pinb1">pinb1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pinb2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/printinputbuffer.html#pinb2">pinb2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-textdropshadow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#textdropshadow">textDropShadow</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Controls whether text in text tokens is printed with a drop shadow</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/readnumber.html">ReadNumber</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/stringtonumber.html">StringToNumber</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
