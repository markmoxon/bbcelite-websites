<?php
include_once("../../../templates/template_functions.php");
page_header("title_screen", "subroutine_spawnsecretcode3d.html", "The SpawnSecretCode3D subroutine", "Title screen: SpawnSecretCode3D", "Annotated code for the SpawnSecretCode3D subroutine in The Sentinel", "the_sentinel-code", "source_title_screen", "subroutine_spawnsecretcode3d", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/lownibblebcd.html">lowNibbleBCD</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/printlandscapenum.html">PrintLandscapeNum</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnSecretCode3D</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the landscape's secret code by spawning a set of large 3D</span>
             <span class="headerEntry">text block objects</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_g.html#header-spawnsecretcode3d">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#spawnsecretcode3d">SpawnSecretCode3D</a></span>
</div>
</div></div>
<span class="label">.SpawnSecretCode3D</span><a id="spawnsecretcode3d" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span> <span class="operator">+</span> <span class="decimal">0</span>     <span class="comment">\ Set bit 7 of printTextIn3D so we print the landscape's</span>
 <span class="mne">STA</span> <a class="popup variable">printTextIn3D</a>      <span class="comment">\ secret code in 3D text when we call Print2DigitBCD</span>
                        <span class="comment">\ below</span>

 <span class="mne">JSR</span> <a class="popup destination">SpawnCharacter3D</a>   <span class="comment">\ Call SpawnCharacter3D with A = #%10000000 + 0 to set</span>
                        <span class="comment">\ the tile x-coordinate of the large 3D secret code text</span>
                        <span class="comment">\ to zero</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11000000</span> <span class="operator">+</span> <span class="decimal">7</span>     <span class="comment">\ Call SpawnCharacter3D with A = #%11000000 + 7 to set</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnCharacter3D</a>   <span class="comment">\ the tile z-coordinate of the large 3D secret code text</span>
                        <span class="comment">\ to 7</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we draw the secret code in large 3D text blocks at</span>
                        <span class="comment">\ tile coordinate (0, 7) on the landscape, so that's</span>
                        <span class="comment">\ starting at the left edge of the landscape and seven</span>
                        <span class="comment">\ tile rows from the front</span>

 <span class="mne">LSR</span> <a class="popup variable">playerIsOnTower</a>    <span class="comment">\ If we got here legally (i.e. without crackers getting</span>
                        <span class="comment">\ involved, then the ProcessActionKeys will have set</span>
                        <span class="comment">\ playerIsOnTower to 6 when the player transferred into</span>
                        <span class="comment">\ the robot on the Sentinel's tower, so this sets the</span>
                        <span class="comment">\ value of playerIsOnTower to 3</span>

 <span class="mne">LDX</span> <a class="popup variable">playerIsOnTower</a>    <span class="comment">\ Set X = 3 to use as a loop in the following code</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If crackers have jumped straight here instead of</span>
                        <span class="comment">\ playing the game properly, then X will not be 3 (it</span>
                        <span class="comment">\ will probably be 64, as playerIsOnTower is initialised</span>
                        <span class="comment">\ to 128 at the start of each level)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The following code picks up where the CheckSecretCode</span>
                        <span class="comment">\ routine ends, for when bit 7 of doNotPlayLandscape is</span>
                        <span class="comment">\ set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In this case, CheckSecretCode only iterates up to the</span>
                        <span class="comment">\ point where the secret code is about to be generated,</span>
                        <span class="comment">\ and then it stops, so we can finish the generation</span>
                        <span class="comment">\ process here</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For this to work, we need to set X = 3 so we can</span>
                        <span class="comment">\ generate the next four BCD numbers in the landscape's</span>
                        <span class="comment">\ sequence of seed numbers, as these will give us the</span>
                        <span class="comment">\ secret code</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If X is 64, then the secret code that is generated</span>
                        <span class="comment">\ will be incorrect</span>

<span class="label">.dsec1</span><a id="dsec1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedAsBCD</a>   <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers, converted to a binary coded decimal</span>
                        <span class="comment">\ (BCD) number</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ If X >= 4, skip printing the BCD number, so that we</span>
 <span class="mne">BCS</span> <a class="popup destination">dsec2</a>              <span class="comment">\ skip printing the four correct secret code numbers if</span>
                        <span class="comment">\ X starts the loop at 64</span>

 <span class="mne">JSR</span> <a class="popup destination">Print2DigitBCD</a>     <span class="comment">\ Draw the binary coded decimal (BCD) number in A in</span>
                        <span class="comment">\ large 3D text</span>

<span class="label">.dsec2</span><a id="dsec2" class="anchor"></a>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the loop counter</span>

 <span class="mne">BPL</span> <a class="popup destination">dsec1</a>              <span class="comment">\ Loop back until we have printed the four BCD numbers</span>
                        <span class="comment">\ in the landscape's secret code</span>

 <span class="mne">STX</span> <a class="popup variable">playerIsOnTower</a>    <span class="comment">\ Set playerIsOnTower = &FF to overwrite the correct</span>
                        <span class="comment">\ value, to make it harder for crackers to work out why</span>
                        <span class="comment">\ their secret codes aren't valid</span>

 <span class="mne">JSR</span> <a class="popup destination">GetNextSeedNumber</a>  <span class="comment">\ Set A to the next number from the landscape's sequence</span>
                        <span class="comment">\ of seed numbers</span>

 <span class="mne">LSR</span> <a class="popup variable">printTextIn3D</a>      <span class="comment">\ Clear bit 7 of printTextIn3D to return to printing</span>
                        <span class="comment">\ normal text</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseedasbcd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/getnextseedasbcd.html">GetNextSeedAsBCD</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to the next number from the landscape's sequence of seed numbers, converted to a binary coded decimal (BCD) number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getnextseednumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/getnextseednumber.html">GetNextSeedNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a seed number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-print2digitbcd"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/print2digitbcd.html">Print2DigitBCD</a> (category: Text)</div><div class="summary">Print a binary coded decimal (BCD) number using two digits</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawncharacter3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/spawncharacter3d_part_1_of_2.html">SpawnCharacter3D (Part 1 of 2)</a> (category: Title screen)</div><div class="summary">Spawn a character on the landscape in large 3D blocks for drawing on the main title screen or secret code screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dsec1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawnsecretcode3d.html#dsec1">dsec1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dsec2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawnsecretcode3d.html#dsec2">dsec2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerisontower"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#playerisontower">playerIsOnTower</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A flag to record whether the player is on top of the the Sentinel's tower</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-printtextin3d"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#printtextin3d">printTextIn3D</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Controls whether we are printing text normally or in 3D (as in the game's title on the title screen)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/lownibblebcd.html">lowNibbleBCD</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/printlandscapenum.html">PrintLandscapeNum</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
