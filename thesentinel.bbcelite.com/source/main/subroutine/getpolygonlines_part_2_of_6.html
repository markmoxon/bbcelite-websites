<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_polygons", "subroutine_getpolygonlines_part_2_of_6.html", "The GetPolygonLines (Part 2 of 6) subroutine", "Drawing polygons: GetPolygonLines (Part 2 of 6)", "Annotated code for the GetPolygonLines (Part 2 of 6) subroutine in The Sentinel", "the_sentinel-code", "source_drawing_polygons", "subroutine_getpolygonlines_part_2_of_6", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getpolygonlines_part_1_of_6.html">GetPolygonLines (Part 1 of 6)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getpolygonlines_part_3_of_6.html">GetPolygonLines (Part 3 of 6)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">GetPolygonLines (Part 2 of 6)</span>                           <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">The main entry point for the routine to calculate the horizontal</span>
             <span class="headerEntry">lines in filled polygon and prepare them for drawing on-screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-getpolygonlines-part-2-of-6">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawpolygon.html">DrawPolygon</a> calls <a href="#getpolygonlines">GetPolygonLines</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">polygonType</span>          <span class="argumentEntry">The polygon type</span>

   <span class="argumentLabel">triangleStartPoint</span>   <span class="argumentEntry">When drawing a two-face tile as a pair of triangles,</span>
                        <span class="argumentEntry">this is the number of the starting point to use (0 or 1)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">C flag</span>               <span class="argumentEntry">Status flag:</span>

                        <span class="argumentEntry">  * Clear if the polygon is visible in the current</span>
                        <span class="argumentEntry">    screen buffer and should be drawn</span>

                        <span class="argumentEntry">  * Set if the polygon is not visible in the current</span>
                        <span class="argumentEntry">    screen buffer and should not be drawn</span>

   <span class="argumentLabel">yPolygonTop</span>          <span class="argumentEntry">The y-coordinate of the top of the polygon (where higher</span>
                        <span class="argumentEntry">y-coordinates are up the screen)</span>

   <span class="argumentLabel">yPolygonBottom</span>       <span class="argumentEntry">The y-coordinate of the bottom of the polygon (where</span>
                        <span class="argumentEntry">higher y-coordinates are up the screen)</span>

   <span class="argumentLabel">xPolygonLeft</span>         <span class="argumentEntry">The pixel x-coordinates of the left edges of each pixel</span>
                        <span class="argumentEntry">line in the polygon</span>

   <span class="argumentLabel">xPolygonRight</span>        <span class="argumentEntry">The pixel x-coordinates of the right edges of each pixel</span>
                        <span class="argumentEntry">line in the polygon</span>

</div></div>
<span class="label">.GetPolygonLines</span><a id="getpolygonlines" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">xTileToDraw</a>        <span class="comment">\ Set A to the drawing table offset plus the column</span>
 <span class="mne">ORA</span> <a class="popup variable">drawingTableOffset</a> <span class="comment">\ number of the tile we are currently drawing, so if we</span>
                        <span class="comment">\ are drawing a tile, this is the offset of the first</span>
                        <span class="comment">\ point of the tile in the drawing tables</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A is the position in the drawViewYaw(Hi Lo) and</span>
                        <span class="comment">\ drawViewPitch(Hi Lo) tables of the tile corners</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The four points are laid out with the front edge in</span>
                        <span class="comment">\ one drawing table offset (0 or 32) and the back edge</span>
                        <span class="comment">\ in the other drawing table offset (32 or 0), and the</span>
                        <span class="comment">\ left-right points are together in the same offset</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Specifically, the four tile corners will be offset in</span>
                        <span class="comment">\ the drawing tables in one of two layouts</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is the layout when drawingTableOffset = 0:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset x          offset x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset 32 + x     offset 32 + x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ where x is xTileToDraw and the top row is the back row</span>
                        <span class="comment">\ away from the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ And this is the layout when drawingTableOffset = 32:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset 32 + x     offset 32 + x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   offset x          offset x + 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So the offset in A will point to the drawing data for</span>
                        <span class="comment">\ the top-left point above, i.e. the rear left tile</span>
                        <span class="comment">\ corner from the perspective of the viewer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Also, consider the above layouts and how we can move</span>
                        <span class="comment">\ between the corners:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We can move from left to right by adding 1 to the</span>
                        <span class="comment">\     offset, and from right to left by subtracting 1</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * We can move between the top and bottom rows by</span>
                        <span class="comment">\     using EOR #32 on the offset, as this will flip</span>
                        <span class="comment">\     between x and x + 32</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We use these calculations to work out which points in</span>
                        <span class="comment">\ the drawing table we should map to points 1 to 5 in</span>
                        <span class="comment">\ polygonPoint for use in the polygon-drawing process</span>

 <span class="mne">BIT</span> <a class="popup variable">polygonType</a>        <span class="comment">\ If bit 7 of polygonType is set then we are drawing a</span>
 <span class="mne">BMI</span> <a class="popup destination">gpol1</a>              <span class="comment">\ two-face tile as a pair of triangles, so jump to gpol1</span>
                        <span class="comment">\ to do this</span>

 <span class="mne">BVS</span> <a class="popup destination">gpol7</a>              <span class="comment">\ If bit 7 of polygonType is clear and bit 6 is set then</span>
                        <span class="comment">\ we are drawing an object, so jump to part 4 as the</span>
                        <span class="comment">\ point numbers in polygonPoint are already set up</span>
                        <span class="comment">\ correctly for the polygon</span>

                        <span class="comment">\ If we get here then both bits 6 and 7 of polygonType</span>
                        <span class="comment">\ are clear, so we are drawing a tile as a four-sided</span>
                        <span class="comment">\ shape (quadrilateral) and A contains the offset of the</span>
                        <span class="comment">\ rear left tile corner in the drawing tables</span>
                        <span class="comment">\</span>
                        <span class="comment">\ For a quadrilateral, we number the points like</span>
                        <span class="comment">\ this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   1. Rear left       4. Rear right</span>
                        <span class="comment">\</span>
                        <span class="comment">\   2. Front left      3. Front right</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also set point 5 to be the same as point 1, so that</span>
                        <span class="comment">\ the fourth edge from point 4 to point 5 is effectively</span>
                        <span class="comment">\ from point 4 to point 1</span>

 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a>       <span class="comment">\ Set the first quadrilateral point to the rear-left</span>
                        <span class="comment">\ tile corner</span>

 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">4</span>     <span class="comment">\ Set the fifth quadrilateral point to A, so the fourth</span>
                        <span class="comment">\ edge in the quadrilateral joins with the start of the</span>
                        <span class="comment">\ first edge</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set the second quadrilateral point to the front-left</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">1</span>     <span class="comment">\ tile corner</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set the third quadrilateral point to the front-right</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ tile corner</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">2</span>

 <span class="mne">EOR</span> <span class="hash">#</span><span class="decimal">32</span>                <span class="comment">\ Set the fourth quadrilateral point to the rear-right</span>
 <span class="mne">STA</span> <a class="popup variable">polygonPoint</a><span class="operator">+</span><span class="decimal">3</span>     <span class="comment">\ tile corner</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">4</span>                 <span class="comment">\ Set X = 4 to set as the value of polygonEdgeCount as</span>
                        <span class="comment">\ there are four edges in a quadrilateral</span>

<span class="label">.gpol3</span><a id="gpol3" class="anchor"></a>

 <span class="mne">STX</span> <a class="popup variable">polygonEdgeCount</a>   <span class="comment">\ Set polygonEdgeCount to the value in X</span>

 <span class="mne">JMP</span> <a class="popup destination">gpol7</a>              <span class="comment">\ Jump to part 4 to continue analysing the polygon</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawingtableoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#drawingtableoffset">drawingTableOffset</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The offset to use within the various drawing data tables for the tile we are analysing</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_1_of_6.html#gpol1">gpol1</a> in subroutine <a href="/source/main/subroutine/getpolygonlines_part_1_of_6.html">GetPolygonLines (Part 1 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gpol7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/getpolygonlines_part_4_of_6.html#gpol7">gpol7</a> in subroutine <a href="/source/main/subroutine/getpolygonlines_part_4_of_6.html">GetPolygonLines (Part 4 of 6)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonedgecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#polygonedgecount">polygonEdgeCount</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of sides in the polygon we are drawing, which is one less than the number of points in the polygon's point list (as the last point in the list is always a repeat of the first point)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygonpoint"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#polygonpoint">polygonPoint</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Up to five coordinates for the points of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-polygontype"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#polygontype">polygonType</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Bits 6 and 7 determine the type of polygon to draw in the DrawPolygon routine (the calling subroutine is in brackets)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtiletodraw"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xtiletodraw">xTileToDraw</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The column number of the tile we are currently drawing</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/getpolygonlines_part_1_of_6.html">GetPolygonLines (Part 1 of 6)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getpolygonlines_part_3_of_6.html">GetPolygonLines (Part 3 of 6)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
