<?php
include_once("../../../templates/template_functions.php");
page_header("landscape", "subroutine_spawnenemies.html", "The SpawnEnemies subroutine", "Landscape: SpawnEnemies", "Annotated code for the SpawnEnemies subroutine in The Sentinel", "the_sentinel-code", "source_landscape", "subroutine_spawnenemies", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/viewtype.html">viewType</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/spawnplayer.html">SpawnPlayer</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnEnemies</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the number of enemies for this landscape, add them to</span>
             <span class="headerEntry">the landscape and set the palette accordingly</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_b.html#header-spawnenemies">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#spawnenemies">SpawnEnemies</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#spawnenemies">SpawnEnemies</a></span>
</div>
</div></div>
<span class="label">.SpawnEnemies</span><a id="spawnenemies" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If this is not landscape 0000, jump to popu1 to</span>
 <span class="mne">BNE</span> <a class="popup destination">popu1</a>              <span class="comment">\ calculate the number of enemies to spawn</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ This is landscape 0000, so set A = 1 to use for the</span>
                        <span class="comment">\ total number of enemies</span>

 <span class="mne">BNE</span> <a class="popup destination">popu2</a>              <span class="comment">\ Jump to popu2 to set numberOfEnemies to the value of A</span>

<span class="label">.popu1</span><a id="popu1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetEnemyCount</a>      <span class="comment">\ Set A to the enemy count for this landscape, which is</span>
                        <span class="comment">\ derived from the top digit of the landscape number and</span>
                        <span class="comment">\ the next number in the landscape's sequence of seed</span>
                        <span class="comment">\ numbers, so it is always the same value for the same</span>
                        <span class="comment">\ landscape number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ At this point A is in the range 1 to 8, with higher</span>
                        <span class="comment">\ values for higher landscape numbers</span>

 <span class="mne">CMP</span> <a class="popup variable">maxNumberOfEnemies</a> <span class="comment">\ If A &lt; maxNumberOfEnemies then skip the following</span>
 <span class="mne">BCC</span> <a class="popup destination">popu2</a>              <span class="comment">\ instruction</span>

 <span class="mne">LDA</span> <a class="popup variable">maxNumberOfEnemies</a> <span class="comment">\ Set A = maxNumberOfEnemies, so the number of enemies</span>
                        <span class="comment">\ does not exceed the value of maxNumberOfEnemies that</span>
                        <span class="comment">\ we set in the InitialiseSeeds routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So landscapes 0000 to 0009 have a maximum enemy count</span>
                        <span class="comment">\ of 1, landscapes 0010 to 0019 have a maximum enemy</span>
                        <span class="comment">\ count of 2, and so on up to landscapes 0070 and up,</span>
                        <span class="comment">\ which have a maximum enemy count of 8</span>

<span class="label">.popu2</span><a id="popu2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ Store the number of enemies for this landscape in</span>
                        <span class="comment">\ numberOfEnemies</span>

 <span class="mne">JSR</span> <a class="popup destination">AddEnemiesToTiles</a>  <span class="comment">\ Add the required number of enemies to the landscape,</span>
                        <span class="comment">\ starting from the highest altitude and working down,</span>
                        <span class="comment">\ with no more than one enemy on each contour</span>

                        <span class="comment">\ We now update colours 2 and 3 in the first palette in</span>
                        <span class="comment">\ colourPalettes according to the number of enemies</span>

 <span class="mne">LDA</span> <a class="popup variable">numberOfEnemies</a>    <span class="comment">\ Set X = (numberOfEnemies - 1) mod 8</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ The mod 8 is not strictly necessary as numberOfEnemies</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ is in the range 1 to 8, but doing this ensures we can</span>
 <span class="mne">TAX</span>                    <span class="comment">\ safely use X as an index into the landscapeColour</span>
                        <span class="comment">\ tables</span>

 <span class="mne">LDA</span> <a class="popup variable">landscapeColour3</a>,<span class="register">X</span> <span class="comment">\ Set colour 3 in the game palette to the X-th entry</span>
 <span class="mne">STA</span> <a class="popup variable">colourPalettes</a><span class="operator">+</span><span class="decimal">3</span>   <span class="comment">\ from landscapeColour3</span>

 <span class="mne">LDA</span> <a class="popup variable">landscapeColour2</a>,<span class="register">X</span> <span class="comment">\ Set colour 2 in the game palette to the X-th entry</span>
 <span class="mne">STA</span> <a class="popup variable">colourPalettes</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ from landscapeColour2</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-addenemiestotiles"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/addenemiestotiles.html">AddEnemiesToTiles</a> (category: Landscape)</div><div class="summary">Add the required number of enemies to the landscape, starting from the highest altitude and working down, with one enemy per contour</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getenemycount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/getenemycount.html">GetEnemyCount</a> (category: Landscape)</div><div class="summary">Calculate the number of enemies for the current landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-colourpalettes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/colourpalettes.html">colourPalettes</a> (category: Graphics)</div><div class="summary">The logical colours for two mode 5 palettes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapecolour2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/landscapecolour2.html">landscapeColour2</a> (category: Landscape)</div><div class="summary">Physical colours for colour 2 in the game palette for the different numbers of enemies</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapecolour3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/landscapecolour3.html">landscapeColour3</a> (category: Landscape)</div><div class="summary">Physical colours for colour 3 in the game palette for the different numbers of enemies</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapezero"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#landscapezero">landscapeZero</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A flag that is set depending on whether we are playing landscape 0000</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxnumberofenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#maxnumberofenemies">maxNumberOfEnemies</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The maximum number of enemies that can appear on the current landscape, which is calculated as follows</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-numberofenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#numberofenemies">numberOfEnemies</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The number of enemies in the current landscape, including the Sentinel (in the range 1 to 8)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-popu1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawnenemies.html#popu1">popu1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-popu2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawnenemies.html#popu2">popu2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/viewtype.html">viewType</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/spawnplayer.html">SpawnPlayer</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
