<?php
include_once("../../../templates/template_functions.php");
page_header("landscape", "subroutine_initialiseseeds.html", "The InitialiseSeeds subroutine", "Landscape: InitialiseSeeds", "Annotated code for the InitialiseSeeds subroutine in The Sentinel", "the_sentinel-code", "source_landscape", "subroutine_initialiseseeds", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/printlandscapenum.html">PrintLandscapeNum</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/processcharacter.html">ProcessCharacter</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">InitialiseSeeds</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Initialise the seed number generator so it generates the sequence</span>
             <span class="headerEntry">of seed numbers for a specific landscape number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_g.html#header-initialiseseeds">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#initialiseseeds">InitialiseSeeds</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#initialiseseeds">InitialiseSeeds</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#initialiseseeds">InitialiseSeeds</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">(Y X)</span>                <span class="argumentEntry">A landscape number in BCD (0000 to 9999)</span>

</div></div>
<span class="label">.InitialiseSeeds</span><a id="initialiseseeds" class="anchor"></a>

 <span class="mne">STY</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">1</span>   <span class="comment">\ Initialise the seed number generator by setting bits</span>
 <span class="mne">STX</span> <a class="popup variable">seedNumberLFSR</a>     <span class="comment">\ 0-15 of the five-byte linear feedback shift register</span>
                        <span class="comment">\ to the landscape number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This ensures that the GetNextSeedNumber routine (and</span>
                        <span class="comment">\ related routines) will generate a unique sequence of</span>
                        <span class="comment">\ pseudo-random numbers for this landscape, and which</span>
                        <span class="comment">\ will be the exact same sequence every time we need to</span>
                        <span class="comment">\ generate this landscape</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It also ensures that the third number to be generated</span>
                        <span class="comment">\ by the shift register is the high byte of the</span>
                        <span class="comment">\ landscape number that we put into seedNumberLFSR+1, as</span>
                        <span class="comment">\ at this early stage of the process the EOR feedback</span>
                        <span class="comment">\ does not affect this byte as it passes through the</span>
                        <span class="comment">\ shift register, so after three 8-bit shifts the high</span>
                        <span class="comment">\ byte reaches seedNumberLFSR+4 and is returned as the</span>
                        <span class="comment">\ next seed number</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This fact is exploited by the anti-cracker code in the</span>
                        <span class="comment">\ SetCrackerSeed routine</span>

 <span class="mne">STY</span> <a class="popup variable">landscapeNumberHi</a>  <span class="comment">\ Set landscapeNumber(Hi Lo) = (Y X)</span>
 <span class="mne">STX</span> <a class="popup variable">landscapeNumberLo</a>

 <span class="mne">STY</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If the high byte of the landscape number is non-zero,</span>
 <span class="mne">TYA</span>                    <span class="comment">\ then set landscapeZero to this non-zero value (to</span>
 <span class="mne">BNE</span> <a class="popup destination">seed1</a>              <span class="comment">\ indicate that we are not playing landscape 0000) and</span>
                        <span class="comment">\ jump to seed1 to set maxNumberOfEnemies to 8</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set landscapeZero to the low byte of the landscape,</span>
 <span class="mne">STA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ so this sets landscapeZero to zero if we are playing</span>
                        <span class="comment">\ landscape 0000, and it sets it to a non-zero value if</span>
                        <span class="comment">\ we are not</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So landscapeZero is now correctly set to indicate</span>
                        <span class="comment">\ whether or not we are playing landscape 0000</span>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set A to the high byte of the BCD landscape number</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ plus 1, which is the same as saying:</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\   A = 1 + (landscapeNumber div 10)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>                 <span class="comment">\ Or A is 1 plus the "tens" digit of the landscape</span>
                        <span class="comment">\ number</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">9</span>                 <span class="comment">\ If A &lt; 9 then A is in the range 1 to 8, so jump to</span>
 <span class="mne">BCC</span> <a class="popup destination">seed2</a>              <span class="comment">\ seed2 to set maxNumberOfEnemies to this value</span>

                        <span class="comment">\ Otherwise A is 9 or higher, so we now cap A to 8 as</span>
                        <span class="comment">\ the maximum allowed value for maxNumberOfEnemies</span>

<span class="label">.seed1</span><a id="seed1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set A = 8 to use as the maximum number of enemies</span>

<span class="label">.seed2</span><a id="seed2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">maxNumberOfEnemies</a> <span class="comment">\ Set maxNumberOfEnemies to the value in A, so we get</span>
                        <span class="comment">\ the following cap on the number of enemies:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   min(8, 1 + (landscapeNumber div 10))</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So landscapes 0000 to 0009 have a maximum enemy count</span>
                        <span class="comment">\ of 1, landscapes 0010 to 0019 have a maximum enemy</span>
                        <span class="comment">\ count of 2, and so on up to landscapes 0070 and up,</span>
                        <span class="comment">\ which have a maximum enemy count of 8</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapenumberhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#landscapenumberhi">landscapeNumberHi</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The high byte of the four-digit binary coded decimal landscape number (0000 to 9999)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapenumberlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#landscapenumberlo">landscapeNumberLo</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The low byte of the four-digit binary coded decimal landscape number (0000 to 9999)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapezero"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#landscapezero">landscapeZero</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A flag that is set depending on whether we are playing landscape 0000</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-maxnumberofenemies"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#maxnumberofenemies">maxNumberOfEnemies</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The maximum number of enemies that can appear on the current landscape, which is calculated as follows</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seed1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/initialiseseeds.html#seed1">seed1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seed2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/initialiseseeds.html#seed2">seed2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/printlandscapenum.html">PrintLandscapeNum</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/processcharacter.html">ProcessCharacter</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
