<?php
include_once("../../../templates/template_functions.php");
page_header("keyboard", "subroutine_scankeyboard.html", "The ScanKeyboard subroutine", "Keyboard: ScanKeyboard", "Annotated code for the ScanKeyboard subroutine in The Sentinel", "the_sentinel-code", "source_keyboard", "subroutine_scankeyboard", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/multiply8x16.html">Multiply8x16</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getsineandcosine.html">GetSineAndCosine</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">ScanKeyboard</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Keyboard</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Scan the keyboard for a specific key press</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_a.html#header-scankeyboard">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> calls <a href="#scankeyboard">ScanKeyboard</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/scanforgamekeys.html">ScanForGameKeys</a> calls <a href="#scankeyboard">ScanKeyboard</a></span>
</div>
<hr class="light">
 This routine is from Revs, Geoff Crammond's previous game. There is only one
 minor difference: the value of Y is preserved.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The negative inkey value of the key to scan for (in the</span>
                        <span class="argumentEntry">range &80 to &FF)</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">Z flag</span>               <span class="argumentEntry">The result:</span>

                        <span class="argumentEntry">  * Set if the key in X is being pressed, in which case</span>
                        <span class="argumentEntry">    BEQ will branch</span>

                        <span class="argumentEntry">  * Clear if the key in X is not being pressed, in which</span>
                        <span class="argumentEntry">    case BNE will branch</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">Y is preserved</span>

</div></div>
<span class="label">.ScanKeyboard</span><a id="scankeyboard" class="anchor"></a>

 <span class="mne">TYA</span>                    <span class="comment">\ Store Y on the stack so we can preserve it</span>
 <span class="mne">PHA</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">129</span>               <span class="comment">\ Call OSBYTE with A = 129, Y = &FF and the inkey value</span>
 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ in X, to scan the keyboard for key X</span>
 <span class="mne">JSR</span> <a class="popup destination">OSBYTE</a>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve Y from the stack so it is unchanged</span>
 <span class="mne">TAY</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ If the key in X is being pressed, the above call sets</span>
                        <span class="comment">\ both X and Y to &FF, so this sets the Z flag depending</span>
                        <span class="comment">\ on whether the key is being pressed (so a BEQ after</span>
                        <span class="comment">\ the call will branch if the key in X is being pressed)</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Configuration variable <a href="/source/all/workspaces.html#osbyte">OSBYTE</a> = &FFF4</div><div class="summary">The address for the OSBYTE routine</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/multiply8x16.html">Multiply8x16</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getsineandcosine.html">GetSineAndCosine</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
