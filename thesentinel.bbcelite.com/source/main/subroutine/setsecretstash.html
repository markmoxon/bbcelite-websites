<?php
include_once("../../../templates/template_functions.php");
page_header("cracker_protection", "subroutine_setsecretstash.html", "The SetSecretStash subroutine", "Cracker protection: SetSecretStash", "Annotated code for the SetSecretStash subroutine in The Sentinel", "the_sentinel-code", "source_cracker_protection", "subroutine_setsecretstash", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawflattile.html">DrawFlatTile</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">SetSecretStash</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Cracker protection</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Alter the secret code stash, as part of the anti-cracker code</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_e.html#header-setsecretstash">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.SetSecretStash</span><a id="setsecretstash" class="anchor"></a>

                        <span class="comment">\ This routine sets the value of stashOffset, which is</span>
                        <span class="comment">\ the offset into the secretCodeStash where we store a</span>
                        <span class="comment">\ set of generated values for later checking in the</span>
                        <span class="comment">\ GetRowVisibility routine</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The offset is set to the middle byte from the</span>
                        <span class="comment">\ landscape seed linear feedback shift register (LFSR),</span>
                        <span class="comment">\ overwriting previous values until we get here for the</span>
                        <span class="comment">\ last time</span>
                        <span class="comment">\</span>
                        <span class="comment">\ As we only reach this routine when drawing flat tiles</span>
                        <span class="comment">\ in colour 0, so stashOffset is set to the middle byte</span>
                        <span class="comment">\ from the landscape seed linear feedback shift register</span>
                        <span class="comment">\ for the last flat colour 0 tile to be drawn</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The value itself doesn't matter, it's just another way</span>
                        <span class="comment">\ of throwing crackers off the trail of working out how</span>
                        <span class="comment">\ to generate landscape codes, as it changes the address</span>
                        <span class="comment">\ of the secret code stash for each landscape</span>

 <span class="mne">LDA</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">2</span><span class="operator">-</span><span class="decimal">8</span>,<span class="register">X</span>   <span class="comment">\ At this point, X = 8 from DrawFlatTile, so this</span>
 <span class="mne">STA</span> <a class="popup variable">stashOffset</a><span class="operator">-</span><span class="decimal">8</span>,<span class="register">X</span>        <span class="comment">\ sets the following:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   stashOffset = seedNumberLFSR+2</span>

                        <span class="comment">\ seedNumberLFSR+2 is the middle byte of the LFSR at</span>
                        <span class="comment">\ seedNumberLFSR(4 3 2 1 0), so this sets the secret</span>
                        <span class="comment">\ code stash offset to a unique and consistent value for</span>
                        <span class="comment">\ each landscape</span>

                        <span class="comment">\ Fall through into DrawOneFaceTile to finish drawing</span>
                        <span class="comment">\ the flat tile</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stashoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#stashoffset">stashOffset</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The offset into the secretCodeStash where we store a set of generated values for later checking in the GetRowVisibility routine</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawflattile.html">DrawFlatTile</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawonefacetile.html">DrawOneFaceTile</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
