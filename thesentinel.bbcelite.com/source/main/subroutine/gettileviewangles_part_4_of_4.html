<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_the_landscape", "subroutine_gettileviewangles_part_4_of_4.html", "The GetTileViewAngles (Part 4 of 4) subroutine", "Drawing the landscape: GetTileViewAngles (Part 4 of 4)", "Annotated code for the GetTileViewAngles (Part 4 of 4) subroutine in The Sentinel", "the_sentinel-code", "source_drawing_the_landscape", "subroutine_gettileviewangles_part_4_of_4", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/gettileviewangles_part_3_of_4.html">GetTileViewAngles (Part 3 of 4)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawlandscaperow.html">DrawLandscapeRow</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">GetTileViewAngles (Part 4 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate how much of the tile is on-screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_e.html#header-gettileviewangles-part-4-of-4">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
                        <span class="comment">\ By this point we have pitch and yaw angles for the</span>
                        <span class="comment">\ vector between the viewer and the tile that we are</span>
                        <span class="comment">\ analysing, relative to the viewing gaze, so we now</span>
                        <span class="comment">\ need to work out the value of tileIsOnScreen to return</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We set tileIsOnScreen to zero at the start of the</span>
                        <span class="comment">\ routine, to indicate that the tile is not on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We now set the following bits if applicable:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set bit 7 when</span>
                        <span class="comment">\              drawViewYaw(Hi Lo) >= bufferMinYaw(Hi Lo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * Set bit 0 when drawViewYawHi >= bufferMaxYawHi</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So bit 7 is set when the tile corner is inside the</span>
                        <span class="comment">\ minimum yaw limit, and bit 0 is set when the tile</span>
                        <span class="comment">\ corner is inside (but not on) the maximum yaw limit</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If the yaw limit is the screen size, then the two bits</span>
                        <span class="comment">\ determine whether the tile is on-screen</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>    <span class="comment">\ If drawViewYawHi &lt; bufferMinYawHi, jump to tang11 to</span>
 <span class="mne">CMP</span> <a class="popup variable">bufferMinYawHi</a>     <span class="comment">\ return with tileIsOnScreen = 0, as the tile is off the</span>
 <span class="mne">BCC</span> <a class="popup destination">tang11</a>             <span class="comment">\ left of the screen edge</span>

 <span class="mne">BNE</span> <a class="popup destination">tang10</a>             <span class="comment">\ If drawViewYawHi > bufferMinYawHi, jump to tang10 with</span>
                        <span class="comment">\ the C flag set to set bit 7 of tileIsOnScreen</span>

                        <span class="comment">\ If we get here then drawViewYawHi = bufferMinYawHi, so</span>
                        <span class="comment">\ we now check the low bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawLo</a>,<span class="register">Y</span>    <span class="comment">\ If drawViewYawLo &lt; bufferMinYawLo, jump to tang11 to</span>
 <span class="mne">CMP</span> <a class="popup variable">bufferMinYawLo</a>     <span class="comment">\ return with tileIsOnScreen = 0</span>
 <span class="mne">BCC</span> <a class="popup destination">tang11</a>

 <span class="mne">LDA</span> <a class="popup variable">drawViewYawHi</a>,<span class="register">Y</span>    <span class="comment">\ If we get here then drawViewYawLo >= bufferMinYawLo,</span>
                        <span class="comment">\ so the C flag is set, and we set A to drawViewYawHi</span>
                        <span class="comment">\ for the comparison below</span>

<span class="label">.tang10</span><a id="tang10" class="anchor"></a>

                        <span class="comment">\ If we get here then the C flag is set, as we have to</span>
                        <span class="comment">\ pass through a BCC to get here</span>

 <span class="mne">ROR</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ Set bit 7 of tileIsOnScreen, so bit 7 is set if the</span>
                        <span class="comment">\ tile is on or to the right of the minimum yaw limit,</span>
                        <span class="comment">\ i.e. to the right of the left edge of the screen</span>

 <span class="mne">CMP</span> <a class="popup variable">bufferMaxYawHi</a>     <span class="comment">\ If drawViewYawHi &lt; bufferMaxYawHi, jump to tang11 to</span>
 <span class="mne">BCC</span> <a class="popup destination">tang11</a>             <span class="comment">\ return from the routine with bit 0 of tileIsOnScreen</span>
                        <span class="comment">\ clear</span>

                        <span class="comment">\ If we get here then drawViewYawHi >= bufferMaxYawHi,</span>
                        <span class="comment">\ so the tile is off-screen to the right</span>

 <span class="mne">INC</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ Set bit 0 of tileIsOnScreen to indicate that the tile</span>
                        <span class="comment">\ is to the right of the maximum yaw limit, i.e. to the</span>
                        <span class="comment">\ right of the right edge of the screen</span>

<span class="label">.tang11</span><a id="tang11" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">yStoreTileView</a>     <span class="comment">\ Restore Y so that it's preserved</span>

 <span class="mne">LDA</span> <a class="popup variable">tileIsOnScreen</a>     <span class="comment">\ Set A to the value of tileIsOnScreen, to return from</span>
                        <span class="comment">\ the subroutine</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Clear the C flag to indicate that we have not gone</span>
                        <span class="comment">\ past the end of the tile row, which is used when</span>
                        <span class="comment">\ calling this routine via GetTileEdgeToLeft or</span>
                        <span class="comment">\ GetTileEdgeToRight</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffermaxyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#buffermaxyawhi">bufferMaxYawHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The maximum allowed yaw angle for points in the current screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#bufferminyawhi">bufferMinYawHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The minimum allowed yaw angle for points in the current screen buffer (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferminyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#bufferminyawlo">bufferMinYawLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The minimum allowed yaw angle for points in the current screen buffer (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/drawviewyawhi.html">drawViewYawHi</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (high bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-drawviewyawlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/drawviewyawlo.html">drawViewYawLo</a> (category: Drawing the landscape)</div><div class="summary">Storage for the yaw angles of tiles and object points for drawing the current landscape view (low bytes)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang10"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/gettileviewangles_part_4_of_4.html#tang10">tang10</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tang11"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/gettileviewangles_part_4_of_4.html#tang11">tang11</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tileisonscreen"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#tileisonscreen">tileIsOnScreen</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Information on whether a tile is fully on-screen, partially on-screen or fully off-screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ystoretileview"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ystoretileview">yStoreTileView</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage for Y so it can be preserved through calls to GetTileViewAngles</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/gettileviewangles_part_3_of_4.html">GetTileViewAngles (Part 3 of 4)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawlandscaperow.html">DrawLandscapeRow</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
