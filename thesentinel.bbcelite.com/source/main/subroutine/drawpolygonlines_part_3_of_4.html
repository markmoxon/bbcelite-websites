<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_polygons", "subroutine_drawpolygonlines_part_3_of_4.html", "The DrawPolygonLines (Part 3 of 4) subroutine", "Drawing polygons: DrawPolygonLines (Part 3 of 4)", "Annotated code for the DrawPolygonLines (Part 3 of 4) subroutine in The Sentinel", "the_sentinel-code", "source_drawing_polygons", "subroutine_drawpolygonlines_part_3_of_4", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawpolygonlines_part_4_of_4.html">DrawPolygonLines (Part 4 of 4)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawPolygonLines (Part 3 of 4)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw the left and right edges of the polygon line and fall into</span>
             <span class="headerEntry">part 4 to draw the line in between</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_d.html#header-drawpolygonlines-part-3-of-4">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.dpol13</span><a id="dpol13" class="anchor"></a>

                        <span class="comment">\ This is the entry point for the loop that spans parts</span>
                        <span class="comment">\ 2, 3 and 4</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We jump here from part 1 with Y set to the number of</span>
                        <span class="comment">\ the polygon pixel line at the top of the polygon</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We also get here on later iterations with Y set to the</span>
                        <span class="comment">\ polygon pixel to draw next</span>
                        <span class="comment">\</span>
                        <span class="comment">\ In either case we draw polygon pixel line Y and steps</span>
                        <span class="comment">\ down the polygon one pixel line at a time until we</span>
                        <span class="comment">\ reach the bottom</span>

 <span class="mne">LDA</span> <a class="popup variable">xPolygonRight</a>,<span class="register">Y</span>    <span class="comment">\ Set A to the pixel x-coordinate of the right edge for</span>
                        <span class="comment">\ the line we are drawing</span>

 <span class="mne">CMP</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">Y</span>     <span class="comment">\ If the pixel x-coordinate of the right edge is less</span>
 <span class="mne">BCC</span> <a class="popup destination">dpol2</a>              <span class="comment">\ than the pixel x-coordinate of the left edge for the</span>
                        <span class="comment">\ line we are drawing, then the polygon must be facing</span>
                        <span class="comment">\ away from us, so jump to dpol2 to return from the</span>
                        <span class="comment">\ subroutine without drawing the polygon</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the pixel x-coordinate of the right edge</span>

 <span class="mne">SBC</span> <a class="popup variable">xBufferLeft</a>        <span class="comment">\ Set A = A - xBufferLeft</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A is the distance between the right edge of the</span>
                        <span class="comment">\ polygon and the left edge of the buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works because we just passed through</span>
                        <span class="comment">\ a BCC, so we know the C flag is set</span>

 <span class="mne">BCC</span> <a class="popup destination">dpol5</a>              <span class="comment">\ If the subtraction underflowed then the right edge of</span>
                        <span class="comment">\ the polygon is before the left edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol5 in part 2 to process this</span>

 <span class="mne">CMP</span> <a class="popup variable">xBufferWidth</a>       <span class="comment">\ If A >= xBufferWidth then the right edge of the</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol7</a>              <span class="comment">\ polygon is beyond the right edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol7 in part 2 to process this</span>

                        <span class="comment">\ If we get here then the left and right edges of the</span>
                        <span class="comment">\ polygon are both within the screen buffer</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set Y to the offset within the character row of the</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111000</span>         <span class="comment">\ pixel byte containing the right edge of the polygon</span>
 <span class="mne">TAY</span>                    <span class="comment">\ ???</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set X to the pixel number within the character block</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ of the left edge of the polygon (as each character</span>
 <span class="mne">TAX</span>                    <span class="comment">\ block contains four pixels)</span>

 <span class="mne">STY</span> <a class="popup variable">xPolygonRightEdge</a>  <span class="comment">\ Store the pixel byte offset within the character row</span>
                        <span class="comment">\ of the right edge of the polygon in xPolygonRightEdge</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the current screen contents of the pixel byte</span>
                        <span class="comment">\ where we want to draw the right edge of the polygon</span>

 <span class="mne">STA</span> <a class="popup variable">currentPixelByte</a>   <span class="comment">\ Store the current screen contents for the right edge</span>
                        <span class="comment">\ of the polygon in currentPixelByte, in case we need</span>
                        <span class="comment">\ to draw the left and right edges in the same pixel</span>
                        <span class="comment">\ byte</span>

 <span class="mne">AND</span> <a class="popup variable">pixelsToRight</a>,<span class="register">X</span>    <span class="comment">\ Clear the pixels to the left of the right edge by</span>
                        <span class="comment">\ AND'ing the current screen contents with a pixel byte</span>
                        <span class="comment">\ with all the pixels to the right of position X set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the existing screen contents for the</span>
                        <span class="comment">\ pixels outside the polygon line, and with the polygon</span>
                        <span class="comment">\ line pixels cleared, so now we can OR the polygon line</span>
                        <span class="comment">\ pixels into the space we just cleared</span>

<span class="label">.dpol14</span><a id="dpol14" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">edgePixelsRight</a><span class="operator">+</span><span class="hex">&3C</span>,<span class="register">X</span>  <span class="comment">\ This instruction is modified in part 1 to point to</span>
                            <span class="comment">\ the correct entry for the specified polygon</span>
                            <span class="comment">\ colour:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   ORA edgePixelsRight + polygonColours,X</span>
                            <span class="comment">\</span>
                            <span class="comment">\ So this inserts the right edge of the polygon into</span>
                            <span class="comment">\ the left part of the pixel byte in the correct</span>
                            <span class="comment">\ colours for the currently configured fill and edge</span>
                            <span class="comment">\ colours, with the edge pixels starting at the left</span>
                            <span class="comment">\ end of the pixel byte and ending at pixel number X</span>
                            <span class="comment">\ within the byte</span>
                            <span class="comment">\</span>
                            <span class="comment">\ The original value of edgePixelsRight+&3C is just</span>
                            <span class="comment">\ workspace noise and has no meaning, it just sets</span>
                            <span class="comment">\ the high byte to HI(edgePixelsRight)</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Poke the pixel byte containing the right edge into</span>
                        <span class="comment">\ screen memory, so we have now drawn the right edge of</span>
                        <span class="comment">\ the polygon line</span>

<span class="label">.dpol15</span><a id="dpol15" class="anchor"></a>

 <span class="mne">LDY</span> <a class="popup variable">yPolygonLine</a>       <span class="comment">\ Set A to the pixel x-coordinate of the left edge for</span>
 <span class="mne">LDA</span> <a class="popup variable">xPolygonLeft</a>,<span class="register">Y</span>     <span class="comment">\ the line we are drawing</span>

 <span class="mne">TAX</span>                    <span class="comment">\ Set X to the pixel x-coordinate of the left edge</span>

 <span class="mne">CMP</span> <a class="popup variable">xBufferRight</a>       <span class="comment">\ If A >= xBufferRight then the left edge of the</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol6</a>              <span class="comment">\ polygon is beyond the right edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol6 in part 2 to process this</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set A = A - xBufferLeft</span>
 <span class="mne">SBC</span> <a class="popup variable">xBufferLeft</a>        <span class="comment">\</span>
                        <span class="comment">\ So A is the distance between the left edge of the</span>
                        <span class="comment">\ polygon and the left edge of the buffer</span>

 <span class="mne">BCC</span> <a class="popup destination">dpol8</a>              <span class="comment">\ If the subtraction underflowed then the left edge of</span>
                        <span class="comment">\ the polygon is before the left edge of the buffer, so</span>
                        <span class="comment">\ jump to dpol8 in part 2 to process this</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set Y to the offset within the character row of the</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111000</span>         <span class="comment">\ pixel byte containing the left edge of the polygon ???</span>
 <span class="mne">TAY</span>

 <span class="mne">CPY</span> <a class="popup variable">xPolygonRightEdge</a>  <span class="comment">\ If Y >= xPolygonRightEdge then the pixel byte offset</span>
 <span class="mne">BCS</span> <a class="popup destination">dpol9</a>              <span class="comment">\ for the left edge is the same as the pixel byte offset</span>
                        <span class="comment">\ for the right edge, so jump to dpol9 to draw both</span>
                        <span class="comment">\ edges within the same pixel byte</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Set X to the pixel number within the character block</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ of the left edge of the polygon (as each character</span>
 <span class="mne">TAX</span>                    <span class="comment">\ block contains four pixels)</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Set A to the current screen contents of the pixel byte</span>
                        <span class="comment">\ where we want to draw the left edge of the polygon</span>

 <span class="mne">AND</span> <a class="popup variable">pixelsToLeft</a>,<span class="register">X</span>     <span class="comment">\ Clear the pixels to the right of the left edge by</span>
                        <span class="comment">\ AND'ing the current screen contents with a pixel byte</span>
                        <span class="comment">\ with all the pixels to the left of position X set</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So A contains the existing screen contents for the</span>
                        <span class="comment">\ pixels outside the polygon line, and with the polygon</span>
                        <span class="comment">\ line pixels cleared, so now we can OR the polygon line</span>
                        <span class="comment">\ pixels into the space we just cleared</span>

<span class="label">.dpol16</span><a id="dpol16" class="anchor"></a>

 <span class="mne">ORA</span> <a class="popup variable">edgePixelsLeft</a><span class="operator">+</span><span class="hex">&3C</span>,<span class="register">X</span>   <span class="comment">\ This instruction is modified in part 1 to point to</span>
                            <span class="comment">\ the correct entry for the specified polygon</span>
                            <span class="comment">\ colour:</span>
                            <span class="comment">\</span>
                            <span class="comment">\   ORA edgePixelsLeft + polygonColours,X</span>
                            <span class="comment">\</span>
                            <span class="comment">\ So this inserts the left edge of the polygon into</span>
                            <span class="comment">\ the right part of the pixel byte in the correct</span>
                            <span class="comment">\ colours for the currently configured fill and edge</span>
                            <span class="comment">\ colours, with the edge pixels starting at pixel</span>
                            <span class="comment">\ number X within the byte and ending at the right</span>
                            <span class="comment">\ end of the pixel byte</span>
                            <span class="comment">\</span>
                            <span class="comment">\ The original value of edgePixelsLeft+&3C is just</span>
                            <span class="comment">\ workspace noise and has no meaning, it just sets</span>
                            <span class="comment">\ the high byte to HI(edgePixelsLeft)</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">R</a><span class="bracket">)</span>,<span class="register">Y</span>              <span class="comment">\ Poke the pixel byte containing the left edge into</span>
                        <span class="comment">\ screen memory, so we have now drawn the left edge of</span>
                        <span class="comment">\ the polygon line</span>

                        <span class="comment">\ Fall through into part 4 to draw a line between the</span>
                        <span class="comment">\ left and right edges to finish off this line of the</span>
                        <span class="comment">\ polygon</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-r"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#r">R</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage, used in a number of places</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-currentpixelbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#currentpixelbyte">currentPixelByte</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The original contents of the screen behind the right edge of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawpolygonlines_part_1_of_4.html#dpol2">dpol2</a> in subroutine <a href="/source/main/subroutine/drawpolygonlines_part_1_of_4.html">DrawPolygonLines (Part 1 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html#dpol5">dpol5</a> in subroutine <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html#dpol6">dpol6</a> in subroutine <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html#dpol7">dpol7</a> in subroutine <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html#dpol8">dpol8</a> in subroutine <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dpol9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html#dpol9">dpol9</a> in subroutine <a href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edgepixelsleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/edgepixelsleft.html">edgePixelsLeft</a> (category: Drawing polygons)</div><div class="summary">Table to convert a polygon colours byte and a pixel offset (0-3) into a pixel byte for the left edge of the polygon pixel line</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-edgepixelsright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/edgepixelsright.html">edgePixelsRight</a> (category: Drawing polygons)</div><div class="summary">Table to convert a polygon colours byte and a pixel offset (0-3) into a pixel byte for the right edge of the polygon pixel line</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelstoleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/pixelstoleft.html">pixelsToLeft</a> (category: Graphics)</div><div class="summary">Pixel byte with all the pixels to the left of position X set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelstoright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/pixelstoright.html">pixelsToRight</a> (category: Graphics)</div><div class="summary">Pixel byte with all the pixels to the right of position X set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xbufferleft">xBufferLeft</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The left edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xbufferright">xBufferRight</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The right edge of the screen buffer in pixels</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xbufferwidth"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xbufferwidth">xBufferWidth</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The width in pixels of the screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonleft"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xpolygonleft.html">xPolygonLeft</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the left edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonright"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xpolygonright.html">xPolygonRight</a> (category: Drawing polygons)</div><div class="summary">The pixel x-coordinate of the right edge of each pixel line in the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xpolygonrightedge"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xpolygonrightedge">xPolygonRightEdge</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The screen x-coordinate of the right edge of the polygon being drawn</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ypolygonline"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ypolygonline">yPolygonLine</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The polygon y-coordinate of the pixel line being drawn in the DrawPolygonLines routine</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawpolygonlines_part_2_of_4.html">DrawPolygonLines (Part 2 of 4)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/drawpolygonlines_part_4_of_4.html">DrawPolygonLines (Part 4 of 4)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
