<?php
include_once("../../../templates/template_functions.php");
page_header("landscape", "subroutine_smoothtilecorners_part_4_of_4.html", "The SmoothTileCorners (Part 4 of 4) subroutine", "Landscape: SmoothTileCorners (Part 4 of 4)", "Annotated code for the SmoothTileCorners (Part 4 of 4) subroutine in The Sentinel", "the_sentinel-code", "source_landscape", "subroutine_smoothtilecorners_part_4_of_4", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/setcrackerseed.html">SetCrackerSeed</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/gettileshape.html">GetTileShape</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">SmoothTileCorners (Part 4 of 4)</span>                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Copy the smoothed strip data back into the tileData table</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-smoothtilecorners-part-4-of-4">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
<hr class="light">
 This part copies the smoothed strip back into the tileData table.

</div></div>
<span class="label">.stri16</span><a id="stri16" class="anchor"></a>

                        <span class="comment">\ By this point we have smoothed the whole strip, so we</span>
                        <span class="comment">\ can now copy the smoothed tile data back into the</span>
                        <span class="comment">\ tileData table</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">31</span>                <span class="comment">\ Set A counter in X to work through the tile data for</span>
                        <span class="comment">\ the 32 tiles in the strip we just smoothed</span>

<span class="label">.stri17</span><a id="stri17" class="anchor"></a>

 <span class="mne">TXA</span>                    <span class="comment">\ Set A to the tile index</span>

 <span class="mne">BIT</span> <a class="popup variable">processAction</a>      <span class="comment">\ If bit 7 of processAction is clear then we are</span>
 <span class="mne">BPL</span> <a class="popup destination">stri18</a>             <span class="comment">\ smoothing a row of tiles at z-coordinate zTile, so</span>
                        <span class="comment">\ jump to stri18 to iterate across xTile</span>

 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ If we get here then we are smoothing a column of tiles</span>
                        <span class="comment">\ so set zTile to the counter in X so we iterate along</span>
                        <span class="comment">\ the z-coordinate (i.e. coming out of the screen)</span>

 <span class="mne">JMP</span> <a class="popup destination">stri19</a>             <span class="comment">\ Jump to stri19 to skip the following</span>

<span class="label">.stri18</span><a id="stri18" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\ If we get here then we are smoothing a row of tiles</span>
                        <span class="comment">\ so set xTile to the counter in X so we iterate along</span>
                        <span class="comment">\ the x-coordinate (i.e. from right to left)</span>

<span class="label">.stri19</span><a id="stri19" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetTileData</a>        <span class="comment">\ Set A to the tile data for the tile anchored at</span>
                        <span class="comment">\ (xTile, zTile), which we ignore, but this also sets</span>
                        <span class="comment">\ the tile page in tileDataPage and the index in Y, so</span>
                        <span class="comment">\ tileDataPage+Y now points to the tile data entry in</span>
                        <span class="comment">\ the tileData table</span>

 <span class="mne">LDA</span> <a class="popup variable">stripData</a>,<span class="register">X</span>        <span class="comment">\ Copy the X-th byte of tile data from the smoothed</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">tileDataPage</a><span class="bracket">)</span>,<span class="register">Y</span>   <span class="comment">\ strip into the corresponding entry for (xTile, zTile)</span>
                        <span class="comment">\ in the tileData table</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the tile counter in X so we work our way</span>
                        <span class="comment">\ along to the next tile in the strip we are smoothing</span>

 <span class="mne">BPL</span> <a class="popup destination">stri17</a>             <span class="comment">\ Loop back to smooth the next tile until we have</span>
                        <span class="comment">\ smoothed the whole strip</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gettiledata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/gettiledata.html">GetTileData</a> (category: Landscape)</div><div class="summary">Get the tile data and tile data address for a specific tile</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processaction"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#processaction">processAction</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Defines the following</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri17"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/smoothtilecorners_part_4_of_4.html#stri17">stri17</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri18"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/smoothtilecorners_part_4_of_4.html#stri18">stri18</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stri19"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/smoothtilecorners_part_4_of_4.html#stri19">stri19</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-stripdata"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/stripdata.html">stripData</a> (category: Landscape)</div><div class="summary">Storage for tile data when smoothing strips of tiles during the landscape generation process</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tiledatapage"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#tiledatapage">tileDataPage</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The address of the tileData page containing the current tile's data</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xtile">xTile</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Tile corner x-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ztile">zTile</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/setcrackerseed.html">SetCrackerSeed</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/gettileshape.html">GetTileShape</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
