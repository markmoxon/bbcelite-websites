<?php
include_once("../../../templates/template_functions.php");
page_header("sights", "subroutine_movesightssideways.html", "The MoveSightsSideways subroutine", "Sights: MoveSightsSideways", "Annotated code for the MoveSightsSideways subroutine in The Sentinel", "the_sentinel-code", "source_sights", "subroutine_movesightssideways", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/movesights.html">MoveSights</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/movesightsupdown.html">MoveSightsUpDown</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">MoveSightsSideways</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sights</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Check for the left/right keys and move the sights accordingly,</span>
             <span class="headerEntry">panning to the left or right if they go past the screen edges</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_h.html#header-movesightssideways">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/movesights.html">MoveSights</a> calls <a href="#movesightssideways">MoveSightsSideways</a></span>
</div>
</div></div>
<span class="label">.MoveSightsSideways</span><a id="movesightssideways" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">keyLogger</a>          <span class="comment">\ Set X to the key logger entry for "S" and "D" (pan</span>
                        <span class="comment">\ left, pan right), which are used to move the sights</span>

 <span class="mne">BMI</span> <a class="popup destination">sisd4</a>              <span class="comment">\ If there is no key press in the key logger entry, jump</span>
                        <span class="comment">\ to sisd4 to return from the subroutine</span>

                        <span class="comment">\ If we get here then "S" or "D" is being pressed, which</span>
                        <span class="comment">\ will put 1 or 0 into the key logger respectively</span>

 <span class="mne">BNE</span> <a class="popup destination">sisd2</a>              <span class="comment">\ If X = 1 then "S" is being pressed, so jump to sisd2</span>
                        <span class="comment">\ to process moving the sights left</span>

                        <span class="comment">\ If we get here then X = 0, so "D" is being pressed,</span>
                        <span class="comment">\ which is the key for moving the sights right</span>

 <span class="mne">LDA</span> <a class="popup variable">xSights</a>            <span class="comment">\ Increment xSights to move the sights right</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">144</span>               <span class="comment">\ If xSights &lt; 144 then skip the following, as the</span>
 <span class="mne">BCC</span> <a class="popup destination">sisd1</a>              <span class="comment">\ sights have not moved off the right edge of the screen</span>

                        <span class="comment">\ If we get here then the sights have just moved off the</span>
                        <span class="comment">\ right edge of the screen, so we need to pan the screen</span>
                        <span class="comment">\ by moving the sights back towards the centre of the</span>
                        <span class="comment">\ screen and starting a pan right by "pressing" the</span>
                        <span class="comment">\ relevant pan key</span>

 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ Subtract 64 from A to move the sights to the left by</span>
                        <span class="comment">\ 64, as we are about to pan the screen to the right</span>
                        <span class="comment">\ (the subtraction works because we passed through a</span>
                        <span class="comment">\ BCC so we know the C flag is set)</span>

 <span class="mne">STX</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ Set panKeyBeingPressed to the key logger entry for "D"</span>
                        <span class="comment">\ to pretend that the "D" key is being pressed to pan</span>
                        <span class="comment">\ the screen as well as move the sights</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This will pan to the right by scrolling the screen to</span>
                        <span class="comment">\ the left</span>

<span class="label">.sisd1</span><a id="sisd1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xSights</a>            <span class="comment">\ Update the x-coordinate of the sights to the updated</span>
                        <span class="comment">\ value in A</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ If the x-coordinate is now a multiple of four then the</span>
 <span class="mne">BEQ</span> <a class="popup destination">SetSightsAddress</a>   <span class="comment">\ sights just moved right into the next character block</span>
                        <span class="comment">\ (as each block is four pixels wide), so jump to</span>
                        <span class="comment">\ SetSightsAddress with X = 0 to update the screen</span>
                        <span class="comment">\ variables for the sights</span>

 <span class="mne">JMP</span> <a class="popup destination">sisd4</a>              <span class="comment">\ Otherwise jump to sisd4 to return from the subroutine</span>

<span class="label">.sisd2</span><a id="sisd2" class="anchor"></a>

                        <span class="comment">\ If we get here then X = 1, so "S" is being pressed,</span>
                        <span class="comment">\ which is the key for moving the sights left</span>

 <span class="mne">LDA</span> <a class="popup variable">xSights</a>            <span class="comment">\ Decrement xSights to move the sights left</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">16</span>                <span class="comment">\ If xSights >= 16 then skip the following, as the</span>
 <span class="mne">BCS</span> <a class="popup destination">sisd3</a>              <span class="comment">\ sights have not moved off the left edge of the screen</span>

                        <span class="comment">\ If we get here then the sights have just moved off the</span>
                        <span class="comment">\ left edge of the screen, so we need to pan the screen</span>
                        <span class="comment">\ by moving the sights back towards the centre of the</span>
                        <span class="comment">\ screen and starting a pan left by "pressing" the</span>
                        <span class="comment">\ relevant pan key</span>

 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ Add 64 to A to move the sights to the right by 64, as</span>
                        <span class="comment">\ we are about to pan the screen to the left (the</span>
                        <span class="comment">\ addition works because we passed through a BCS so we</span>
                        <span class="comment">\ know the C flag is clear)</span>

 <span class="mne">STX</span> <a class="popup variable">panKeyBeingPressed</a> <span class="comment">\ Set panKeyBeingPressed to the key logger entry for "S"</span>
                        <span class="comment">\ to pretend that the "S" key is being pressed to pan</span>
                        <span class="comment">\ the screen as well as move the sights</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This will pan to the left by scrolling the screen to</span>
                        <span class="comment">\ the right</span>

<span class="label">.sisd3</span><a id="sisd3" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xSights</a>            <span class="comment">\ Update the x-coordinate of the sights to the updated</span>
                        <span class="comment">\ value in A</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ If the x-coordinate is now one less than a multiple of</span>
 <span class="mne">CMP</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ four then the sights just moved left into the previous</span>
 <span class="mne">BEQ</span> <a class="popup destination">SetSightsAddress</a>   <span class="comment">\ character block (as each block is four pixels wide),</span>
                        <span class="comment">\ so jump to SetSightsAddress to update the screen</span>
                        <span class="comment">\ variables for the sights</span>

<span class="label">.sisd4</span><a id="sisd4" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setsightsaddress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/setsightsaddress.html">SetSightsAddress</a> (category: Sights)</div><div class="summary">Update the address variables for the sights when they move into a new character block or row</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-keylogger"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#keylogger">keyLogger</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The four-byte key logger for logging game key presses</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pankeybeingpressed"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#pankeybeingpressed">panKeyBeingPressed</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The direction in which the player is currently panning</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sisd1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/movesightssideways.html#sisd1">sisd1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sisd2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/movesightssideways.html#sisd2">sisd2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sisd3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/movesightssideways.html#sisd3">sisd3</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sisd4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/movesightssideways.html#sisd4">sisd4</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xsights"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#xsights">xSights</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The pixel x-coordinate of the sights on-screen</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/movesights.html">MoveSights</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/movesightsupdown.html">MoveSightsUpDown</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
