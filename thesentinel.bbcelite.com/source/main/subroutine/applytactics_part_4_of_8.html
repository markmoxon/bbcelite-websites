<?php
include_once("../../../templates/template_functions.php");
page_header("gameplay", "subroutine_applytactics_part_4_of_8.html", "The ApplyTactics (Part 4 of 8) subroutine", "Gameplay: ApplyTactics (Part 4 of 8)", "Annotated code for the ApplyTactics (Part 4 of 8) subroutine in The Sentinel", "the_sentinel-code", "source_gameplay", "subroutine_applytactics_part_4_of_8", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/applytactics_part_3_of_8.html">ApplyTactics (Part 3 of 8)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/applytactics_part_5_of_8.html">ApplyTactics (Part 5 of 8)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">ApplyTactics (Part 4 of 8)</span>                              <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Gameplay</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">If configured, search the landscape for a suitable target for the</span>
             <span class="headerEntry">enemy to drain of energy</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_b.html#header-applytactics-part-4-of-8">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tact7</span><a id="tact7" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics (so this is now object #X)</span>

 <span class="mne">LDA</span> <a class="popup variable">enemyDrainScan</a>,<span class="register">X</span>   <span class="comment">\ If bit 7 of enemyDrainScan is clear, jump to part 5 to</span>
 <span class="mne">BPL</span> <a class="popup destination">tact9</a>              <span class="comment">\ skip the search for a drainable object</span>

 <span class="mne">JSR</span> <a class="popup destination">FindObjectToDrain</a>  <span class="comment">\ Find a suitable target object for the enemy to drain</span>
                        <span class="comment">\ (i.e. a tree that is stacked on top of another object,</span>
                        <span class="comment">\ or a boulder, which is exposed to the enemy and on a</span>
                        <span class="comment">\ tile that can be seen by the enemy)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ If successful, the object number is in targetObject</span>
                        <span class="comment">\ and the C flag is clear, otherwise the C flag is set</span>

 <span class="mne">LDX</span> <a class="popup variable">enemyObject</a>        <span class="comment">\ Set X to the object number of the enemy to which we</span>
                        <span class="comment">\ are applying tactics (so this is now object #X)</span>

 <span class="mne">BCS</span> <a class="popup destination">tact8</a>              <span class="comment">\ If FindObjectToDrain set the C flag, then no suitable</span>
                        <span class="comment">\ object was found for the enemy to drain, so jump to</span>
                        <span class="comment">\ tact8 to stop the enemy from searching again and keep</span>
                        <span class="comment">\ applying tactics</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">64</span>                <span class="comment">\ Set enemyMeanieCheck = 64 for the enemy so if we start</span>
 <span class="mne">STA</span> <a class="popup variable">enemyMeanieScan</a>,<span class="register">X</span>  <span class="comment">\ scanning objects for trees to potentially turn into a</span>
                        <span class="comment">\ meanie, we start from the last object and work down</span>

 <span class="mne">BNE</span> <a class="popup destination">tact15</a>             <span class="comment">\ Jump to tact15 to drain energy from the target object</span>
                        <span class="comment">\ (this BNE is effectively a JMP as A is never zero)</span>

<span class="label">.tact8</span><a id="tact8" class="anchor"></a>

 <span class="mne">LSR</span> <a class="popup variable">enemyDrainScan</a>,<span class="register">X</span>   <span class="comment">\ Clear bit 7 of enemyDrainScan for this enemy to stop</span>
                        <span class="comment">\ it searching for a drainable target for now</span>

                        <span class="comment">\ Fall through into part 5 to keep applying tactics to</span>
                        <span class="comment">\ this enemy</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-findobjecttodrain"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/findobjecttodrain.html">FindObjectToDrain</a> (category: Gameplay)</div><div class="summary">Find a suitable target object for an enemy to drain</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemydrainscan"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#enemydrainscan">enemyDrainScan</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Enemy will perform a scan for a drainable object (one</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemymeaniescan"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#enemymeaniescan">enemyMeanieScan</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Enemy meanie scan object counter (one byte per enemy)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-enemyobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#enemyobject">enemyObject</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The object number of the enemy to which we are applying tactics in this iteration around the main loop (0-7)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact15"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/applytactics_part_5_of_8.html#tact15">tact15</a> in subroutine <a href="/source/main/subroutine/applytactics_part_5_of_8.html">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/applytactics_part_4_of_8.html#tact8">tact8</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tact9"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/applytactics_part_5_of_8.html#tact9">tact9</a> in subroutine <a href="/source/main/subroutine/applytactics_part_5_of_8.html">ApplyTactics (Part 5 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/applytactics_part_3_of_8.html">ApplyTactics (Part 3 of 8)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/applytactics_part_5_of_8.html">ApplyTactics (Part 5 of 8)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
