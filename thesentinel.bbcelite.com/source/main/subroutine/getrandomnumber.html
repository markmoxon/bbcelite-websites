<?php
include_once("../../../templates/template_functions.php");
page_header("maths_arithmetic", "subroutine_getrandomnumber.html", "The GetRandomNumber subroutine", "Maths (Arithmetic): GetRandomNumber", "Annotated code for the GetRandomNumber subroutine in The Sentinel", "the_sentinel-code", "source_maths_arithmetic", "subroutine_getrandomnumber", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/ystorehypotenuse.html">yStoreHypotenuse</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/randomgenerator.html">randomGenerator</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">GetRandomNumber</span>                                         <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Arithmetic)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Set A to a random number</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_i.html#header-getrandomnumber">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/ditherscreenbuffer.html">DitherScreenBuffer</a> calls <a href="#getrandomnumber">GetRandomNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawrandomdots.html">DrawRandomDots</a> calls <a href="#getrandomnumber">GetRandomNumber</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/updatescannernow.html">UpdateScannerNow</a> calls <a href="#getrandomnumber">GetRandomNumber</a></span>
</div>
</div></div>
<span class="label">.GetRandomNumber</span><a id="getrandomnumber" class="anchor"></a>

                        <span class="comment">\ We generate a new random number by taking our 24-bit</span>
                        <span class="comment">\ generator in randomGenerator(2 1 0) and adding it to</span>
                        <span class="comment">\ itself but shifted left by two places, so on each</span>
                        <span class="comment">\ iteration we do the following:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   randomGenerator(2 1 0) += shiftGenerator(2 1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We then return the high byte of randomGenerator(2 1 0)</span>
                        <span class="comment">\ as the next random number</span>

 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a>    <span class="comment">\ Set shiftGenerator(2 1 0) = randomGenerator(2 1 0)</span>
 <span class="mne">STA</span> <a class="popup variable">shiftGenerator</a>
 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">STA</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">2</span>
 <span class="mne">STA</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">2</span>

 <span class="mne">ASL</span> <a class="popup variable">shiftGenerator</a>     <span class="comment">\ Shift shiftGenerator(2 1 0) left by two places</span>
 <span class="mne">ROL</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ROL</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">2</span>
 <span class="mne">ASL</span> <a class="popup variable">shiftGenerator</a>
 <span class="mne">ROL</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ROL</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">2</span>

 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a>    <span class="comment">\ Set randomGenerator(2 1 0) += shiftGenerator(2 1 0)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">shiftGenerator</a>     <span class="comment">\ This also sets A to byte #2 of randomGenerator, so we</span>
 <span class="mne">STA</span> <a class="popup variable">randomGenerator</a>    <span class="comment">\ return this as the next random number</span>
 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">STA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">2</span>
 <span class="mne">ADC</span> <a class="popup variable">shiftGenerator</a><span class="operator">+</span><span class="decimal">2</span>
 <span class="mne">STA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">2</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-randomgenerator"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/randomgenerator.html">randomGenerator</a> (category: Maths (Arithmetic))</div><div class="summary">A 24-bit random number generator that works independently from the landscape seeds and with a much simpler generation algorithm</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-shiftgenerator"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/shiftgenerator.html">shiftGenerator</a> (category: Maths (Arithmetic))</div><div class="summary">Storage for randomGenerator(2 1 0) while we shift it left by two places</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/ystorehypotenuse.html">yStoreHypotenuse</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/randomgenerator.html">randomGenerator</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
