<?php
include_once("../../../templates/template_functions.php");
page_header("graphics", "subroutine_drawrandomdots.html", "The DrawRandomDots subroutine", "Graphics: DrawRandomDots", "Annotated code for the DrawRandomDots subroutine in The Sentinel", "the_sentinel-code", "source_graphics", "subroutine_drawrandomdots", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawblackdots.html">DrawBlackDots</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/dotcounter.html">dotCounter</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">DrawRandomDots</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Graphics</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Draw 80 randomly positioned dots on the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_i.html#header-drawrandomdots">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawstars.html">DrawStars</a> calls <a href="#drawrandomdots">DrawRandomDots</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The colour of the dots:</span>

                        <span class="argumentEntry">  * Bit 7 clear = colour 1 (black)</span>

                        <span class="argumentEntry">  * Bit 7 set = colour 2 (white, yellow, cyan or red)</span>

</div></div>
<span class="label">.DrawRandomDots</span><a id="drawrandomdots" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">dotColour</a>          <span class="comment">\ Set dotColour to the value of A from above, so we</span>
                        <span class="comment">\ draw coloured dots if bit 7 is set or black dots if</span>
                        <span class="comment">\ bit 7 is clear</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">80</span>                <span class="comment">\ Set dotCounter = 80 so we draw 80 dots on the screen</span>
 <span class="mne">STA</span> <a class="popup variable">dotCounter</a>

<span class="label">.dots1</span><a id="dots1" class="anchor"></a>

 <span class="mne">JSR</span> <a class="popup destination">GetRandomNumber</a>    <span class="comment">\ Set A to a random number</span>

 <span class="mne">STA</span> <a class="popup variable">screenAddr</a>         <span class="comment">\ Set the low byte of screenAddr(1 0) to the random</span>
                        <span class="comment">\ number in A</span>

 <span class="mne">LDA</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">1</span>  <span class="comment">\ Set randomPixel to the second byte of the random</span>
 <span class="mne">STA</span> <a class="popup variable">randomPixel</a>        <span class="comment">\ number generator, so this is also a random number</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="hex">&1F</span>               <span class="comment">\ Reduce the random number to the range 0 to &1F</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&1E</span>               <span class="comment">\ If A >= &1E then loop back to dots1 to choose another</span>
 <span class="mne">BCS</span> <a class="popup destination">dots1</a>              <span class="comment">\ random number</span>

 <span class="mne">STA</span> <a class="popup variable">screenAddr</a><span class="operator">+</span><span class="decimal">1</span>       <span class="comment">\ Set the high byte of screenAddr(1 0) to A, so we now</span>
                        <span class="comment">\ have screenAddr(1 0) set to a random number in the</span>
                        <span class="comment">\ range 0 to &1DFF</span>

                        <span class="comment">\ We can now add this to the address of the start of</span>
                        <span class="comment">\ screen memory in viewScreenAddr(1 0) to get the</span>
                        <span class="comment">\ address of a random pixel byte within screen memory</span>

 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a>     <span class="comment">\ Set screenAddr(1 0) = viewScreenAddr(1 0)</span>
 <span class="mne">CLC</span>                    <span class="comment">\                       + screenAddr(1 0)</span>
 <span class="mne">ADC</span> <a class="popup variable">screenAddr</a>
 <span class="mne">STA</span> <a class="popup variable">screenAddr</a>
 <span class="mne">LDA</span> <a class="popup variable">viewScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>
 <span class="mne">ADC</span> <a class="popup variable">screenAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">dots2</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.dots2</span><a id="dots2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">screenAddr</a><span class="operator">+</span><span class="decimal">1</span>       <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   screenAddr(1 0) = viewScreenAddr(1 0)</span>
                        <span class="comment">\                     + screenAddr(1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So screenAddr(1 0) is the address of a random pixel</span>
                        <span class="comment">\ byte within screen memory</span>

 <span class="mne">LDA</span> <a class="popup variable">randomPixel</a>        <span class="comment">\ Take bits 6 and 7 of randomPixel and put them into</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ bits 0 and 1 of X (with all the other bits clear), so</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ X is a random number in the range 0 to 3 that we can</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ use as the pixel number within the pixel byte for the</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>         <span class="comment">\ dot we want to draw</span>
 <span class="mne">TAX</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 so we can use (screenAddr),Y below to behave</span>
                        <span class="comment">\ like AND (screenAddr) or STA (screenAddr)</span>

 <span class="mne">LDA</span> <a class="popup variable">pixelBitMask</a>,<span class="register">X</span>     <span class="comment">\ Take the existing pixel byte from screenAddr(1 0) and</span>
 <span class="mne">EOR</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ clear the two bits for pixel number X (the EOR inverts</span>
 <span class="mne">AND</span> <span class="bracket">(</span><a class="popup variable">screenAddr</a><span class="bracket">)</span>,<span class="register">Y</span>     <span class="comment">\ the mask in pixelBitMask so that AND'ing the mask will</span>
                        <span class="comment">\ clear pixel X while leaving the other pixels alone</span>

 <span class="mne">ORA</span> <a class="popup variable">pixelByteColour1</a>,<span class="register">X</span> <span class="comment">\ Change the two bits for pixel X into colour 1 (%01),</span>
                        <span class="comment">\ which is black, so that drawing lots of dots will</span>
                        <span class="comment">\ slowly turn the screen to black</span>

 <span class="mne">BIT</span> <a class="popup variable">dotColour</a>          <span class="comment">\ If bit 7 of dotColour is set, flip the two bits of the</span>
 <span class="mne">BPL</span> <a class="popup destination">dots3</a>              <span class="comment">\ pixel so they are drawn in colour 2 (%10), for when we</span>
 <span class="mne">EOR</span> <a class="popup variable">pixelBitMask</a>,<span class="register">X</span>     <span class="comment">\ we want to draw coloured stars instead</span>

<span class="label">.dots3</span><a id="dots3" class="anchor"></a>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">screenAddr</a><span class="bracket">)</span>,<span class="register">Y</span>     <span class="comment">\ Store the updated pixel byte in screenAddr(1 0) to</span>
                        <span class="comment">\ draw a black dot or a coloured star on-screen</span>

 <span class="mne">DEC</span> <a class="popup variable">dotCounter</a>         <span class="comment">\ Decrement the dot counter</span>

 <span class="mne">BNE</span> <a class="popup destination">dots1</a>              <span class="comment">\ Loop back until we have drawn all 80 dots</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getrandomnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/getrandomnumber.html">GetRandomNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a random number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dotcolour"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/dotcolour.html">dotColour</a> (category: Graphics)</div><div class="summary">A flag that determines the colour of the dots drawn by the DrawRandomDots routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dotcounter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/dotcounter.html">dotCounter</a> (category: Graphics)</div><div class="summary">A counter for the number of dots drawn in the DrawRandomDots routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dots1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawrandomdots.html#dots1">dots1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dots2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawrandomdots.html#dots2">dots2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dots3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/drawrandomdots.html#dots3">dots3</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelbitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/pixelbitmask.html">pixelBitMask</a> (category: Graphics)</div><div class="summary">A table for converting a pixel number in the range 0 to 3 into a screen mode 5 bit mask with that pixel's bits set and others clear</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelbytecolour1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/pixelbytecolour1.html">pixelByteColour1</a> (category: Sights)</div><div class="summary">A table for converting a pixel number in the range 0 to 3 into a screen mode 5 pixel byte with that pixel set to colour 1 (%01)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-randomgenerator"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/randomgenerator.html">randomGenerator</a> (category: Maths (Arithmetic))</div><div class="summary">A 24-bit random number generator that works independently from the landscape seeds and with a much simpler generation algorithm</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-randompixel"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#randompixel">randomPixel</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Storage for a random value in the DrawRandomDots routine to use as a random pixel number when drawing dots</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#screenaddr">screenAddr</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Storage for a screen address</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-viewscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#viewscreenaddr">viewScreenAddr</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The screen address of the player's scrolling landscape view, which is just below the icon and scanner row at the top of the screen</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawblackdots.html">DrawBlackDots</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/dotcounter.html">dotCounter</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
