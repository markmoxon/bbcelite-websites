<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_polygons", "subroutine_tracepolygonedge_part_5_of_8.html", "The TracePolygonEdge (Part 5 of 8) subroutine", "Drawing polygons: TracePolygonEdge (Part 5 of 8)", "Annotated code for the TracePolygonEdge (Part 5 of 8) subroutine in The Sentinel", "the_sentinel-code", "source_drawing_polygons", "subroutine_tracepolygonedge_part_5_of_8", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/tracepolygonedge_part_4_of_8.html">TracePolygonEdge (Part 4 of 8)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">GetPolygonLines (Part 6 of 6)</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">TracePolygonEdge (Part 5 of 8)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing polygons</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Trace a shallow edge that starts off-screen, without storing the</span>
             <span class="headerEntry">coordinates, until we reach the screen and return to part 3</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-tracepolygonedge-part-5-of-8">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">No direct references to this subroutine in this source file</span>
</div>
</div></div>
<span class="label">.tred31</span><a id="tred31" class="anchor"></a>

 <span class="mne">INC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Increment the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred24 to balance out the additional</span>
                        <span class="comment">\ DEC tred24+1 that we do below when we rejoin the</span>
                        <span class="comment">\ loop in part 3</span>

 <span class="mne">LDX</span> <a class="popup variable">tred22</a>             <span class="comment">\ Modify the instruction at tred32 so it matches the</span>
 <span class="mne">STX</span> <a class="popup variable">tred32</a>             <span class="comment">\ modified instruction at tred22, so that's:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">LDX</span> <a class="popup variable">xEdgeStartLo</a>       <span class="comment">\ Set X to the x-coordinate of the starting point, so we</span>
                        <span class="comment">\ can start tracing from the start of the edge</span>

                        <span class="comment">\ The loop below has the same structure as the loop in</span>
                        <span class="comment">\ part 3 between tred22 and tred25, and which we enter</span>
                        <span class="comment">\ via tred24, but in this version of the loop we do not</span>
                        <span class="comment">\ store the coordinates of the edge, as the portion we</span>
                        <span class="comment">\ are currently tracing is off-screen</span>

 <span class="mne">JMP</span> <a class="popup destination">tred33</a>             <span class="comment">\ Jump into the middle of the loop at tred33 to trace</span>
                        <span class="comment">\ the edge but without storing the results</span>

<span class="label">.tred32</span><a id="tred32" class="anchor"></a>

 <span class="mne">INX</span>                    <span class="comment">\ This instruction is modified above to:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * INX (if we are stepping right along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * DEX (if we are stepping left along the x-axis)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So in either case this steps us along the x-axis by</span>
                        <span class="comment">\ one pixel</span>

 <span class="mne">ADC</span> <a class="popup variable">yEdgeDeltaLo</a>       <span class="comment">\ Add the y-axis delta to the slope error in A, so we</span>
                        <span class="comment">\ keep track of the slope error as we move along the</span>
                        <span class="comment">\ x-axis</span>

 <span class="mne">BCC</span> <a class="popup destination">tred33</a>             <span class="comment">\ If the addition didn't overflow then we have not</span>
                        <span class="comment">\ moved into a new y-coordinate with this step along the</span>
                        <span class="comment">\ x-axis, so jump to tred33 so we do not move along the</span>
                        <span class="comment">\ y-axis</span>

 <span class="mne">SBC</span> <a class="popup variable">xEdgeDelta</a>         <span class="comment">\ Set A = A - xEdgeDelta ???</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This subtraction works as we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

 <span class="mne">DEC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred24 so that it points to the table</span>
                        <span class="comment">\ entry for the next y-coordinate down</span>

 <span class="mne">BEQ</span> <a class="popup destination">tred34</a>             <span class="comment">\ If we just decremented the low byte of the address to</span>
                        <span class="comment">\ zero then we have finished stepping along the y-axis</span>
                        <span class="comment">\ for this value of the high byte, so the next address</span>
                        <span class="comment">\ we decrement it to will be on-screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We therefore jump to tred34 to set the address for the</span>
                        <span class="comment">\ top of the screen and rejoin the edge-tracing loop in</span>
                        <span class="comment">\ part 3 to keep tracing the edge</span>

<span class="label">.tred33</span><a id="tred33" class="anchor"></a>

 <span class="mne">DEY</span>                    <span class="comment">\ Decrement the pixel counter in Y</span>

 <span class="mne">BNE</span> <a class="popup destination">tred32</a>             <span class="comment">\ Loop back to keep tracing the polygon edge until we</span>
                        <span class="comment">\ have worked our way through all the pixels along the</span>
                        <span class="comment">\ x-axis</span>

 <span class="mne">JMP</span> <a class="popup destination">tred16</a>             <span class="comment">\ If we get here then we have finished tracing the edge</span>
                        <span class="comment">\ and we didn't reach an on-screen portion, so jump to</span>
                        <span class="comment">\ tred16 to return from the subroutine without changing</span>
                        <span class="comment">\ drawPolygon (as we didn't draw anything in this</span>
                        <span class="comment">\ routine)</span>

<span class="label">.tred34</span><a id="tred34" class="anchor"></a>

 <span class="mne">DEC</span> <a class="popup variable">tred24</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Decrement the low byte of the address in the STX</span>
                        <span class="comment">\ instruction at tred24 to &FF (as we only get here when</span>
                        <span class="comment">\ we have just decremented it to zero), so it now points</span>
                        <span class="comment">\ to the address for the top line of the screen at a</span>
                        <span class="comment">\ y-coordinate of 255</span>

 <span class="mne">JMP</span> <a class="popup destination">tred25</a>             <span class="comment">\ Jump to tred25 to rejoin the normal edge-tracing loop</span>
                        <span class="comment">\ in part 3 so we trace the rest of the edge</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred16"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_2_of_8.html#tred16">tred16</a> in subroutine <a href="/source/main/subroutine/tracepolygonedge_part_2_of_8.html">TracePolygonEdge (Part 2 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred22"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html#tred22">tred22</a> in subroutine <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred24"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html#tred24">tred24</a> in subroutine <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred25"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html#tred25">tred25</a> in subroutine <a href="/source/main/subroutine/tracepolygonedge_part_3_of_8.html">TracePolygonEdge (Part 3 of 8)</a></div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred32"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_5_of_8.html#tred32">tred32</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred33"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_5_of_8.html#tred33">tred33</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tred34"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/tracepolygonedge_part_5_of_8.html#tred34">tred34</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgedelta"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgedelta">xEdgeDelta</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The scaled and signed x-axis delta between two polygon points when tracing the polygon edges (single byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xedgestartlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xedgestartlo">xEdgeStartLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The x-coordinate of the start point in the polygon edge being processed (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yedgedeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#yedgedeltalo">yEdgeDeltaLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference in pitch angle between two polygon points, i.e. the delta along the y-axis (low byte)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/tracepolygonedge_part_4_of_8.html">TracePolygonEdge (Part 4 of 8)</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getpolygonlines_part_6_of_6.html">GetPolygonLines (Part 6 of 6)</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
