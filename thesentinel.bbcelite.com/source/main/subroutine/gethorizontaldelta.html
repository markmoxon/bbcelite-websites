<?php
include_once("../../../templates/template_functions.php");
page_header("maths_geometry", "subroutine_gethorizontaldelta.html", "The GetHorizontalDelta subroutine", "Maths (Geometry): GetHorizontalDelta", "Annotated code for the GetHorizontalDelta subroutine in The Sentinel", "the_sentinel-code", "source_maths_geometry", "subroutine_gethorizontaldelta", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawobject.html">DrawObject</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getverticaldelta.html">GetVerticalDelta</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">GetHorizontalDelta</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Maths (Geometry)</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Calculate the difference in the x-axis and z-axis between two</span>
             <span class="headerEntry">objects, as both signed and absolute deltas</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_j.html#header-gethorizontaldelta">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/getobjectangles.html">GetObjectAngles</a> calls <a href="#gethorizontaldelta">GetHorizontalDelta</a></span>
</div>
<hr class="light">
 This routine calculates the following:

   xDelta(Hi Lo) = x-coordinate of object #Y - x-coordinate of object #X
                                                   - xTitleOffset

   xDeltaAbsoluteHi = |xDeltaHi|

   zDelta(Hi Lo) = z-coordinate of object #Y - z-coordinate of object #X

   zDeltaAbsoluteHi = |zDeltaHi|

 So this calculates the difference (the "delta") in both the x-coordinate and
 z-coordinate between the two objects, which are the differences along the
 left-right x-axis and the z-axis the goes into the screen.

 Note that xTitleOffset is zero during gameplay, and is only non-zero when we
 are drawing large 3D text on the title screen.

<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">The number of the first object</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">The number of the second object</span>

</div></div>
<span class="label">.GetHorizontalDelta</span><a id="gethorizontaldelta" class="anchor"></a>

                        <span class="comment">\ The x-coordinates for each object are stored as 8-bit</span>
                        <span class="comment">\ signed integers, with the x-coordinate for object #X</span>
                        <span class="comment">\ in xObject+X and for object #Y in xObject+Y</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We want to calculate the deltas in 16-bit accuracy,</span>
                        <span class="comment">\ where the low byte is effectively a fractional part,</span>
                        <span class="comment">\ so we convert these x-coordinates into 16-bit numbers</span>
                        <span class="comment">\ like this:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * x-coordinate for object #X = (xObject+X 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * x-coordinate for object #Y = (xObject+Y 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and we then do a multi-byte subtraction to get the</span>
                        <span class="comment">\ delta, with the title offset included in the</span>
                        <span class="comment">\ calculation as (xTitleOffset 0)</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Calculate the following:</span>
 <span class="mne">STA</span> <a class="popup variable">xDeltaLo</a>           <span class="comment">\</span>
                        <span class="comment">\   xDelta(Hi Lo) = (xObject+Y 0) - (xObject,X 0)</span>
                        <span class="comment">\                                 - (xTitleOffset 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low byte (which we know will be</span>
                        <span class="comment">\ zero)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ And then subtracting the high bytes</span>
 <span class="mne">LDA</span> <a class="popup variable">xObject</a>,<span class="register">Y</span>
 <span class="mne">SBC</span> <a class="popup variable">xObject</a>,<span class="register">X</span>
 <span class="mne">SEC</span>
 <span class="mne">SBC</span> <a class="popup variable">xTitleOffset</a>
 <span class="mne">STA</span> <a class="popup variable">xDeltaHi</a>

 <span class="mne">BPL</span> <a class="popup destination">delt1</a>              <span class="comment">\ If the high byte of the result is positive, jump to</span>
                        <span class="comment">\ delt1 as the result in A is already correct for the</span>
                        <span class="comment">\ absolute value (i.e. A = xDeltaHi = |xDeltaHi|)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The high byte is negative, so set:</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">xDeltaHi</a>           <span class="comment">\   A = 0 - xDeltaHi</span>
                        <span class="comment">\     = -xDeltaHi</span>
                        <span class="comment">\     = |xDeltaHi|</span>

<span class="label">.delt1</span><a id="delt1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">xDeltaAbsoluteHi</a>   <span class="comment">\ Set xDeltaAbsoluteHi = |xDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute x-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (xDeltaAbsoluteHi xDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed x-axis length</span>
                        <span class="comment">\ is still in xDeltaHi</span>

                        <span class="comment">\ We now do the same thing, but with the z-coordinates</span>
                        <span class="comment">\</span>
                        <span class="comment">\ There is no title delta to include for the z-axis</span>
                        <span class="comment">\ calculation</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Calculate the following:</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaLo</a>           <span class="comment">\</span>
                        <span class="comment">\   zDelta(Hi Lo) = (zObject+Y 0) - (zObject,X 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ starting with the low byte (which we know will be</span>
                        <span class="comment">\ zero)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ And then subtracting the high bytes</span>
 <span class="mne">LDA</span> <a class="popup variable">zObject</a>,<span class="register">Y</span>
 <span class="mne">SBC</span> <a class="popup variable">zObject</a>,<span class="register">X</span>
 <span class="mne">STA</span> <a class="popup variable">zDeltaHi</a>

 <span class="mne">BPL</span> <a class="popup destination">delt2</a>              <span class="comment">\ If the high byte of the result is positive, jump to</span>
                        <span class="comment">\ delt2 as the result in A is already correct for the</span>
                        <span class="comment">\ absolute value (i.e. A = zDeltaHi = |zDeltaHi|)</span>

 <span class="mne">SEC</span>                    <span class="comment">\ The high byte is negative, so set:</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">SBC</span> <a class="popup variable">zDeltaHi</a>           <span class="comment">\   A = 0 - zDeltaHi</span>
                        <span class="comment">\     = -zDeltaHi</span>
                        <span class="comment">\     = |zDeltaHi|</span>

<span class="label">.delt2</span><a id="delt2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">zDeltaAbsoluteHi</a>   <span class="comment">\ Set zDeltaAbsoluteHi = |zDeltaHi|</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we now have the absolute z-axis length in:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   (zDeltaAbsoluteHi zDeltaLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the original high byte of the signed z-axis length</span>
                        <span class="comment">\ is still in zDeltaHi</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-delt1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/gethorizontaldelta.html#delt1">delt1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-delt2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/gethorizontaldelta.html#delt2">delt2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltaabsolutehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xdeltaabsolutehi">xDeltaAbsoluteHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The absolute difference between two x-coordinates (high byte), i.e. |xDeltaHi|</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xdeltahi">xDeltaHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference between two x-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xdeltalo">xDeltaLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference between two x-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xobject.html">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtitleoffset"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#xtitleoffset">xTitleOffset</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">An x-coordinate offset for drawing the title screen this is zero during gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltaabsolutehi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#zdeltaabsolutehi">zDeltaAbsoluteHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The absolute difference between two z-coordinates (high byte), i.e. |zDeltaHi|</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltahi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#zdeltahi">zDeltaHi</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference between two z-coordinates (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zdeltalo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#zdeltalo">zDeltaLo</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The difference between two z-coordinates (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-zobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/zobject.html">zObject</a> (category: 3D objects)</div><div class="summary">The z-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/drawobject.html">DrawObject</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/getverticaldelta.html">GetVerticalDelta</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
