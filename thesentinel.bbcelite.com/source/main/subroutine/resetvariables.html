<?php
include_once("../../../templates/template_functions.php");
page_header("main_title_loop", "subroutine_resetvariables.html", "The ResetVariables subroutine", "Main title Loop: ResetVariables", "Annotated code for the ResetVariables subroutine in The Sentinel", "the_sentinel-code", "source_main_title_loop", "subroutine_resetvariables", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/lowestpitchangle.html">lowestPitchAngle</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/resettilesobjects.html">ResetTilesObjects</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">ResetVariables</span>                                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main title Loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Reset all the game's main variables</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_b.html#header-resetvariables">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#resetvariables">ResetVariables</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maintitleloop.html">MainTitleLoop</a> calls <a href="#resetvariables">ResetVariables</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/secretcodeerror.html">SecretCodeError</a> calls <a href="#resetvariables">ResetVariables</a></span>
</div>
</div></div>
<span class="label">.ResetVariables</span><a id="resetvariables" class="anchor"></a>

 <span class="mne">SEC</span>                    <span class="comment">\ Set bit 7 of gameInProgress to indicate that a game is</span>
 <span class="mne">ROR</span> <a class="popup variable">gameInProgress</a>     <span class="comment">\ not currently in progress and that we are in the title</span>
                        <span class="comment">\ and preview screens (so the interrupt handler doesn't</span>
                        <span class="comment">\ update the game)</span>

                        <span class="comment">\ We now zero the following variable blocks:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0000 to &008F (Zero page workspace)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0100 to &01BF (Stack variables workspace)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0900 to &09EF (xObject)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0A00 to &0AEF (yObjectLo)</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0C00 to &0CE3 (Main variable workspace)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and set the following variable block to %10000000:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * &0CE4 to &0CEF (Main variable workspace)</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set X to use as a byte counter to run from 0 to &EF</span>

<span class="label">.rese1</span><a id="rese1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A = 0 so we can zero the following variable blocks</span>

 <span class="mne">STA</span> <a class="popup variable">xObject</a>,<span class="register">X</span>          <span class="comment">\ Zero the X-th byte of xObject</span>

 <span class="mne">STA</span> <a class="popup variable">yObjectLo</a>,<span class="register">X</span>        <span class="comment">\ Zero the X-th byte of yObjectLo</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&90</span>               <span class="comment">\ If X >= &90 then skip the following instruction</span>
 <span class="mne">BCS</span> <a class="popup destination">rese2</a>

 <span class="mne">STA</span> <span class="hex">&0000</span>,<span class="register">X</span>            <span class="comment">\ Zero the X-th byte of zero page</span>

<span class="label">.rese2</span><a id="rese2" class="anchor"></a>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&C0</span>               <span class="comment">\ If X >= &C0 then skip the following instruction</span>
 <span class="mne">BCS</span> <a class="popup destination">rese3</a>

 <span class="mne">STA</span> <span class="hex">&0100</span>,<span class="register">X</span>            <span class="comment">\ Zero the X-th byte of &0100</span>

<span class="label">.rese3</span><a id="rese3" class="anchor"></a>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&E4</span>               <span class="comment">\ If X &lt; &E4 then skip the following instruction,</span>
 <span class="mne">BCC</span> <a class="popup destination">rese4</a>              <span class="comment">\ leaving A = 0, so we zero &0C00 to &0CE3</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ If we get here then X >= &E4, so set A = %10000000 to</span>
                        <span class="comment">\ set bit 7 of &0CE4 to &0CEF</span>

<span class="label">.rese4</span><a id="rese4" class="anchor"></a>

 <span class="mne">STA</span> <span class="hex">&0C00</span>,<span class="register">X</span>            <span class="comment">\ Set the X-th byte of &0CE4 to A</span>

 <span class="mne">INX</span>                    <span class="comment">\ Increment the byte counter</span>

 <span class="mne">CPX</span> <span class="hash">#</span><span class="hex">&F0</span>               <span class="comment">\ Loop back until we have processed X from &E4 to &EF</span>
 <span class="mne">BCC</span> <a class="popup destination">rese1</a>              <span class="comment">\ to set &0CE4 to &0CEF to &80</span>

                        <span class="comment">\ Fall through into ResetTilesObjects to reset the tile</span>
                        <span class="comment">\ visibility table and deallocate all object numbers</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-gameinprogress"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#gameinprogress">gameInProgress</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Flags whether or not a game is in progress (i.e. the player is playing a landscape rather than interacting with the title and preview screens)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/resetvariables.html#rese1">rese1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/resetvariables.html#rese2">rese2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/resetvariables.html#rese3">rese3</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rese4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/resetvariables.html#rese4">rese4</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/xobject.html">xObject</a> (category: 3D objects)</div><div class="summary">The x-coordinates in 3D space for the 3D objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-yobjectlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/yobjectlo.html">yObjectLo</a> (category: 3D objects)</div><div class="summary">The y-coordinates in 3D space for the 3D objects (low byte)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/lowestpitchangle.html">lowestPitchAngle</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/resettilesobjects.html">ResetTilesObjects</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
