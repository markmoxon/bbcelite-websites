<?php
include_once("../../../templates/template_functions.php");
page_header("main_title_loop", "subroutine_resettilesobjects.html", "The ResetTilesObjects subroutine", "Main title Loop: ResetTilesObjects", "Annotated code for the ResetTilesObjects subroutine in The Sentinel", "the_sentinel-code", "source_main_title_loop", "subroutine_resettilesobjects", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/resetvariables.html">ResetVariables</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">ResetTilesObjects</span>                                       <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Main title Loop</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Reset the tile visibility table and deallocate all object numbers</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_b.html#header-resettilesobjects">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/maingameloop.html">MainGameLoop</a> calls <a href="#resettilesobjects">ResetTilesObjects</a></span>
</div>
</div></div>
<span class="label">.ResetTilesObjects</span><a id="resettilesobjects" class="anchor"></a>

                        <span class="comment">\ We now set the following variable block to %11111111</span>
                        <span class="comment">\ to indicate that all tiles are visible:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * tileVisibility to tileVisibility+127</span>
                        <span class="comment">\</span>
                        <span class="comment">\ and the following variable block to %10000000 to</span>
                        <span class="comment">\ deallocate all the object numbers:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   * objectFlags to objectFlags+63</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">63</span>                <span class="comment">\ Set X to use as a byte counter to run from 63 to 0,</span>
                        <span class="comment">\ so we can initialise the 64-byte objectFlags table and</span>
                        <span class="comment">\ the 128-byte tileVisibility table</span>

<span class="label">.resv1</span><a id="resv1" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%11111111</span>         <span class="comment">\ Set the X-th and X+64-th bytes of tileVisibility to</span>
 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a>,<span class="register">X</span>   <span class="comment">\ all set bits, to indicate visible tiles</span>
 <span class="mne">STA</span> <a class="popup variable">tileVisibility</a><span class="operator">+</span><span class="decimal">64</span>,<span class="register">X</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="binary">%10000000</span>         <span class="comment">\ Set bit 7 of the X-th byte of objectFlags, to denote</span>
 <span class="mne">STA</span> <a class="popup variable">objectFlags</a>,<span class="register">X</span>      <span class="comment">\ that object #X is not allocated to an object</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">resv1</a>              <span class="comment">\ Loop back until we have processed X from &3F to 0</span>

 <span class="mne">INC</span> <a class="popup variable">seedNumberLFSR</a><span class="operator">+</span><span class="decimal">2</span>   <span class="comment">\ Set bit 16 of the five-byte linear feedback shift</span>
                        <span class="comment">\ register in seedNumberLFSR(4 3 2 1 0), as we need a</span>
                        <span class="comment">\ non-zero element for the seed number generator to</span>
                        <span class="comment">\ work (as otherwise the EOR feedback will not affect</span>
                        <span class="comment">\ the contents of the shift register and it won't start</span>
                        <span class="comment">\ generating non-zero numbers)</span>

 <span class="mne">JSR</span> <a class="popup destination">SetColumnBufferMax</a> <span class="comment">\ Call SetColumnBufferMax to set the maximum and minimum</span>
                        <span class="comment">\ pitch angles for the column buffer</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-setcolumnbuffermax"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/setcolumnbuffermax.html">SetColumnBufferMax</a> (category: Screen buffer)</div><div class="summary">Set the maximum and minimum pitch angles for the column buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objectflags"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/stack_variables.html#objectflags">objectFlags</a> in workspace <a href="/source/main/workspace/stack_variables.html">Stack variables</a></div><div class="summary">Object flags for up to 64 objects</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-resv1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/resettilesobjects.html#resv1">resv1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-seednumberlfsr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#seednumberlfsr">seedNumberLFSR</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A five-byte linear feedback shift register for</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-tilevisibility"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/tilevisibility.html">tileVisibility</a> (category: Drawing the landscape)</div><div class="summary">A table for storing the visibility of each tile from the player's point of view, with one bit per tile (1 = visible, 0 = hidden)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/resetvariables.html">ResetVariables</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
