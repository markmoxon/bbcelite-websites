<?php
include_once("../../../templates/template_functions.php");
page_header("title_screen", "subroutine_spawncharacter3d_part_1_of_2.html", "The SpawnCharacter3D (Part 1 of 2) subroutine", "Title screen: SpawnCharacter3D (Part 1 of 2)", "Annotated code for the SpawnCharacter3D (Part 1 of 2) subroutine in The Sentinel", "the_sentinel-code", "source_title_screen", "subroutine_spawncharacter3d_part_1_of_2", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/printdigit.html">PrintDigit</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/checkcrackerseed.html">CheckCrackerSeed</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnCharacter3D (Part 1 of 2)</span>                          <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Title screen</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Spawn a character on the landscape in large 3D blocks for drawing</span>
             <span class="headerEntry">on the main title screen or secret code screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_f.html#header-spawncharacter3d-part-1-of-2">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawtitlescreen.html">DrawTitleScreen</a> calls <a href="#spawncharacter3d">SpawnCharacter3D</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/printdigit.html">PrintDigit</a> calls <a href="#spawncharacter3d">SpawnCharacter3D</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/spawnsecretcode3d.html">SpawnSecretCode3D</a> calls <a href="#spawncharacter3d">SpawnCharacter3D</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">A</span>                    <span class="argumentEntry">The character to be spawned or the tile coordinates of</span>
                        <span class="argumentEntry">the character on the landscape:</span>

                        <span class="argumentEntry">  * %00xxxxxx = bits 0-5 contain the ASCII code of the</span>
                        <span class="argumentEntry">                character to spawn</span>

                        <span class="argumentEntry">  * %10xxxxxx = bits 0-4 contain the tile x-coordinate</span>
                        <span class="argumentEntry">                of the character on the landscape</span>

                        <span class="argumentEntry">  * %11xxxxxx = bits 0-4 contain the tile z-coordinate</span>
                        <span class="argumentEntry">                of the character on the landscape</span>

<hr class="light">
<span class="subheader"> Returns:</span>

   <span class="argumentLabel">X</span>                    <span class="argumentEntry">X is preserved</span>

   <span class="argumentLabel">Y</span>                    <span class="argumentEntry">Y is preserved</span>

</div></div>
<span class="label">.SpawnCharacter3D</span><a id="spawncharacter3d" class="anchor"></a>

 <span class="mne">PHA</span>                    <span class="comment">\ Store the character on the stack so we can retrieve it</span>
                        <span class="comment">\ below</span>

 <span class="mne">STA</span> <a class="popup variable">characterDef</a>       <span class="comment">\ Store the character in the first byte of the OSWORD</span>
                        <span class="comment">\ block at characterDef, so we can extract the operating</span>
                        <span class="comment">\ system's character definition (if this is a printable</span>
                        <span class="comment">\ character)</span>

 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11000000</span>         <span class="comment">\ Clear all bits of the character number except for bits</span>
                        <span class="comment">\ 6 and 7</span>

 <span class="mne">BPL</span> <a class="popup destination">spac2</a>              <span class="comment">\ If bit 7 is clear then this is a printable character,</span>
                        <span class="comment">\ so jump to spac2 to spawn the character in 3D text</span>
                        <span class="comment">\ blocks</span>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Bit 7 is set so this is a tile coordinate, so extract</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ bit 6 of the character number into the C flag</span>

 <span class="mne">PLA</span>                    <span class="comment">\ Retrieve the character number from the stack and</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00011111</span>         <span class="comment">\ extract bits 0-4 to get the coordinate value</span>

 <span class="mne">BCS</span> <a class="popup destination">spac1</a>              <span class="comment">\ If bit 6 of the original character number is set then</span>
                        <span class="comment">\ this is a tile z-coordinate, so jump to spac1 to set</span>
                        <span class="comment">\ zTileCharacter</span>

 <span class="mne">STA</span> <a class="popup variable">xTileCharacter</a>     <span class="comment">\ Bit 6 of the original character number is clear, so</span>
                        <span class="comment">\ store bits 0-4 in xTileCharacter, so we can spawn the</span>
                        <span class="comment">\ next printable character that's passed to the routine</span>
                        <span class="comment">\ in the right place</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.spac1</span><a id="spac1" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">zTileCharacter</a>     <span class="comment">\ Bit 6 of the original character number is set, so</span>
                        <span class="comment">\ store bits 0-4 in zTileCharacter, so we can spawn the</span>
                        <span class="comment">\ next printable character that's passed to the routine</span>
                        <span class="comment">\ in the right place</span>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>

<span class="label">.spac2</span><a id="spac2" class="anchor"></a>

                        <span class="comment">\ If we get here then we have a printable character in A</span>

 <span class="mne">TXA</span>                    <span class="comment">\ Store X and Y on the stack to we can preserve them</span>
 <span class="mne">PHA</span>
 <span class="mne">TYA</span>
 <span class="mne">PHA</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">characterDef</a><span class="bracket">)</span>  <span class="comment">\ Call OSWORD with A = 10 to extract the operating</span>
 <span class="mne">LDX</span> <span class="hash">#</span><span class="operator">LO</span><span class="bracket">(</span><a class="popup variable">characterDef</a><span class="bracket">)</span>  <span class="comment">\ system's character definition into the block at</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ characterDef</span>
 <span class="mne">JSR</span> <a class="popup destination">OSWORD</a>             <span class="comment">\</span>
                        <span class="comment">\ The first byte of the block contains the ASCII code</span>
                        <span class="comment">\ of the character (which we stored above), and the call</span>
                        <span class="comment">\ returns the character definition from the second byte</span>
                        <span class="comment">\ onwards</span>

 <span class="mne">LDA</span> <a class="popup variable">zTileCharacter</a>     <span class="comment">\ Set zTile to the z-coordinate where we want to spawn</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ the character</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">7</span>                 <span class="comment">\ We now loop through the top seven rows of the</span>
                        <span class="comment">\ character definition, so set a row counter in X</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We actually loop through the character definition</span>
                        <span class="comment">\ from the bottom to top, ignoring the very bottom row</span>
                        <span class="comment">\ of the definition as this is always blank for the</span>
                        <span class="comment">\ capital letters and digits that we are displaying</span>
                        <span class="comment">\ (the bottom row is only used for descenders, and</span>
                        <span class="comment">\ "THE SENTINEL" and landscape digits don't have them)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Instead we insert a blank pixel row at the top of the</span>
                        <span class="comment">\ definition, on the iteration when X is zero</span>

                        <span class="comment">\ We now have a short interlude to check some of the</span>
                        <span class="comment">\ anti-cracker code, so we can corrupt the secret code</span>
                        <span class="comment">\ being drawn on-screen if this landscape has not been</span>
                        <span class="comment">\ played through properly</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-osword"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Configuration variable <a href="/source/all/workspaces.html#osword">OSWORD</a> = &FFF1</div><div class="summary">The address for the OSWORD routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-characterdef"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#characterdef">characterDef</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">An OSWORD block for reading a character definition</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawncharacter3d_part_1_of_2.html#spac1">spac1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spac2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawncharacter3d_part_1_of_2.html#spac2">spac2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtilecharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#xtilecharacter">xTileCharacter</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The tile x-coordinate of the character being spawned in large 3D blocks on the landscape for the title screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ztile">zTile</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztilecharacter"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#ztilecharacter">zTileCharacter</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The tile z-coordinate of the character being spawned in large 3D blocks on the landscape for the title screen</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/printdigit.html">PrintDigit</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/checkcrackerseed.html">CheckCrackerSeed</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
