<?php
include_once("../../../templates/template_functions.php");
page_header("sights", "subroutine_removesights.html", "The RemoveSights subroutine", "Sights: RemoveSights", "Annotated code for the RemoveSights subroutine in The Sentinel", "the_sentinel-code", "source_sights", "subroutine_removesights", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/ysightsstep.html">ySightsStep</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/sightsmoveaddrlo.html">sightsMoveAddrLo</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">RemoveSights</span>                                            <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Sights</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Remove the sights from the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_h.html#header-removesights">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/checkforkeypresses.html">CheckForKeyPresses</a> calls <a href="#removesights">RemoveSights</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawsights.html">DrawSights</a> calls <a href="#removesights">RemoveSights</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#removesights">RemoveSights</a></span>
</div>
</div></div>
<span class="label">.RemoveSights</span><a id="removesights" class="anchor"></a>

 <span class="mne">LDX</span> <a class="popup variable">sightsByteCount</a>    <span class="comment">\ If the sights pixel byte stash is empty then there are</span>
 <span class="mne">BEQ</span> <a class="popup destination">rems2</a>              <span class="comment">\ no pixel bytes to restore to the screen, so jump to</span>
                        <span class="comment">\ rems2 to return from the subroutine</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the size of the sights pixel byte stash to</span>
                        <span class="comment">\ give us a loop counter to count through the bytes</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set Y = 0 so the STA (sightsByteAddr),Y instruction</span>
                        <span class="comment">\ below behaves like STA (sightsByteAddr)</span>

<span class="label">.rems1</span><a id="rems1" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">sightsByteAddrLo</a>,<span class="register">X</span> <span class="comment">\ Set sightsByteAddr(1 0) to the address for the X-th</span>
 <span class="mne">STA</span> <a class="popup variable">sightsByteAddr</a>     <span class="comment">\ entry in the sights pixel byte stash, which we get</span>
 <span class="mne">LDA</span> <a class="popup variable">sightsByteAddrHi</a>,<span class="register">X</span> <span class="comment">\ from the sightsByteAddr(Hi Lo) tables</span>
 <span class="mne">STA</span> <a class="popup variable">sightsByteAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">LDA</span> <a class="popup variable">sightsByte</a>,<span class="register">X</span>       <span class="comment">\ Copy the X-th pixel byte from the sights pixel byte</span>
 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">sightsByteAddr</a><span class="bracket">)</span>,<span class="register">Y</span> <span class="comment">\ stash to the address in sightsByteAddr(1 0), to</span>
                        <span class="comment">\ restore this byte of screen memory to its original</span>
                        <span class="comment">\ contents, thus removing the sights from this byte</span>

 <span class="mne">DEX</span>                    <span class="comment">\ Decrement the pixel byte counter</span>

 <span class="mne">BPL</span> <a class="popup destination">rems1</a>              <span class="comment">\ Loop back until we have restored every byte from the</span>
                        <span class="comment">\ sights pixel byte stash into its original address in</span>
                        <span class="comment">\ screen memory</span>

 <span class="mne">LDX</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Reset the size of the sights pixel byte stash to zero</span>
 <span class="mne">STX</span> <a class="popup variable">sightsByteCount</a>    <span class="comment">\ as we have just emptied it</span>

<span class="label">.rems2</span><a id="rems2" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rems1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/removesights.html#rems1">rems1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-rems2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/removesights.html#rems2">rems2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbyte"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/sightsbyte.html">sightsByte</a> (category: Sights)</div><div class="summary">The sights pixel byte stash, which contains the screen pixel bytes behind the sights, so they can be restored to remove the sights</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbyteaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#sightsbyteaddr">sightsByteAddr</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Storage for an address that loops through the pixel bytes in screen memory where the sights appear, so the sights can be drawn and removed using the contents of the sights pixel byte stash</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbyteaddrhi"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/sightsbyteaddrhi.html">sightsByteAddrHi</a> (category: Sights)</div><div class="summary">The screen addresses of the bytes in the sights pixel byte stash, to which they can be restored to remove the sights (high byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbyteaddrlo"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/sightsbyteaddrlo.html">sightsByteAddrLo</a> (category: Sights)</div><div class="summary">The screen addresses of the bytes in the sights pixel byte stash, to which they can be restored to remove the sights (low byte)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sightsbytecount"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#sightsbytecount">sightsByteCount</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The number of screen bytes in the sights pixel byte stash that contain the contents of the screen behind the sights (so they can be restored to remove the sights)</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/ysightsstep.html">ySightsStep</a><a class="next" rel="next" title="Next routine" href="/source/main/variable/sightsmoveaddrlo.html">sightsMoveAddrLo</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
