<?php
include_once("../../../templates/template_functions.php");
page_header("landscape", "subroutine_spawnplayer.html", "The SpawnPlayer subroutine", "Landscape: SpawnPlayer", "Annotated code for the SpawnPlayer subroutine in The Sentinel", "the_sentinel-code", "source_landscape", "subroutine_spawnplayer", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/spawntrees.html">SpawnTrees</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">SpawnPlayer</span>                                             <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Add the player object to the landscape, ideally placing it below</span>
             <span class="headerEntry">all the enemies and in the bottom half of the landscape</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_b.html#header-spawnplayer">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/finishlandscape.html">FinishLandscape</a> calls <a href="#spawnplayer">SpawnPlayer</a></span>
             <span class="headerEntry">* <a href="/source/main/subroutine/previewlandscape.html">PreviewLandscape</a> calls <a href="#spawnplayer">SpawnPlayer</a></span>
</div>
</div></div>
<span class="label">.SpawnPlayer</span><a id="spawnplayer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Spawn the player's robot (an object of type 0),</span>
 <span class="mne">JSR</span> <a class="popup destination">SpawnObject</a>        <span class="comment">\ returning the object number of the new object in X</span>
                        <span class="comment">\ and currentObject</span>

 <span class="mne">STX</span> <a class="popup variable">playerObject</a>       <span class="comment">\ Set playerObject to the object number of the newly</span>
                        <span class="comment">\ spawned object</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">10</span>                <span class="comment">\ Set the player's energy level to 10</span>
 <span class="mne">STA</span> <a class="popup variable">playerEnergy</a>

 <span class="mne">LDA</span> <a class="popup variable">landscapeZero</a>      <span class="comment">\ If the landscape number is not 0000, jump to sply1</span>
 <span class="mne">BNE</span> <a class="popup destination">sply1</a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">8</span>                 <span class="comment">\ Set (xTile, zTile) = (8, 17)</span>
 <span class="mne">STA</span> <a class="popup variable">xTile</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">17</span>                <span class="comment">\ So the player always starts on this tile in the first</span>
 <span class="mne">STA</span> <a class="popup variable">zTile</a>              <span class="comment">\ landscape</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectOnTile</a>  <span class="comment">\ Place object #X on the tile anchored at (xTile, zTile)</span>

 <span class="mne">JMP</span> <a class="popup destination">SpawnTrees</a>         <span class="comment">\ Jump to SpawnTrees to add trees to the landscape and</span>
                        <span class="comment">\ move towards playing the game</span>

<span class="label">.sply1</span><a id="sply1" class="anchor"></a>

                        <span class="comment">\ If we get here then this is not landscape 0000</span>

 <span class="mne">LDA</span> <a class="popup variable">minEnemyAltitude</a>   <span class="comment">\ Set A to the altitude of the lowest enemy on the</span>
                        <span class="comment">\ landscape</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ If A >= 6 then set A = 6</span>
 <span class="mne">BCC</span> <a class="popup destination">sply2</a>              <span class="comment">\</span>
 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">6</span>                 <span class="comment">\ So A = min(6, minEnemyAltitude)</span>

<span class="label">.sply2</span><a id="sply2" class="anchor"></a>

                        <span class="comment">\ By this point A contains an altitude that is no higher</span>
                        <span class="comment">\ than any enemies and is no greater than 6</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We can use this as a cap on the player's starting</span>
                        <span class="comment">\ altitude to ensure that the player starts below all</span>
                        <span class="comment">\ the enemies, and in the bottom half of the landscape</span>
                        <span class="comment">\ (which ranges from altitude 1 to 11)</span>

 <span class="mne">JSR</span> <a class="popup destination">PlaceObjectBelow</a>   <span class="comment">\ Attempt to place the player object on a tile that is</span>
                        <span class="comment">\ below the maximum altitude specified in A (though we</span>
                        <span class="comment">\ may end up placing the object higher than this)</span>

 <span class="mne">BCS</span> <a class="popup destination">sply1</a>              <span class="comment">\ If the call to PlaceObjectBelow sets the C flag then</span>
                        <span class="comment">\ the object has not been successfully placed, so loop</span>
                        <span class="comment">\ back to sply1 to keep trying, working through the</span>
                        <span class="comment">\ landscape's sequence of seed numbers until we do</span>
                        <span class="comment">\ manage to place the player on a tile</span>

                        <span class="comment">\ Otherwise we have placed the player object on a tile,</span>
                        <span class="comment">\ so now we fall through into SpawnTrees to add trees to</span>
                        <span class="comment">\ the landscape</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-placeobjectbelow"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/placeobjectbelow.html">PlaceObjectBelow</a> (category: 3D objects)</div><div class="summary">Attempt to place an object on a tile that is below the maximum altitude specified in A</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-placeobjectontile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/placeobjectontile.html">PlaceObjectOnTile</a> (category: 3D objects)</div><div class="summary">Place an object on a tile, putting it on top of any existing boulders or towers</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawnobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/spawnobject.html">SpawnObject</a> (category: 3D objects)</div><div class="summary">Add a new object of the specified type to the objectTypes table</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-spawntrees"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/spawntrees.html">SpawnTrees</a> (category: Landscape)</div><div class="summary">Add trees to the landscape, ideally placing them below all the enemies in the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-landscapezero"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#landscapezero">landscapeZero</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A flag that is set depending on whether we are playing landscape 0000</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-minenemyaltitude"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#minenemyaltitude">minEnemyAltitude</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The altitude of the lowest enemy on the landscape</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerenergy"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#playerenergy">playerEnergy</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The player's energy level (in the range 0 to 63)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-playerobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#playerobject">playerObject</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">The number of the player object</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sply1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawnplayer.html#sply1">sply1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-sply2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/spawnplayer.html#sply2">sply2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-xtile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#xtile">xTile</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Tile corner x-coordinate</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ztile"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ztile">zTile</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Tile corner z-coordinate</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/subroutine/spawnenemies.html">SpawnEnemies</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/spawntrees.html">SpawnTrees</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
