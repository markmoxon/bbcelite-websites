<?php
include_once("../../../templates/template_functions.php");
page_header("screen_buffer", "subroutine_ditherscreenbuffer.html", "The DitherScreenBuffer subroutine", "Screen buffer: DitherScreenBuffer", "Annotated code for the DitherScreenBuffer subroutine in The Sentinel", "the_sentinel-code", "source_screen_buffer", "subroutine_ditherscreenbuffer", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/colourpalettes.html">colourPalettes</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">DitherScreenBuffer</span>                                      <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Subroutine</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Screen buffer</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Dither the contents of the screen buffer onto the screen</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this subroutine <a href="/source/all/the_sentinel_j.html#header-ditherscreenbuffer">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This subroutine is called as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/drawupdatedobject.html">DrawUpdatedObject</a> calls <a href="#ditherscreenbuffer">DitherScreenBuffer</a></span>
</div>
<hr class="light">
<span class="subheader"> Arguments:</span>

   <span class="argumentLabel">ditherOuterLoop</span>      <span class="argumentEntry">The number of outer loops to implement for the dithered</span>
                        <span class="argumentEntry">effect, where each inner loop dithers 255 pixels to the</span>
                        <span class="argumentEntry">screen</span>

</div></div>
<span class="label">.DitherScreenBuffer</span><a id="ditherscreenbuffer" class="anchor"></a>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">255</span>               <span class="comment">\ Each inner loop of the dithering process updates 255</span>
 <span class="mne">STA</span> <a class="popup variable">ditherInnerLoop</a>    <span class="comment">\ random pixels on-screen, so set the inner loop counter</span>
                        <span class="comment">\ in ditherInnerLoop accordingly</span>

 <span class="mne">LDA</span> <a class="popup variable">bufferColumns</a>      <span class="comment">\ Set bufferWidthBytes = bufferColumns * 8</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ This converts the number of character columns into</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ pixel bytes, as each character block contains eight</span>
 <span class="mne">STA</span> <a class="popup variable">bufferWidthBytes</a>   <span class="comment">\ bytes</span>

 <span class="mne">SEC</span>                    <span class="comment">\ Set A = bufferWidthBytes - 1</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="decimal">1</span>

                        <span class="comment">\ We now set bitMask to a bit mask that covers all the</span>
                        <span class="comment">\ non-zero bits in the list length in A, so if A is of</span>
                        <span class="comment">\ the form %001xxxxx, for example, then bitMask will</span>
                        <span class="comment">\ contain %00111111, while A being like %000001xx will</span>
                        <span class="comment">\ give a bitMask of %00000111</span>
                        <span class="comment">\</span>
                        <span class="comment">\ To do this we count the number of continuous clear</span>
                        <span class="comment">\ bits at the top of A, and then use this as an index</span>
                        <span class="comment">\ into the leadingBitMask table</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So we count zeroes from bit 7 down until we hit a 1,</span>
                        <span class="comment">\ and put the result into Y</span>

 <span class="mne">BEQ</span> <a class="popup destination">dith2</a>              <span class="comment">\ If A = 0 then jump to dith2 to skip the following</span>
                        <span class="comment">\ process and set bitMaskDither to %00000000, which has</span>
                        <span class="comment">\ the same number of leading zeroes as A</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="hex">&FF</span>               <span class="comment">\ Set Y = -1 so the following loop counts the number of</span>
                        <span class="comment">\ zeroes correctly</span>

<span class="label">.dith1</span><a id="dith1" class="anchor"></a>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Shift A to the left, moving the top bit into the C</span>
                        <span class="comment">\ flag</span>

 <span class="mne">INY</span>                    <span class="comment">\ Increment the zero counter in Y</span>

 <span class="mne">BCC</span> <a class="popup destination">dith1</a>              <span class="comment">\ Loop back to keep shifting and counting zeroes until</span>
                        <span class="comment">\ we shift a 1 out of bit 7, at which point Y contains</span>
                        <span class="comment">\ the length of the run of zeroes in bits 7 to 0 of the</span>
                        <span class="comment">\ buffer width in bytes</span>

 <span class="mne">LDA</span> <a class="popup variable">leadingBitMask</a>,<span class="register">Y</span>   <span class="comment">\ Set A to the Y-th entry from the leadingBitMask table,</span>
                        <span class="comment">\ which will give us a bit mask with a matching number</span>
                        <span class="comment">\ of leading zeroes as A</span>

<span class="label">.dith2</span><a id="dith2" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">bitMaskDither</a>      <span class="comment">\ Set bitMaskDither to a bit mask with a matching number</span>
                        <span class="comment">\ of leading zeroes as the buffer width in bytes</span>

<span class="label">.dith3</span><a id="dith3" class="anchor"></a>

 <span class="mne">SEI</span>                    <span class="comment">\ Disable interrupts so we can fetch a random number</span>
                        <span class="comment">\ without clashing with the dithering process in the</span>
                        <span class="comment">\ handler (which is activated on the game over screen,</span>
                        <span class="comment">\ which also uses this routine)</span>

 <span class="mne">JSR</span> <a class="popup destination">GetRandomNumber</a>    <span class="comment">\ Set A to a random number</span>

 <span class="mne">LDY</span> <a class="popup variable">randomGenerator</a><span class="operator">+</span><span class="decimal">1</span>  <span class="comment">\ Set ditherRandom to the second byte of the random</span>
 <span class="mne">STY</span> <a class="popup variable">ditherRandom</a>       <span class="comment">\ number generator, so this is also a random number</span>

 <span class="mne">CLI</span>                    <span class="comment">\ Re-enable interrupts</span>

 <span class="mne">CLC</span>                    <span class="comment">\ Set A = A + pixelByteToDither</span>
 <span class="mne">ADC</span> <a class="popup variable">pixelByteToDither</a>  <span class="comment">\</span>
                        <span class="comment">\ This sets A to a random value in the range 0 to 255</span>
                        <span class="comment">\ that's unlikely to be the same as pixelByteToDither,</span>
                        <span class="comment">\ which is the pixel byte that we dithered last time we</span>
                        <span class="comment">\ were here</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We don't care that pixelByteToDither isn't initialised</span>
                        <span class="comment">\ outside of the reset routine, as we want this to be</span>
                        <span class="comment">\ random</span>

 <span class="mne">AND</span> <a class="popup variable">bitMaskDither</a>      <span class="comment">\ We set bitMaskDither above to a bit mask that has a</span>
                        <span class="comment">\ matching number of leading zeroes as the number of</span>
                        <span class="comment">\ bytes in the buffer width, so this instruction</span>
                        <span class="comment">\ converts A into a number with the same range of</span>
                        <span class="comment">\ non-zero bits as bufferWidthBytes</span>

 <span class="mne">CMP</span> <a class="popup variable">bufferWidthBytes</a>   <span class="comment">\ If A &lt; bufferWidthBytes then jump to dith4 to skip the</span>
 <span class="mne">BCC</span> <a class="popup destination">dith4</a>              <span class="comment">\ next instruction</span>

 <span class="mne">SBC</span> <a class="popup variable">bufferWidthBytes</a>   <span class="comment">\ Subtract bufferWidthBytes from A to bring it into the</span>
                        <span class="comment">\ range 0 to bufferWidthBytes (which works because we</span>
                        <span class="comment">\ already reduced A to a maximum value of bitMaskDither,</span>
                        <span class="comment">\ so A must be less than bufferWidthBytes * 2)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The subtraction works because we just passed through a</span>
                        <span class="comment">\ BCC, so we know the C flag is set</span>

<span class="label">.dith4</span><a id="dith4" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">pixelByteToDither</a>  <span class="comment">\ Set pixelByteToDither to the result in A, which is a</span>
                        <span class="comment">\ valid pixel byte number within the range of the pixel</span>
                        <span class="comment">\ bytes in the screen buffer row</span>

                        <span class="comment">\ We now set (ditherStore A) to the address of a random</span>
                        <span class="comment">\ row in the screen buffer, as an offset from the first</span>
                        <span class="comment">\ screen row buffer at screenBufferRow0, using bits 0 to</span>
                        <span class="comment">\ 4 of the random number in ditherRandom</span>

 <span class="mne">LDA</span> <a class="popup variable">ditherRandom</a>       <span class="comment">\ Set ditherStore to bits 0 to 4 of our random number,</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00011111</span>         <span class="comment">\ so that's a number in the range 0 to &1F</span>
 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>

 <span class="mne">LSR</span> <span class="register">A</span>                  <span class="comment">\ Set ditherStore = ditherStore / 2 + ditherStore</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ and round the result down to the nearest even number,</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%11111110</span>         <span class="comment">\ so that's an even number in the range 0 to &2E</span>
 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>

 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ Set A = ditherStore * 4</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\</span>
                        <span class="comment">\ So that's a multiple of 8 in the range 0 to &B8</span>

 <span class="mne">ADC</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ Set ditherStore = ditherStore + A</span>
 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\</span>
                        <span class="comment">\ So that's an even number in the range 0 to &2E</span>

 <span class="mne">LDA</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set (ditherStore A) = (ditherStore 0) / 8</span>
 <span class="mne">LSR</span> <a class="popup variable">ditherStore</a>        <span class="comment">\</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ This gives us the address of a randomly picked screen</span>
 <span class="mne">LSR</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ row in (ditherStore A), as an offset from within</span>
 <span class="mne">ROR</span> <span class="register">A</span>                  <span class="comment">\ screen memory ???</span>
 <span class="mne">LSR</span> <a class="popup variable">ditherStore</a>
 <span class="mne">ROR</span> <span class="register">A</span>

 <span class="mne">ADC</span> <a class="popup variable">pixelByteToDither</a>  <span class="comment">\ Set the following:</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\</span>
 <span class="mne">LDA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\   fromAddr(1 0) = (ditherStore A) + pixelByteToDither</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ So fromAddr(1 0) now contains the offset address</span>
                        <span class="comment">\ within screen memory of a randomly picked pixel byte</span>
                        <span class="comment">\ within the width of the screen buffer</span>
                        <span class="comment">\</span>
                        <span class="comment">\ This is calculated by adding the address of a randomly</span>
                        <span class="comment">\ picked screen row in (ditherStore A) and a randomly</span>
                        <span class="comment">\ picked pixel byte within the width of the screen</span>
                        <span class="comment">\ buffer in pixelByteToDither</span>

                        <span class="comment">\ The address in fromAddr(1 0) is now the offset within</span>
                        <span class="comment">\ screen memory of the random pixel byte that we can use</span>
                        <span class="comment">\ for dithering one pixel of the screen buffer to the</span>
                        <span class="comment">\ screen (as we will dither just one pixel of this byte</span>
                        <span class="comment">\ on each iteration of the inner loop)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ The next step is to convert this offset into both a</span>
                        <span class="comment">\ screen memory address and the corresponding screen</span>
                        <span class="comment">\ buffer address, so we can copy the pixel from the</span>
                        <span class="comment">\ screen buffer to the screen</span>
                        <span class="comment">\</span>
                        <span class="comment">\ We start with the screen memory address</span>

 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a>      <span class="comment">\ Set (A toAddr) = objScreenAddr(1 0) + fromAddr(1 0)</span>
 <span class="mne">CLC</span>                    <span class="comment">\</span>
 <span class="mne">ADC</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ This gives us the address in screen memory of the</span>
 <span class="mne">STA</span> <a class="popup variable">toAddr</a>             <span class="comment">\ random pixel byte, as objScreenAddr(1 0) contains the</span>
 <span class="mne">LDA</span> <a class="popup variable">objScreenAddr</a><span class="operator">+</span><span class="decimal">1</span>    <span class="comment">\ screen address of the object</span>
 <span class="mne">ADC</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&80</span>               <span class="comment">\ If the high byte in A >= &80 then the new address is</span>
 <span class="mne">BCC</span> <a class="popup destination">dith5</a>              <span class="comment">\ past the end of screen memory, so subtract &20 from</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&20</span>               <span class="comment">\ the high byte so the address wraps around within the</span>
                        <span class="comment">\ range of screen memory between &6000 and &8000</span>

<span class="label">.dith5</span><a id="dith5" class="anchor"></a>

 <span class="mne">STA</span> <a class="popup variable">toAddr</a><span class="operator">+</span><span class="decimal">1</span>           <span class="comment">\ Store the high byte of the result, so we now have:</span>
                        <span class="comment">\</span>
                        <span class="comment">\   toAddr(1 0) = objScreenAddr(1 0) + fromAddr(1 0)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ with the address wrapped around as required</span>

                        <span class="comment">\ And now we calculate the equivalent address in the</span>
                        <span class="comment">\ screen buffer, which is a column buffer, so we start</span>
                        <span class="comment">\ by adding the offset in fromAddr(1 0) to the address</span>
                        <span class="comment">\ of the first screen buffer row at screenBufferRow0</span>
                        <span class="comment">\ (we can skip adding the low bytes as the low byte of</span>
                        <span class="comment">\ screenBufferRow0 is zero)</span>
                        <span class="comment">\</span>
                        <span class="comment">\ It's worth noting that the structure of the screen</span>
                        <span class="comment">\ buffer is similar to the screen, with each row in</span>
                        <span class="comment">\ the screen buffer being spaced out by 320 bytes, just</span>
                        <span class="comment">\ as in screen memory, so this means we can just add</span>
                        <span class="comment">\ screenBufferRow0 and fromAddr(1 0) to get the address</span>
                        <span class="comment">\</span>
                        <span class="comment">\ However, as we use a column buffer to update objects</span>
                        <span class="comment">\ on-screen, we need to wrap around after buffer row 15,</span>
                        <span class="comment">\ so we also need to check for this</span>

 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\ Set fromAddr(1 0) = screenBufferRow0 + fromAddr(1 0)</span>
 <span class="mne">CLC</span>
 <span class="mne">ADC</span> <span class="hash">#</span><span class="operator">HI</span><span class="bracket">(</span><a class="popup variable">screenBufferRow0</a><span class="bracket">)</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>

 <span class="mne">CMP</span> <span class="hash">#</span><span class="hex">&53</span>               <span class="comment">\ If the result of the addition is less than &5300, then</span>
 <span class="mne">BCC</span> <a class="popup destination">dith6</a>              <span class="comment">\ we have not reached the end of row 15 in the screen</span>
                        <span class="comment">\ buffer, so jump to dith6 to skip the following</span>

 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ Set fromAddr(1 0) = fromAddr(1 0) - &1360</span>
 <span class="mne">SEC</span>                    <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&60</span>               <span class="comment">\ If we get here then we have reached character row 16</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a>           <span class="comment">\ in the screen buffer, so we need to wrap around</span>
 <span class="mne">LDA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\</span>
 <span class="mne">SBC</span> <span class="hash">#</span><span class="hex">&13</span>               <span class="comment">\ The value of &1360 is calculated as follows</span>
 <span class="mne">STA</span> <a class="popup variable">fromAddr</a><span class="operator">+</span><span class="decimal">1</span>         <span class="comment">\</span>
                        <span class="comment">\ Character row 15 in the screen buffer is at address</span>
                        <span class="comment">\ &51C0, and adding another 320 to that address gives</span>
                        <span class="comment">\ us &5300, but this is past the end of the screen</span>
                        <span class="comment">\ buffer, so we need to wrap it around</span>
                        <span class="comment">\</span>
                        <span class="comment">\ Character row 16 is actually at address &3FA0, so we</span>
                        <span class="comment">\ need to subtract &5300 - &3FA0 = &1360 from the</span>
                        <span class="comment">\ address to perform the wraparound</span>

<span class="label">.dith6</span><a id="dith6" class="anchor"></a>

 <span class="mne">LDA</span> <a class="popup variable">ditherRandom</a>       <span class="comment">\ Set X to bits 6 and 7 of ditherRandom, shifted into</span>
 <span class="mne">ASL</span> <span class="register">A</span>                  <span class="comment">\ bits 0 and 1 to create a random number in the range</span>
 <span class="mne">ROL</span> <span class="register">A</span>                  <span class="comment">\ 0 to 3</span>
 <span class="mne">ROL</span> <span class="register">A</span>
 <span class="mne">AND</span> <span class="hash">#</span><span class="binary">%00000011</span>
 <span class="mne">TAX</span>

 <span class="mne">LDY</span> <span class="hash">#</span><span class="decimal">0</span>                 <span class="comment">\ Set A to the pixel byte that we want to dither onto</span>
 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">fromAddr</a><span class="bracket">)</span>,<span class="register">Y</span>       <span class="comment">\ the screen, taking it from the screen buffer at</span>
                        <span class="comment">\ address fromAddr(1 0)</span>

 <span class="mne">AND</span> <a class="popup variable">pixelBitMask</a>,<span class="register">X</span>     <span class="comment">\ Convert X from a number in the range 0 to 3 into a bit</span>
                        <span class="comment">\ mask with that pixel number set (where pixel 0 is on</span>
                        <span class="comment">\ the left and pixel 3 is on the right), and clear all</span>
                        <span class="comment">\ the bits in A apart from the two bits for that pixel</span>
                        <span class="comment">\</span>
                        <span class="comment">\ So if X is 2, for example, the resulting mask will be</span>
                        <span class="comment">\ %00100010, in which pixel 2 is set, so only these two</span>
                        <span class="comment">\ bits of the pixel byte will be kept</span>

 <span class="mne">STA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ Store the pixel that we want to dither in ditherStore</span>

 <span class="mne">LDA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>         <span class="comment">\ Set A to the current screen contents of the pixel byte</span>
                        <span class="comment">\ that we are updating,  taking it from the screen at</span>
                        <span class="comment">\ address toAddr(1 0)</span>

 <span class="mne">AND</span> <a class="popup variable">clearPixelMask</a>,<span class="register">X</span>   <span class="comment">\ Clear the pixel number in A by applying a pixel bit</span>
                        <span class="comment">\ mask from clearPixelMask where the bits for every</span>
                        <span class="comment">\ pixel are set except for pixel X</span>

 <span class="mne">ORA</span> <a class="popup variable">ditherStore</a>        <span class="comment">\ Set the colour of pixel X to the colour of the pixel</span>
                        <span class="comment">\ from the screen buffer by OR'ing in the pixel bits</span>
                        <span class="comment">\ that we set above</span>

 <span class="mne">STA</span> <span class="bracket">(</span><a class="popup variable">toAddr</a><span class="bracket">)</span>,<span class="register">Y</span>         <span class="comment">\ Store the updated pixel byte in screen memory to draw</span>
                        <span class="comment">\ the pixel from the screen buffer on-screen</span>

 <span class="mne">BIT</span> <a class="popup variable">doNotDitherObject</a>  <span class="comment">\ If bit 7 of doNotDitherObject is set then the dithered</span>
 <span class="mne">BMI</span> <a class="popup destination">dith8</a>              <span class="comment">\ effect has been disabled (while we focus on processing</span>
                        <span class="comment">\ an action key), so jump to dith8 to return from the</span>
                        <span class="comment">\ subroutine without doing any more dithering</span>

 <span class="mne">DEC</span> <a class="popup variable">ditherInnerLoop</a>    <span class="comment">\ Decrement the inner loop counter</span>

 <span class="mne">BNE</span> <a class="popup destination">dith7</a>              <span class="comment">\ If we have not yet finished the inner loop, jump to</span>
                        <span class="comment">\ dith7 to loop back to dither another pixel onto the</span>
                        <span class="comment">\ screen, until we have done all 255 pixels in the</span>
                        <span class="comment">\ inner loop</span>

 <span class="mne">JSR</span> <a class="popup destination">ProcessSound</a>       <span class="comment">\ Process any sounds or music that are being made in the</span>
                        <span class="comment">\ background</span>

 <span class="mne">DEC</span> <a class="popup variable">ditherOuterLoop</a>    <span class="comment">\ Decrement the outer loop counter</span>

 <span class="mne">BEQ</span> <a class="popup destination">dith8</a>              <span class="comment">\ If we have finished the outer loop, jump to dith8 to</span>
                        <span class="comment">\ return from the subroutine</span>

<span class="label">.dith7</span><a id="dith7" class="anchor"></a>

 <span class="mne">JMP</span> <a class="popup destination">dith3</a>              <span class="comment">\ Loop back to dither another pixel onto the screen</span>

<span class="label">.dith8</span><a id="dith8" class="anchor"></a>

 <span class="mne">RTS</span>                    <span class="comment">\ Return from the subroutine</span>
</pre>
				</div>

				<div class="codeBlockWrapper popupWrapper" id="popup-getrandomnumber"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/getrandomnumber.html">GetRandomNumber</a> (category: Maths (Arithmetic))</div><div class="summary">Set A to a random number</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-processsound"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/processsound.html">ProcessSound</a> (category: Sound)</div><div class="summary">Process any sound effects that have been configured so they play in the background (this is called regularly throughout gameplay)</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bitmaskdither"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#bitmaskdither">bitMaskDither</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A bit mask for use in the DitherScreenBuffer routine that has a matching number of leading zeroes as the size of the screen buffer in bytes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-buffercolumns"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#buffercolumns">bufferColumns</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The number of character columns in the current screen buffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-bufferwidthbytes"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#bufferwidthbytes">bufferWidthBytes</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">The width of the screen buffer in pixel bytes for implementing the dithered effect in DitherScreenBuffer</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-clearpixelmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/clearpixelmask.html">clearPixelMask</a> (category: Graphics)</div><div class="summary">A table for converting a pixel number in the range 0 to 3 into a screen mode 5 bit mask with that pixel's bits clear and others set</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith1"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith1">dith1</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith2"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith2">dith2</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith3"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith3">dith3</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith4"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith4">dith4</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith5"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith5">dith5</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith6"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith6">dith6</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith7"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith7">dith7</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-dith8"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Label <a href="/source/main/subroutine/ditherscreenbuffer.html#dith8">dith8</a> is local to this routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherinnerloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#ditherinnerloop">ditherInnerLoop</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A counter for the inner loop when dithering objects to the screen in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherouterloop"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/ditherouterloop.html">ditherOuterLoop</a> (category: Screen buffer)</div><div class="summary">A counter for the inner loop when dithering objects to the screen in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherrandom"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#ditherrandom">ditherRandom</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Storage for a random value in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-ditherstore"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#ditherstore">ditherStore</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">Temporary storage for use in the DitherScreenBuffer routine</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-donotditherobject"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#donotditherobject">doNotDitherObject</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">Controls whether the DitherScreenBuffer routine can update an object on the screen using a dithered effect</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-fromaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#fromaddr">fromAddr</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">An address, typically used as a source address when copying</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-leadingbitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/leadingbitmask.html">leadingBitMask</a> (category: Landscape)</div><div class="summary">A table for converting the number of leading clear bits in a number into a bit mask with the same number of leading zeroes</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-objscreenaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/objscreenaddr.html">objScreenAddr</a> (category: Screen buffer)</div><div class="summary">The screen address of the object we are updating</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelbitmask"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/pixelbitmask.html">pixelBitMask</a> (category: Graphics)</div><div class="summary">A table for converting a pixel number in the range 0 to 3 into a screen mode 5 bit mask with that pixel's bits set and others clear</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-pixelbytetodither"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/main_variable_workspace.html#pixelbytetodither">pixelByteToDither</a> in workspace <a href="/source/main/workspace/main_variable_workspace.html">Main variable workspace</a></div><div class="summary">A random pixel byte in a character row in the screen buffer to use when dithering an object to the screen</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-randomgenerator"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Variable <a href="/source/main/variable/randomgenerator.html">randomGenerator</a> (category: Maths (Arithmetic))</div><div class="summary">A 24-bit random number generator that works independently from the landscape seeds and with a much simpler generation algorithm</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-screenbufferrow0"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="link">Subroutine <a href="/source/main/subroutine/screenbufferrow0.html">screenBufferRow0</a> (category: Screen buffer)</div><div class="summary">The screen buffer for character row 0</div></div></div></div>

				<div class="codeBlockWrapper popupWrapper" id="popup-toaddr"><div class="codeBlock"><div class="close">[X]</div><div class="content"><div class="name">Variable <a href="/source/main/workspace/zero_page.html#toaddr">toAddr</a> in workspace <a href="/source/main/workspace/zero_page.html">Zero page</a></div><div class="summary">An address, typically used as a destination address when copying</div></div></div></div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/colourpalettes.html">colourPalettes</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/showgameoverscreen.html">ShowGameOverScreen</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
