<?php
include_once("../../../templates/template_functions.php");
page_header("drawing_the_landscape", "variable_panangletoupdate.html", "The panAngleToUpdate variable", "Drawing the landscape: panAngleToUpdate", "Annotated code for the panAngleToUpdate variable in The Sentinel", "the_sentinel-code", "source_drawing_the_landscape", "variable_panangletoupdate", "");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/screenbufferlo.html">screenBufferLo</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/startscrollingview.html">StartScrollingView</a></nav>
				</div>

				<div class="codeBlockWrapper">
<pre class="codeBlock sourceCode initial"><div class="headerBlockWrapper"><div class="headerBlock"><span class="headerLabel">       Name:</span> <span class="headerEntry">panAngleToUpdate</span>                                        <span class="routineLink">[<a class="extraDataLink" href="#">Show more</a>]</span>
<span class="headerLabel">       Type:</span> <span class="headerEntry">Variable</span>
<span class="headerLabel">   Category:</span> <span class="headerEntry">Drawing the landscape</span>
<span class="headerLabel">    Summary:</span> <span class="headerEntry">Pitch and yaw angles for panning the landscape view, so the output</span>
             <span class="headerEntry">of DrawLandscapeView will be the bit we add when updating the view</span>
<div class="extraData"><span class="headerLabel">    Context:</span> <span class="headerEntry">See this variable <a href="/source/all/the_sentinel_g.html#header-panangletoupdate">in context in the source code</a></span>
<span class="headerLabel"> References:</span> <span class="headerEntry">This variable is used as follows:</span>
             <span class="headerEntry">* <a href="/source/main/subroutine/panlandscapeview.html">PanLandscapeView</a> uses <a href="#panangletoupdate">panAngleToUpdate</a></span>
</div>
<hr class="light">
 This table contains the angles through which we need to pitch or yaw the
 landscape view when we need to scroll the landscape view during a pan.

 The DrawLandscapeView routine always renders the full view, and its output is
 clipped to the size of the screen or screen buffer. This clipping is done on
 the screen x- and y-coordinates, and the clipping is done from the right or
 bottom edges of the screen.

 This means that when we pan the screen, we effectively redraw the whole view,
 which is 20 yaw angles wide and 12 pitch angles tall, and then use the newly
 drawn portion from the top-left corner of that redrawn view for the new part
 that we scroll into the screen to complete the pan.

 When panning left, we can simply subtract 8 from the player's current yaw
 angle to rotate the player's view to the left. This moves the player's gaze to
 the left, so when we draw the new landscape view into the screen buffer, the
 portion on the left of the view is the new part that the player is now seeing,
 so clipping the left portion of the view into the screen buffer will give us
 the content that we need to scroll in from the left to perform the pan.

 Things are different when panning right. If we simply add 8 to the player's
 current yaw angle, then the new part of the landscape view will be on the far
 right of the newly drawn view, so it will be clipped when drawing into the
 screen buffer. So instead we add 20 to the player's yaw angle to rotate the
 view to the right by an entire screen's width, so when the view is drawn and
 clipped, the new portion will be on the left of the newly drawn view, just as
 it was when panning left. As long as we make sure to set the player's yaw
 angle correctly after we have finished drawing - by subtracting 12 from the
 player's yaw angle, leaving them with a net rotation of 8 to the right - then
 this approach ensures that the new portion of the screen is drawn into the
 screen buffer correctly.

 The same approach is applied when panning vertically. If we pan up, then we
 simply add 4 to the player's yaw angle so they look up higher. This moves the
 player's gaze up, so when we draw the new landscape view into the screen
 buffer, the portion at the top of the view is the new part that the player is
 now seeing, so clipping the top portion of the view into the screen buffer
 will give us the content that we need to scroll in from the top to perform the
 pan.

 However, if we are panning down then we need to jump down a whole screen's
 height, so we subtract 12 from the player's pitch angle, as this is the height
 of the screen. We then draw the new view, which puts the new portion of the
 view into the screen buffer. We then fix the player's pitch angle by adding 8,
 so the net result is a pitch rotation of -4, as required.

</div></div>
<span class="label">.panAngleToUpdate</span><a id="panangletoupdate" class="anchor"></a>

 <span class="mne">EQUB</span> <span class="decimal">20</span>                <span class="comment">\ Direction 0 (pan right, scroll left)</span>
 <span class="mne">EQUB</span> <span class="decimal">-8</span>                <span class="comment">\ Direction 1 (pan left, scroll right)</span>
 <span class="mne">EQUB</span> <span class="decimal">4</span>                 <span class="comment">\ Direction 2 (pan up, scroll down)</span>
 <span class="mne">EQUB</span> <span class="decimal">-12</span>               <span class="comment">\ Direction 3 (pan down, scroll up)</span>
</pre>
				</div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous routine" href="/source/main/variable/screenbufferlo.html">screenBufferLo</a><a class="next" rel="next" title="Next routine" href="/source/main/subroutine/startscrollingview.html">StartScrollingView</a></nav>
				</div>
			</article>

<?php
include_once("../../../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
