<?php
include_once("../templates/template_functions.php");
page_header("deep_dives", "fonts_in_nes_elite.html", "Fonts in NES Elite", "Fonts in NES Elite", "A deep dive into fonts in NES Elite", "elite", "deep_dives_drawing_text", "fonts_in_nes_elite");
?>
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous deep dive" href="drawing_text.html">Drawing text</a><a class="next" rel="next" title="Next deep dive" href="bresenhams_line_algorithm.html">Bresenham's line algorithm</a></nav>
				</div>

				<div class="codeBlockWrapper">
					<div class="codeBlock article">
						<h2 class="articleSubheader deepDive">The three different fonts used in the Nintendo version of Elite</h2>

						<p>NES Elite comes with its own custom font; indeed, every NES game comes with its own custom font, as the NES doesn't have an operating system, and therefore doesn't have any built-in text routines. So the cartridge has to bring along pretty much everything itself, including its own text characters.</p>

						<p>The custom font in NES Elite is loaded from the <a href="/nes/bank_7/variable/fontimage.html">fontImage</a> table as each view is initialised. This initialisation is a whole process in its own right (see the deep dive on <a href="views_and_view_types_in_nes_elite.html">views and view types in NES Elite</a> for details), but once it's loaded, the font looks like this in the pattern table:</p>

						<img class="titleImage lightBorder" style="width: 128px" src="/images/nes/languages/fontImage_ram.png" alt="The custom font in NES Elite">

						<p>And on-screen it looks like this:</p>

						<img class="titleImage" src="/images/nes/missions/mission_1a.png" alt="The first briefing screen for mission 1 in NES Elite">

						<p>I'm not sure I'm a big fan of the game font - if I'm honest, I much prefer the clean looks of the BBC Micro font, especially as the same font is used in the Commodore 64 version and works really well there too. But it's still more readable than the futuristic font in the <a href="/6502sp/releases.html#executive">Executive version</a>, so I guess it could be worse.</p>

						<h2 class="articleSubheader">Support for multiple languages<br />
													 ------------------------------</h2>

						<p>One thing the font does have going for it is support for multiple European languages. Here's a complete list of printable characters in the NES Elite font, showing the macros that we can use in the text token tables to insert each character:</p>

						<table class="spacedTableBorder codeSummary">
							<tr class="codeSummaryHeader"><th>ASCII code</th><th>CHAR/ECHR macro</th><th>Accented character</th><th>Font character</th></tr>
							<tr><td>32</td><td>CHAR ' '</td><td>Space</td><td>Space</td></tr>
							<tr><td>33</td><td>CHAR '!'</td><td>!</td><td>!</td></tr>
							<tr><td>34</td><td>CHAR '"'</td><td>À</td><td>First A</td></tr>
							<tr><td>35</td><td>CHAR '#'</td><td>Ô</td><td>O</td></tr>
							<tr><td>36</td><td>CHAR '$'</td><td>à</td><td>à</td></tr>
							<tr><td>37</td><td>CHAR '%'</td><td>é</td><td>é</td></tr>
							<tr><td>38</td><td>CHAR '&'</td><td>&</td><td>&</td></tr>
							<tr><td>39</td><td>CHAR '''</td><td>'</td><td>'</td></tr>
							<tr><td>40</td><td>CHAR '('</td><td>(</td><td>(</td></tr>
							<tr><td>41</td><td>CHAR ')'</td><td>)</td><td>)</td></tr>
							<tr><td>42</td><td>CHAR '*'</td><td>è</td><td>è</td></tr>
							<tr><td>43</td><td>CHAR '+'</td><td>ê</td><td>ê</td></tr>
							<tr><td>44</td><td>CHAR ','</td><td>,</td><td>,</td></tr>
							<tr><td>45</td><td>CHAR '-'</td><td>-</td><td>-</td></tr>
							<tr><td>46</td><td>CHAR '.'</td><td>.</td><td>.</td></tr>
							<tr><td>47</td><td>CHAR '/'</td><td>ô</td><td>ô</td></tr>
							<tr><td>48-57</td><td>CHAR '0' - CHAR '9'</td><td>0-9</td><td>0-9</td></tr>
							<tr><td>58</td><td>CHAR ':'</td><td>:</td><td>:</td></tr>
							<tr><td>59</td><td>CHAR ';'</td><td>ß</td><td>ß</td></tr>
							<tr><td>60</td><td>CHAR '&lt;'</td><td>É</td><td>First E</td></tr>
							<tr><td>61</td><td>CHAR '='</td><td>È</td><td>Second E</td></tr>
							<tr><td>62</td><td>CHAR '&gt;'</td><td>&gt;</td><td>&gt;</td></tr>
							<tr><td>63</td><td>CHAR '?'</td><td>?</td><td>?</td></tr>
							<tr><td>64</td><td>CHAR '@'</td><td>Ç</td><td>Ç</td></tr>
							<tr><td>65-90</td><td>CHAR 'A' - CHAR 'Z'</td><td>A-Z</td><td>A-Z</td></tr>
							<tr><td>91</td><td>CHAR '['</td><td>Ä</td><td>Ä</td></tr>
							<tr><td>92</td><td>CHAR '\'</td><td>Ö</td><td>Ö</td></tr>
							<tr><td>93</td><td>CHAR ']'</td><td>Ü</td><td>Ü</td></tr>
							<tr><td>94</td><td>CHAR '^'</td><td>ẞ</td><td>ẞ</td></tr>
							<tr><td>95</td><td>CHAR '_'</td><td>Ê</td><td>Third E</td></tr>
							<tr><td>96</td><td>CHAR '`'</td><td>ç</td><td>ç</td></tr>
							<tr><td>97-122</td><td>CHAR 'a' - CHAR 'z'</td><td>a-z</td><td>a-z</td></tr>
							<tr><td>123</td><td>CHAR '{'</td><td>ä</td><td>ä</td></tr>
							<tr><td>124</td><td>CHAR '|'</td><td>ö</td><td>ö</td></tr>
							<tr><td>125</td><td>CHAR '}'</td><td>ü</td><td>ü</td></tr>
							<tr><td>126</td><td>CHAR '~'</td><td>n/a</td><td>n/a</td></tr>
							<tr><td>127</td><td>CHAR 'DEL'</td><td>DEL</td><td>DEL</td></tr>
						</table>

						<p>Not all of the accented characters in the font actually have accents; there are three unembellished capital E's in the font that represent É, È and Ê, and an unembellished A that represents À (these are all noted in the table above). The lower-case characters all have their correct accents included.</p>

						<p>See the deep dive on <a href="multi-language_support_in_nes_elite.html">multi-language support in NES Elite</a> for details on how different languages are supported, but from the point of view of the font, it contains enough accented characters in both upper and lower case to support French, German and Italian, as well as the original English, all from one font.</p>

						<h2 class="articleSubheader">Loading fonts into memory<br />
													 -------------------------</h2>

						<p>There is only one font - the one in <a href="/nes/bank_7/variable/fontimage.html">fontImage</a> - but different views load the font in different ways.</p>

						<p>Views and view types are described in the deep dive on <a href="views_and_view_types_in_nes_elite.html">views and view types in NES Elite</a>, but as far as fonts are concerned, there are two bits in the view type that configure whether that view needs to load a font:</p>

						<ul>
							<li>Bit 4 clear = do not load the normal font<br />
								Bit 4 set &nbsp; = load the normal font
							</li>

							<li>Bit 5 clear = do not load the highlight font<br />
								Bit 5 set &nbsp; = load the highlight font
							</li>
						</ul>

						<p>So, for example, view type $97 is the Inventory screen, and because $97 (%10010111) has bit 4 set, this view loads the normal font when it's initialised. View type $B9, meanwhile, is the Equip Ship screen, and because $B9 (%10111001) has both bits 4 and 5 set, it loads both the normal and the highlight font.</p>

						<p>The normal font is used for most text in the game, while the highlight font is the same font design but on a highlighted background. We can use the latter for things like menu highlights, like the Fuel entry in this screenshot:</p>

						<img class="titleImage" src="/images/nes/general/equipment.png" alt="The Equip Ship screen in NES Elite" />

						<p>When required, the normal font is typically loaded into patterns 66 to 160 of pattern table 1. It uses colour 1 on a background of colour 0 (typically white or cyan on black) and it looks like this in the pattern table:</p>

						<img class="titleImage lightBorder" src="/images/nes/fonts/normal_font_patterns.png" alt="The normal font patterns in NES Elite">

						<p>The highlight font, meanwhile, uses colour 3 on a background of colour 1 (typically green on white) and it looks like this in the pattern table when loaded alongside the normal font:</p>

						<img class="titleImage lightBorder" src="/images/nes/fonts/highlight_font_patterns.png" alt="The normal and highlight font patterns in NES Elite">

						<p>The font loading is done by the <a href="/nes/bank_3/subroutine/loadnormalfont.html">LoadNormalFont</a> and <a href="/nes/bank_3/subroutine/loadhighfont.html">LoadHighFont</a> routines. The LoadNormalFont routine fills the pattern buffer from pattern 66 to 160 with the font in colour 1 on colour 0, while LoadHighFont fills the pattern buffer from pattern 161 to 255 with the font in colour 3 on colour 1.</p>

						<p>There are two exceptions to this rule. For views $9D (Long-range Chart) and $DF (Start screen), the normal font is loaded into pattern table 0 (rather than 1), and at pattern numbers 68 to 162 (rather than 66 to 160). This leaves the pattern tables looking like this, with the full font in pattern table 0:</p>

						<img class="titleImage lightBorder" src="/images/nes/fonts/chart_font_patterns_0.png" alt="The font patterns in table 0 in the Long-range Chart in NES Elite">

						<p>with all the dynamically drawn tiles for the star systems and the screen title in pattern table 1:</p>

						<img class="titleImage lightBorder" src="/images/nes/fonts/chart_font_patterns_1.png" alt="The font patterns in table 1 in the Long-range Chart in NES Elite">

						<p>The other exception is the Save and Load screen, which loads the normal and highlight fonts, but gives the normal font different colours. Instead of being colour 1 on colour 0, the normal font is loaded as colour 1 on a colour 2 background (which is a grey font on a red background in that view's palette). Also, while the highlight font is in the same palette as in the other views, only the first 70 characters of the font get loaded, taking up patterns 161 to 230 so there's enough room left for the grey-coloured title text to be added at the end of the table:</p>

						<img class="titleImage lightBorder" src="/images/nes/fonts/save_and_load_font_patterns.png" alt="The Save and Load font patterns in NES Elite">

						<p>Although it is technically possible to configure a view to only load the highlight font and not the normal font, in practice this configuration isn't required. In terms of fonts, these are the only combinations that are used:</p>

						<ul>
							<li>No font is loaded</li>

							<li>The normal font is loaded</li>

							<li>The normal and highlight fonts are loaded</li>

							<li>The normal and highlight fonts are loaded, with special colours for the normal font</li>
						</ul>

						<p>As noted above, the last one is only used for the Save and Load screen.</p>

						<h2 class="articleSubheader">Printing fonts on-screen<br />
													 ------------------------</h2>

						<p>On the tile-based NES, writing text to the screen is a simple case of setting the relevant nametable entry to the pattern number of the letter we want to print - it's a lot easier than the pixel-by-pixel pokery of the original 6502 versions. That said, the text-printing routine at <a href="/nes/bank_2/subroutine/chpr_part_1_of_6.html">CHPR</a> has to cater for all views, including those that haven't loaded any fonts. In this case, CHPR copies each individual letter's pattern from the <a href="/nes/bank_7/variable/fontimage.html">fontImage</a> table into the pattern table before setting the nametable entry.</p>

						<p>This approach is used for the "Front View" title in the space view, for example, as the space view doesn't want to waste patterns on loading an entire font. Instead, it just loads the font characters one letter at a time, as you can see here:</p>

						<img class="titleImage lightBorder" src="/images/nes/bitplanes/planet_asteroid_patterns_1.png" alt="Example pattern table 1 in NES Elite">

						<p>In this case, CHPR loaded the characters "FrontView" individually, so the name of the space view can be printed while using patterns in the most efficient way (and in-flight messages are loaded in the same way, too). Of course, for views that have pre-loaded the font during initialisation, printing text to the screen is a simple case of updating the nametable, which is about as quick as it gets.</p>

						<p>One more thing to note is about the colour of the text we are printing. Screen colours on the NES are controlled by the attribute table, and each view has an associated set of attributes that defines the colours used for each 2x2-tile block on the screen. These are taken from one of 24 view attribute tables, as described in the deep dive on <a href="views_and_view_types_in_nes_elite.html">views and view types in NES Elite</a>. The view attributes define the palettes that are used when printing text on-screen, so they define, for example, that the label text on the Status Mode screen is green, while the data itself is white, like this:</p>

						<img class="titleImage" src="/images/nes/commander/default_commander.png" alt="The default commander in NES Elite" />

						<p>These view attributes are also language-dependent, so that they can cope with the different lengths of text in German and French, for example. See the deep dive on <a href="multi-language_support_in_nes_elite.html">multi-language support in NES Elite</a> for lots more about this, and for examples of how this can go wrong if you're not careful.</p>
					</div>
				</div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="previous" rel="prev" title="Previous deep dive" href="drawing_text.html">Drawing text</a><a class="next" rel="next" title="Next deep dive" href="bresenhams_line_algorithm.html">Bresenham's line algorithm</a></nav>
				</div>
			</article>

<?php
include_once("../templates_local/navigation.php");
?>
		</div>
	</body>
</html>
