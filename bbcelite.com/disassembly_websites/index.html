<?php
include_once("../templates/template_functions.php");
page_header("disassembly_websites", "index.html", "An overview of my automated scripts", "An overview of my automated scripts", "How I automate my disassembly sites and source code repositories", "archaeology", "disassembly_websites", "index");
?>
				<!-- Start of article -->
				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="next" rel="next" title="Next page" href="generating_websites.html">Generating websites from source code</a></nav>
				</div>

				<div class="codeBlockWrapper">
					<div class="codeBlock article">
						<h2 class="articleSubheader deepDive">How I automated my disassembly sites and source repositories</h2>

						<p>Back in the first lockdown of 2020, I started poking around inside the BBC Micro version of Elite. Pulling apart 8-bit code from a bygone era gave me a zen-like refuge from the outside world, and that's when I fell in love with the art of disassembly.</p>

						<p>To be honest, I got carried away, but those were strange times. You can read the <a href="https://elite.bbcelite.com/about_site/about_this_project.html">full story on my Elite website</a>, but the first release back in August 2020 consisted of a huge text file containing fully buildable source code for the cassette version of BBC Micro Elite, with every single line explained. I also inserted various deep dives into the source, and the resulting 1.6MB text file ended up with 41,274 lines of lovingly crafted homage to this epic game.</p>

						<p>I <a href="https://github.com/markmoxon/cassette-elite-beebasm/tree/d7ce8248ee52dc2d0f7e421cc353f1dcf15c8e68">released the source on GitHub</a>, and people liked it. I'm pretty proud of how that first version turned out, and it still looks great in a terminal at a width of 80 columns:</p>

						<img class="titleImage noBorder" style="width: 298px" src="/images/disassembly/vi_source_v1.png" alt="The first version of the fully documented Elite source code in vi" />

						<p>Unfortunately the main source file was too large to browse properly on GitHub; much larger files can be viewed in GitHub these days, but back then the only browsing option was the raw text file. So I knocked together a quick Python script to extract the code from the source files and produce a much <a href="https://elite.bbcelite.com">friendlier website version</a>. In the process I removed the deep dives from the source files and published them on the website instead, and the <a href="https://news.ycombinator.com/item?id=24611341">resulting website proved pretty popular</a>.</p>

						<p>And then there was a second lockdown in late 2020, so I turned to the 6502 Second Processor source code and started pulling that version apart. It was obvious from early on that there was an awful lot of overlap between the cassette version and the 6502 Second Processor version, and after a few attempts to copy over comments from my cassette commentary into the new commentary, I figured there must be a better way of doing this. So I created a single repository to contain both versions, with as much content sharing as possible, and this turned into a <a href="https://github.com/markmoxon/library-elite-beebasm">central library of commented Elite code</a>. I built a second Python script to generate the fully documented source code for both versions, using the library as a source, and the <a href="https://elite.bbcelite.com/6502sp/">6502 Second Processor commentary</a> went live in early 2021.</p>

						<h2 class="articleSubheader">The project that keeps on giving<br />
													 --------------------------------</h2>

						<p>The Elite project has grown rather a lot since then. It now covers seven distinct versions of the game, and each of these has its own repository containing the fully documented and buildable source code for that version. These repositories are still generated from the central library, which contains commented source code for all seven versions, and the Elite website not only contains source code for all seven versions, but it also contains indexes, cross-references and statistics for each of those versions, as well as a section that compares the main Acornsoft releases on a line-by-line basis, so you can see exactly what the differences are between the versions.</p>

						<p>To put this in context, at the time of writing (summer 2024), the <a href="https://elite.bbcelite.com">Elite site</a> contains 7,653 web pages. Of these, 171 are hand-crafted; this total includes over 100 deep dives, a hacks section, site information, the homepage and various pages describing the different versions of the game. The other 7,482 pages are generated by the first Python script that I originally knocked out in a hurry in September 2020, which still ingests the source code repositories to create the bulk of the website that you see today. The same script also produces the code sections of the <a href="https://aviator.bbcelite.com">Aviator</a>, <a href="https://revs.bbcelite.com">Revs</a> and <a href="https://lander.bbcelite.com">Lander</a> websites, taking the code from their respective source code repositories. Meanwhile, the second Python script that I wrote still creates the Elite source code repositories from the Elite library repository... but there are seven of them now, one for each version of Elite that I've analysed.</p>

						<p>You can find out how these two scripts work in the articles on <a href="generating_websites.html">generating websites from source code</a> and <a href="generating_elite.html">generating source code for Elite</a>, but before getting stuck into the code, it's worth taking an overview of how these scripts work together with the various repositories to create my disassembly websites.</p>

						<h2 class="articleSubheader">Generating websites from source code repositories<br />
													 -------------------------------------------------</h2>

						<p>First let's talk about how the simpler websites are generated, i.e. the sites for <a href="https://aviator.bbcelite.com">Aviator</a>, <a href="https://revs.bbcelite.com">Revs</a> and <a href="https://lander.bbcelite.com">Lander</a>.</p>

						<p>For each of these projects, I hand-built a repository containing the fully buildable and fully documented source code. These are those repositories:</p>

						<ul>
							<li><a href="https://github.com/markmoxon/aviator-beebasm">aviator-beebasm</a></li>

							<li><a href="https://github.com/markmoxon/revs-beebasm">revs-beebasm</a></li>

							<li><a href="https://github.com/markmoxon/archimedes-lander">archimedes-lander</a></li>
						</ul>

						<p>These repositories all have the same folder structure and a similar build process, though the Lander repository is in ARM assembly while Aviator and Revs are 6502 assembly. In terms of building the websites from the source, they all work in the same way, so let's look at on example: Aviator.</p>

						<p>The core script that creates my websites is <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/disassembly-website-generator/create-disassembly-websites.py">create-disassembly-websites.py</a>. This was the first script I wrote back in September 2020, and it shows; it has grown organically, shall we say, so don't expect beautiful code. It does work well, however.</p>

						<p>The script ingests the relevant source code repository - <a href="https://github.com/markmoxon/aviator-beebasm">aviator-beebasm</a> in the case of Aviator - and creates HTML pages that cover the entire source code, all cross-references and linked, and with popup information for every operand (i.e. variable, subroutine, constant and so on). The script also generates indexes to the source, plus a set of statistics broken down by category and type.</p>

						<p>The hand-crafted content on the Aviator site comes from the <a href="https://github.com/markmoxon/bbcelite-websites/">bbc-websites</a> repository, which covers the homepage, deep dives, site information and version pages. This gets combined with the output from the Python script, and the result is the <a href="https://aviator.bbcelite.com">complete Aviator website</a>.</p>

						<p>Here's a flowchart of how this works:</p>

<pre class="articleIndented">
          <a href="https://github.com/markmoxon/aviator-beebasm">aviator-beebasm</a>                               <a href="https://github.com/markmoxon/bbcelite-websites/">bbc-websites</a>
                |                                             |
                |                                             |
  <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/disassembly-website-generator/create-disassembly-websites.py">create-disassembly-websites.py</a>                              |
                |                                             |
                |                                             |
                |                                             |
  +-------------|-------- <a href="https://aviator.bbcelite.com/">aviator.bbcelite.com</a> website -------|-------------+
  |             |                                             |             |
  |             v                                             v             |
  |                                                                         |
  |         <a href="https://aviator.bbcelite.com/source/articles/map_of_the_source_code.html">Code pages</a>                                    <a href="https://aviator.bbcelite.com/">Homepage</a>          |
  |           <a href="https://aviator.bbcelite.com/source/indexes/a-z.html">Indexes</a>                                    <a href="https://aviator.bbcelite.com/about_site/quick_start_guide.html">About site</a>         |
  |         <a href="https://aviator.bbcelite.com/source/articles/source_code_statistics.html">Statistics</a>                                   <a href="https://aviator.bbcelite.com/deep_dives/">Deep dives</a>         |
  |                                                     <a href="https://aviator.bbcelite.com/source/">Version info</a>        |
  |                                                                         |
  +-------------------------------------------------------------------------+
</pre>

						<p>The exact same process builds the Revs and Lander websites, and you can read all about how the script works in the article on <a href="generating_websites.html">generating websites from source code</a>. The Elite site is rather more complicated, however, so let's look at that next.</p>

						<h2 class="articleSubheader">Generating source code repositories from the library<br />
													 ----------------------------------------------------</h2>

						<p>Things are rather more complicated for the Elite website. Not only is there an additional step - that of generating the source code repositories from the library repository - but there is an additional section that compares the code in the different Acornsoft versions, and that's automatically generated too.</p>

						<p>Here's the flowchart for the Elite site:</p>

<pre class="articleIndented">                +---- <a href="https://github.com/markmoxon/library-elite-beebasm">library-elite-beebasm</a> -----+             <a href="https://github.com/markmoxon/bbcelite-websites/">bbc-websites</a>
                |                                |                   |
                |                                |                   |
   <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/elite-repository-generator/create-elite-repositories.py">create-elite-repositories.py</a>                  |                   |
                |                                |                   |
                |                                |                   |
                v                                |                   |
       <a href="https://github.com/markmoxon/6502sp-elite-beebasm">6502sp-elite-beebasm</a>                      |                   |
      <a href="https://github.com/markmoxon/cassette-elite-beebasm">cassette-elite-beebasm</a>                     |                   |
        <a href="https://github.com/markmoxon/disc-elite-beebasm">disc-elite-beebasm</a>        <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/disassembly-website-generator/create-disassembly-websites.py">create-disassembly-websites.py</a>     |
       <a href="https://github.com/markmoxon/master-elite-beebasm">master-elite-beebasm</a>                      |                   |
      <a href="https://github.com/markmoxon/electron-elite-beebasm">electron-elite-beebasm</a>                     |                   |
        <a href="https://github.com/markmoxon/nes-elite-beebasm">nes-elite-beebasm</a>                        |                   |
         <a href="https://github.com/markmoxon/elite-a-beebasm">elite-a-beebasm</a>                         |                   |
                |                                |                   |
                |                                |                   |
  <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/disassembly-website-generator/create-disassembly-websites.py">create-disassembly-websites.py</a>                 |                   |
                |                                |                   |
                |                                |                   |
                |                                |                   |
  +-------------|-- <a href="https://elite.bbcelite.com/">elite.bbcelite.com</a> website --|-------------------|------+
  |             |                                |                   |      |
  |             |                                |                   v      |
  |             v                                |                          |
  |                                              v               <a href="https://elite.bbcelite.com/">Homepage</a>   |
  |         <a href="https://elite.bbcelite.com/cassette/articles/map_of_the_source_code.html">Code pages</a>                                          <a href="https://elite.bbcelite.com/about_site/quick_start_guide.html">About site</a>  |
  |           <a href="https://elite.bbcelite.com/cassette/indexes/a-z.html">Indexes</a>                     <a href="https://elite.bbcelite.com/compare/indexes/shared_code_standard.html">Code comparisons</a>      <a href="https://elite.bbcelite.com/deep_dives/">Deep dives</a>  |
  |         <a href="https://elite.bbcelite.com/cassette/articles/source_code_statistics.html">Statistics</a>                                             <a href="https://elite.bbcelite.com/hacks/">Hacks</a>    |
  |                                                            <a href="https://elite.bbcelite.com/cassette/">Version info</a> |
  |                                                            <a href="https://elite.bbcelite.com/compare/versions_of_elite.html">Compare info</a> |
  |                                                                         |
  +-------------------------------------------------------------------------+
</pre>

						<p>On the simpler Aviator website we looked at earlier, all of the website content comes from just two sources: the source code itself comes from the <a href="https://github.com/markmoxon/aviator-beebasm">aviator-beebasm</a> repository, while the static website content comes from the <a href="https://github.com/markmoxon/bbcelite-websites/">bbc-websites</a> repository. It's the same on the Elite website, except the source code comes from the <a href="https://github.com/markmoxon/library-elite-beebasm">library-elite-beebasm</a> repository.</p>

						<p>This library repository is different, though, as it contains source code for seven different versions of Elite, compared to just one version in the Aviator repository. The first step when building the Elite website is to run the second Python script that I wrote, <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/elite-repository-generator/create-elite-repositories.py">create-elite-repositories.py</a>, which takes the library repository and generates seven self-contained source code repositories, one for each version of Elite. These seven repositories can then be converted into websites by the same <a href="https://github.com/markmoxon/bbcelite-scripts/blob/main/disassembly-website-generator/create-disassembly-websites.py">create-disassembly-websites.py</a> script that we use to generate the sites for Aviator, Revs and Lander.</p>

						<p>The same script is also used to generate the comparison section of the Elite site. This compares the different versions of Elite in a side-by-side view, showing all the code differences between the five Acornsoft versions (the comparison section omits Elite-A and NES Elite; Elite-A uses a more suitable comment-based approach to highlight its variations from the original, and the NES version is just too different from the original versions to make a comparison useful). The script generates the comparison section directly from the library repository, as that's the library contains all the versions in one place.</p>

						<p>Finally, the generated content (all 7,482 pages of it) is merged with the 171 hand-crafted pages from the <a href="https://github.com/markmoxon/bbcelite-websites/">bbc-websites</a> repository, which contains the homepage, deep dives, site information, hacks section and version pages. The result is the <a href="https://elite.bbcelite.com">complete Elite website</a>... all 7,653 pages of it.</p>

						<h2 class="articleSubheader">What this means<br />
													 ---------------</h2>

						<p>The upshot of all of this scripting is that if I want to update a comment in the Elite source, I simply make the changes in one place in the library repository and then run the scripts. This process updates the comment in the source code repositories, as well as updating the comment wherever it appears in the website.</p>

						<p>As an example, consider the circle-drawing routine at <a href="https://elite.bbcelite.com/compare/main/subroutine/bline.html">BLINE</a>, which appears in every version of Elite with only minor differences. If I change a comment in this routine, then the scripts will update that comment in all seven source code repositories, and it will also update the comment on 17 different website pages, all automatically. (Specifically, it updates eight individual BLINE pages - one for each of the seven different versions plus an extra page for the disc version as it has both the docked and flight code - plus another eight occurrences in the full source code pages, plus one more occurrence in the comparison page.)</p>

						<p>To put it another way, without these scripts, then either this website would exist, or my sanity... but not both.</p>
					</div>
				</div>

				<div class="codeBlockWrapper nav">
					<nav class="codeBlock previousNext"><a class="next" rel="next" title="Next page" href="generating_websites.html">Generating websites from source code</a></nav>
				</div>
				<!-- End of article -->
			</article>

<?php
include_once("../templates_local/navigation.php");

?>
		</div>
	</body>
</html>
